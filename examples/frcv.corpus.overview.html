<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no"
        />
        <link rel="stylesheet" href="./dist/lotivis.css" />
        <link rel="stylesheet" href="./examples.css" />
        <title>FRCV - Search</title>
    </head>
    <body>
        <div class="ltv-container">
            <div class="row">
                <div class="col-2">
                    <a href="../index.html">
                        <a href="../index.html"> Back </a>
                    </a>
                    <button type="button" onclick="screenshot()">
                        Screenshot
                    </button>
                </div>
                <div class="col-8 text-center">
                    <h1>Corpus Data</h1>
                    <br />
                </div>
                <div id="DEBUG-ltv-url-DEBUG"></div>
                <div class="col-6">
                    <p>Bar</p>
                    <div id="bar-chart">
                        <!-- Bar Chart Here -->
                    </div>
                    <br />
                    <p>Plot</p>
                    <div id="plot-chart">
                        <!-- Plot Chart Here -->
                    </div>
                </div>
                <div class="col-6">
                    <p>Map</p>
                    <div id="map-chart">
                        <!-- Map Chart Here -->
                    </div>
                    <p>Data</p>
                    <!-- <div id="ltv-data"> -->
                    <!-- Map Chart Here -->
                    <!-- </div> -->
                </div>
            </div>
            <!-- Row -->
        </div>
        <!-- Container -->

        <script src="./dist/lotivis.js"></script>

        <script>
            // enable debug mode
            lotivis.debug(true);

            let bar = lotivis.bar().selector("#bar-chart");

            let map = lotivis
                .map()
                .selector("#map-chart")
                .exclude(["2A", "2B"])
                .featureIDAccessor((f) => "" + f.properties.code)
                .featureNameAccessor((f) => f.properties.nom);

            let plot = lotivis.plot().selector("#plot-chart");

            let datatext;

            Promise.all([
                lotivis.d3.json("./assets/departements.geojson"),
                lotivis.d3.json("./assets/corpus.overview.tracks.json"),
            ]).then(function (results) {
                let geoJSON = results[0];
                let dataController = lotivis.parseDataset(results[1]);

                map.geoJSON(geoJSON);

                bar.dataController(dataController).run();
                map.dataController(dataController).run();
                plot.dataController(dataController).run();

                // datatext = dataController.datatext("ltv-data");
            });

            function screenshot() {
                bar.pngDownload(() => {
                    map.pngDownload(() => {
                        plot.pngDownload(() => {
                            datatext.download();
                        });
                    });
                });
            }
        </script>
    </body>
</html>
