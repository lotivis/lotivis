{"version":3,"file":"lotivis.js","sources":["../src/js/shared/color.js","../src/js/shared/hash.js","../src/js/shared/selector.js","../src/js/data.juggle/data.validate.error.js","../src/js/shared.components/component.js","../src/js/shared.components/button.js","../src/js/shared.components/toast.js","../src/js/shared.components/option.js","../src/js/shared/config.js","../src/js/shared/debug.js","../src/js/chart/chart.js","../src/js/shared/copy.js","../src/js/shared/value.js","../src/js/data.juggle/data.combine.js","../src/js/data.juggle/data.sum.js","../src/js/data.date.assessor/date.assessor.js","../src/js/dataview/data.view.cache.js","../src/js/datasets.controller/datasets.controller.js","../src/js/chart/chart.datasets.js","../src/js/shared.components/card.js","../src/js/shared.components/checkbox.js","../src/js/shared.components/dropdown.js","../src/js/shared.components/popup.js","../src/js/shared.components/textarea.card.js","../src/js/dataview.card/updatable.dataview.card.js","../src/js/data.juggle/data.validate.js","../src/js/shared/equal.js","../src/js/dataview.card/editable.dataview.card.js","../src/js/shared/filename.js","../src/js/shared/screenshot.js","../src/js/shared/download.js","../src/js/dataview.card/data.json.card.js","../src/js/shared/csv.to.array.js","../src/js/shared/trim.js","../src/js/data.juggle/data.create.datasets.js","../src/js/data.parse/parse.csv.js","../src/js/data.juggle/data.flat.js","../src/js/data.render/render.csv.js","../src/js/dataview.card/data.csv.card.js","../src/js/data.parse/parse.csv.date.js","../src/js/data.juggle/data.extract.js","../src/js/data.juggle/data.relations.js","../src/js/data.render/render.csv.date.js","../src/js/dataview.card/data.csv.date.card.js","../src/js/dataview.card/dataview.card.js","../src/js/dataview.card/datasets.controller.card.js","../src/js/date.chart/date.chart.axis.renderer.js","../src/js/date.chart/time.chart.label.renderer.js","../src/js/date.chart/time.chart.legend.renderer.js","../src/js/date.chart/time.chart.bars.renderer.js","../src/js/date.chart/time.chart.hover.bars.renderer.js","../src/js/date.chart/time.chart.tooltip.renderer.js","../src/js/date.chart/time.chart.grid.renderer.js","../src/js/date.chart/time.chart.selection.renderer.js","../src/js/date.chart/date.chart.config.js","../src/js/date.chart/date.chart.js","../src/js/shared/url.parameters.js","../src/js/shared.components/settings.popup.js","../src/js/date.chart.card/date.chart.card.settings.popup.js","../src/js/shared.components/chart.card.js","../src/js/date.chart.card/date.chart.card.js","../src/js/geojson/remove.features.js","../src/js/shared/style.js","../src/js/shared/format.js","../src/js/map.chart/map.tooltip.renderer.js","../src/js/map.chart/map.legend.renderer.js","../src/js/map.chart/map.label.renderer.js","../src/js/map.chart/map.dataset.renderer.js","../src/js/map.chart/map.geojson.renderer.js","../src/js/geojson/join.features.js","../node_modules/topojson-client/src/identity.js","../node_modules/topojson-client/src/transform.js","../node_modules/topojson-client/src/bbox.js","../node_modules/topojson-client/src/reverse.js","../node_modules/topojson-client/src/feature.js","../node_modules/topojson-client/src/stitch.js","../node_modules/topojson-client/src/mesh.js","../node_modules/topojson-client/src/merge.js","../node_modules/topojson-client/src/bisect.js","../node_modules/topojson-client/src/neighbors.js","../node_modules/topojson-client/src/untransform.js","../node_modules/topojson-client/src/quantize.js","../src/js/map.chart/map.exterior.border.renderer.js","../src/js/geojson/create.geojson.js","../src/js/map.chart/map.chart.config.js","../src/js/map.chart/map.background.renderer.js","../src/js/geojson/geometry.js","../src/js/geojson/feature.js","../src/js/geojson/geojson.js","../src/js/map.chart/map.selection.renderer.js","../src/js/map.chart/map.chart.js","../src/js/map.chart.card/map.chart.settings.popup.js","../src/js/map.chart.card/map.chart.card.js","../src/js/datasets.controller/datasets.controller.cache.js","../src/js/dataview/dataview.plot.js","../src/js/plot.chart/plot.chart.config.js","../src/js/plot.chart/plot.axis.renderer.js","../src/js/plot.chart/plot.tooltip.renderer.js","../src/js/plot.chart/plot.label.renderer.js","../src/js/plot.chart/plot.grid.renderer.js","../src/js/plot.chart/plot.background.renderer.js","../src/js/plot.chart/plot.chart.hover.bars.renderer.js","../src/js/plot.chart/plot.bars.fractions.renderer.js","../src/js/plot.chart/plot.bars.gradient.creator.js","../src/js/plot.chart/plot.bars.gradient.renderer.js","../src/js/plot.chart/plot.labels.fractions.renderer.js","../src/js/plot.chart/plot.chart.selection.renderer.js","../src/js/plot.chart/plot.chart.js","../src/js/plot.chart.card/plot.chart.card.settings.popup.js","../src/js/plot.chart.card/plot.chart.card.js","../src/js/datasets.controller/datasets.controller.listeners.js","../src/js/datasets.controller/datasets.controller.filter.js","../src/js/datasets.controller/datasets.controller.colors.js","../src/js/datasets.controller/datasets.controller.snapshot.js","../src/js/datasets.controller/datasets.controller.data.js","../src/js/data.juggle/data.stacks.js","../src/js/shared/extension.array.js","../src/js/data.juggle/data.combine.ratio.js","../src/js/dataview/dataview.date.js","../src/js/dataview/dataview.date.combined.stacks.js","../src/js/dataview/dataview.location.js","../src/index.js"],"sourcesContent":["/**\n * Color defined by r,g,b.\n * @class Color\n */\nexport class Color {\n  /**\n   * Creates a new instance of Color.\n   * @param r The red value.\n   * @param g The green value.\n   * @param b The blue value.\n   */\n  constructor(r, g, b) {\n    if ((r || r === 0) && (g || g === 0) && (b || b === 0)) {\n      this.initialize(r, g, b);\n    } else if (typeof r === `object`) {\n      this.initialize(r.r, r.g, r.b);\n    } else if (r) {\n    } else if (r) {\n      this.initialize(r, r, r);\n    } else {\n      throw new Error(`Invalid argument: ${r}`);\n    }\n  }\n\n  initialize(r, g, b) {\n    this.r = Math.round(r);\n    this.g = Math.round(g);\n    this.b = Math.round(b);\n  }\n\n  rgbString() {\n    return `rgb(${this.r},${this.g},${this.b})`;\n  }\n\n  toString() {\n    return this.rgbString();\n  }\n\n  colorAdding(r, g, b) {\n    return new Color(this.r + r, this.g + g, this.b + b);\n  }\n\n  // MARK: - Statics\n\n  static mapColors(till) {\n    return d3\n      .scaleLinear()\n      .domain([0, (1 / 3) * till, (2 / 3) * till, till])\n      .range([\"yellow\", \"orange\", \"red\", \"purple\"]);\n  }\n\n  static plotColor(till) {\n    return Color.mapColors(till);\n    // return d3\n    //   .scaleLinear()\n    //   .domain([0, 1 / 2 * till, till])\n    //   .range(['lightgreen', 'steelblue', 'purple']);\n  }\n}\n\n/**\n * Returns a randomly generated shared.color.\n * @returns {[]}\n */\nColor.colorsForStack = function(stackNumber, amount = 1) {\n  let colorCouple = Color.stackColors[stackNumber % Color.stackColors.length];\n  let colorGenerator = d3\n    .scaleLinear()\n    .domain([0, amount])\n    .range([colorCouple[0], colorCouple[1]]);\n\n  let colors = [];\n  for (let i = 0; i < amount; i++) {\n    let color = colorGenerator(i);\n    colors.push(new Color(color));\n  }\n\n  return colors;\n};\n\n// MARK: - Defaults\n\nColor.defaultTint = new Color(0, 122, 255);\nColor.organgeLow = new Color(250, 211, 144);\nColor.organgeHigh = new Color(229, 142, 38);\nColor.redLow = new Color(248, 194, 145);\nColor.redHigh = new Color(183, 21, 64);\nColor.blueLow = new Color(106, 137, 204);\nColor.blueHigh = new Color(12, 36, 97);\nColor.lightBlueLow = new Color(130, 204, 221);\nColor.lightBlueHight = new Color(10, 61, 98);\nColor.greenLow = new Color(184, 233, 148);\nColor.greenHight = new Color(7, 153, 146);\nColor.stackColors = [\n  [Color.blueHigh, Color.blueLow],\n  [Color.redHigh, Color.redLow],\n  [Color.greenHight, Color.greenLow],\n  [Color.organgeHigh, Color.organgeLow],\n  [Color.lightBlueHight, Color.lightBlueLow]\n];\n","/**\n * Returns the hash of the given string.\n * @param aString The string to create the hash of.\n * @returns {number} The hash of the given string.\n */\nexport function hashCode(aString) {\n  let hash = 0, i, chr;\n  for (i = 0; i < aString.length; i++) {\n    chr = aString.charCodeAt(i);\n    hash = ((hash << 5) - hash) + chr;\n    hash |= 0; // Convert to 32bit integer\n  }\n  return hash;\n}\n","import {hashCode} from \"./hash\";\n\n/**\n * Creates and returns a unique ID.\n */\nexport var createID;\n(function () {\n  let uniquePrevious = 0;\n  createID = function () {\n    return 'lotivis-id-' + uniquePrevious++;\n  };\n}());\n\n/**\n * Returns a 'save-to-use' id for a HTML element by replacing whitespace with dashes.\n *\n * @param theID The id for a HTML element.\n *\n * @returns {string} The save version of the given id.\n */\nexport function toSaveID(theID) {\n  return theID\n    .split(` `).join(`-`)\n    .split(`/`).join(`-`)\n    .split(`.`).join(`-`);\n}\n\n/**\n * Creates and returns a unique (save to use for elements) id.  The id is created by calculating the hash of the\n * dataset's label.\n *\n * @param dataset The dataset.\n *\n * @returns {number} The created id.\n */\nexport function createIDFromDataset(dataset) {\n  if (!dataset || !dataset.label) return 0;\n  return hashCode(dataset.label);\n}\n\nexport function camel2title(camelCase) {\n  // no side-effects\n  return camelCase\n    // inject space before the upper case letters\n    .replace(/([A-Z])/g, function (match) {\n      return \" \" + match;\n    })\n    // replace first char with upper case\n    .replace(/^./, function (match) {\n      return match.toUpperCase();\n    });\n}\n","export class LotivisError extends Error {\n  constructor(message) {\n    super(message);\n    this.name = this.constructor.name;\n  }\n}\n\nexport class LotivisElementNotFoundError extends LotivisError {\n  constructor(selector) {\n    super(`Can't find an element with ID '${selector}'.`);\n  }\n}\n\nexport class DataValidateError extends LotivisError {\n  // constructor(message) {\n  //   super(message);\n  // }\n}\n\nexport class MissingPropertyError extends DataValidateError {\n  constructor(message, data) {\n    super(message + ' ' + JSON.stringify(data || {}));\n    this.data = data;\n  }\n}\n\nexport class InvalidFormatError extends DataValidateError {\n  // constructor(message) {\n  //   super(message);\n  // }\n}\n\nexport class GeoJSONValidateError extends LotivisError {\n  // constructor(message) {\n  //   super(message);\n  // }\n}\n\nexport class LotivisUnimplementedMethodError extends LotivisError {\n  constructor(functionName) {\n    super(`Subclasses must override function '${functionName}'.`);\n  }\n}\n\nexports.LotivisError = LotivisError;\nexports.DataValidateError = DataValidateError;\nexports.MissingPropertyError = MissingPropertyError;\nexports.InvalidFormatError = InvalidFormatError;\nexports.GeoJSONValidateError = GeoJSONValidateError;\nexports.LotivisUnimplementedMethodError = LotivisUnimplementedMethodError;\n","import { camel2title, createID } from \"../shared/selector\";\nimport {\n  LotivisError,\n  LotivisElementNotFoundError\n} from \"../data.juggle/data.validate.error\";\n\n/**\n * A lotivis component.\n *\n * @class Component\n */\nexport class Component {\n  /**\n   * Creates a new instance of Component.\n   * @param {Component|string|{}} parent The parental component or selector.\n   */\n  constructor(parent) {\n    if (!parent) throw new LotivisError(\"No parent or selector specified.\");\n    if (Object.getPrototypeOf(parent) === String.prototype) {\n      this.initializeFromSelector(parent);\n    } else if (Object.getPrototypeOf(parent) === Object.prototype) {\n      this.initializeFromConfig(parent);\n    } else {\n      this.initializeFromParent(parent);\n    }\n    this.element = undefined;\n  }\n\n  /**\n   * Initializes this component from the given selector string.\n   * @param selector The selector of the parental\n   */\n  initializeFromSelector(selector) {\n    this.selector = selector;\n    this.parent = d3.select(\"#\" + selector);\n    if (this.parent.empty()) throw new LotivisElementNotFoundError(selector);\n  }\n\n  initializeFromConfig(config) {\n    this.config = config;\n    if (config.selector) {\n      this.initializeFromSelector(config.selector);\n    } else {\n      let selector = camel2title(this.constructor.name)\n        .toLowerCase()\n        .trim()\n        .split(` `)\n        .join(`-`);\n\n      this.initializeFromSelector(selector);\n    }\n  }\n\n  initializeFromParent(parent) {\n    this.selector = createID();\n    this.parent = parent;\n  }\n\n  // MARK: - Functions\n\n  show() {\n    if (!this.element) return;\n    this.element.style(\"display\", \"\");\n    return this;\n  }\n\n  hide() {\n    if (!this.element) return;\n    this.element.style(\"display\", \"none\");\n    return this;\n  }\n\n  get isVisible() {\n    if (!this.element) return false;\n    return this.element.style(\"display\") !== \"none\";\n  }\n\n  getElementEffectiveSize() {\n    if (!this.element) return [0, 0];\n    let width = this.element.style(\"width\").replace(\"px\", \"\");\n    let height = this.element.style(\"height\").replace(\"px\", \"\");\n    return [Number(width), Number(height)];\n  }\n\n  getElementPosition() {\n    let element = document.getElementById(this.selector);\n    if (!element) return [0, 0];\n    let rect = element.getBoundingClientRect();\n    let xPosition = rect.x + window.scrollX;\n    let yPosition = rect.y + window.scrollY;\n    return [xPosition, yPosition];\n  }\n\n  /**\n   * Returns a string representation of this Component.\n   * @returns {string} A string representing this Component.\n   */\n  toString() {\n    let components = [this.constructor.name];\n    if (this.selector) components.push(`'${this.selector}'`);\n    return `[${components.join(\" \")}]`;\n  }\n\n  /**\n   * Returns the name of the constructor of this component if present. Will return the result of `typeof` else.\n   * @returns {*|\"undefined\"|\"object\"|\"boolean\"|\"number\"|\"string\"|\"function\"|\"symbol\"|\"bigint\"}\n   */\n  getClassname() {\n    if (!this.constructor || !this.constructor.name) return typeof this;\n    return this.constructor.name;\n  }\n}\n","import { Component } from \"./component\";\n\n/**\n * A button\n *\n * @class Button\n * @extends Component\n */\nexport class Button extends Component {\n  /**\n   * Creates an instance of Button.\n   *\n   * @constructor\n   * @param {Component} parent The parental component.\n   * @param style The style of the button.  One of default|back|forward\n   */\n  constructor(parent, style = \"default\") {\n    super(parent);\n\n    this.element = parent\n      .append(\"button\")\n      .attr(\"id\", this.selector)\n      .attr(\"class\", \"ltv-button\")\n      .on(\n        \"click\",\n        function(event) {\n          if (!this.onClick) return;\n          this.onClick(event);\n        }.bind(this)\n      );\n  }\n\n  /**\n   * Sets the text of the button.\n   * @param text The text of the button.\n   */\n  setText(text) {\n    this.element.text(text);\n  }\n\n  onClick(event) {\n    // empty\n  }\n}\n","import { Component } from \"./component\";\nimport { Button } from \"./button\";\n\n/**\n * A toast in the top of the page.\n *\n * @class Toast\n * @extends Component\n */\nexport class Toast extends Component {\n  /**\n   * Creates a new instance of Toast.\n   * @constructor\n   * @param {Component} parent The parental component.\n   */\n  constructor(parent) {\n    super(parent);\n    this.element = this.parent\n      .append(\"div\")\n      .attr(\"class\", \"lotivis-data-card-status-tooltip\")\n      .style(\"opacity\", 0)\n      .style(\"display\", `none`);\n    this.row = this.element.append(\"div\").attr(\"class\", \"row\");\n    this.leftComponnt = this.row.append(\"div\").attr(\"class\", \"col-6\");\n    this.rightComponent = this.row.append(\"div\").attr(\"class\", \"col-6\");\n    this.hideButton = new Button(this.rightComponent).setText(`Hello`);\n  }\n\n  /**\n   * Shows the toast.\n   * @override\n   */\n  show() {\n    super.show();\n    this.element.style(\"opacity\", 1);\n    return this;\n  }\n\n  /**\n   * Hides the toast.\n   * @override\n   */\n  hide() {\n    super.hide();\n    this.element.style(\"opacity\", 0);\n  }\n\n  /**\n   * Sets the text of the Toast.\n   * @param text The text of the Toast.\n   */\n  setText(text) {\n    this.element.text(text);\n  }\n\n  /**\n   * Sets the text of the status label.  If text is empty the status label will be hide.\n   * @param newStatusMessage The new status message.\n   */\n  setStatusMessage(newStatusMessage) {\n    let saveString = String(newStatusMessage || \"\").trim();\n    this.element.text(saveString);\n    if (saveString) {\n      this.show();\n    } else {\n      this.hide();\n    }\n  }\n}\n","import {toSaveID} from \"../shared/selector\";\n\n/**\n * Represents an option of a dropdown or radio group.\n * @class Option\n */\nexport class Option {\n\n  /**\n   * Creates a new instance of Option.\n   * @param title The title of the option.\n   */\n  constructor(title) {\n    this.title = title;\n    this.id = toSaveID(title);\n  }\n}\n","export const LotivisConfig = {\n  // The default margin to use for charts.\n  defaultMargin: 60,\n  // The default offset for the space between an object an the toolbar.\n  tooltipOffset: 7,\n  // The default radius to use for bars drawn on a chart.\n  barRadius: 5,\n  // A Boolean value indicating whether the debug logging is enabled.\n  debugLog: false,\n  // A Boolean value indicating whether the debug logging is enabled.\n  debug: true,\n  // A string which is used as prefix for download.\n  downloadFilePrefix: 'lotivis',\n  // A string which is used as separator between shared.components when creating a file name.\n  filenameSeparator: '_',\n  // A string which is used for unknown values.\n  unknown: 'LOTIVIS_UNKNOWN'\n};\n","import {LotivisConfig} from \"./config\";\n\n/**\n * A collection of messages which already hast been printed.\n * @type {*[]}\n */\nlet alreadyLogged = [];\n\nexport var lotivis_log_once = function (message) {\n  if (alreadyLogged.includes(message)) return;\n  alreadyLogged.push(message);\n  console.warn(`[lotivis]  Warning only once: ${message}`);\n};\n\nexport var lotivis_log = () => null;\n\n/**\n * Sets whether lotivis prints debug log messages to the console.\n * @param enabled A Boolean value indicating whether to enable debug logging.\n * @param printConfig A Boolean value indicating whether to print the global lotivis configuration.  Default is false.\n */\nexport function debug(enabled, printConfig = false) {\n  lotivis_log = enabled ? console.log : () => null;\n  lotivis_log(`[lotivis]  ${enabled ? 'En' : 'Dis'}abled debug mode.`);\n  if (!printConfig) return;\n  lotivis_log(`LotivisConfig = ${JSON.stringify(LotivisConfig, null, 2)}`);\n}\n","import { Component } from \"../shared.components/component\";\nimport { createID } from \"../shared/selector\";\nimport { LotivisUnimplementedMethodError } from \"../data.juggle/data.validate.error\";\nimport { lotivis_log } from \"../shared/debug\";\n\n/**\n * Superclass for lotivis charts.\n * @class Chart\n * @extends Component\n * @see DateChart\n * @see MapChart\n * @see PlotChart\n */\nexport class Chart extends Component {\n  /**\n   * Creates an instance of DiachronicChart.\n   * @constructor\n   * @param {Component} parent The parental component.\n   * @param config The configuration of the chart.\n   */\n  constructor(parent, config) {\n    super(parent);\n\n    this.svgSelector = (this.selector || createID()) + \"-svg\";\n    this.element = this.parent;\n    this.element.attr(\"id\", this.selector);\n    this.config = config || {};\n    this.updateSensible = true;\n    this.initialize();\n\n    if (this.config.datasets) {\n      this.setDatasets(this.config.datasets);\n    } else {\n      this.update();\n    }\n  }\n\n  /**\n   * Initializes this chart.\n   */\n  initialize() {\n    return new LotivisUnimplementedMethodError(`initialize()`);\n  }\n\n  /**\n   * Updates the content of this chart by calling the 'update'-chain:\n   *\n   * ```\n   * remove();\n   * precalculate();\n   * draw();\n   * ```\n   */\n  update(datasetsController, reason) {\n    lotivis_log(\"[lotivis] \", this.constructor.name, \"update\", reason);\n    if (!this.updateSensible) return;\n    if (datasetsController) {\n      this.snapshot = datasetsController.snapshot;\n    }\n    lotivis_log(\n      \"[lotivis] \",\n      this.constructor.name,\n      \"update\",\n      datasetsController\n    );\n    lotivis_log(\"[lotivis] \", this.constructor.name, \"update\", this.snapshot);\n    this.remove();\n    this.precalculate();\n    this.draw();\n  }\n\n  /**\n   * Removes any old content from this chart.\n   * @returns {LotivisUnimplementedMethodError}\n   */\n  remove() {\n    throw new LotivisUnimplementedMethodError(`remove()`);\n  }\n\n  /**\n   * Precalculates data for this chart.\n   * @returns {LotivisUnimplementedMethodError}\n   */\n  precalculate() {\n    throw new LotivisUnimplementedMethodError(`precalculate()`);\n  }\n\n  /**\n   * Appends / draw the shared.components of this chart.\n   * @returns {LotivisUnimplementedMethodError}\n   */\n  draw() {\n    throw new LotivisUnimplementedMethodError(`draw()`);\n  }\n\n  /**\n   * Tells this chart to ignore updates of a datasets controller.\n   */\n  makeUpdateInsensible() {\n    this.updateSensible = false;\n  }\n\n  /**\n   * Tells this chart to listen to update of a datasets controller.\n   */\n  makeUpdateSensible() {\n    this.updateSensible = true;\n  }\n}\n","/**\n * Returns a copy of the passed object.  The copy is created by using the\n * JSON's `parse` and `stringify` functions.\n * @param object The java script object to copy.\n * @returns {any} The copy of the object.\n */\nexport function copy(object) {\n  return JSON.parse(JSON.stringify(object));\n}\n","import {LotivisConfig} from \"./config\";\n\n/**\n * Returns `true` if the given value not evaluates to false and is not 0. false else.\n * @param value The value to check.\n * @returns {boolean} A Boolean value indicating whether the given value is valid.\n */\nexport function isValue(value) {\n  return Boolean(value || value === 0);\n}\n\n/**\n * Returns the value if it evaluates to true or is 0.  Returns `GlobalConfig.unknown` else.\n * @param value The value to check.\n * @returns The value or `GlobalConfig.unknown`.\n */\nexport function toValue(value) {\n  return value || (value === 0 ? 0 : LotivisConfig.unknown);\n}\n","import {copy} from \"../shared/copy\";\nimport {isValue} from \"../shared/value\";\n\n/**\n *\n * @param flattenList\n * @returns {[]}\n */\nexport function combine(flattenList) {\n  let combined = [];\n  let copiedList = copy(flattenList);\n  for (let index = 0; index < copiedList.length; index++) {\n    let listItem = copiedList[index];\n    let entry = combined.find(function (entryItem) {\n      return entryItem.dataset === listItem.dataset\n        && entryItem.stack === listItem.stack\n        && entryItem.label === listItem.label\n        && entryItem.location === listItem.location\n        && entryItem.date === listItem.date;\n    });\n    if (entry) {\n      entry.value += (listItem.value + 0);\n    } else {\n      let entry = {};\n      if (isValue(listItem.label)) entry.label = listItem.label;\n      if (isValue(listItem.dataset)) entry.dataset = listItem.dataset;\n      if (isValue(listItem.stack)) entry.stack = listItem.stack;\n      if (isValue(listItem.location)) entry.location = listItem.location;\n      if (isValue(listItem.locationTotal)) entry.locationTotal = listItem.locationTotal;\n      if (isValue(listItem.date)) entry.date = listItem.date;\n      if (isValue(listItem.dateTotal)) entry.dateTotal = listItem.dateTotal;\n      if (isValue(listItem.locationName)) entry.locationName = listItem.locationName;\n      entry.value = (listItem.value || 0);\n      combined.push(entry);\n    }\n  }\n  return combined;\n}\n\n/**\n * Returns\n *\n * @param flattenList\n * @returns {[]}\n */\nexport function combineByStacks(flattenList) {\n  let combined = [];\n  for (let index = 0; index < flattenList.length; index++) {\n    let listItem = flattenList[index];\n\n    let entry = combined.find(function (entryItem) {\n      return entryItem.stack === listItem.stack\n        && entryItem.location === listItem.location\n        && entryItem.date === listItem.date;\n    });\n\n    if (entry) {\n      entry.value += (listItem.value + 0);\n    } else {\n      let entry = {};\n      if (isValue(listItem.label)) entry.label = listItem.label;\n      if (isValue(listItem.dataset)) entry.dataset = listItem.dataset;\n      if (isValue(listItem.stack)) entry.stack = listItem.stack;\n      if (isValue(listItem.location)) entry.location = listItem.location;\n      if (isValue(listItem.locationTotal)) entry.locationTotal = listItem.locationTotal;\n      if (isValue(listItem.date)) entry.date = listItem.date;\n      if (isValue(listItem.dateTotal)) entry.dateTotal = listItem.dateTotal;\n      if (isValue(listItem.locationName)) entry.locationName = listItem.locationName;\n      entry.value = (listItem.value || 0);\n      combined.push(entry);\n    }\n  }\n  return combined;\n}\n\n/**\n *\n * @param flatData\n * @returns {[]}\n */\nexport function combineByDate(flatData) {\n  let combined = [];\n  for (let index = 0; index < flatData.length; index++) {\n    let listItem = flatData[index];\n    let entry = combined.find(function (entryItem) {\n      return entryItem.dataset === listItem.dataset\n        && entryItem.stack === listItem.stack\n        && entryItem.label === listItem.label\n        && entryItem.date === listItem.date;\n    });\n    if (entry) {\n      entry.value += (listItem.value + 0);\n    } else {\n      let entry = {};\n      if (isValue(listItem.label)) entry.label = listItem.label;\n      if (isValue(listItem.dataset)) entry.dataset = listItem.dataset;\n      if (isValue(listItem.stack)) entry.stack = listItem.stack;\n      if (isValue(listItem.date)) entry.date = listItem.date;\n      if (isValue(listItem.dateTotal)) entry.dateTotal = listItem.dateTotal;\n      entry.value = (listItem.value || 0);\n      combined.push(entry);\n    }\n  }\n  return combined;\n}\n\n/**\n *\n * @param flatData\n * @returns {[]}\n */\nexport function combineByLocation(flatData) {\n  let combined = [];\n  for (let index = 0; index < flatData.length; index++) {\n    let listItem = flatData[index];\n    let entry = combined.find(function (entryItem) {\n      return entryItem.dataset === listItem.dataset\n        && entryItem.stack === listItem.stack\n        && entryItem.label === listItem.label\n        && entryItem.location === listItem.location;\n    });\n    if (entry) {\n      entry.value += listItem.value;\n    } else {\n      let entry = {};\n      if (isValue(listItem.label)) entry.label = listItem.label;\n      if (isValue(listItem.dataset)) entry.dataset = listItem.dataset;\n      if (isValue(listItem.stack)) entry.stack = listItem.stack;\n      if (isValue(listItem.location)) entry.location = listItem.location;\n      if (isValue(listItem.locationTotal)) entry.locationTotal = listItem.locationTotal;\n      if (isValue(listItem.locationName)) entry.locationName = listItem.locationName;\n      entry.value = listItem.value;\n      combined.push(entry);\n    }\n  }\n  return combined;\n}\n","/**\n * Returns the sum of samples values for the given dataset.\n *\n * @param flatData The flat samples array.\n * @param dataset The dataset name.\n * @returns {*} The sum.\n */\nexport function sumOfDataset(flatData, dataset) {\n  return sumOfValues(flatData.filter(item => item.dataset === dataset));\n}\n\n/**\n * Returns the sum of samples values for the given label.\n *\n * @param flatData The flat samples array.\n * @param label The label.\n * @returns {*} The sum.\n */\nexport function sumOfLabel(flatData, label) {\n  return sumOfValues(flatData.filter(item => item.label === label));\n}\n\n/**\n * Returns the sum of samples values for the given stack.\n *\n * @param flatData The flat samples array.\n * @param stack The stack name.\n * @returns {*} The sum.\n */\nexport function sumOfStack(flatData, stack) {\n  return sumOfValues(flatData.filter(item => item.stack === stack));\n}\n\n/**\n * Returns the sum of the value properties of each item.\n *\n * @param flatData\n * @returns {*}\n */\nexport function sumOfValues(flatData) {\n  return flatData.map(item => +(item.value || 0)).reduce((acc, next) => acc + next, 0);\n}\n","import {lotivis_log_once} from \"../shared/debug\";\n\n/**\n *\n * @param date\n * @constructor\n */\nexport const DefaultDateAccess = (date) => date;\n\n/**\n *\n * @param dateString\n * @returns {number}\n * @constructor\n */\nexport const FormattedDateAccess = function (dateString) {\n  let value = Date.parse(dateString);\n  if (isNaN(value)) {\n    lotivis_log_once(`Received NaN for date \"${dateString}\"`);\n  }\n  return value;\n};\n\n/**\n *\n * @param dateString\n *\n * @returns {number}\n *\n * @constructor\n */\nexport const DateGermanAssessor = function (dateString) {\n  let saveDateString = String(dateString);\n  let components = saveDateString.split('.');\n  let day = components[0];\n  let month = components[1];\n  let year = components[2];\n  let date = new Date(`${year}-${month}-${day}`);\n  return Number(date);\n};\n\n/**\n *\n * @param weekday\n * @returns {number}\n * @constructor\n */\nexport const DateWeekAssessor = function (weekday) {\n  let lowercase = weekday.toLowerCase();\n  switch (lowercase) {\n    case 'sunday':\n    case 'sun':\n      return 0;\n    case 'monday':\n    case 'mon':\n      return 1;\n    case 'tuesday':\n    case 'tue':\n      return 2;\n    case 'wednesday':\n    case 'wed':\n      return 3;\n    case 'thursday':\n    case 'thr':\n      return 4;\n    case 'friday':\n    case 'fri':\n      return 5;\n    case 'saturday':\n    case 'sat':\n      return 6;\n    default:\n      return -1;\n  }\n};\n","/**\n * @class DataViewCache\n */\nexport class DataViewCache {\n\n  /**\n   * Creates a new instance of DataViewCache.\n   */\n  constructor() {\n    let content = {};\n\n    /**\n     * Creates an identifier for a cached data view with the given parameters.\n     * @param type The type of the graph.\n     * @param locationFilters The collection of filtered locations.\n     * @param dateFilters The collection of filtered dates.\n     * @param datasetFilters The collection of filtered datasets.\n     * @returns {*}\n     */\n    function createName(type, locationFilters, dateFilters, datasetFilters) {\n      return type + locationFilters + dateFilters + datasetFilters;\n    }\n\n    /**\n     * Returns the cached data view for the given parameters.\n     * @param type The type of the graph.\n     * @param locationFilters The collection of filtered locations.\n     * @param dateFilters The collection of filtered dates.\n     * @param datasetFilters The collection of filtered datasets.\n     * @returns {*}\n     */\n    this.getDataView = function (type, locationFilters, dateFilters, datasetFilters) {\n      let name = createName(type, locationFilters, dateFilters, datasetFilters);\n      return content[name];\n    };\n\n    /**\n     * Inserts the given data view into the cache for the given parameters.\n     * @param dataView The data view to cache.\n     * @param type The type of the graph.\n     * @param locationFilters The collection of filtered locations.\n     * @param dateFilters The collection of filtered dates.\n     * @param datasetFilters The collection of filtered datasets.\n     */\n    this.setDataView = function (dataView, type, locationFilters, dateFilters, datasetFilters) {\n      let name = createName(type, locationFilters, dateFilters, datasetFilters);\n      content[name] = dataView;\n    };\n\n    /**\n     * Invalidates the cache.\n     */\n    this.invalidate = function () {\n      content = {};\n    };\n  }\n}\n","import {combineByDate, combineByLocation, combineByStacks} from \"../data.juggle/data.combine\";\nimport {sumOfDataset, sumOfLabel, sumOfStack} from \"../data.juggle/data.sum\";\nimport {DefaultDateAccess} from \"../data.date.assessor/date.assessor\";\nimport {InvalidFormatError} from \"../data.juggle/data.validate.error\";\nimport {DataViewCache} from \"../dataview/data.view.cache\";\n\n/**\n * Controls a collection of datasets.\n * @class DatasetsController\n */\nexport class DatasetsController {\n\n  /**\n   * Creates a new instance of DatasetsController\n   * @param datasets The datasets to control.\n   * @param config\n   */\n  constructor(datasets, config) {\n    if (!Array.isArray(datasets)) {\n      throw new InvalidFormatError(`Datasets are not an array.`);\n    }\n    this.initialize(config || {});\n    this.setDatasets(datasets);\n  }\n\n  initialize(config) {\n    this.config = config;\n    this.dateAccess = this.config.dateAccess || DefaultDateAccess;\n    this.filters = {};\n    this.cache = new DataViewCache();\n    if (this.config.filters) {\n      this.filters.locations = this.config.filters.locations || [];\n      this.filters.dates = this.config.filters.dates || [];\n      this.filters.labels = this.config.filters.labels || [];\n    } else {\n      this.filters.locations = [];\n      this.filters.dates = [];\n      this.filters.labels = [];\n    }\n  }\n\n  getFlatDataCombinedStacks() {\n    return combineByStacks(this.flatData);\n  }\n\n  getFlatDataCombinedDates() {\n    return combineByDate(this.flatData);\n  }\n\n  getFlatDataCombinedLocations() {\n    return combineByLocation(this.flatData);\n  }\n\n  getSumOfLabel(label) {\n    return sumOfLabel(this.flatData, label);\n  }\n\n  getSumOfDataset(dataset) {\n    return sumOfDataset(this.flatData, dataset);\n  }\n\n  getSumOfStack(stack) {\n    return sumOfStack(this.flatData, stack);\n  }\n\n  getMax() {\n    return d3.max(this.datasets, function (dataset) {\n      return d3.max(dataset.data, function (item) {\n        return item.value;\n      });\n    });\n  }\n\n  // MARK: - Colors\n\n  getColorForDataset(label) {\n    return this.datasetsColorsController.colorForDataset(label);\n  }\n\n  getColorForStack(stack) {\n    return this.datasetsColorsController.colorForStack(stack);\n  }\n\n  getColorsForStack(stack) {\n    return this.datasetsColorsController.colorsForStack(stack);\n  }\n\n  /**\n   * Returns a string that can be used as filename for downloads.\n   */\n  getFilename() {\n    if (!this.labels) return 'Unknown';\n    let labels = this.labels.map(label => label.split(` `).join(`-`));\n    if (labels.length > 10) {\n      labels = labels.splice(0, 10);\n    }\n    return labels.join(',');\n  }\n}\n","import {Chart} from \"./chart\";\nimport {DatasetsController} from \"../datasets.controller/datasets.controller\";\n\n/**\n * Sets a new datasets controller.  The chart is updated automatically.\n * @param newController The new datasets controller.\n */\nChart.prototype.setDatasetsController = function (newController) {\n  if (this.datasetController) this.datasetController.removeListener(this);\n  this.datasetController = newController;\n  this.datasetController.addListener(this);\n  this.update(newController, 'registration');\n};\n\n/**\n * Sets the datasets of this map.chart chart.\n * @param newDatasets The new dataset.\n */\nChart.prototype.setDatasets = function (newDatasets) {\n  this.setDatasetsController(new DatasetsController(newDatasets));\n};\n\n/**\n * Returns the presented datasets.\n * @returns {[*]} The collection of datasets.\n */\nChart.prototype.getDatasets = function () {\n  if (!this.datasetController || !Array.isArray(this.datasetController.datasets)) return [];\n  return this.datasetController.datasets;\n};\n","import { Component } from \"./component\";\n\n/**\n * A lotivis card.\n * @class Card\n * @extends Component\n */\nexport class Card extends Component {\n  /**\n   * Creates a new instance of Card.\n   * @param parent The parental component.\n   */\n  constructor(parent) {\n    super(parent);\n    this.injectCard();\n    this.injectHeader();\n    this.injectBody();\n  }\n\n  /**\n   * Appends the card element.\n   */\n  injectCard() {\n    this.element = this.parent.append(\"div\").classed(\"ltv-card\", true);\n  }\n\n  /**\n   * Appends the header of the card.\n   */\n  injectHeader() {\n    this.header = this.element.append(\"div\").attr(\"class\", \"ltv-card-header\");\n    this.headerLeftComponent = this.header\n      .append(\"div\")\n      .attr(\"class\", \"ltv-left\");\n    this.headerCenterComponent = this.header\n      .append(\"div\")\n      .attr(\"class\", \"ltv-center\");\n    this.headerRightComponent = this.header\n      .append(\"div\")\n      .attr(\"class\", \"ltv-right ltv-button-group\");\n    this.titleLabel = this.headerLeftComponent\n      .append(\"div\")\n      .attr(\"class\", \"ltv-title-label\");\n  }\n\n  /**\n   * Appends the body of the card.\n   */\n  injectBody() {\n    this.body = this.element.append(\"div\").attr(\"class\", \"ltv-card-body\");\n    this.content = this.body.append(\"div\").attr(\"class\", \"ltv-card-body\");\n  }\n\n  /**\n   * Sets the text of the title label.\n   * @param newTitle The text of the title label.\n   */\n  setTitle(newTitle) {\n    this.titleLabel.text(newTitle);\n  }\n\n  /**\n   * Shows the footer by resetting its style display value.\n   */\n  showFooter() {\n    this.footer.style(\"display\", \"\");\n  }\n\n  /**\n   * Hides the footer by setting its style display value to `none`.\n   */\n  hideFooter() {\n    this.footer.style(\"display\", \"none\");\n  }\n}\n","import { Component } from \"./component\";\n\nexport class Checkbox extends Component {\n  constructor(parent) {\n    super(parent);\n    this.renderInput();\n    this.renderLabel();\n  }\n\n  // MARK: - Life Cycle\n  renderInput() {\n    let thisReference = this;\n    this.element = this.parent\n      .classed(\"radio-group\", true)\n      .append(\"input\")\n      .attr(\"type\", \"checkbox\")\n      .attr(\"id\", this.selector)\n      .on(\"click\", function(event) {\n        if (!event.target) {\n          return;\n        }\n        let checkbox = event.target;\n        if (thisReference.onClick) {\n          thisReference.onClick(checkbox.checked);\n        }\n      });\n  }\n\n  renderLabel() {\n    this.label = this.parent\n      .append(\"label\")\n      .attr(\"for\", this.selector)\n      .text(\"Unknown\");\n  }\n\n  // MARK: - Functions\n  setText(text) {\n    this.label.text(text);\n    return this;\n  }\n\n  setChecked(checked) {\n    this.element.attr(\"checked\", checked === true ? checked : null);\n    return this;\n  }\n\n  onClick(checked) {\n    // empty\n    console.log(\"onClick: \" + checked);\n  }\n\n  enable() {\n    this.element.attr(\"disabled\", null);\n    this.label.style(\"color\", \"black\");\n  }\n\n  disable() {\n    this.element.attr(\"disabled\", true);\n    this.label.style(\"color\", \"gray\");\n  }\n}\n","import { Component } from \"./component\";\nimport { createID } from \"../shared/selector\";\n\n/**\n *\n * @class Dropdown\n * @extends Component\n */\nexport class Dropdown extends Component {\n  /**\n   * Creates a new instance of Dropdown.\n   * @param parent The parent or selector.\n   */\n  constructor(parent) {\n    super(parent);\n    this.inputElements = [];\n    this.selector = createID();\n    this.element = parent\n      .append(\"div\")\n      .classed(\"lotivis-dropdown-container\", true);\n    this.selectId = createID();\n    this.renderLabel();\n    this.renderSelect();\n    this.hide();\n  }\n\n  renderLabel() {\n    this.label = this.element\n      .append(\"label\")\n      .classed(\"lotivis-dropdown-label\", true)\n      .attr(\"for\", this.selectId);\n  }\n\n  renderSelect() {\n    let thisReference = this;\n    this.select = this.element\n      .append(\"select\")\n      .attr(\"id\", this.selectId)\n      .on(\"change\", function(event) {\n        thisReference.onClick(event);\n      });\n  }\n\n  addOption(optionId, optionName) {\n    return this.select\n      .append(\"option\")\n      .attr(\"id\", optionId)\n      .attr(\"value\", optionId)\n      .text(optionName);\n  }\n\n  setOptions(options) {\n    this.removeAllInputs();\n    for (let i = 0; i < options.length; i++) {\n      let id, name;\n\n      if (Array.isArray(options[i])) {\n        id = options[i][0] || options[i].id;\n        name = options[i][1] || options[i].translatedTitle;\n      } else if (typeof options[i] === \"string\") {\n        id = options[i];\n        name = options[i];\n      } else {\n        id = options[i].id;\n        name = options[i].title;\n      }\n\n      let inputElement = this.addOption(name, name);\n      this.inputElements.push(inputElement);\n    }\n\n    if (options.length === 0) {\n      this.hide();\n    } else {\n      this.show();\n    }\n\n    return this;\n  }\n\n  removeAllInputs() {\n    this.element.selectAll(\"input\").remove();\n    return this;\n  }\n\n  onClick(event) {\n    let element = event.target;\n    if (!element) {\n      return;\n    }\n    let value = element.value;\n    if (!this.onChange) {\n      return;\n    }\n    this.onChange(value);\n    return this;\n  }\n\n  onChange(argument) {\n    console.log(\"argument: \" + argument);\n    if (typeof argument !== \"string\") {\n      this.onChange = argument;\n    } else {\n    }\n    return this;\n  }\n\n  // MARK: - Chaining Setter\n\n  setLabelText(text) {\n    this.label.text(text);\n    return this;\n  }\n\n  setOnChange(callback) {\n    this.onChange = callback;\n    return this;\n  }\n\n  setSelectedOption(optionID) {\n    if (\n      this.inputElements.find(function(item) {\n        return item.attr(\"value\") === optionID;\n      }) !== undefined\n    ) {\n      this.value = optionID;\n    }\n    return this;\n  }\n\n  set value(optionID) {\n    document.getElementById(this.selectId).value = optionID;\n  }\n\n  get value() {\n    return document.getElementById(this.selectId).value;\n  }\n}\n\nDropdown.create = function(selector, options, selectedOption, onChange) {\n  let div = d3.select(`#${selector}`);\n  let dropdown = new Dropdown(div);\n  dropdown.setLabelText(\"Group Size\");\n  dropdown.setOptions(options);\n  dropdown.setSelectedOption(selectedOption);\n  dropdown.setOnChange(onChange);\n  return dropdown;\n};\n","import { Component } from \"./component\";\nimport { createID } from \"../shared/selector\";\nimport { Card } from \"./card\";\nimport { Button } from \"./button\";\n\n/**\n * A lotivis popup.\n *\n * +----------------------------------------------------------------+\n * |                                                                |\n * |                                                                |\n *\n * @class Popup\n * @extends Component\n */\nexport class Popup extends Component {\n  /**\n   * Creates a new instance of Popup.\n   * @param parent The parental component.\n   */\n  constructor(parent = d3.select(\"body\")) {\n    super(parent);\n    this.injectUnderground(parent);\n    this.injectContainer();\n    this.injectCard();\n    this.inject();\n    this.injectCloseButton();\n    this.addCloseActionListeners();\n  }\n\n  // MARK: - Render\n\n  /**\n   * Appends shared.components to this popup.\n   * Should be overridden by subclasses.\n   */\n  inject() {\n    // empty\n  }\n\n  /**\n   * Appends the 'dim' background to the given parent.\n   *\n   * @param parent The parental element.\n   */\n  injectUnderground(parent) {\n    this.modalBackgroundId = createID();\n    this.modalBackground = parent\n      .append(\"div\")\n      .classed(\"ltv-popup-underground ltv-fade-in\", true)\n      .attr(\"id\", this.modalBackgroundId);\n  }\n\n  /**\n   *\n   */\n  injectContainer() {\n    this.elementId = createID();\n    this.element = this.modalBackground\n      .append(\"div\")\n      .classed(\"ltv-popup\", true)\n      .attr(\"id\", this.elementId);\n  }\n\n  /**\n   *\n   */\n  injectCard() {\n    this.card = new Card(this.element);\n    this.card.element.classed(\"ltv-popup\", true);\n  }\n\n  /**\n   * Appends a close button to the right header component.\n   */\n  injectCloseButton() {\n    this.closeButton = new Button(this.card.headerRightComponent);\n    this.closeButton.setText(\"Close\");\n  }\n\n  /**\n   * Appends an on click listener to the button.\n   */\n  addCloseActionListeners() {\n    let validIDs = [this.closeButton.selector, this.modalBackgroundId];\n    let popup = this;\n    this.modalBackground.on(\"click\", function(event) {\n      if (!event || !event.target) return;\n      if (!validIDs.includes(event.target.id)) return;\n      popup.dismiss();\n    });\n  }\n\n  // MARK: - Life Cycle\n\n  /**\n   * Tells the receiving popup that it is about to be presented.\n   *\n   * Subclasses may override.\n   */\n  willShow() {\n    // empty\n  }\n\n  /**\n   * Tells the receiving popup that it is now presented.\n   *\n   * Subclasses may override.\n   */\n  didShow() {\n    // empty\n  }\n\n  /**\n   * Presents the popup.\n   */\n  show() {\n    if (this.willShow) this.willShow();\n    this.getUnderground().style.display = \"block\";\n    if (this.didShow) this.didShow();\n  }\n\n  /**\n   * Tells the receiving popup that it is about to be dismissed.\n   *\n   * Subclasses may override.\n   */\n  willDismiss() {\n    // empty\n  }\n\n  /**\n   * Tells the receiving popup that the DOM element will be removed.\n   *\n   * Subclasses may override.\n   */\n  willRemoveDOMElement() {\n    // empty\n  }\n\n  /**\n   * Dismisses the popup.\n   */\n  dismiss() {\n    if (this.willDismiss) this.willDismiss();\n    this.getUnderground().style.display = \"none\";\n    if (this.willRemoveDOMElement) this.willRemoveDOMElement();\n    this.getUnderground().remove();\n  }\n\n  getUnderground() {\n    return document.getElementById(this.modalBackgroundId);\n  }\n\n  showUnder(sourceElement, position = \"center\") {\n    if (!sourceElement) return;\n\n    let preferredSize = this.preferredSize();\n    let origin = this.calculateBottomCenter(sourceElement);\n\n    if (position === \"left\") {\n      origin.x -= origin.width / 2;\n    } else if (position === \"right\") {\n      origin.x -= preferredSize.width - origin.width / 2;\n    } else {\n      // assume center\n      origin.x -= preferredSize.width / 2;\n    }\n\n    let id = this.elementId;\n    let popup = document.getElementById(id);\n\n    popup.style.position = \"absolute\";\n    popup.style.width = preferredSize.width + \"px\";\n    // popup.style.height = preferredSize.height + 'px';\n    popup.style.left = origin.x + \"px\";\n    popup.style.top = origin.y + \"px\";\n\n    this.show();\n  }\n\n  showBigModal() {\n    let id = this.elementId;\n    let popup = document.getElementById(id);\n    let preferredSize = this.preferredSize();\n\n    popup.style.position = \"relative\";\n    popup.style.margin = \"50px auto\";\n    popup.style.width = preferredSize.width + \"px\";\n\n    this.show();\n  }\n\n  /**\n   * Returns the preferred size of the popup.  Subclasses may override in order to\n   * change the size of the popup.\n   *\n   * @returns {{width: number, height: number}}\n   */\n  preferredSize() {\n    return {\n      width: 300,\n      height: 300\n    };\n  }\n\n  /**\n   * Returns the bottom middle point of the passed element.\n   *\n   * @param element\n   * @param respectWindowScroll\n   * @returns {{x: number, width: number, y: number, height: number}}\n   */\n  calculateBottomCenter(element, respectWindowScroll = false) {\n    let rect = element.getBoundingClientRect();\n    let x = rect.x + rect.width / 2;\n    let y = rect.y + rect.height;\n\n    if (respectWindowScroll) {\n      x += window.scrollX;\n      y += window.scrollY;\n    }\n\n    return {\n      x: x,\n      y: y,\n      width: rect.width,\n      height: rect.height\n    };\n  }\n}\n","import {Card} from \"./card\";\nimport {createID} from \"../shared/selector\";\nimport {Button} from \"./button\";\nimport {LotivisError, LotivisUnimplementedMethodError} from \"../data.juggle/data.validate.error\";\n\n/**\n * A lotivis card containing a textarea.\n * @class TextareaCard\n * @extends Card\n */\nexport class TextareaCard extends Card {\n\n  /**\n   * Creates a new instance of TextareaCard.\n   * @param parent The parental element or a selector (id).\n   */\n  constructor(parent) {\n    super(parent);\n    this.render();\n    this.updateSensible = true;\n\n    if (this.config) {\n      this.textarea.attr('rows', this.config.lines || 25);\n      this.setTitle(this.config.title || this.getClassname());\n    } else {\n      this.textarea.attr('rows', 25);\n      this.setTitle(this.getClassname());\n    }\n  }\n\n  /**\n   * Appends the component to this card.\n   */\n  render() {\n    this.textareaID = createID();\n    this.textarea = this.body\n      .append('textarea')\n      .attr('id', this.textareaID)\n      .attr('name', this.textareaID)\n      .attr('class', 'lotivis-data-textarea')\n      .on('keyup', this.onKeyup.bind(this));\n    this.downloadButton = new Button(this.headerRightComponent);\n    this.downloadButton.setText('Download');\n    this.downloadButton.onClick = function (event) {\n      let content = this.getTextareaContent();\n      this.download(content);\n    }.bind(this);\n  }\n\n  /**\n   * Returns the text of the textarea.\n   * @returns {*} The text of the textarea.\n   */\n  getTextareaContent() {\n    return document.getElementById(this.textareaID).value || \"\";\n  }\n\n  /**\n   * Sets the text of the textarea.\n   * @param newContent The text for the textarea.\n   */\n  setTextareaContent(newContent) {\n    let textarea = document.getElementById(this.textareaID);\n    if (!textarea) return;\n    textarea.value = newContent;\n\n    if (this.config && this.config.updatesHeight !== true) return;\n    if (typeof newContent !== 'string') return;\n    let numberOfRows = newContent.split(`\\n`).length;\n    this.textarea.attr('rows', numberOfRows);\n  }\n\n  /**\n   * Enable the textarea.\n   */\n  enableTextarea() {\n    this.textarea.attr('disabled', null);\n    [this.textarea, this.titleLabel].forEach(item => item.classed('lotivis-disabled', false));\n  }\n\n  /**\n   * Disables the textarea.\n   */\n  disableTextarea() {\n    this.textarea.attr('disabled', '');\n    [this.textarea, this.titleLabel].forEach(item => item.classed('lotivis-disabled', true));\n  }\n\n  /**\n   * Tells this dataset card that a 'keyup'-event occurred in the textarea.\n   * @param event The key event.\n   */\n  onKeyup(event) {\n    throw new LotivisUnimplementedMethodError(`onKeyup(event)`);\n  }\n\n  /**\n   * Initiates a download of the content of the textarea.\n   * @param content The new content of the textarea.\n   */\n  download(content) {\n    throw new LotivisUnimplementedMethodError(`download(content)`);\n  }\n}\n","import {TextareaCard} from \"../shared.components/textarea.card\";\nimport {lotivis_log} from \"../shared/debug\";\nimport {LotivisUnimplementedMethodError} from \"../data.juggle/data.validate.error\";\n\n/**\n *\n * @class UpdatableDataviewCard\n * @extends TextareaCard\n */\nexport class UpdatableDataviewCard extends TextareaCard {\n\n  /**\n   * Creates a new instance of UpdatableDataviewCard.\n   * @param parent The parental element or a selector (id).\n   */\n  constructor(parent = {}) {\n    // parent.title = parent.title || 'UpdatableDataviewCard';\n    super(parent);\n    this.updateSensible = true;\n    this.downloadButton.hide();\n  }\n\n  /**\n   * Sets the dataset controller.\n   * @param newDatasetController\n   */\n  setDatasetsController(newDatasetController) {\n    this.datasetsController = newDatasetController;\n    this.datasetsController.addListener(this);\n  }\n\n  /**\n   * Tells thi dataset card that the datasets of the datasets controller has changed.\n   * @param datasetsController The datasets controller.\n   * @param reason The reason of the update.\n   */\n  update(datasetsController, reason) {\n    if (!this.updateSensible) {\n      lotivis_log(`[lotivis]  NOT sensible ${this}. Reason '${reason}'.`);\n      return;\n    } else if (this.config && this.config.updateSensible === false) {\n      lotivis_log(`[lotivis]  NOT sensible (Config) ${this}. Reason '${reason}'.`);\n      return;\n    } else if (!datasetsController) {\n      lotivis_log(`[lotivis]  NO controller ${this}. Reason '${reason}'.`);\n      return;\n    }\n\n    let datasets = datasetsController.datasets;\n    let content = this.datasetsToText(datasetsController, datasets);\n\n    this.setTextareaContent(content);\n    this.cachedDatasets = datasets;\n\n    lotivis_log(`[lotivis]  Update ${this}. Reason '${reason}'.`);\n  }\n\n  /**\n   * Sets the content of the textarea by rendering the given datasets to text.  Subclasses should override.\n   * @param controller The datasets controller.\n   * @param datasets The datasets to render.\n   * @return {*}\n   */\n  datasetsToText(controller, datasets) {\n    throw new LotivisUnimplementedMethodError(`Subclasses should override.`);\n  }\n}\n","import {\n  InvalidFormatError,\n  MissingPropertyError\n} from \"./data.validate.error\";\n\n/**\n * Validates the given datasets.\n * @param datasets The datasets to validate.\n * @throws InvalidFormatError\n */\nexport function validateDatasets(datasets) {\n\n  if (!datasets) {\n    throw new InvalidFormatError(`No dataset given.`);\n  } else if (!Array.isArray(datasets)) {\n    throw new InvalidFormatError(`Expecting array of datasets.`);\n  }\n\n  for (let index = 0; index < datasets.length; index++) {\n    validateDataset(datasets[index]);\n  }\n}\n\n/**\n * Validates the given dataset.\n * @param dataset The dataset to validate.\n * @throws InvalidFormatError\n * @throws MissingPropertyError\n */\nexport function validateDataset(dataset) {\n  if (!dataset) {\n    throw new InvalidFormatError(`No dataset given.`);\n  } else if (!dataset.label) {\n    throw new MissingPropertyError(`Missing label for dataset. ${dataset}`);\n  } else if (!dataset.data) {\n    throw new MissingPropertyError(`Invalid data. Property is not an array. Dataset: ${dataset.label}`);\n  } else if (!Array.isArray(dataset.data)) {\n    throw new InvalidFormatError(`Invalid data. Property is not an array. Dataset: ${dataset.label}`);\n  }\n\n  let data = dataset;\n  for (let index = 0; index < data.length; index++) {\n    validateDataItem(data[index]);\n  }\n}\n\n/**\n * Validates the given datasets.controller item by ensuring it has a valid `date.chart`, `location` and `value` property value.\n * @param item The datasets.controller item to validate.\n * @throws MissingPropertyError\n */\nexport function validateDataItem(item) {\n  if (!item.date) {\n    throw new MissingPropertyError(`Missing date property for item.`, item);\n  } else if (!item.location) {\n    throw new MissingPropertyError(`Missing location property for item.`, item);\n  }\n}\n","/**\n * Compares the string version of each oof the two given values for equality.\n *\n * @param value1 The first value to compare.\n * @param value2 The second value to compare.\n * @returns {boolean} `True` if the string versions are equal, `false` if not.\n */\nexport function equals(value1, value2) {\n  return String(value1) === String(value2);\n}\n\n/**\n * Returns a Boolean value indicating whether the JSON string version of the given two objects are equal.\n *\n * @param object1 The first object to compare.\n * @param object2 The second object to compare.\n * @returns {boolean} `True` if the JSON strings of the given objects are equal,`false` if not.\n */\nexport function objectsEqual(object1, object2) {\n  if (object1 === object2) return true;\n  let string1 = JSON.stringify(object1);\n  let string2 = JSON.stringify(object2);\n  return string1 === string2;\n}\n","import {Toast} from \"../shared.components/toast\";\nimport {validateDatasets} from \"../data.juggle/data.validate\";\nimport {lotivis_log} from \"../shared/debug\";\nimport {objectsEqual} from \"../shared/equal\";\nimport {UpdatableDataviewCard} from \"./updatable.dataview.card\";\nimport {LotivisUnimplementedMethodError} from \"../data.juggle/data.validate.error\";\n\n/**\n *\n * @class EditableDataviewCard\n * @extends UpdatableDataviewCard\n */\nexport class EditableDataviewCard extends UpdatableDataviewCard {\n\n  /**\n   * Creates a new instance of DatasetCard.\n   * @param parent The parental element or a selector (id).\n   */\n  constructor(parent) {\n    super(parent);\n    this.toast = new Toast(this.parent);\n    this.downloadButton.show();\n  }\n\n  /**\n   * Tells this dataset card that a 'keyup'-event occurred in the textarea.\n   */\n  onKeyup() {\n    this.updateDatasetsOfController.bind(this)(true);\n  }\n\n  /**\n   * Tells\n   * @param notifyController A boolean value indicating whether the datasets controller should be notified about the\n   * update.\n   */\n  updateDatasetsOfController(notifyController = false) {\n\n    let content = this.getTextareaContent();\n    this.toast.setStatusMessage(null);\n\n    try {\n\n      // will throw an error if parsing is not possible\n      let parsedDatasets = this.textToDatasets(content);\n      if (!parsedDatasets) return;\n\n      // will throw an error if parsed datasets aren't valid.\n      validateDatasets(parsedDatasets);\n\n      if (notifyController === true) {\n\n        if (!this.datasetsController) {\n          return lotivis_log(`[lotivis]  No datasets controller.`);\n        }\n\n        if (objectsEqual(this.cachedDatasets, parsedDatasets)) {\n          return lotivis_log(`[lotivis]  No changes in datasets.`);\n        }\n\n        this.cachedDatasets = parsedDatasets;\n        this.updateSensible = false;\n        this.datasetsController.setDatasets(parsedDatasets);\n        this.updateSensible = true;\n      }\n\n    } catch (error) {\n      lotivis_log(`[lotivis]  ERROR: ${error}`);\n      this.toast.setStatusMessage(error);\n    }\n  }\n\n  datasetsToText(datasets) {\n    return new LotivisUnimplementedMethodError('datasetsToText(datasets)');\n  }\n}\n","import {LotivisConfig} from \"./config\";\n\n/**\n * Appends the given string in extension to the given string filename if filename not already ends with this extension.\n *\n * @param filename A string with or without an extension.\n * @param extension The extension the filename will end with.\n *\n * @returns {*|string} The filename with the given extension.\n */\nexport function appendExtensionIfNeeded(filename, extension) {\n  if (extension === '' || extension === '.') return filename;\n  extension = extension.startsWith(\".\") ? extension : `.${extension}`;\n  return filename.endsWith(extension) ? filename : `${filename}${extension}`;\n}\n\nexport function createDownloadFilename() {\n  let components = [LotivisConfig.downloadFilePrefix];\n  let separator = LotivisConfig.filenameSeparator;\n  for (let i = 0; i < arguments.length; i++) {\n    components.push(String(arguments[i]));\n  }\n  return components.join(separator);\n}\n","// http://bl.ocks.org/Rokotyan/0556f8facbaf344507cdc45dc3622177\n/**\n * Parses a String from the given (D3.js) SVG node.\n *\n * @param svgNode The node of the SVG.\n * @returns {string} The parsed String.\n */\nexport function getSVGString(svgNode) {\n\n  svgNode.setAttribute('xlink', 'http://www.w3.org/1999/xlink');\n  let cssStyleText = getCSSStyles(svgNode);\n  appendCSS(cssStyleText, svgNode);\n\n  let serializer = new XMLSerializer();\n  let svgString = serializer.serializeToString(svgNode);\n\n  // Fix root xlink without namespace\n  svgString = svgString.replace(\n    /(\\w+)?:?xlink=/g,\n    'xmlns:xlink='\n  );\n\n  // Safari NS namespace fix\n  svgString = svgString.replace(\n    /NS\\d+:href/g,\n    'xlink:href'\n  );\n\n  return svgString;\n\n  function getCSSStyles(parentElement) {\n    let selectorTextArr = [];\n\n    // Add Parent element Id and Classes to the list\n    selectorTextArr.push('#' + parentElement.id);\n    for (let c = 0; c < parentElement.classList.length; c++) {\n      if (!contains('.' + parentElement.classList[c], selectorTextArr)) {\n        selectorTextArr.push('.' + parentElement.classList[c]);\n      }\n    }\n\n    // Add Children element Ids and Classes to the list\n    let nodes = parentElement.getElementsByTagName(\"*\");\n    for (let i = 0; i < nodes.length; i++) {\n      let id = nodes[i].id;\n      if (!contains('#' + id, selectorTextArr)) {\n        selectorTextArr.push('#' + id);\n      }\n\n      let classes = nodes[i].classList;\n      for (let c = 0; c < classes.length; c++) {\n        if (!contains('.' + classes[c], selectorTextArr)) {\n          selectorTextArr.push('.' + classes[c]);\n        }\n      }\n    }\n\n    // Extract CSS Rules\n    let extractedCSSText = \"\";\n    for (let i = 0; i < document.styleSheets.length; i++) {\n      let s = document.styleSheets[i];\n\n      try {\n        if (!s.cssRules) continue;\n      } catch (e) {\n        if (e.name !== 'SecurityError') throw e; // for Firefox\n        continue;\n      }\n\n      let cssRules = s.cssRules;\n      for (let r = 0; r < cssRules.length; r++) {\n        if (contains(cssRules[r].selectorText, selectorTextArr)) {\n          extractedCSSText += cssRules[r].cssText;\n        }\n      }\n    }\n\n    return extractedCSSText;\n\n    function contains(str, arr) {\n      return arr.indexOf(str) !== -1;\n    }\n  }\n\n  function appendCSS(cssText, element) {\n    let styleElement = document.createElement(\"style\");\n    styleElement.setAttribute(\"type\", \"text/css\");\n    styleElement.innerHTML = cssText;\n    let refNode = element.hasChildNodes() ? element.children[0] : null;\n    element.insertBefore(styleElement, refNode);\n  }\n}\n\n/**\n *\n * @param svgString\n * @param width\n * @param height\n * @param callback\n */\nexport function svgString2Image(svgString, width, height, callback) {\n\n  // Convert SVG string to samples URL\n  let imageSource = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgString)));\n\n  let canvas = document.createElement(\"canvas\");\n  canvas.width = width;\n  canvas.height = height;\n\n  let context = canvas.getContext(\"2d\");\n  let image = new Image();\n  image.onload = function () {\n    context.clearRect(0, 0, width, height);\n    context.drawImage(image, 0, 0, width, height);\n\n    let data = canvas.toDataURL(\"image/png\");\n    if (callback) callback(data);\n  };\n\n  image.src = imageSource;\n}\n\n/**\n * Returns the size of the viewBox or the normal size of the given svg element.\n *\n * @param svgElement The svg element.\n * @returns {number[]} The size [width, height].\n */\nexport function getOriginalSizeOfSVG(svgElement) {\n  let viewBoxBaseValue = svgElement.viewBox.baseVal;\n  if (viewBoxBaseValue.width !== 0 && viewBoxBaseValue.height !== 0) {\n    return [\n      viewBoxBaseValue.width,\n      viewBoxBaseValue.height\n    ];\n  } else {\n    return [\n      svgElement.width.baseVal.value,\n      svgElement.height.baseVal.value,\n    ];\n  }\n}\n","import {appendExtensionIfNeeded} from \"./filename\";\nimport {getOriginalSizeOfSVG, getSVGString, svgString2Image} from \"./screenshot\";\n\n/**\n * Creates and appends an anchor linked to the given samples which is then immediately clicked.\n *\n * @param blob The samples to be downloaded.\n * @param filename The name of the file.\n */\nexport function downloadBlob(blob, filename) {\n  if (window.navigator.msSaveOrOpenBlob) {\n    window.navigator.msSaveBlob(blob, filename);\n  } else {\n    let anchor = document.createElement(\"a\");\n    anchor.href = URL.createObjectURL(blob);\n    anchor.download = filename;\n    document.body.appendChild(anchor);\n    anchor.click();\n    document.body.removeChild(anchor);\n  }\n}\n\n/**\n * Initiates a download of a JSON file with the given content and the given filename.\n * @param jsonString The JSON content.\n * @param filename The filename of the file to be downloaded. Will append '.json' extension\n * if needed.\n */\nexport function downloadJSON(jsonString, filename) {\n  let blob = new Blob([jsonString], {type: 'text/json'});\n  let saveFilename = appendExtensionIfNeeded(filename, 'json');\n  downloadBlob(blob, saveFilename);\n}\n\nexport function downloadCSV(jsonString, filename) {\n  let blob = new Blob([jsonString], {type: 'text/csv'});\n  let saveFilename = appendExtensionIfNeeded(filename, 'csv');\n  downloadBlob(blob, saveFilename);\n}\n\n/**\n * Initiates a download of the PNG image of the SVG with the given selector (id).\n *\n * @param selector The id of the SVG element to create the image of.\n * @param filename The name of the file which is been downloaded.\n */\nexport function downloadImage(selector, filename) {\n  // console.log('selector:' + selector);\n  // console.log('filename:' + filename);\n  let svgElement = d3.select('#' + selector);\n  let node = svgElement.node();\n  let size = getOriginalSizeOfSVG(node);\n  let svgString = getSVGString(node);\n\n  svgString2Image(svgString, 2 * size[0], 2 * size[1], function (dataURL) {\n    // console.log('dataURL:' + dataURL);\n    fetch(dataURL)\n      .then(res => res.blob())\n      .then(function (dataBlob) {\n        let saveFilename = appendExtensionIfNeeded(filename, 'png');\n\n        // console.log('saveFilename:' + saveFilename);\n\n        downloadBlob(dataBlob, saveFilename);\n      });\n  });\n}\n","import {EditableDataviewCard} from \"./editable.dataview.card\";\nimport {downloadJSON} from \"../shared/download\";\nimport {createDownloadFilename} from \"../shared/filename\";\n\n/**\n * A card containing a textarea which contains the JSON text of a dataset collection.\n * @class DatasetsJSONCard\n * @extends EditableDataviewCard\n */\nexport class DatasetsJSONCard extends EditableDataviewCard {\n\n  /**\n   * Creates a new instance of DatasetJSONCard.\n   * @param parent The parental element or a selector (id).\n   */\n  constructor(parent = 'datasets-json-card') {\n    if (Object.getPrototypeOf(parent) === Object.prototype) {\n      parent.selector = parent.selector || 'datasets-json-card';\n    }\n    super(parent);\n    this.setTitle('Dataset JSON');\n  }\n\n  download(content) {\n    let filename = this.datasetsController.getFilename();\n    let downloadFilename = createDownloadFilename(filename, `datasets`);\n    downloadJSON(content, downloadFilename);\n  }\n\n  textToDatasets(text) {\n    if (text === \"\") return [];\n    return JSON.parse(text.trim());\n  }\n\n  datasetsToText(datasetsController) {\n    return JSON.stringify(datasetsController.datasets, null, 2) || \"\";\n  }\n}\n","/*\nFollowing code from:\nhttps://gist.github.com/Jezternz/c8e9fafc2c114e079829974e3764db75\n\nWe use this function to save parse a CSV file.\n */\n\nexport const csvStringToArray = strData => {\n  const objPattern = new RegExp(\n    '(\\\\,|\\\\r?\\\\n|\\\\r|^)(?:\"([^\"]*(?:\"\"[^\"]*)*)\"|([^\\\\,\\\\r\\\\n]*))',\n    \"gi\"\n  );\n  let arrMatches = null,\n    arrData = [[]];\n  while ((arrMatches = objPattern.exec(strData))) {\n    if (arrMatches[1].length && arrMatches[1] !== \",\") arrData.push([]);\n    arrData[arrData.length - 1].push(\n      arrMatches[2]\n        ? arrMatches[2].replace(new RegExp('\"\"', \"g\"), '\"')\n        : arrMatches[3]\n    );\n  }\n  return arrData;\n};\n","/**\n * Returns a new version of the given string by trimming the given char from the beginning and the end of the string.\n * @param string The string to be trimmed.\n * @param character The character to trim.\n * @returns {string} The trimmed version of the string.\n */\nexport function trimByChar(string, character) {\n  const saveString = String(string);\n  const first = [...saveString].findIndex(char => char !== character);\n  const last = [...saveString].reverse().findIndex(char => char !== character);\n  return saveString.substring(first, saveString.length - last);\n}\n","/**\n * Returns a dataset collection created from the given flat samples collection.\n * @param flatData The flat samples collection.\n * @returns {[]} A collection of datasets.\n */\nexport function createDatasets(flatData) {\n  let datasetsByLabel = {};\n\n  for (let itemIndex = 0; itemIndex < flatData.length; itemIndex++) {\n    let item = flatData[itemIndex];\n    let label = item.dataset || item.label;\n    let dataset = datasetsByLabel[label];\n\n    if (dataset) {\n      dataset.data.push({\n        date: item.date,\n        location: item.location,\n        value: item.value\n      });\n    } else {\n      datasetsByLabel[label] = {\n        label: label,\n        stack: item.stack,\n        data: [{\n          date: item.date,\n          location: item.location,\n          value: item.value\n        }]\n      };\n    }\n  }\n\n  let datasets = [];\n  let labels = Object.getOwnPropertyNames(datasetsByLabel);\n\n  for (let index = 0; index < labels.length; index++) {\n    let label = labels[index];\n    if (label.length === 0) continue;\n    datasets.push(datasetsByLabel[label]);\n  }\n\n  return datasets;\n}\n","import {csvStringToArray} from \"../shared/csv.to.array\";\nimport {trimByChar} from \"../shared/trim\";\nimport {createDatasets} from \"../data.juggle/data.create.datasets\";\nimport {lotivis_log} from \"../shared/debug\";\n\nexport function parseCSV(text) {\n  let flatData = [];\n  let arrays = csvStringToArray(text);\n  let headlines = arrays.shift();\n\n  for (let lineIndex = 0; lineIndex < arrays.length; lineIndex++) {\n\n    let lineArray = arrays[lineIndex].map(element => trimByChar(element, `\"`));\n\n    if (lineArray.length < 5) {\n      lotivis_log(`Skipping row: ${lineArray}`);\n      continue;\n    }\n\n    flatData.push({\n      label: lineArray[0],\n      stack: lineArray[1],\n      value: +lineArray[2],\n      date: lineArray[3],\n      location: lineArray[4]\n    });\n  }\n\n  let datasets = createDatasets(flatData);\n  datasets.csv = {\n    content: text,\n    headlines: headlines,\n    lines: arrays,\n  };\n\n  return datasets;\n}\n","import {copy} from \"../shared/copy\";\nimport {lotivis_log} from \"../shared/debug\";\n\n/**\n * Returns a flat version of the given dataset collection.\n *\n * @param datasets The collection of datasets.\n * @returns {[]} The array containing the flat samples.\n */\nexport function flatDatasets(datasets) {\n  let flatData = [];\n  let datasetsCopy = datasets;\n  for (let datasetIndex = 0; datasetIndex < datasetsCopy.length; datasetIndex++) {\n    let dataset = datasetsCopy[datasetIndex];\n    let flatDataChunk = flatDataset(dataset);\n    flatData = flatData.concat(flatDataChunk);\n  }\n  return flatData;\n}\n\n/**\n * Returns an array containing the flat samples of the given dataset.\n *\n * @param dataset The dataset with samples.\n * @returns {[]} The array containing the flat samples.\n */\nexport function flatDataset(dataset) {\n  let flatData = [];\n  if (!dataset.data) {\n    lotivis_log(`[lotivis]  INFO Flat samples for dataset without samples requested. Will return an empty array.`, dataset);\n    return flatData;\n  }\n  dataset.data.forEach(item => {\n    let newItem = {};\n    newItem.dataset = dataset.label;\n    newItem.label = dataset.label;\n    newItem.stack = dataset.stack || dataset.label;\n    newItem.location = item.location;\n    newItem.date = item.date;\n    newItem.dateNumeric = item.dateNumeric;\n    newItem.value = item.value;\n    flatData.push(newItem);\n  });\n  return flatData;\n}\n","import {flatDatasets} from \"../data.juggle/data.flat\";\n\n/**\n * Returns the given string with a quotation mark in the left and right.\n *\n * @param aString The string to surround by quotation marks.\n * @returns {string} The string surrounded by quotation marks.\n */\nfunction surroundWithQuotationMarks(aString) {\n  return `\"${aString}\"`;\n}\n\n/**\n * Returns the CSV string of the given datasets.\n *\n * @param datasets The datasets to create the CSV of.\n */\nexport function renderCSV(datasets) {\n  let flatData = flatDatasets(datasets);\n  let headlines = ['label', 'stack', 'value', 'date', 'location'];\n  let csvContent = `${headlines.join(',')}\\n`;\n  for (let index = 0; index < flatData.length; index++) {\n    let data = flatData[index];\n    let components = [];\n    components.push(surroundWithQuotationMarks(data.dataset || 'Unknown'));\n    components.push(surroundWithQuotationMarks(data.stack || ''));\n    components.push(data.value || '0');\n    components.push(surroundWithQuotationMarks(data.date || ''));\n    components.push(surroundWithQuotationMarks(data.location || ''));\n    csvContent += `${components.join(`,`)}\\n`;\n  }\n  return csvContent;\n}\n","import {Card} from \"../shared.components/card\";\nimport {EditableDataviewCard} from \"./editable.dataview.card\";\nimport {parseCSV} from \"../data.parse/parse.csv\";\nimport {renderCSV} from \"../data.render/render.csv\";\nimport {downloadCSV} from \"../shared/download\";\nimport {createDownloadFilename} from \"../shared/filename\";\n\n/**\n * Presents the CSV version of datasets.  The presented CSV can be edited.\n * @class DatasetCSVCard\n * @extends Card\n */\nexport class DatasetCSVCard extends EditableDataviewCard {\n\n  /**\n   * Creates a new instance of DatasetCSVCard.\n   * @param parent The parental element or a selector (id).\n   */\n  constructor(parent) {\n    super(parent);\n    this.setTitle('Dataset CSV');\n  }\n\n  download(content) {\n    let filename = this.datasetsController.getFilename();\n    let downloadFilename = createDownloadFilename(filename, `datasets`);\n    downloadCSV(content, downloadFilename);\n  }\n\n  textToDatasets(text) {\n    if (text === \"\") return [];\n    return parseCSV(text);\n  }\n\n  datasetsToText(datasetsController) {\n    return renderCSV(datasetsController.datasets);\n  }\n}\n","import {csvStringToArray} from \"../shared/csv.to.array\";\nimport {trimByChar} from \"../shared/trim\";\n\n/**\n * Returns a collection of datasets parsed from the given CSV content.\n * @param text The CSV content.\n * @returns {[]} The parsed datasets.\n */\nexport function parseCSVDate(text) {\n  let arrays = csvStringToArray(text);\n  let datasetLabels = arrays.shift();\n  let dateTitle = datasetLabels.shift();\n  let datasets = [];\n  let minLineLength = datasetLabels.length;\n\n  for (let index = 0; index < datasetLabels.length; index++) {\n    datasets.push({\n      label: datasetLabels[index],\n      data: []\n    });\n  }\n\n  for (let lineIndex = 0; lineIndex < arrays.length; lineIndex++) {\n    let lineArray = arrays[lineIndex].map(element => trimByChar(element, `\"`));\n    if (lineArray.length < minLineLength) continue;\n\n    let date = lineArray.shift();\n\n    for (let columnIndex = 0; columnIndex < lineArray.length; columnIndex++) {\n      let value = lineArray[columnIndex];\n      datasets[columnIndex].data.push({\n        date: date,\n        value: value\n      });\n    }\n  }\n\n  datasets.csv = {\n    content: text,\n    headlines: datasetLabels.push(),\n    lines: arrays,\n  };\n\n  return datasets;\n}\n","import {flatDatasets} from \"./data.flat\";\nimport {toValue} from \"../shared/value\";\n\n/**\n * Returns the set of dataset names from the given dataset collection.\n *\n * @param datasets The collection of datasets.\n * @returns {[]} The array containing the flat samples.\n */\nexport function extractLabelsFromDatasets(datasets) {\n  return toSet(datasets.map(dataset => toValue(dataset.label)));\n}\n\n/**\n * Returns the set of stacks from the given dataset collection.\n * Will fallback on dataset property if stack property isn't present.\n *\n * @param datasets The collection of datasets.\n * @returns {[]} The array containing the flat samples.\n */\nexport function extractStacksFromDatasets(datasets) {\n  return toSet(datasets.map(dataset => toValue(dataset.stack || dataset.label)));\n}\n\n/**\n * Returns the set of dates from the given dataset collection.\n *\n * @param datasets The collection of datasets.\n * @returns {[]} The set containing the dates.\n */\nexport function extractDatesFromDatasets(datasets) {\n  return extractDatesFromFlatData(flatDatasets(datasets));\n}\n\n/**\n * Returns the set of locations from the given dataset collection.\n *\n * @param datasets The collection of datasets.\n * @returns {[]} The set containing the locations.\n */\nexport function extractLocationsFromDatasets(datasets) {\n  return extractLocationsFromFlatData(flatDatasets(datasets));\n}\n\n/**\n * Returns the set of dataset names from the given flat samples array.\n *\n * @param flatData The flat samples array.\n * @returns {[]} The array containing the flat samples.\n */\nexport function extractLabelsFromFlatData(flatData) {\n  return toSet(flatData.map(item => toValue(item.dataset)));\n}\n\n/**\n * Returns the set of stacks from the given flat samples array.\n * Will fallback on dataset property if stack property isn't present.\n *\n * @param flatData The flat samples array.\n * @returns {[]} The array containing the flat samples.\n */\nexport function extractStacksFromFlatData(flatData) {\n  return toSet(flatData.map(item => toValue(item.stack || item.dataset)));\n}\n\n/**\n * Returns the set of dates from the given dataset collection.\n *\n * @param flatData The flat samples array.\n * @returns {[]} The set containing the dates.\n */\nexport function extractDatesFromFlatData(flatData) {\n  return toSet(flatData.map(item => toValue(item.date)));\n}\n\n/**\n * Returns the set of locations from the given dataset collection.\n *\n * @param flatData The flat samples array.\n * @returns {[]} The set containing the locations.\n */\nexport function extractLocationsFromFlatData(flatData) {\n  return toSet(flatData.map(item => toValue(item.location)));\n}\n\n/**\n * Return an array containing each equal item of the given array only once.\n *\n * @param array The array to create a set of.\n * @returns {any[]} The set version of the array.\n */\nfunction toSet(array) {\n  return Array.from(new Set(array));\n}\n\n/**\n * Returns the earliest date.chart occurring in the flat array of items.\n *\n * @param flatData The flat samples array.\n * @param dateAccess\n * @returns {*} The earliest date.chart.\n */\nexport function extractEarliestDate(flatData, dateAccess = (date) => date) {\n  return extractDatesFromFlatData(flatData)\n    .sort((left, right) => dateAccess(left) - dateAccess(right)).shift();\n}\n\n/**\n * Returns the earliest date.chart occurring in the flat array of items.\n *\n * @param flatData The flat samples array.\n * @param dateAccess\n * @returns {*} The earliest date.chart.\n */\nexport function extractEarliestDateWithValue(flatData, dateAccess = (date) => date) {\n  return extractEarliestDate(filterWithValue(flatData), dateAccess);\n}\n\n/**\n * Returns the latest date.chart occurring in the flat array of items.\n *\n * @param flatData The flat samples array.\n * @param dateAccess\n * @returns {*} The latest date.chart.\n */\nexport function extractLatestDate(flatData, dateAccess = (date) => date) {\n  return extractDatesFromFlatData(flatData)\n    .sort((left, right) => dateAccess(left) - dateAccess(right)).pop();\n}\n\n/**\n * Returns the latest date.chart occurring in the flat array of items.\n *\n * @param flatData The flat samples array.\n * @param dateAccess\n * @returns {*} The latest date.chart.\n */\nexport function extractLatestDateWithValue(flatData, dateAccess = (date) => date) {\n  return extractLatestDate(filterWithValue(flatData), dateAccess);\n}\n\n/**\n * Returns a filtered collection containing all items which have a valid value greater than 0.\n *\n * @param flatData The flat samples to filter.\n * @returns {*} All items with a value greater 0.\n */\nexport function filterWithValue(flatData) {\n  return flatData.filter(item => (item.value || 0) > 0);\n}\n","import {\n  extractDatesFromDatasets,\n  extractLabelsFromDatasets\n} from \"./data.extract\";\nimport {flatDatasets} from \"./data.flat\";\nimport {combineByDate} from \"./data.combine\";\n\n/**\n *\n * @param datasets\n * @param dateAccess\n * @returns {{date.chart: *}[]}\n */\nexport function dateToItemsRelation(datasets, dateAccess) {\n\n  let flatData = flatDatasets(datasets);\n  flatData = combineByDate(flatData);\n\n  let listOfDates = extractDatesFromDatasets(datasets);\n  // verbose_log('listOfDates', listOfDates);\n  listOfDates = listOfDates.reverse();\n  // verbose_log('listOfDates', listOfDates);\n  // listOfDates = listOfDates.sort(function (left, right) {\n  //   return dateAccess(left) - dateAccess(right);\n  // });\n\n  let listOfLabels = extractLabelsFromDatasets(datasets);\n\n  return listOfDates.map(function (date) {\n    let datasetDate = {date: date};\n    flatData\n      .filter(item => item.date === date)\n      .forEach(function (entry) {\n        datasetDate[entry.dataset] = entry.value;\n        datasetDate.total = entry.dateTotal;\n      });\n\n    // addDataset zero values for empty datasets\n    for (let index = 0; index < listOfLabels.length; index++) {\n      let label = listOfLabels[index];\n      if (!datasetDate[label]) {\n        datasetDate[label] = 0;\n      }\n    }\n\n    return datasetDate;\n  });\n}\n","import {extractLabelsFromDatasets} from \"../data.juggle/data.extract\";\nimport {dateToItemsRelation} from \"../data.juggle/data.relations\";\n\n/**\n *\n * @param datasets\n */\nexport function renderCSVDate(datasets) {\n  let dateRelation = dateToItemsRelation(datasets, (date) => date);\n  let labels = extractLabelsFromDatasets(datasets);\n  let headlines = ['date'];\n\n  for (let labelIndex = 0; labelIndex < labels.length; labelIndex++) {\n    headlines.push(labels[labelIndex]);\n  }\n\n  let csvContent = `${headlines.join(',')}\\n`;\n\n  for (let index = 0; index < dateRelation.length; index++) {\n    let dateRow = dateRelation[index];\n    let csvRow = `${dateRow.date}`;\n\n    for (let labelIndex = 0; labelIndex < labels.length; labelIndex++) {\n      let label = labels[labelIndex];\n      csvRow += `,${dateRow[label]}`;\n    }\n\n    csvContent += `${csvRow}\\n`;\n  }\n\n  return csvContent;\n}\n","import {Card} from \"../shared.components/card\";\nimport {EditableDataviewCard} from \"./editable.dataview.card\";\nimport {parseCSVDate} from \"../data.parse/parse.csv.date\";\nimport {renderCSVDate} from \"../data.render/render.csv.date\";\nimport {downloadCSV} from \"../shared/download\";\nimport {createDownloadFilename} from \"../shared/filename\";\n\n/**\n * Presents the CSV version of datasets.  The presented CSV can be edited.\n * @class DatasetCSVDateCard\n * @extends Card\n */\nexport class DatasetCSVDateCard extends EditableDataviewCard {\n\n  /**\n   * Creates a new instance of DatasetCSVCard.\n   * @param parent The parental element or a selector (id).\n   */\n  constructor(parent) {\n    super(parent);\n    this.setTitle('Dataset CSV');\n  }\n\n  download(content) {\n    let filename = this.datasetsController.getFilename();\n    let downloadFilename = createDownloadFilename(filename, `datasets`);\n    downloadCSV(content, downloadFilename);\n  }\n\n  textToDatasets(text) {\n    if (text === \"\") return [];\n    return parseCSVDate(text);\n  }\n\n  datasetsToText(datasetsController) {\n    return renderCSVDate(datasetsController.datasets);\n  }\n}\n","import {UpdatableDataviewCard} from \"./updatable.dataview.card\";\n\n/**\n * A card containing a textarea which contains the JSON text of a dataset collection.\n * @class DataviewCard\n * @extends UpdatableDataviewCard\n */\nexport class DataViewCard extends UpdatableDataviewCard {\n\n  /**\n   * Creates a new instance of DataviewCard.\n   * @param parent The parental element or a selector (id).\n   */\n  constructor(parent) {\n    super(parent);\n    if (!this.config) this.config = {};\n    this.config.updatesHeight = this.config.updatesHeight || true;\n    this.disableTextarea();\n  }\n\n  datasetsToText(datasets) {\n    if (!this.datasetsController) return \"No datasets controller.\";\n    let dataView = this.getDataview();\n    return JSON.stringify(dataView, null, 2);\n  }\n\n  getDataview() {\n    // empty\n  }\n}\n\nexport class DataViewDateChartCard extends DataViewCard {\n  getTitle() {\n    return 'Dataview Date';\n  }\n\n  getDataview() {\n    return this.datasetsController.getDateDataview();\n  }\n}\n\nexport class DataViewDatePlotChartCard extends DataViewCard {\n  getTitle() {\n    return 'Dataview Plot';\n  }\n\n  getDataview() {\n    return this.datasetsController.getPlotDataview();\n  }\n}\n\nexport class DataViewMapChartCard extends DataViewCard {\n  getTitle() {\n    return 'Dataview Map';\n  }\n\n  getDataview() {\n    return this.datasetsController.getLocationDataview();\n  }\n}\n\nexport class DataViewFlatCard extends DataViewCard {\n  getTitle() {\n    return 'Flat Data';\n  }\n\n  getDataview() {\n    return this.datasetsController.flatData;\n  }\n}\n","import {DataViewCard} from \"./dataview.card\";\n\n/**\n * @class DatasetsControllerCard\n *\n * @extends DataviewCard\n */\nexport class DatasetsControllerCard extends DataViewCard {\n\n  /**\n   * Creates a new instance of DatasetsControllerCard.\n   */\n  constructor(parent) {\n    super(parent);\n  }\n\n  datasetsToText(datasets) {\n    return JSON.stringify({\n      labels: this.datasetsController.labels,\n      stacks: this.datasetsController.stacks,\n      dates: this.datasetsController.dates,\n      locations: this.datasetsController.locations,\n      filters: {\n        locations: this.datasetsController.locationFilters,\n        dates: this.datasetsController.dateFilters,\n        datasets: this.datasetsController.datasetFilters,\n      },\n      selection: {},\n      datasets: this.datasetsController.datasets,\n      flatData: this.datasetsController.flatData,\n      originalDatasets: this.datasetsController.originalDatasets,\n      snapshot: this.datasetsController.snapshot\n    }, null, 2);\n  }\n}\n","/**\n * @class DateChartAxisRenderer\n */\nexport class DateChartAxisRenderer {\n\n  /**\n   * Creates a new instance of DateChartAxisRenderer.\n   *\n   * @param dateChart The parental date.chart chart.\n   */\n  constructor(dateChart) {\n\n    /**\n     * Appends the `left` and `bottom` axis to the date.chart chart.\n     */\n    this.render = function () {\n      let height = dateChart.config.height;\n      let margin = dateChart.config.margin;\n\n      // left axis\n      dateChart.svg\n        .append(\"g\")\n        .call(d3.axisLeft(dateChart.yChart))\n        .attr(\"transform\", () => `translate(${margin.left},0)`);\n\n      // bottom axis\n      dateChart.svg\n        .append(\"g\")\n        .call(d3.axisBottom(dateChart.xChartScale))\n        .attr(\"transform\", () => `translate(0,${height - margin.bottom})`);\n\n    };\n  }\n}\n","/**\n * Appends labels on top of the bars of a date.chart chart.\n * @class TimeChartLabelRenderer\n */\nexport class TimeChartLabelRenderer {\n\n  /**\n   * Creates a new instance of TimeChartLabelRenderer.\n   * @param dateChart The parental date.chart chart.\n   */\n  constructor(dateChart) {\n\n    /**\n     * Appends a label for the given stack.\n     * @param stack The stack to create a label for.\n     */\n    this.renderBarLabels = function (stack) {\n\n      let xChartRef = dateChart.xChartScale;\n      let yChartRef = dateChart.yChart;\n      let xStackRef = dateChart.xStack;\n      let numberFormat = dateChart.config.numberFormat;\n      let labelColor = dateChart.config.labelColor;\n      let numberOfSeries = stack.length;\n      let seriesIndex = 0;\n      let bandwidth = xStackRef.bandwidth() / 2;\n\n      dateChart\n        .svg\n        .append(\"g\")\n        .selectAll('g')\n        .data(stack)\n        .enter()\n        .append('g')\n        .attr('fill', labelColor)\n        .selectAll('.text')\n        .data(dataset => dataset)\n        .enter()\n        .append('text')\n        .attr('class', 'lotivis-date.chart-chart-label')\n        .attr(\"transform\", function (item) {\n          let x = xChartRef(item.data.date) + xStackRef(stack.label) + bandwidth;\n          let y = yChartRef(item[1]) - 5;\n          return `translate(${x},${y})rotate(-60)`;\n        })\n        .text(function (item, index) {\n          if (index === 0) seriesIndex += 1;\n          if (seriesIndex !== numberOfSeries) return;\n          let value = item[1];\n          return value === 0 ? '' : numberFormat.format(value);\n        });\n    };\n  }\n}\n","import {sumOfStack} from \"../data.juggle/data.sum\";\nimport {Color} from \"../shared/color\";\n\n/**\n *\n */\nexport class TimeChartLegendRenderer {\n\n  constructor(dateChart) {\n\n    /**\n     * Renders the legend of the date chart.\n     */\n    this.render = function () {\n      if (dateChart.config.combineStacks) {\n        renderCombinedStacksLegend();\n      } else {\n        renderDefaultLegend();\n      }\n    };\n\n    function renderDefaultLegend() {\n      let config = dateChart.config;\n      let controller = dateChart.datasetController;\n      let numberFormat = dateChart.config.numberFormat;\n      let datasets = controller.datasets;\n      let datasetNames = controller.labels;\n      let circleRadius = 6;\n      let labelMargin = 50;\n\n      let xLegend = d3.scaleBand()\n        .domain(datasetNames)\n        .rangeRound([config.margin.left, config.width - config.margin.right]);\n\n      let legends = dateChart.graph\n        .selectAll('.legend')\n        .data(datasets)\n        .enter();\n\n      legends\n        .append('text')\n        .attr('class', 'lotivis-date.chart-chart-legend-label')\n        .attr(\"font-size\", 13)\n        .attr(\"x\", (item) => xLegend(item.label) - 30)\n        .attr(\"y\", dateChart.graphHeight + labelMargin)\n        .style('cursor', 'pointer')\n        .style(\"fill\", function (item) {\n          return controller.getColorForDataset(item.label);\n        })\n        .text(function (item) {\n          let value = controller.getSumOfDataset(item.label);\n          let formatted = numberFormat.format(value);\n          return `${item.label} (${formatted})`;\n        })\n        .on('click', function (event) {\n          if (!event || !event.target) return;\n          if (!event.target.innerHTML) return;\n          let components = event.target.innerHTML.split(' (');\n          components.pop();\n          let label = components.join(\" (\");\n          console.log('label', label);\n          dateChart.toggleDataset(label);\n        }.bind(this));\n\n      legends\n        .append(\"circle\")\n        .attr('class', 'lotivis-date.chart-chart-legend-circle')\n        .attr(\"r\", circleRadius)\n        .attr(\"cx\", (item) => xLegend(item.label) - (circleRadius * 2) - 30)\n        .attr(\"cy\", dateChart.graphHeight + labelMargin - circleRadius + 2)\n        .style(\"stroke\", (item) => controller.getColorForDataset(item.label))\n        .style(\"fill\", function (item) {\n          return item.isEnabled ? controller.getColorForDataset(item.label) : 'white';\n        }.bind(this));\n    };\n\n    function renderCombinedStacksLegend() {\n      let stackNames = dateChart.datasetController.stacks;\n      let numberFormat = dateChart.config.numberFormat;\n      let circleRadius = 6;\n      let labelMargin = 50;\n\n      let xLegend = d3\n        .scaleBand()\n        .domain(stackNames)\n        .rangeRound([dateChart.config.margin.left, dateChart.config.width - dateChart.config.margin.right]);\n\n      let legends = dateChart\n        .graph\n        .selectAll('.lotivis-date.chart-chart-legend-label')\n        .data(stackNames)\n        .enter();\n\n      legends\n        .append('text')\n        .attr('class', 'lotivis-date.chart-chart-legend-label')\n        .attr(\"font-size\", 23)\n        .attr(\"x\", (item) => xLegend(item) - 30)\n        .attr(\"y\", function () {\n          return dateChart.graphHeight + labelMargin;\n        }.bind(this))\n        .style('cursor', 'pointer')\n        .style(\"fill\", function (item, index) {\n          return Color.colorsForStack(index)[0].rgbString();\n        }.bind(this))\n        .text(function (item) {\n          let value = sumOfStack(dateChart.datasetController.flatData, item);\n          let formatted = numberFormat.format(value);\n          let labels = item.split(',');\n          let text;\n\n          if (labels.length > 3) {\n            labels = labels.splice(0, 3);\n            text = labels.join(', ') + ',...';\n          } else {\n            text = item;\n          }\n\n          return `${text} (${formatted})`;\n\n        }.bind(this));\n\n      legends\n        .append(\"circle\")\n        .attr(\"r\", circleRadius)\n        .attr(\"cx\", item => xLegend(item) - (circleRadius * 2) - 30)\n        .attr(\"cy\", dateChart.graphHeight + labelMargin - circleRadius + 2)\n        .style('cursor', 'pointer')\n        .style(\"stroke\", function (item, index) {\n          return Color.colorsForStack(index)[0].rgbString();\n        }.bind(this))\n        .style(\"fill\", function (item, index) {\n          return item.isEnabled ? Color.colorsForStack(index)[0].rgbString() : 'white';\n        }.bind(this))\n        .style(\"stroke-width\", 2);\n\n    };\n  }\n}\n","import { LotivisConfig } from \"../shared/config\";\n\n/**\n * Appends the bars to a date.chart chart.\n * @class TimeChartBarsRenderer\n */\nexport class TimeChartBarsRenderer {\n  /**\n   * Creates a new instance of TimeChartBarsRenderer.\n   * @param dateChart The parental date.chart chart.\n   */\n  constructor(dateChart) {\n    /**\n     * Appends the bar for the given stack.\n     * @param stack The stack to append the bar for.\n     */\n    this.renderBars = function(stack) {\n      let config = dateChart.config || {};\n      let isCombineStacks = config.combineStacks || false;\n      let colors =\n        dateChart.datasetController.getColorsForStack(stack.stack) ||\n        Color.defaultTint;\n      let barRadius = config.barRadius || LotivisConfig.barRadius;\n\n      dateChart.svg\n        .append(\"g\")\n        .selectAll(\"g\")\n        .data(stack)\n        .enter()\n        .append(\"g\")\n        .attr(\"fill\", (stackData, index) =>\n          isCombineStacks ? colors[0] : stack.colors[index]\n        )\n        .selectAll(\"rect\")\n        .data(data => data)\n        .enter()\n        .append(\"rect\")\n        .attr(\"class\", \"ltv-date-chart-bar\")\n        .attr(\"rx\", isCombineStacks ? 0 : barRadius)\n        .attr(\"ry\", isCombineStacks ? 0 : barRadius)\n        .attr(\n          \"x\",\n          d =>\n            dateChart.xChartScale(d.data.date) + dateChart.xStack(stack.label)\n        )\n        .attr(\"y\", d => dateChart.yChart(d[1]))\n        .attr(\"width\", dateChart.xStack.bandwidth())\n        .attr(\"height\", d => dateChart.yChart(d[0]) - dateChart.yChart(d[1]));\n    };\n  }\n}\n","import { toSaveID } from \"../shared/selector\";\n\n/**\n *\n * @class TimeChartHoverBarsRenderer\n */\nexport class TimeChartHoverBarsRenderer {\n  /**\n   * Creates a new instance of TimeChartHoverBarsRenderer.\n   *\n   * @param dateChart\n   */\n  constructor(dateChart) {\n    function createID(date) {\n      return `ltv-date-chart-hover-bar-id-${toSaveID(String(date))}`;\n    }\n\n    this.hideAll = function() {\n      dateChart.svg.selectAll(`.ltv-date-chart-hover-bar`).attr(`opacity`, 0);\n    };\n\n    function onMouseEnter(event, date) {\n      this.hideAll();\n      dateChart.svg.select(`#${createID(date)}`).attr(\"opacity\", 0.3);\n      dateChart.tooltipRenderer.showTooltip(event, date);\n    }\n\n    function onMouserOut(event, date) {\n      this.hideAll();\n      dateChart.tooltipRenderer.hideTooltip(event, date);\n\n      // check for mouse down\n      if (event.buttons === 1) {\n        onMouseClick(event, date);\n      }\n    }\n\n    function onMouseClick(even, date) {\n      if (dateChart.config.sendsNotifications) {\n        dateChart.makeUpdateInsensible();\n        dateChart.datasetController.toggleDate(date);\n        dateChart.makeUpdateSensible();\n      }\n      dateChart.selectionRenderer.update();\n    }\n\n    this.renderGhostBars = function() {\n      let config = dateChart.config;\n      let margin = config.margin;\n      let dates = dateChart.config.dateLabels || dateChart.dataview.dates;\n\n      dateChart.svg\n        .append(\"g\")\n        .selectAll(\"rect\")\n        .data(dates)\n        .enter()\n        .append(\"rect\")\n        .attr(\"class\", \"ltv-date-chart-hover-bar\")\n        .attr(\"id\", date => createID(date))\n        .attr(\"opacity\", 0)\n        .attr(\"x\", date => dateChart.xChartScale(date))\n        .attr(\"y\", margin.top)\n        .attr(\"width\", dateChart.xChartScale.bandwidth())\n        .attr(\"height\", config.height - margin.bottom - margin.top)\n        .on(\"mouseenter\", onMouseEnter.bind(this))\n        .on(\"mouseout\", onMouserOut.bind(this))\n        .on(\"mousedrag\", onMouserOut.bind(this))\n        .on(\"click\", onMouseClick.bind(this));\n    };\n  }\n}\n","import { combineByDate } from \"../data.juggle/data.combine\";\nimport { LotivisConfig } from \"../shared/config\";\n\n/**\n * Injects and presents a tooltip on a date.chart chart.\n *\n * @class TimeChartTooltipRenderer\n */\nexport class TimeChartTooltipRenderer {\n  /**\n   * Creates a new instance of TimeChartTooltipRenderer.\n   *\n   * @constructor\n   */\n  constructor(dateChart) {\n    const tooltip = dateChart.element\n      .append(\"div\")\n      .attr(\"class\", \"ltv-tooltip\")\n      .attr(\"rx\", 5) // corner radius\n      .attr(\"ry\", 5)\n      .style(\"opacity\", 0);\n\n    /**\n     * Returns the size [width, height] of the tooltip.\n     *\n     * @returns {number[]}\n     */\n    function getTooltipSize() {\n      let tooltipWidth = Number(tooltip.style(\"width\").replace(\"px\", \"\"));\n      let tooltipHeight = Number(tooltip.style(\"height\").replace(\"px\", \"\"));\n      return [tooltipWidth, tooltipHeight];\n    }\n\n    /**\n     * Calculates and returns the top pixel position for the tooltip.\n     *\n     * @param factor The size factor of the chart.\n     * @param offset The offset of the chart.\n     * @param tooltipSize The size of the tooltip.\n     * @returns {number}\n     */\n    function getTop(factor, offset, tooltipSize) {\n      let top = dateChart.config.margin.top * factor;\n      top += (dateChart.graphHeight * factor - tooltipSize[1]) / 2;\n      top += offset[1] - 10;\n      return top;\n    }\n\n    /**\n     * Calculates the x offset to position the tooltip on the left side\n     * of a bar.\n     *\n     * @param date The presented date.chart of selected bar.\n     * @param factor The size factor of the chart.\n     * @param offset The offset of the chart.\n     * @param tooltipSize The size of the tooltip.\n     * @returns {number} The x offset for the tooltip.\n     */\n    function getXLeft(date, factor, offset, tooltipSize) {\n      let x = dateChart.xChartScalePadding(date) * factor;\n      return x + offset[0] - tooltipSize[0] - 22 - LotivisConfig.tooltipOffset;\n    }\n\n    /**\n     * Calculates the x offset to position the tooltip on the right side\n     * of a bar.\n     *\n     * @param date The presented date.chart of selected bar.\n     * @param factor The size factor of the chart.\n     * @param offset The offset of the chart.\n     * @returns {number} The x offset for the tooltip.\n     */\n    function getXRight(date, factor, offset) {\n      let x =\n        dateChart.xChartScalePadding(date) +\n        dateChart.xChartScalePadding.bandwidth();\n      x *= factor;\n      x += offset[0] + LotivisConfig.tooltipOffset;\n      return x;\n    }\n\n    /**\n     * Returns the HTML content for the given date.chart.\n     *\n     * @param date The date.chart to get the HTML content for.\n     * @returns {string} Return the rendered HTML content.\n     */\n    function getHTMLForDate(date) {\n      let flatData = dateChart.snapshot.flatData.filter(\n        item => `${item.date}` === `${date}`\n      );\n\n      let first = flatData.first();\n      let title;\n      if (first && first.from && first.till) {\n        title = `${first.from} - ${first.till}`;\n      } else {\n        title = `${date}`;\n      }\n\n      let sum = 0;\n      let dataHTML = combineByDate(flatData)\n        .filter(item => item.value > 0)\n        .map(function(item) {\n          let color = dateChart.datasetController.getColorForDataset(\n            item.dataset\n          );\n          let divHTML = `<div style=\"background: ${color};color: ${color}; display: inline;\">__</div>`;\n          let valueFormatted = dateChart.config.numberFormat.format(item.value);\n          sum += item.value;\n          return `${divHTML} ${item.dataset}: <b>${valueFormatted}</b>`;\n        })\n        .join(\"<br>\");\n\n      let sumFormatted = dateChart.config.numberFormat.format(sum);\n      return `<b>${title}</b><br>${dataHTML}<br><br>Sum: <b>${sumFormatted}</b>`;\n    }\n\n    /**\n     * Presents the tooltip next to bar presenting the given date.chart.\n     *\n     * @param event The mouse event.\n     * @param date The date.chart which is presented.\n     */\n    this.showTooltip = function(event, date) {\n      // set examples content before positioning the tooltip cause the size is\n      // calculated based on the size\n      const html = getHTMLForDate(date);\n      tooltip.html(html);\n\n      // position tooltip\n      let tooltipSize = getTooltipSize();\n      let factor =\n        dateChart.getElementEffectiveSize()[0] / dateChart.config.width;\n      let offset = dateChart.getElementPosition();\n      let top = getTop(factor, offset, tooltipSize);\n      let left = dateChart.xChartScalePadding(date);\n\n      // differ tooltip position on bar position\n      if (left > dateChart.config.width / 2) {\n        left = getXLeft(date, factor, offset, tooltipSize);\n      } else {\n        left = getXRight(date, factor, offset);\n      }\n\n      // update position and opacity of tooltip\n      tooltip\n        .style(\"left\", `${left}px`)\n        .style(\"top\", `${top}px`)\n        .style(\"opacity\", 1);\n    };\n\n    /**\n     * Hides the tooltip.  Does nothing if tooltips opacity is already 0.\n     */\n    this.hideTooltip = function() {\n      if (+tooltip.style(\"opacity\") === 0) return;\n      tooltip.style(\"opacity\", 0);\n    };\n  }\n}\n","/**\n * @class TimeChartGridRenderer\n */\nexport class TimeChartGridRenderer {\n\n  /**\n   * Creates a new instance of TimeChartGridRenderer.\n   *\n   * @param dateChart\n   */\n  constructor(dateChart) {\n\n    /**\n     *\n     */\n    this.createAxis = function () {\n\n      this.xAxisGrid = d3\n        .axisBottom(dateChart.xChartScale)\n        .tickSize(-dateChart.graphHeight)\n        .tickFormat('');\n\n      this.yAxisGrid = d3\n        .axisLeft(dateChart.yChart)\n        .tickSize(-dateChart.graphWidth)\n        .tickFormat('')\n        .ticks(20);\n\n    };\n\n    /**\n     *\n     */\n    this.renderGrid = function () {\n      let config = dateChart.config;\n      let color = 'lightgray';\n      let width = '0.5';\n      let opacity = 0.3;\n\n      dateChart.svg\n        .append('g')\n        .attr('class', 'x axis-grid')\n        .attr('transform', 'translate(0,' + (config.height - config.margin.bottom) + ')')\n        .attr('stroke', color)\n        .attr('stroke-width', width)\n        .attr(\"opacity\", opacity)\n        .call(this.xAxisGrid);\n\n      dateChart.svg\n        .append('g')\n        .attr('class', 'y axis-grid')\n        .attr('transform', `translate(${config.margin.left},0)`)\n        .attr('stroke', color)\n        .attr('stroke-width', width)\n        .attr(\"opacity\", opacity)\n        .call(this.yAxisGrid);\n\n    };\n  }\n}\n","import { toSaveID } from \"../shared/selector\";\n\n/**\n *\n * @class TimeChartSelectionRenderer\n */\nexport class TimeChartSelectionRenderer {\n  /**\n   * Creates a new instance of TimeChartHoverBarsRenderer.\n   * @param dateChart\n   */\n  constructor(dateChart) {\n    function createID(date) {\n      return `ltv-date-chart-selection-rect-id-${toSaveID(String(date))}`;\n    }\n\n    function getSelectedDates() {\n      if (!dateChart.datasetController) {\n        return [];\n      }\n      return dateChart.datasetController.filters.dates || [];\n    }\n\n    this.hideAll = function() {\n      dateChart.svg\n        .selectAll(`.ltv-date-chart-selection-rect`)\n        .attr(`opacity`, 0);\n    };\n\n    this.render = function() {\n      let margin = dateChart.config.margin;\n      let dates = dateChart.config.dateLabels || dateChart.dataview.dates;\n\n      dateChart.svg\n        .append(\"g\")\n        .selectAll(\"rect\")\n        .data(dates)\n        .enter()\n        .append(\"rect\")\n        .attr(\"class\", \"ltv-date-chart-selection-rect\")\n        .attr(\"id\", date => createID(date))\n        .attr(\"x\", date => dateChart.xChartScale(date))\n        .attr(\"y\", margin.top)\n        .attr(\"opacity\", 0)\n        .attr(\"width\", dateChart.xChartScale.bandwidth())\n        .attr(\"height\", dateChart.config.height - margin.bottom - margin.top);\n    };\n\n    this.update = function() {\n      let selectedDates = getSelectedDates();\n      dateChart.svg\n        .selectAll(`.ltv-date-chart-selection-rect`)\n        .attr(`opacity`, date =>\n          selectedDates.includes(String(date)) ? 0.15 : 0\n        );\n    };\n  }\n}\n","import {LotivisConfig} from \"../shared/config\";\nimport {Color} from \"../shared/color\";\n\nexport const DATE_CHART_CONFIG = {\n  width: 1000,\n  height: 600,\n  margin: {\n    top: LotivisConfig.defaultMargin,\n    right: LotivisConfig.defaultMargin,\n    bottom: LotivisConfig.defaultMargin,\n    left: LotivisConfig.defaultMargin\n  },\n  showLabels: false,\n  combineStacks: false,\n  sendsNotifications: true,\n  labelColor: new Color(155, 155, 155),\n  numberFormat: Intl.NumberFormat('de-DE', {\n    maximumFractionDigits: 3\n  }),\n  dateAccess: function (date) {\n    return Date.parse(date);\n  }\n};\n","import { Chart } from \"../chart/chart\";\nimport { DateChartAxisRenderer } from \"./date.chart.axis.renderer\";\nimport { TimeChartLabelRenderer } from \"./time.chart.label.renderer\";\nimport { TimeChartLegendRenderer } from \"./time.chart.legend.renderer\";\nimport { TimeChartBarsRenderer } from \"./time.chart.bars.renderer\";\nimport { TimeChartHoverBarsRenderer } from \"./time.chart.hover.bars.renderer\";\nimport { TimeChartTooltipRenderer } from \"./time.chart.tooltip.renderer\";\nimport { TimeChartGridRenderer } from \"./time.chart.grid.renderer\";\nimport { TimeChartSelectionRenderer } from \"./time.chart.selection.renderer\";\nimport { DATE_CHART_CONFIG } from \"./date.chart.config\";\n\n/**\n *\n * @class DateChart\n * @extends Chart\n */\nexport class DateChart extends Chart {\n  // called by `Chart` superclass\n  /**\n   * Initializes this diachronic chart by setting the default values.\n   *\n   * @override\n   */\n  initialize() {\n    this.initializeDefaultValues();\n    this.initializeRenderers();\n  }\n\n  /**\n   *\n   */\n  initializeDefaultValues() {\n    let margin, config;\n\n    margin = Object.assign({}, DATE_CHART_CONFIG.margin);\n    margin = Object.assign(margin, this.config.margin);\n\n    config = Object.assign({}, DATE_CHART_CONFIG);\n\n    this.config = Object.assign(config, this.config);\n    this.config.margin = margin;\n  }\n\n  initializeRenderers() {\n    this.axisRenderer = new DateChartAxisRenderer(this);\n    this.gridRenderer = new TimeChartGridRenderer(this);\n    this.labelRenderer = new TimeChartLabelRenderer(this);\n    this.legendRenderer = new TimeChartLegendRenderer(this);\n    this.barsRenderer = new TimeChartBarsRenderer(this);\n    this.ghostBarsRenderer = new TimeChartHoverBarsRenderer(this);\n    this.selectionRenderer = new TimeChartSelectionRenderer(this);\n    this.tooltipRenderer = new TimeChartTooltipRenderer(this);\n  }\n\n  /**\n   * Removes all `svg`s from the parental element.\n   * @override\n   */\n  remove() {\n    this.element.selectAll(\"svg\").remove();\n  }\n\n  /**\n   * @override\n   */\n  precalculate() {\n    let config = this.config;\n    let margin = config.margin;\n    this.graphWidth = config.width - margin.left - margin.right;\n    this.graphHeight = config.height - margin.top - margin.bottom;\n    if (!this.datasetController) return;\n    let groupSize = this.config.groupSize || 1;\n\n    if (this.config.combineStacks) {\n      this.dataview = this.datasetController.getDateDataviewCombinedStacks(\n        groupSize\n      );\n    } else {\n      this.dataview = this.datasetController.getDateDataview(groupSize);\n    }\n    this.createScales();\n  }\n\n  /**\n   * Creates scales which are used to calculate the x and y positions of bars or circles.\n   */\n  createScales() {\n    if (!this.dataview) return;\n\n    let config = this.config;\n    let margin = config.margin;\n\n    /*\n     * Prefer dates specified by configuration. Fallback to dates of datasets.\n     */\n    let dates = config.dateLabels || this.dataview.dates;\n\n    this.xChartScale = d3\n      .scaleBand()\n      .domain(dates)\n      .rangeRound([margin.left, config.width - margin.right]);\n\n    this.xChartScalePadding = d3\n      .scaleBand()\n      .domain(dates)\n      .rangeRound([margin.left, config.width - margin.right])\n      .paddingInner(0.2);\n\n    this.xStack = d3\n      .scaleBand()\n      .domain(this.dataview.enabledStacks)\n      .rangeRound([0, this.xChartScale.bandwidth()])\n      .padding(0.05);\n\n    this.yChart = d3\n      .scaleLinear()\n      .domain([0, this.dataview.max])\n      .nice()\n      .rangeRound([config.height - margin.bottom, margin.top]);\n  }\n\n  /**\n   * Creates and renders the chart.\n   *\n   * @override\n   */\n  draw() {\n    this.renderSVG();\n    if (\n      !this.dataview ||\n      !this.dataview.datasetStacks ||\n      this.dataview.datasetStacks.length === 0\n    )\n      return;\n\n    this.axisRenderer.render();\n    this.gridRenderer.createAxis();\n    this.gridRenderer.renderGrid();\n    this.selectionRenderer.render();\n    this.ghostBarsRenderer.renderGhostBars();\n    this.legendRenderer.render();\n\n    for (\n      let index = 0;\n      index < this.dataview.datasetStacksPresented.length;\n      index++\n    ) {\n      let stack = this.dataview.datasetStacksPresented[index];\n      this.barsRenderer.renderBars(stack, index);\n      if (this.config.showLabels === false) continue;\n      this.labelRenderer.renderBarLabels(stack, index);\n    }\n  }\n\n  /**\n   *\n   */\n  renderSVG() {\n    this.svg = this.element\n      .append(\"svg\")\n      .attr(\"class\", \"ltv-chart-svg ltv-date-chart-svg\")\n      .attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n      .attr(\"viewBox\", `0 0 ${this.config.width} ${this.config.height}`)\n      .attr(\"id\", this.svgSelector);\n\n    this.background = this.svg\n      .append(\"rect\")\n      .attr(\"width\", this.config.width)\n      .attr(\"height\", this.config.height)\n      .attr(\"fill\", \"white\")\n      .attr(\"opacity\", 0)\n      .attr(\"cursor\", \"pointer\")\n      .on(\"click\", (event, some) => {\n        this.datasetController.resetDateFilters();\n      });\n\n    this.graph = this.svg\n      .append(\"g\")\n      .attr(\"width\", this.graphWidth)\n      .attr(\"height\", this.graphHeight)\n      .attr(\n        \"transform\",\n        `translate(${this.config.margin.left},${this.config.margin.top})`\n      );\n  }\n\n  /**\n   * Toggle the enabled of the dataset with the given label.\n   * @param label The label of the dataset.\n   */\n  toggleDataset(label) {\n    this.datasetController.toggleDataset(\n      label,\n      this.config.sendsNotifications === true\n    );\n    this.update();\n  }\n}\n","/**\n *\n * @class UrlParameters\n */\nexport class UrlParameters {\n\n  /**\n   * Returns the singleton instance.\n   *\n   * @returns {UrlParameters}\n   */\n  static getInstance() {\n    if (!UrlParameters.instance) {\n      UrlParameters.instance = new UrlParameters();\n    }\n    return UrlParameters.instance;\n  }\n\n  /**\n   * Return the current window URL.\n   * @returns {URL}\n   */\n  getURL() {\n    return new URL(window.location.href);\n  }\n\n  getBoolean(parameter, defaultValue = false) {\n    let value = this.getURL().searchParams.get(parameter);\n    return value ? value === 'true' : defaultValue;\n  }\n\n  getString(parameter, defaultValue = '') {\n    return this.getURL().searchParams.get(parameter) || defaultValue;\n  }\n\n  set(parameter, newValue) {\n    const url = this.getURL();\n\n    if (newValue === false) {\n      url.searchParams.delete(parameter);\n    } else {\n      url.searchParams.set(parameter, newValue);\n    }\n\n    window.history.replaceState(null, null, url);\n    this.updateCurrentPageFooter();\n  }\n\n  setWithoutDeleting(parameter, newValue) {\n    const url = this.getURL();\n    url.searchParams.set(parameter, newValue);\n    window.history.replaceState(null, null, url);\n    this.updateCurrentPageFooter();\n  }\n\n  clear() {\n    const url = this.getURL();\n    const newPath = url.protocol + url.host;\n    const newURL = new URL(newPath);\n    window.history.replaceState(null, null, newURL);\n    this.updateCurrentPageFooter();\n  }\n\n  updateCurrentPageFooter() {\n    // console.log('window.lotivisApplication: ' + window.lotivisApplication);\n    // window.lotivisApplication.currentPage.updateFooter();\n    const url = this.getURL();\n    d3\n      .select('#lotivis-url-container')\n      .text(url);\n  }\n}\n\nUrlParameters.language = 'language';\nUrlParameters.page = 'page';\nUrlParameters.query = 'query';\nUrlParameters.searchViewMode = 'search-view-mode';\nUrlParameters.chartType = 'chart-type';\nUrlParameters.chartShowLabels = 'chart-show-labels';\nUrlParameters.chartCombineStacks = 'combine-stacks';\nUrlParameters.contentType = 'content-type';\nUrlParameters.valueType = 'value-type';\nUrlParameters.searchSensitivity = 'search-sensitivity';\nUrlParameters.startYear = 'start-year';\nUrlParameters.endYear = 'end-year';\n\nUrlParameters.showTestData = 'show-samples';\n","import { Popup } from \"./popup\";\nimport { Button } from \"./button\";\nimport { downloadImage } from \"../shared/download\";\nimport { createDownloadFilename } from \"../shared/filename\";\n\n/**\n * @class SettingsPopup\n * @extends Popup\n */\nexport class SettingsPopup extends Popup {\n  /**\n   * Creates a new instance of SettingsPopup.\n   */\n  constructor(parent) {\n    super(parent);\n  }\n\n  /**\n   * Appends the content of the settings popup.\n   * @override\n   */\n  inject() {\n    super.inject();\n    this.card.setTitle(\"\");\n    this.row = this.card.content.append(\"div\").classed(\"row\", true);\n\n    let container = this.row.append(\"div\");\n    this.screenshotButton = new Button(container);\n    this.screenshotButton.setText(\"Make Screenshot\");\n    this.screenshotButton.element.classed(\"ltv-button ltv-button-block\", true);\n    this.screenshotButton.onClick = this.screenshotButtonAction.bind(this);\n  }\n\n  /**\n   * Returns the preferred size of the popup.\n   * @returns {{width: number, height: number}}\n   * @override\n   */\n  preferredSize() {\n    return { width: 240, height: 600 };\n  }\n\n  /**\n   * Triggered when the screenshot button is pushed.\n   *\n   * Should be overridden by subclasses.\n   */\n  screenshotButtonAction() {\n    let filename = this.chart.datasetController.getFilename() || \"unknown\";\n    let downloadFilename = createDownloadFilename(filename, `chart`);\n    downloadImage(this.chart.svgSelector, downloadFilename);\n  }\n}\n","import { Checkbox } from \"../shared.components/checkbox\";\nimport { UrlParameters } from \"../shared/url.parameters\";\nimport { SettingsPopup } from \"../shared.components/settings.popup\";\n\n/**\n *\n * @class DateChartCardSettingsPopup\n * @extends SettingsPopup\n */\nexport class DateChartCardSettingsPopup extends SettingsPopup {\n  inject() {\n    super.inject();\n    this.injectShowLabelsCheckbox();\n    this.injectCombineStacksCheckbox();\n  }\n\n  injectShowLabelsCheckbox() {\n    let container = this.row.append(\"div\");\n    this.showLabelsCheckbox = new Checkbox(container);\n    this.showLabelsCheckbox.setText(\"Labels\");\n    this.showLabelsCheckbox.onClick = function(checked) {\n      this.chart.config.showLabels = checked;\n      this.chart.update();\n      UrlParameters.getInstance().set(\n        `showLabels-${this.chart.selector}`,\n        checked\n      );\n    }.bind(this);\n  }\n\n  injectCombineStacksCheckbox() {\n    let container = this.row.append(\"div\");\n    this.combineStacksCheckbox = new Checkbox(container);\n    this.combineStacksCheckbox.setText(\"Combine Stacks\");\n    this.combineStacksCheckbox.onClick = function(checked) {\n      this.chart.config.combineStacks = checked;\n      this.chart.update();\n      UrlParameters.getInstance().set(\n        `combineStacks-${this.chart.selector}`,\n        checked\n      );\n    }.bind(this);\n  }\n\n  willShow() {\n    this.showLabelsCheckbox.setChecked(this.chart.config.showLabels);\n    this.combineStacksCheckbox.setChecked(this.chart.config.combineStacks);\n  }\n}\n","import { Card } from \"./card\";\nimport { Button } from \"./button\";\nimport { Dropdown } from \"./dropdown\";\nimport { Option } from \"./option\";\nimport { LotivisUnimplementedMethodError } from \"../data.juggle/data.validate.error\";\nimport { lotivis_log } from \"../shared/debug\";\n\n/**\n * A lotivis card with a chart.\n * @class ChartCard\n * @extends Card\n */\nexport class ChartCard extends Card {\n  /**\n   * Creates a new instance of ChartCard.\n   * @param parent The parental component.\n   * @param config The configuration\n   */\n  constructor(parent, config) {\n    if (parent && config && typeof parent === \"string\") {\n      config.selector = parent;\n      super(config);\n    } else {\n      super(parent);\n    }\n\n    this.chart = null;\n    this.config = config;\n    this.injectButtons();\n    this.injectRadioGroup();\n    this.injectChart();\n\n    let cardSelector = this.selector;\n    this.setTitle(\n      config && config.title ? config.title : cardSelector || \"No Title\"\n    );\n  }\n\n  /**\n   * Creates and injects the chart.\n   * Should be overridden by subclasses.\n   */\n  injectChart() {\n    return new LotivisUnimplementedMethodError(`injectChart()`);\n  }\n\n  /**\n   * Creates and injects a screenshot button and a more button.\n   */\n  injectButtons() {\n    this.moreButton = new Button(this.headerRightComponent);\n    this.moreButton.setText(\"More\");\n    this.moreButton.element.classed(\"ltv-button\", true);\n    this.moreButton.onClick = this.presentSettingsPopupAction.bind(this);\n  }\n\n  /**\n   * Creates and injects a radio button group.\n   */\n  injectRadioGroup() {\n    this.dropdown = new Dropdown(this.headerCenterComponent);\n    this.dropdown.onChange = function(value) {\n      let dataset = this.datasets.find(function(dataset) {\n        if (!dataset.label) return false;\n        return dataset.label.split(` `).join(`-`) === value;\n      });\n      dataset = this.datasets.find(dataset => dataset.label === value);\n      if (!dataset)\n        return lotivis_log(`Can't find dataset with label ${value}`);\n      this.setDataset(dataset);\n    }.bind(this);\n  }\n\n  /**\n   * Updates the options of the radio button group dependant on the given datasets.\n   */\n  updateRadioGroup() {\n    if (!this.datasets) return;\n    let names = this.datasets.map(dataset => dataset.label || \"Unknown Label\");\n    let options = names.map(name => new Option(name));\n    this.dropdown.setOptions(options);\n  }\n\n  /**\n   *\n   * @param datasets\n   */\n  setDatasets(datasets) {\n    this.datasets = datasets;\n    this.updateRadioGroup();\n    let firstDataset = datasets[0];\n    this.setDataset(firstDataset);\n  }\n\n  /**\n   *\n   * @param dataset\n   */\n  setDataset(dataset) {\n    lotivis_log(\"this.chart: \" + this.chart);\n    lotivis_log(\"this.chart: \", dataset);\n    if (!this.chart) return;\n    if (Array.isArray(dataset)) {\n      this.chart.setDatasets(dataset);\n    } else {\n      this.chart.setDatasets([dataset]);\n    }\n\n    if (this.onSelectedDatasetChanged) {\n      let datasetLabel = dataset.stack || dataset.label || `Unknown`;\n      let index = (this.datasets || []).indexOf(dataset);\n      this.onSelectedDatasetChanged(dataset, index, datasetLabel);\n    }\n  }\n\n  /**\n   * Triggered when the more button is pushed.\n   *\n   * Should be overridden by subclasses.\n   */\n  presentSettingsPopupAction() {\n    return new LotivisUnimplementedMethodError(`presentSettingsPopupAction()`);\n  }\n\n  /**\n   * Triggered for a change of the radio group.\n   *\n   * Should be overridden by subclasses.\n   */\n  onSelectedDatasetChanged() {\n    return new LotivisUnimplementedMethodError(`onSelectedDatasetChanged()`);\n  }\n}\n","import { Card } from \"../shared.components/card\";\nimport { DateChart } from \"../date.chart/date.chart\";\nimport { DateChartCardSettingsPopup } from \"./date.chart.card.settings.popup\";\nimport { Dropdown } from \"../shared.components/dropdown\";\nimport { Option } from \"../shared.components/option\";\nimport { ChartCard } from \"../shared.components/chart.card\";\nimport { downloadImage } from \"../shared/download\";\nimport { createDownloadFilename } from \"../shared/filename\";\nimport { UrlParameters } from \"../shared/url.parameters\";\n\n/**\n * A lotivis date.chart chart card.\n * @class DateChartCard\n * @extends Card\n */\nexport class DateChartCard extends ChartCard {\n  /**\n   * Creates a new instance of DateChartCard.\n   * @param {Component| string} selector The parental component or the selector.\n   * @param config\n   */\n  constructor(selector, config = {}) {\n    let theSelector = selector || config.selector || \"date-chart-card\";\n    super(theSelector, config);\n    this.selector = theSelector;\n    this.datasets = [];\n  }\n\n  /**\n   * Appends the `DateChart` to this card.\n   * @override\n   */\n  injectChart() {\n    this.chartID = this.selector + \"-chart\";\n    this.body.attr(\"id\", this.chartID);\n    this.chart = new DateChart(this.chartID, this.config);\n    this.applyURLParameters();\n  }\n\n  /**\n   * Appends a radio group to the header of the card.\n   */\n  injectRadioGroup() {\n    this.dropdown = new Dropdown(this.headerCenterComponent);\n    this.dropdown.onChange = function(value) {\n      let dataset = this.datasets.find(dataset => dataset.label === value);\n      this.setDataset(dataset);\n    }.bind(this);\n  }\n\n  /**\n   * Updates the radio group dependant on the datasets of this card.\n   */\n  updateRadioGroup() {\n    if (!this.datasets) return;\n    let names = this.datasets.map(dataset => dataset.label);\n    let options = names.map(name => new Option(name));\n    this.dropdown.setOptions(options);\n  }\n\n  /**\n   *\n   */\n  applyURLParameters() {\n    let parameters = UrlParameters.getInstance();\n    this.chart.config.showLabels = parameters.getBoolean(\n      `showLabels-${this.chartID}`,\n      this.chart.config.showLabels\n    );\n    this.chart.config.combineStacks = parameters.getBoolean(\n      `combineStacks-${this.chartID}`,\n      this.chart.config.combineStacks\n    );\n  }\n\n  /**\n   * Tells this chart card to present the setting popup card.\n   * @override\n   */\n  presentSettingsPopupAction() {\n    let button = document.getElementById(this.moreButton.selector);\n    let settingsPopup = new DateChartCardSettingsPopup();\n    settingsPopup.chart = this.chart;\n    settingsPopup.showUnder(button, \"right\");\n  }\n\n  /**\n   * Creates and downloads a screenshot from the chart.\n   * @override\n   */\n  screenshotButtonAction() {\n    let filename =\n      this.chart.datasetController.getFilename() || \"date.chart-chart\";\n    let downloadFilename = createDownloadFilename(filename, `date-chart`);\n    downloadImage(this.chart.svgSelector, downloadFilename);\n  }\n}\n","/**\n *\n * @param geoJSON\n * @param removeCandidates\n * @returns {*}\n */\nexport function removeFeatures(geoJSON, removeCandidates) {\n  if (!Array.isArray(removeCandidates)) return geoJSON;\n  let newGeoJSON = geoJSON;\n  for (let index = 0; index < removeCandidates.length; index++) {\n    let code = removeCandidates[index];\n    let candidate = newGeoJSON.features.find(feature => feature.properties.code === code);\n    if (!candidate) continue;\n    let candidateIndex = newGeoJSON.features.indexOf(candidate);\n    if (candidateIndex < 0) continue;\n    newGeoJSON.features.splice(candidateIndex, 1);\n  }\n  return newGeoJSON;\n}\n","/**\n * Returns the style of the given CSS class or an empty object.\n *\n * @param className The CSS class name.\n * @returns {{}} The CSS style.\n */\nexport function styleForCSSClass(className) {\n  let selector = className;\n  if (!selector.startsWith('.')) selector = '.' + selector;\n  let element = document.querySelector(selector);\n  if (!element) return {};\n  let style = getComputedStyle(element);\n  return style ? style : {};\n}\n","/**\n * The default number format.\n *\n * @type {Intl.NumberFormat}\n */\nconst numberFormat = new Intl.NumberFormat('de-DE', {\n  maximumFractionDigits: 3\n});\n\n/**\n * Returns the formatted version from the given number.\n *\n * @param number The number to format.\n * @returns {string} The formatted version of the number.\n */\nexport function formatNumber(number) {\n  if (typeof number !== 'number') return number;\n  return numberFormat.format(number);\n}\n","import { combineByLocation } from \"../data.juggle/data.combine\";\nimport { styleForCSSClass } from \"../shared/style\";\nimport { formatNumber } from \"../shared/format\";\nimport { equals } from \"../shared/equal\";\nimport { LotivisConfig } from \"../shared/config\";\n\n/**\n *\n * @class MapTooltipRenderer\n */\nexport class MapTooltipRenderer {\n  /**\n   * Creates a new instance of MapTooltipRenderer.\n   * @param mapChart The parental map.chart chart.\n   */\n  constructor(mapChart) {\n    this.mapChart = mapChart;\n\n    let tooltip = mapChart.element\n      .append(\"div\")\n      .attr(\"class\", \"ltv-tooltip\")\n      .attr(\"rx\", 5) // corner radius\n      .attr(\"ry\", 5)\n      .style(\"opacity\", 0);\n\n    function featureMapID(feature) {\n      return `lotivis-map-area-${feature.lotivisId}`;\n    }\n\n    function htmlTitle(features) {\n      if (features.length > 3) {\n        let featuresSlice = features.slice(0, 3);\n        let ids = featuresSlice\n          .map(feature => `${feature.lotivisId}`)\n          .join(\", \");\n        let names = featuresSlice\n          .map(mapChart.config.featureNameAccessor)\n          .join(\", \");\n        let moreCount = features.length - 3;\n        return `IDs: ${ids} (+${moreCount})<br>Names: ${names} (+${moreCount})`;\n      } else {\n        let ids = features.map(feature => `${feature.lotivisId}`).join(\", \");\n        let names = features\n          .map(mapChart.config.featureNameAccessor)\n          .join(\", \");\n        return `IDs: ${ids}<br>Names: ${names}`;\n      }\n    }\n\n    function htmlValues(features) {\n      if (!mapChart.datasetController) {\n        return \"\";\n      }\n\n      let flatData = mapChart.datasetController.flatData;\n      let combined = combineByLocation(flatData);\n      let combinedByLabel = {};\n\n      for (let i = 0; i < features.length; i++) {\n        let feature = features[i];\n        let data = combined.filter(item =>\n          equals(item.location, feature.lotivisId)\n        );\n\n        for (let index = 0; index < data.length; index++) {\n          let item = data[index];\n          let label = item.label || item.dataset || item.stack;\n\n          if (combinedByLabel[label]) {\n            combinedByLabel[label] += item.value;\n          } else {\n            combinedByLabel[label] = item.value;\n          }\n        }\n      }\n\n      let components = [\"\"];\n      for (const label in combinedByLabel) {\n        components.push(label + \": \" + formatNumber(combinedByLabel[label]));\n      }\n\n      return components.join(\"<br>\");\n    }\n\n    /**\n     * Returns the size of the tooltip.\n     * @returns {number[]}\n     */\n    function getTooltipSize() {\n      let tooltipWidth = Number(\n        tooltip.style(\"width\").replace(\"px\", \"\") || 200\n      );\n      let tooltipHeight = Number(tooltip.style(\"height\").replace(\"px\", \"\"));\n      return [tooltipWidth + 20, tooltipHeight + 20];\n    }\n\n    function positionTooltip(event, feature) {\n      // position tooltip\n      let tooltipSize = getTooltipSize();\n      let projection = mapChart.projection;\n      let featureBounds = d3.geoBounds(feature);\n      let featureLowerLeft = projection(featureBounds[0]);\n      let featureUpperRight = projection(featureBounds[1]);\n      let featureBoundsWidth = featureUpperRight[0] - featureLowerLeft[0];\n\n      // svg is presented in dynamic sized view box so we need to get the actual size\n      // of the element in order to calculate a scale for the position of the tooltip.\n      let effectiveSize = mapChart.getElementEffectiveSize();\n      let factor = effectiveSize[0] / mapChart.config.width;\n      let positionOffset = mapChart.getElementPosition();\n\n      /**\n       * Calculates and returns the left position for the tooltip.\n       * @returns {*} The left position in pixels.\n       */\n      function getTooltipLeft() {\n        let left = featureLowerLeft[0];\n        left += featureBoundsWidth / 2;\n        left *= factor;\n        left -= tooltipSize[0] / 2;\n        left += positionOffset[0];\n        return left;\n      }\n\n      /**\n       * Calculates and returns the top tooltip position when displaying above a feature.\n       * @returns {*} The top position in pixels.\n       */\n      function getTooltipLocationAbove() {\n        let top = featureUpperRight[1] * factor;\n        top -= tooltipSize[1];\n        top += positionOffset[1];\n        top -= LotivisConfig.tooltipOffset;\n        return top;\n      }\n\n      /**\n       * Calculates and returns the top tooltip position when displaying under a feature.\n       * @returns {*} The top position in pixels.\n       */\n      function getTooltipLocationUnder() {\n        let top = featureLowerLeft[1] * factor;\n        top += positionOffset[1];\n        top += LotivisConfig.tooltipOffset;\n        return top;\n      }\n\n      let top = 0;\n      if (featureLowerLeft[1] > mapChart.config.height / 2) {\n        top = getTooltipLocationAbove();\n      } else {\n        top = getTooltipLocationUnder();\n      }\n\n      let left = getTooltipLeft();\n      tooltip\n        .style(\"opacity\", 1)\n        .style(\"left\", left + \"px\")\n        .style(\"top\", top + \"px\");\n    }\n\n    /**\n     * Called by map.chart geojson renderer when mouse enters an area drawn on the map.chart.\n     * @param event The mouse event.\n     * @param feature The drawn feature (area).\n     */\n    this.mouseEnter = function(event, feature) {\n      if (\n        mapChart.datasetController &&\n        mapChart.datasetController.filters.locations.includes(feature.lotivisId)\n      ) {\n        tooltip.html(\n          [\n            htmlTitle(mapChart.selectedFeatures),\n            htmlValues(mapChart.selectedFeatures)\n          ].join(\"<br>\")\n        );\n        positionTooltip(event, mapChart.selectionBorderGeoJSON.features[0]);\n      } else {\n        tooltip.html(\n          [htmlTitle([feature]), htmlValues([feature])].join(\"<br>\")\n        );\n        positionTooltip(event, feature);\n      }\n    };\n\n    /**\n     * Called by map.chart geojson renderer when mouse leaves an area drawn on the map.chart.\n     * @param event The mouse event.\n     * @param feature The drawn feature (area).\n     */\n    this.mouseOut = function(event, feature) {\n      let style = styleForCSSClass(\".lotivis-map.chart-area\");\n      let mapID = featureMapID(feature);\n      mapChart.svg\n        .select(`#${mapID}`)\n        .style(\"stroke\", style.stroke || \"black\")\n        .style(\"stroke-width\", style[\"stroke-width\"] || \"0.7\")\n        .style(\"stroke-dasharray\", feature =>\n          feature.departmentsData ? \"0\" : \"1,4\"\n        );\n      tooltip.style(\"opacity\", 0);\n    };\n\n    /**\n     * Raises the tooltip and the rectangle which draws the bounds.\n     */\n    this.raise = function() {\n      tooltip.raise();\n    };\n  }\n}\n","import { Color } from \"../shared/color\";\nimport { formatNumber } from \"../shared/format\";\n\n/**\n *\n * @class MapLegendRenderer\n */\nexport class MapLegendRenderer {\n  /**\n   * Creates a new instance of MapLegendRenderer.\n   *\n   * @param mapChart The parental map.chart chart.\n   */\n  constructor(mapChart) {\n    let legend;\n\n    function appendLegend() {\n      legend = mapChart.svg\n        .append(\"svg\")\n        .attr(\"class\", \"ltv-map-chart-legend\")\n        .attr(\"width\", mapChart.width)\n        .attr(\"height\", 200)\n        .attr(\"x\", 0)\n        .attr(\"y\", 0);\n    }\n\n    function removeDatasetLegend() {\n      legend.selectAll(\"rect\").remove();\n      legend.selectAll(\"text\").remove();\n    }\n\n    this.render = function() {\n      if (!mapChart.dataview) return;\n\n      let stackNames = mapChart.dataview.stacks;\n      let combinedData = mapChart.dataview.combinedData;\n\n      appendLegend();\n      legend.raise();\n      removeDatasetLegend();\n\n      for (let index = 0; index < stackNames.length; index++) {\n        let stackName = stackNames[index];\n        let dataForStack = combinedData.filter(\n          data => data.stack === stackName\n        );\n        let max = d3.max(dataForStack, item => item.value) || 0;\n        let offset = index * 80;\n        let color = Color.colorsForStack(index, 1)[0];\n\n        let steps = 4;\n        let data = [0, (1 / 4) * max, (1 / 2) * max, (3 / 4) * max, max];\n        let generator = Color.mapColors(max);\n\n        legend\n          .append(\"text\")\n          .attr(\"class\", \"ltv-map-chart-legend-title\")\n          .attr(\"x\", offset + 10)\n          .attr(\"y\", \"20\")\n          .style(\"fill\", color.rgbString())\n          .text(stackName);\n\n        legend\n          .append(\"g\")\n          .selectAll(\"text\")\n          .data([\"No Data\"])\n          .enter()\n          .append(\"text\")\n          .attr(\"class\", \"ltv-map-chart-legend-text\")\n          .attr(\"x\", offset + 35)\n          .attr(\"y\", 44)\n          .text(d => d);\n\n        legend\n          .append(\"g\")\n          .selectAll(\"rect\")\n          .data([0])\n          .enter()\n          .append(\"rect\")\n          .attr(\"class\", \"ltv-map-chart-legend-rect\")\n          .style(\"fill\", \"white\")\n          .attr(\"x\", offset + 10)\n          .attr(\"y\", 30)\n          .attr(\"width\", 18)\n          .attr(\"height\", 18)\n          .style(\"stroke-dasharray\", \"1,3\")\n          .style(\"stroke\", \"black\")\n          .style(\"stroke-width\", 1);\n\n        legend\n          .append(\"g\")\n          .selectAll(\"text\")\n          .data([0])\n          .enter()\n          .append(\"text\")\n          .attr(\"class\", \"lotivis-location-chart-legend-text\")\n          .attr(\"x\", offset + 35)\n          .attr(\"y\", 64)\n          .text(d => d);\n\n        legend\n          .append(\"g\")\n          .selectAll(\"rect\")\n          .data([0])\n          .enter()\n          .append(\"rect\")\n          .attr(\"class\", \"ltv-map-chart-legend-rect\")\n          .style(\"fill\", \"WhiteSmoke\")\n          .attr(\"x\", offset + 10)\n          .attr(\"y\", 50)\n          .attr(\"width\", 18)\n          .attr(\"height\", 18)\n          .style(\"stroke\", \"black\")\n          .style(\"stroke-width\", 1);\n\n        legend\n          .append(\"g\")\n          .selectAll(\"rect\")\n          .data(data)\n          .enter()\n          .append(\"rect\")\n          .attr(\"class\", \"ltv-map-chart-legend-rect\")\n          .style(\"fill\", generator)\n          .attr(\"x\", offset + 10)\n          .attr(\"y\", (d, i) => i * 20 + 70)\n          .attr(\"width\", 18)\n          .attr(\"height\", 18)\n          .style(\"stroke\", \"black\")\n          .style(\"stroke-width\", 1);\n\n        legend\n          .append(\"g\")\n          .selectAll(\"text\")\n          .data(data)\n          .enter()\n          .append(\"text\")\n          .attr(\"class\", \"ltv-map-chart-legend-text\")\n          .attr(\"x\", offset + 35)\n          .attr(\"y\", (d, i) => i * 20 + 84)\n          .text(function(d, i) {\n            if (d === 0) {\n              return \"> 0\";\n            } else {\n              return formatNumber((i / steps) * max);\n            }\n          });\n\n        return;\n      }\n    };\n  }\n}\n","import { formatNumber } from \"../shared/format\";\nimport { equals } from \"../shared/equal\";\nimport { lotivis_log } from \"../shared/debug\";\n\n/**\n *\n * @class MapLabelRenderer\n */\nexport class MapLabelRenderer {\n  /**\n   * Creates a new instance of MapLabelRenderer.\n   * @param mapChart The parental map.chart chart.\n   */\n  constructor(mapChart) {\n    /**\n     * Removes any old labels from the map.chart.\n     */\n    function removeLabels() {\n      mapChart.svg.selectAll(\".ltv-map.chart-label\").remove();\n    }\n\n    /**\n     * Appends labels from datasets.\n     */\n    this.render = function() {\n      removeLabels();\n\n      let geoJSON = mapChart.geoJSON;\n      if (!mapChart.geoJSON)\n        return lotivis_log(\n          `[lotivis]  No GeoJSON to render (${mapChart.selector}).`\n        );\n      let dataview = mapChart.dataview;\n\n      if (!dataview)\n        return lotivis_log(\n          `[lotivis]  No dataview in map chart (${mapChart.selector}).`\n        );\n      if (!mapChart.config.showLabels)\n        return lotivis_log(\n          `[lotivis]  Skip rendering labels due to configuration (${mapChart.selector}).`\n        );\n\n      mapChart.svg\n        .selectAll(\"text\")\n        .data(geoJSON.features)\n        .enter()\n        .append(\"text\")\n        .attr(\"class\", \"ltv-map-chart-label\")\n        .text(function(feature) {\n          let featureID = mapChart.config.featureIDAccessor(feature);\n          let dataset = dataview.combinedData.find(dataset =>\n            equals(dataset.location, featureID)\n          );\n          return dataset ? formatNumber(dataset.value) : \"\";\n        })\n        .attr(\n          \"x\",\n          function(feature) {\n            return mapChart.projection(feature.center)[0];\n          }.bind(this)\n        )\n        .attr(\n          \"y\",\n          function(feature) {\n            return mapChart.projection(feature.center)[1];\n          }.bind(this)\n        );\n    };\n  }\n}\n","import { equals } from \"../shared/equal\";\nimport { Color } from \"../shared/color\";\nimport { lotivis_log } from \"../shared/debug\";\nimport { styleForCSSClass } from \"../shared/style\";\n\n/**\n *\n * @class MapDatasetRenderer\n */\nexport class MapDatasetRenderer {\n  /**\n   * Creates a new instance of MapDatasetRenderer.\n   * @param mapChart The parental map.chart chart.\n   */\n  constructor(mapChart) {\n    let generator = Color.mapColors(1);\n    let styleArea = styleForCSSClass(\"ltv-map-chart-area\");\n    let styleHover = styleForCSSClass(\"ltv-map-chart-area-hover\");\n\n    /**\n     * Resets the `fill` and `fill-opacity` property of each area.\n     */\n    function resetAreas() {\n      mapChart.svg\n        .selectAll(\".ltv-map-chart-area\")\n        .classed(\"ltv-map-chart-area-hover\", false);\n    }\n\n    function featureMapID(feature) {\n      return `ltv-map-chart-area-id-${feature.lotivisId}`;\n    }\n\n    /**\n     * Called by map chart GeoJSON renderer when mouse enters an area drawn\n     * on the location chart.\n     *\n     * @param event The mouse event.\n     * @param feature The drawn feature (area).\n     */\n    this.mouseEnter = function(event, feature) {\n      resetAreas();\n\n      let color = styleArea.stroke || Color.defaultTint.rgbString();\n      let mapID = featureMapID(feature);\n\n      mapChart.svg\n        .selectAll(`#${mapID}`)\n        .raise()\n        .classed(\"ltv-map-chart-area-hover\", true);\n      // .style('stroke', styleHover.stroke || color)\n      // .style('stroke-width', styleHover['stroke-width'] || '4')\n      // .style('stroke-dasharray', '0');\n\n      mapChart.svg.selectAll(\".ltv-location-chart-label\").raise();\n    };\n\n    /**\n     * Tells this renderer that the mouse moved out of an area.\n     */\n    this.mouseOut = function() {\n      resetAreas();\n    };\n\n    /**\n     * Iterates the datasets per stack and draws them on svg.\n     */\n    this.render = function() {\n      if (!mapChart.geoJSON)\n        return lotivis_log(\"[lotivis]  No GeoJSON to render.\");\n      if (!mapChart.dataview)\n        return lotivis_log(\"[lotivis]  No data view property.\");\n\n      let stackNames = mapChart.dataview.stacks;\n      let combinedData = mapChart.dataview.combinedData;\n      resetAreas();\n\n      for (let index = 0; index < stackNames.length; index++) {\n        let stackName = stackNames[index];\n        let dataForStack = combinedData.filter(\n          data => data.stack === stackName\n        );\n        let max = d3.max(dataForStack, item => item.value);\n\n        for (let index = 0; index < dataForStack.length; index++) {\n          let datasetEntry = dataForStack[index];\n          let locationID = datasetEntry.location;\n          let opacity = Number(datasetEntry.value / max);\n\n          mapChart.svg\n            .selectAll(\".ltv-map-chart-area\")\n            .filter(item =>\n              equals(mapChart.config.featureIDAccessor(item), locationID)\n            )\n            .style(\"fill\", function() {\n              if (opacity === 0) {\n                return \"WhiteSmoke\";\n              } else {\n                return generator(opacity);\n              }\n            });\n        }\n        return;\n      }\n    };\n  }\n}\n","import { lotivis_log } from \"../shared/debug\";\n\n/**\n * @class MapGeoJSONRenderer\n */\nexport class MapGeoJSONRenderer {\n  /**\n   * Creates a new instance of MapGeoJSONRenderer.\n   * @param mapChart The parental map.chart chart.\n   */\n  constructor(mapChart) {\n    /**\n     * To be called when the mouse enters an area drawn on the map.chart.\n     *\n     * @param event The mouse event.\n     * @param feature The drawn feature (area).\n     */\n    function mouseEnter(event, feature) {\n      mapChart.datasetRenderer.mouseEnter(event, feature);\n      mapChart.tooltipRenderer.mouseEnter(event, feature);\n    }\n\n    /**\n     * To be called when the mouse leaves an area drawn on the map.chart.\n     *\n     * @param event The mouse event.\n     * @param feature The drawn feature (area).\n     */\n    function mouseOut(event, feature) {\n      mapChart.datasetRenderer.mouseOut(event, feature);\n      mapChart.tooltipRenderer.mouseOut(event, feature);\n      mapChart.selectionRenderer.raise();\n\n      if (event.buttons === 1) {\n        mouseClick(event, feature);\n      }\n    }\n\n    function mouseClick(event, feature) {\n      if (!feature || !feature.properties) return;\n      if (!mapChart.datasetController) return;\n\n      if (mapChart.config.sendsNotifications) {\n        let locationID = feature.lotivisId;\n        mapChart.makeUpdateInsensible();\n        mapChart.datasetController.toggleLocation(locationID);\n        mapChart.makeUpdateSensible();\n        mapChart.selectionRenderer.render();\n        mapChart.tooltipRenderer.mouseEnter(event, feature);\n      }\n    }\n\n    /**\n     * Renders the `presentedGeoJSON` property.\n     */\n    this.render = function() {\n      let geoJSON = mapChart.presentedGeoJSON;\n      if (!geoJSON) return;\n\n      mapChart.areas = mapChart.svg\n        .selectAll(\"path\")\n        .data(geoJSON.features)\n        .enter()\n        .append(\"path\")\n        .attr(\"d\", mapChart.path)\n        .attr(\"id\", feature => `ltv-map-chart-area-id-${feature.lotivisId}`)\n        .classed(\"ltv-map-chart-area\", true)\n        .style(\"stroke-dasharray\", feature =>\n          feature.departmentsData ? \"0\" : \"1,4\"\n        )\n        .style(\"fill\", \"white\")\n        .style(\"fill-opacity\", 1)\n        .on(\"click\", mouseClick)\n        .on(\"mouseenter\", mouseEnter)\n        .on(\"mouseout\", mouseOut);\n    };\n  }\n}\n","/**\n * Returns a new created instance of Feature combining the given Features.\n * @param features\n */\nexport function joinFeatures(features) {\n  let topology = topojson.topology(features);\n  let objects = extractObjects(topology);\n\n  return {\n    \"type\": \"FeatureCollection\",\n    \"features\": [\n      {\n        type: \"Feature\",\n        geometry: topojson.merge(topology, objects),\n        properties: {\n          code: 1,\n          nom: \"asdf\"\n        }\n      }\n    ]\n  };\n}\n\n/**\n *\n * @param topology\n * @returns {[]}\n */\nexport function extractObjects(topology) {\n  let objects = [];\n  for (const topologyKey in topology.objects) {\n    if (topology.objects.hasOwnProperty(topologyKey)) {\n      objects.push(topology.objects[topologyKey]);\n    }\n  }\n  return objects;\n}\n","export default function(x) {\n  return x;\n}\n","import identity from \"./identity.js\";\n\nexport default function(transform) {\n  if (transform == null) return identity;\n  var x0,\n      y0,\n      kx = transform.scale[0],\n      ky = transform.scale[1],\n      dx = transform.translate[0],\n      dy = transform.translate[1];\n  return function(input, i) {\n    if (!i) x0 = y0 = 0;\n    var j = 2, n = input.length, output = new Array(n);\n    output[0] = (x0 += input[0]) * kx + dx;\n    output[1] = (y0 += input[1]) * ky + dy;\n    while (j < n) output[j] = input[j], ++j;\n    return output;\n  };\n}\n","import transform from \"./transform.js\";\n\nexport default function(topology) {\n  var t = transform(topology.transform), key,\n      x0 = Infinity, y0 = x0, x1 = -x0, y1 = -x0;\n\n  function bboxPoint(p) {\n    p = t(p);\n    if (p[0] < x0) x0 = p[0];\n    if (p[0] > x1) x1 = p[0];\n    if (p[1] < y0) y0 = p[1];\n    if (p[1] > y1) y1 = p[1];\n  }\n\n  function bboxGeometry(o) {\n    switch (o.type) {\n      case \"GeometryCollection\": o.geometries.forEach(bboxGeometry); break;\n      case \"Point\": bboxPoint(o.coordinates); break;\n      case \"MultiPoint\": o.coordinates.forEach(bboxPoint); break;\n    }\n  }\n\n  topology.arcs.forEach(function(arc) {\n    var i = -1, n = arc.length, p;\n    while (++i < n) {\n      p = t(arc[i], i);\n      if (p[0] < x0) x0 = p[0];\n      if (p[0] > x1) x1 = p[0];\n      if (p[1] < y0) y0 = p[1];\n      if (p[1] > y1) y1 = p[1];\n    }\n  });\n\n  for (key in topology.objects) {\n    bboxGeometry(topology.objects[key]);\n  }\n\n  return [x0, y0, x1, y1];\n}\n","export default function(array, n) {\n  var t, j = array.length, i = j - n;\n  while (i < --j) t = array[i], array[i++] = array[j], array[j] = t;\n}\n","import reverse from \"./reverse.js\";\nimport transform from \"./transform.js\";\n\nexport default function(topology, o) {\n  if (typeof o === \"string\") o = topology.objects[o];\n  return o.type === \"GeometryCollection\"\n      ? {type: \"FeatureCollection\", features: o.geometries.map(function(o) { return feature(topology, o); })}\n      : feature(topology, o);\n}\n\nfunction feature(topology, o) {\n  var id = o.id,\n      bbox = o.bbox,\n      properties = o.properties == null ? {} : o.properties,\n      geometry = object(topology, o);\n  return id == null && bbox == null ? {type: \"Feature\", properties: properties, geometry: geometry}\n      : bbox == null ? {type: \"Feature\", id: id, properties: properties, geometry: geometry}\n      : {type: \"Feature\", id: id, bbox: bbox, properties: properties, geometry: geometry};\n}\n\nexport function object(topology, o) {\n  var transformPoint = transform(topology.transform),\n      arcs = topology.arcs;\n\n  function arc(i, points) {\n    if (points.length) points.pop();\n    for (var a = arcs[i < 0 ? ~i : i], k = 0, n = a.length; k < n; ++k) {\n      points.push(transformPoint(a[k], k));\n    }\n    if (i < 0) reverse(points, n);\n  }\n\n  function point(p) {\n    return transformPoint(p);\n  }\n\n  function line(arcs) {\n    var points = [];\n    for (var i = 0, n = arcs.length; i < n; ++i) arc(arcs[i], points);\n    if (points.length < 2) points.push(points[0]); // This should never happen per the specification.\n    return points;\n  }\n\n  function ring(arcs) {\n    var points = line(arcs);\n    while (points.length < 4) points.push(points[0]); // This may happen if an arc has only two points.\n    return points;\n  }\n\n  function polygon(arcs) {\n    return arcs.map(ring);\n  }\n\n  function geometry(o) {\n    var type = o.type, coordinates;\n    switch (type) {\n      case \"GeometryCollection\": return {type: type, geometries: o.geometries.map(geometry)};\n      case \"Point\": coordinates = point(o.coordinates); break;\n      case \"MultiPoint\": coordinates = o.coordinates.map(point); break;\n      case \"LineString\": coordinates = line(o.arcs); break;\n      case \"MultiLineString\": coordinates = o.arcs.map(line); break;\n      case \"Polygon\": coordinates = polygon(o.arcs); break;\n      case \"MultiPolygon\": coordinates = o.arcs.map(polygon); break;\n      default: return null;\n    }\n    return {type: type, coordinates: coordinates};\n  }\n\n  return geometry(o);\n}\n","export default function(topology, arcs) {\n  var stitchedArcs = {},\n      fragmentByStart = {},\n      fragmentByEnd = {},\n      fragments = [],\n      emptyIndex = -1;\n\n  // Stitch empty arcs first, since they may be subsumed by other arcs.\n  arcs.forEach(function(i, j) {\n    var arc = topology.arcs[i < 0 ? ~i : i], t;\n    if (arc.length < 3 && !arc[1][0] && !arc[1][1]) {\n      t = arcs[++emptyIndex], arcs[emptyIndex] = i, arcs[j] = t;\n    }\n  });\n\n  arcs.forEach(function(i) {\n    var e = ends(i),\n        start = e[0],\n        end = e[1],\n        f, g;\n\n    if (f = fragmentByEnd[start]) {\n      delete fragmentByEnd[f.end];\n      f.push(i);\n      f.end = end;\n      if (g = fragmentByStart[end]) {\n        delete fragmentByStart[g.start];\n        var fg = g === f ? f : f.concat(g);\n        fragmentByStart[fg.start = f.start] = fragmentByEnd[fg.end = g.end] = fg;\n      } else {\n        fragmentByStart[f.start] = fragmentByEnd[f.end] = f;\n      }\n    } else if (f = fragmentByStart[end]) {\n      delete fragmentByStart[f.start];\n      f.unshift(i);\n      f.start = start;\n      if (g = fragmentByEnd[start]) {\n        delete fragmentByEnd[g.end];\n        var gf = g === f ? f : g.concat(f);\n        fragmentByStart[gf.start = g.start] = fragmentByEnd[gf.end = f.end] = gf;\n      } else {\n        fragmentByStart[f.start] = fragmentByEnd[f.end] = f;\n      }\n    } else {\n      f = [i];\n      fragmentByStart[f.start = start] = fragmentByEnd[f.end = end] = f;\n    }\n  });\n\n  function ends(i) {\n    var arc = topology.arcs[i < 0 ? ~i : i], p0 = arc[0], p1;\n    if (topology.transform) p1 = [0, 0], arc.forEach(function(dp) { p1[0] += dp[0], p1[1] += dp[1]; });\n    else p1 = arc[arc.length - 1];\n    return i < 0 ? [p1, p0] : [p0, p1];\n  }\n\n  function flush(fragmentByEnd, fragmentByStart) {\n    for (var k in fragmentByEnd) {\n      var f = fragmentByEnd[k];\n      delete fragmentByStart[f.start];\n      delete f.start;\n      delete f.end;\n      f.forEach(function(i) { stitchedArcs[i < 0 ? ~i : i] = 1; });\n      fragments.push(f);\n    }\n  }\n\n  flush(fragmentByEnd, fragmentByStart);\n  flush(fragmentByStart, fragmentByEnd);\n  arcs.forEach(function(i) { if (!stitchedArcs[i < 0 ? ~i : i]) fragments.push([i]); });\n\n  return fragments;\n}\n","import {object} from \"./feature.js\";\nimport stitch from \"./stitch.js\";\n\nexport default function(topology) {\n  return object(topology, meshArcs.apply(this, arguments));\n}\n\nexport function meshArcs(topology, object, filter) {\n  var arcs, i, n;\n  if (arguments.length > 1) arcs = extractArcs(topology, object, filter);\n  else for (i = 0, arcs = new Array(n = topology.arcs.length); i < n; ++i) arcs[i] = i;\n  return {type: \"MultiLineString\", arcs: stitch(topology, arcs)};\n}\n\nfunction extractArcs(topology, object, filter) {\n  var arcs = [],\n      geomsByArc = [],\n      geom;\n\n  function extract0(i) {\n    var j = i < 0 ? ~i : i;\n    (geomsByArc[j] || (geomsByArc[j] = [])).push({i: i, g: geom});\n  }\n\n  function extract1(arcs) {\n    arcs.forEach(extract0);\n  }\n\n  function extract2(arcs) {\n    arcs.forEach(extract1);\n  }\n\n  function extract3(arcs) {\n    arcs.forEach(extract2);\n  }\n\n  function geometry(o) {\n    switch (geom = o, o.type) {\n      case \"GeometryCollection\": o.geometries.forEach(geometry); break;\n      case \"LineString\": extract1(o.arcs); break;\n      case \"MultiLineString\": case \"Polygon\": extract2(o.arcs); break;\n      case \"MultiPolygon\": extract3(o.arcs); break;\n    }\n  }\n\n  geometry(object);\n\n  geomsByArc.forEach(filter == null\n      ? function(geoms) { arcs.push(geoms[0].i); }\n      : function(geoms) { if (filter(geoms[0].g, geoms[geoms.length - 1].g)) arcs.push(geoms[0].i); });\n\n  return arcs;\n}\n","import {object} from \"./feature.js\";\nimport stitch from \"./stitch.js\";\n\nfunction planarRingArea(ring) {\n  var i = -1, n = ring.length, a, b = ring[n - 1], area = 0;\n  while (++i < n) a = b, b = ring[i], area += a[0] * b[1] - a[1] * b[0];\n  return Math.abs(area); // Note: doubled area!\n}\n\nexport default function(topology) {\n  return object(topology, mergeArcs.apply(this, arguments));\n}\n\nexport function mergeArcs(topology, objects) {\n  var polygonsByArc = {},\n      polygons = [],\n      groups = [];\n\n  objects.forEach(geometry);\n\n  function geometry(o) {\n    switch (o.type) {\n      case \"GeometryCollection\": o.geometries.forEach(geometry); break;\n      case \"Polygon\": extract(o.arcs); break;\n      case \"MultiPolygon\": o.arcs.forEach(extract); break;\n    }\n  }\n\n  function extract(polygon) {\n    polygon.forEach(function(ring) {\n      ring.forEach(function(arc) {\n        (polygonsByArc[arc = arc < 0 ? ~arc : arc] || (polygonsByArc[arc] = [])).push(polygon);\n      });\n    });\n    polygons.push(polygon);\n  }\n\n  function area(ring) {\n    return planarRingArea(object(topology, {type: \"Polygon\", arcs: [ring]}).coordinates[0]);\n  }\n\n  polygons.forEach(function(polygon) {\n    if (!polygon._) {\n      var group = [],\n          neighbors = [polygon];\n      polygon._ = 1;\n      groups.push(group);\n      while (polygon = neighbors.pop()) {\n        group.push(polygon);\n        polygon.forEach(function(ring) {\n          ring.forEach(function(arc) {\n            polygonsByArc[arc < 0 ? ~arc : arc].forEach(function(polygon) {\n              if (!polygon._) {\n                polygon._ = 1;\n                neighbors.push(polygon);\n              }\n            });\n          });\n        });\n      }\n    }\n  });\n\n  polygons.forEach(function(polygon) {\n    delete polygon._;\n  });\n\n  return {\n    type: \"MultiPolygon\",\n    arcs: groups.map(function(polygons) {\n      var arcs = [], n;\n\n      // Extract the exterior (unique) arcs.\n      polygons.forEach(function(polygon) {\n        polygon.forEach(function(ring) {\n          ring.forEach(function(arc) {\n            if (polygonsByArc[arc < 0 ? ~arc : arc].length < 2) {\n              arcs.push(arc);\n            }\n          });\n        });\n      });\n\n      // Stitch the arcs into one or more rings.\n      arcs = stitch(topology, arcs);\n\n      // If more than one ring is returned,\n      // at most one of these rings can be the exterior;\n      // choose the one with the greatest absolute area.\n      if ((n = arcs.length) > 1) {\n        for (var i = 1, k = area(arcs[0]), ki, t; i < n; ++i) {\n          if ((ki = area(arcs[i])) > k) {\n            t = arcs[0], arcs[0] = arcs[i], arcs[i] = t, k = ki;\n          }\n        }\n      }\n\n      return arcs;\n    }).filter(function(arcs) {\n      return arcs.length > 0;\n    })\n  };\n}\n","export default function(a, x) {\n  var lo = 0, hi = a.length;\n  while (lo < hi) {\n    var mid = lo + hi >>> 1;\n    if (a[mid] < x) lo = mid + 1;\n    else hi = mid;\n  }\n  return lo;\n}\n","import bisect from \"./bisect.js\";\n\nexport default function(objects) {\n  var indexesByArc = {}, // arc index -> array of object indexes\n      neighbors = objects.map(function() { return []; });\n\n  function line(arcs, i) {\n    arcs.forEach(function(a) {\n      if (a < 0) a = ~a;\n      var o = indexesByArc[a];\n      if (o) o.push(i);\n      else indexesByArc[a] = [i];\n    });\n  }\n\n  function polygon(arcs, i) {\n    arcs.forEach(function(arc) { line(arc, i); });\n  }\n\n  function geometry(o, i) {\n    if (o.type === \"GeometryCollection\") o.geometries.forEach(function(o) { geometry(o, i); });\n    else if (o.type in geometryType) geometryType[o.type](o.arcs, i);\n  }\n\n  var geometryType = {\n    LineString: line,\n    MultiLineString: polygon,\n    Polygon: polygon,\n    MultiPolygon: function(arcs, i) { arcs.forEach(function(arc) { polygon(arc, i); }); }\n  };\n\n  objects.forEach(geometry);\n\n  for (var i in indexesByArc) {\n    for (var indexes = indexesByArc[i], m = indexes.length, j = 0; j < m; ++j) {\n      for (var k = j + 1; k < m; ++k) {\n        var ij = indexes[j], ik = indexes[k], n;\n        if ((n = neighbors[ij])[i = bisect(n, ik)] !== ik) n.splice(i, 0, ik);\n        if ((n = neighbors[ik])[i = bisect(n, ij)] !== ij) n.splice(i, 0, ij);\n      }\n    }\n  }\n\n  return neighbors;\n}\n","import identity from \"./identity.js\";\n\nexport default function(transform) {\n  if (transform == null) return identity;\n  var x0,\n      y0,\n      kx = transform.scale[0],\n      ky = transform.scale[1],\n      dx = transform.translate[0],\n      dy = transform.translate[1];\n  return function(input, i) {\n    if (!i) x0 = y0 = 0;\n    var j = 2,\n        n = input.length,\n        output = new Array(n),\n        x1 = Math.round((input[0] - dx) / kx),\n        y1 = Math.round((input[1] - dy) / ky);\n    output[0] = x1 - x0, x0 = x1;\n    output[1] = y1 - y0, y0 = y1;\n    while (j < n) output[j] = input[j], ++j;\n    return output;\n  };\n}\n","import bbox from \"./bbox.js\";\nimport untransform from \"./untransform.js\";\n\nexport default function(topology, transform) {\n  if (topology.transform) throw new Error(\"already quantized\");\n\n  if (!transform || !transform.scale) {\n    if (!((n = Math.floor(transform)) >= 2)) throw new Error(\"n must be ≥2\");\n    box = topology.bbox || bbox(topology);\n    var x0 = box[0], y0 = box[1], x1 = box[2], y1 = box[3], n;\n    transform = {scale: [x1 - x0 ? (x1 - x0) / (n - 1) : 1, y1 - y0 ? (y1 - y0) / (n - 1) : 1], translate: [x0, y0]};\n  } else {\n    box = topology.bbox;\n  }\n\n  var t = untransform(transform), box, key, inputs = topology.objects, outputs = {};\n\n  function quantizePoint(point) {\n    return t(point);\n  }\n\n  function quantizeGeometry(input) {\n    var output;\n    switch (input.type) {\n      case \"GeometryCollection\": output = {type: \"GeometryCollection\", geometries: input.geometries.map(quantizeGeometry)}; break;\n      case \"Point\": output = {type: \"Point\", coordinates: quantizePoint(input.coordinates)}; break;\n      case \"MultiPoint\": output = {type: \"MultiPoint\", coordinates: input.coordinates.map(quantizePoint)}; break;\n      default: return input;\n    }\n    if (input.id != null) output.id = input.id;\n    if (input.bbox != null) output.bbox = input.bbox;\n    if (input.properties != null) output.properties = input.properties;\n    return output;\n  }\n\n  function quantizeArc(input) {\n    var i = 0, j = 1, n = input.length, p, output = new Array(n); // pessimistic\n    output[0] = t(input[0], 0);\n    while (++i < n) if ((p = t(input[i], i))[0] || p[1]) output[j++] = p; // non-coincident points\n    if (j === 1) output[j++] = [0, 0]; // an arc must have at least two points\n    output.length = j;\n    return output;\n  }\n\n  for (key in inputs) outputs[key] = quantizeGeometry(inputs[key]);\n\n  return {\n    type: \"Topology\",\n    bbox: box,\n    transform: transform,\n    objects: outputs,\n    arcs: topology.arcs.map(quantizeArc)\n  };\n}\n","import { joinFeatures } from \"../geojson/join.features\";\nimport { lotivis_log, lotivis_log_once } from \"../shared/debug\";\nimport * as topojson from \"topojson-client\";\n\n/**\n *\n * @class MapExteriorBorderRenderer\n */\nexport class MapExteriorBorderRenderer {\n  /**\n   * Creates a new instance of MapExteriorBorderRenderer.\n   * @property mapChart The parental map.chart chart.\n   */\n  constructor(mapChart) {\n    // if (!topojson) lotivis_log_once('Can\\'t find topojson lib.  Skip rendering of exterior border.');\n\n    /**\n     * Renders the exterior border of the presented geo json.\n     */\n    this.render = function() {\n      if (!topojson) {\n        lotivis_log(\"[lotivis]  Can't find topojson library.\");\n        return;\n      }\n      let geoJSON = mapChart.geoJSON;\n      if (!geoJSON) {\n        lotivis_log(\"[lotivis]  No GeoJSON to render.\");\n        return;\n      }\n\n      let borders = joinFeatures(geoJSON.features);\n      if (!borders) {\n        return lotivis_log(\"[lotivis]  No borders to render.\");\n      }\n\n      mapChart.svg\n        .selectAll(\"path\")\n        .append(\"path\")\n        .data(borders.features)\n        .enter()\n        .append(\"path\")\n        .attr(\"d\", mapChart.path)\n        .attr(\"class\", \"ltv-map-chart-exterior-borders\")\n        .raise();\n    };\n  }\n}\n","import {extractLocationsFromDatasets} from \"../data.juggle/data.extract\";\n\n/**\n *\n * @param datasets\n * @returns {{features: [], type: string}}\n */\nexport function createGeoJSON(datasets) {\n  let locations = extractLocationsFromDatasets(datasets);\n  let rowsCount = Math.ceil(locations.length / 5);\n  let latSpan = 0.1;\n  let lngSpan = 0.1;\n  let features = [];\n\n  loop1: for (let rowIndex = 0; rowIndex < rowsCount; rowIndex++) {\n    for (let itemIndex = 0; itemIndex < 5; itemIndex++) {\n\n      if (locations.length === 0) break loop1;\n\n      let location = locations.shift();\n      let lat = (itemIndex + 1) * latSpan;\n      let lng = (rowIndex + 1) * -lngSpan;\n\n      // start down left, counterclockwise\n      let coordinates = [];\n      coordinates.push([lat + latSpan, lng + lngSpan]);\n      coordinates.push([lat + latSpan, lng]);\n      coordinates.push([lat, lng]);\n      coordinates.push([lat, lng + lngSpan]);\n      coordinates.push([lat + latSpan, lng + lngSpan]);\n\n      let feature = {\n        type: 'Feature',\n        id: location,\n        properties: {\n          id: location,\n          code: location,\n          location: location,\n        },\n        geometry: {\n          type: 'Polygon',\n          coordinates: [\n            coordinates\n          ]\n        }\n      };\n\n      features.push(feature);\n    }\n  }\n\n  let geoJSON = {\n    type: \"FeatureCollection\",\n    features: features\n  };\n\n  return geoJSON;\n}\n","import { hashCode } from \"../shared/hash\";\nimport { isValue } from \"../shared/value\";\nimport { LotivisConfig } from \"../shared/config\";\n\n/**\n *\n * @type {{}}\n */\nexport const MapChartConfig = {\n  width: 1000,\n  height: 1000,\n  margin: {\n    top: LotivisConfig.defaultMargin,\n    right: LotivisConfig.defaultMargin,\n    bottom: LotivisConfig.defaultMargin,\n    left: LotivisConfig.defaultMargin\n  },\n  isShowLabels: true,\n  geoJSON: null,\n  departmentsData: [],\n  excludedFeatureCodes: [],\n  drawRectangleAroundSelection: true,\n  sendsNotifications: true,\n  featureIDAccessor: function(feature) {\n    if (feature.id || feature.id === 0) return feature.id;\n    if (feature.properties && isValue(feature.properties.id))\n      return feature.properties.id;\n    if (feature.properties && isValue(feature.properties.code))\n      return Number(feature.properties.code);\n    if (feature.properties) {\n      return hashCode(JSON.stringify(feature.properties));\n    }\n    return hashCode(JSON.stringify(feature));\n  },\n  featureNameAccessor: function(feature) {\n    if (isValue(feature.name)) return feature.name;\n    if (feature.properties && isValue(feature.properties.name))\n      return feature.properties.name;\n    if (feature.properties && isValue(feature.properties.nom))\n      return feature.properties.nom;\n    return LotivisConfig.unknown;\n  }\n};\n","/**\n *\n * @class MapBackgroundRenderer\n */\nexport class MapBackgroundRenderer {\n  /**\n   * Creates a new instance of MapBackgroundRenderer.\n   *\n   * @param mapChart The parental map.chart chart.\n   */\n  constructor(mapChart) {\n    function onMouseClick() {\n      let controller = mapChart.datasetController;\n      if (!controller) return;\n\n      let filters = controller.filters.locations;\n      if (!filters || filters.length === 0) return;\n      mapChart.updateSensible = false;\n      controller.resetLocationFilters();\n      mapChart.updateSensible = true;\n\n      mapChart.selectionRenderer.render();\n    }\n\n    /**\n     * Appends a background rectangle.\n     */\n    this.render = function() {\n      // create a background rectangle for receiving mouse enter events\n      // in order to reset the location samples filter.\n      mapChart.svg\n        .append(\"rect\")\n        .attr(\"class\", \"ltv-map-chart-background\")\n        .attr(\"width\", mapChart.config.width)\n        .attr(\"height\", mapChart.config.height)\n        .attr(\"fill\", \"white\")\n        .on(\"click\", onMouseClick);\n    };\n  }\n}\n","/**\n * @class Geometry\n */\nexport class Geometry {\n\n  /**\n   * Creates a new instance of Geometry.\n   * @param source\n   */\n  constructor(source) {\n    this.type = source.type;\n    this.coordinates = source.coordinates;\n  }\n}\n","import {Geometry} from \"./geometry\";\n\n/**\n *\n * @class Feature\n */\nexport class Feature {\n\n  constructor(source) {\n    this.type = source.type;\n    this.properties = source.properties;\n    this.geometry = new Geometry(source.geometry);\n  }\n}\n","import {Feature} from \"./feature\";\nimport {Geometry} from \"./geometry\";\n\n/**\n *\n * @class GeoJson\n */\nexport class GeoJson {\n\n  constructor(source) {\n    this.type = source.type;\n    this.features = [];\n\n    if (source.features) {\n      for (let index = 0; index < source.features.length; index++) {\n        let featureSource = source.features[index];\n        let feature = new Feature(featureSource);\n        this.features.push(feature);\n      }\n    } else {\n      this.properties = source.properties;\n      this.geometry = new Geometry(source.geometry);\n    }\n  }\n\n  getCenter() {\n    let allCoordinates = this.extractAllCoordinates();\n    console.log('allCoordinates.length: ' + allCoordinates.length);\n    let latitudeSum = 0;\n    let longitudeSum = 0;\n\n    allCoordinates.forEach(function (coordinates) {\n      latitudeSum += coordinates[1];\n      longitudeSum += coordinates[0];\n    });\n\n    return [\n      latitudeSum / allCoordinates.length,\n      longitudeSum / allCoordinates.length\n    ];\n  }\n\n  extractGeometryCollection() {\n    let geometryCollection = [];\n    if (this.type === 'Feature') {\n      geometryCollection.push(this.geometry);\n    } else if (this.type === 'FeatureCollection') {\n      this.features.forEach(feature => geometryCollection.push(feature.geometry));\n    } else if (this.type === 'GeometryCollection') {\n      this.geometries.forEach(geometry => geometryCollection.push(geometry));\n    } else {\n      throw new Error('The geoJSON is not valid.');\n    }\n    return geometryCollection;\n  }\n\n  extractAllCoordinates() {\n    let geometryCollection = this.extractGeometryCollection();\n    let coordinatesCollection = [];\n\n    geometryCollection.forEach(item => {\n\n      let coordinates = item.coordinates;\n      let type = item.type;\n\n      if (type === 'Point') {\n        console.log(\"Point: \" + coordinates.length);\n        coordinatesCollection.push(coordinates);\n      } else if (type === 'MultiPoint') {\n        console.log(\"MultiPoint: \" + coordinates.length);\n        coordinates.forEach(coordinate => coordinatesCollection.push(coordinate));\n      } else if (type === 'LineString') {\n        console.log(\"LineString: \" + coordinates.length);\n        coordinates.forEach(coordinate => coordinatesCollection.push(coordinate));\n      } else if (type === 'Polygon') {\n        coordinates.forEach(function (polygonCoordinates) {\n          polygonCoordinates.forEach(function (coordinate) {\n            coordinatesCollection.push(coordinate);\n          });\n        });\n      } else if (type === 'MultiLineString') {\n        coordinates.forEach(function (featureCoordinates) {\n          featureCoordinates.forEach(function (polygonCoordinates) {\n            polygonCoordinates.forEach(function (coordinate) {\n              coordinatesCollection.push(coordinate);\n            });\n          });\n        });\n      } else if (type === 'MultiPolygon') {\n        coordinates.forEach(function (featureCoordinates) {\n          featureCoordinates.forEach(function (polygonCoordinates) {\n            polygonCoordinates.forEach(function (coordinate) {\n              coordinatesCollection.push(coordinate);\n            });\n          });\n        });\n      } else {\n        throw new Error('The geoJSON is not valid.');\n      }\n    });\n\n    return coordinatesCollection;\n  }\n}\n","import { lotivis_log, lotivis_log_once } from \"../shared/debug\";\nimport { joinFeatures } from \"../geojson/join.features\";\n\n/**\n *\n * @class MapSelectionRenderer\n */\nexport class MapSelectionRenderer {\n  /**\n   * Creates a new instance of MapSelectionRenderer.\n   *\n   * @param mapChart The parental map.chart chart.\n   */\n  constructor(mapChart) {\n    if (!self.topojson)\n      lotivis_log_once(\n        \"Can't find topojson lib.  Skip rendering of exterior border.\"\n      );\n\n    /**\n     * Returns the collection of selected features.\n     *\n     * @returns {*[]}\n     */\n    function getSelectedFeatures() {\n      if (!mapChart.geoJSON) {\n        return null;\n      }\n\n      let allFeatures = mapChart.presentedGeoJSON.features;\n\n      if (!mapChart.datasetController) {\n        return null;\n      }\n\n      let filteredLocations = mapChart.datasetController.filters.locations;\n      let selectedFeatures = [];\n\n      for (let index = 0; index < allFeatures.length; index++) {\n        let feature = allFeatures[index];\n        let featureID = feature.lotivisId;\n\n        if (filteredLocations.indexOf(String(featureID)) !== -1) {\n          selectedFeatures.push(feature);\n        }\n      }\n\n      return selectedFeatures;\n    }\n\n    /**\n     * Renders the exterior border of the presented geo json.\n     */\n    this.render = function() {\n      if (!self.topojson) {\n        lotivis_log(\"[lotivis]  Can't find topojson library.\");\n        return;\n      }\n\n      // return;\n\n      mapChart.selectedFeatures = getSelectedFeatures();\n      mapChart.selectionBorderGeoJSON = joinFeatures(mapChart.selectedFeatures);\n      if (!mapChart.selectionBorderGeoJSON) {\n        return lotivis_log(\"[lotivis]  No selected features to render.\");\n      }\n\n      mapChart.svg.selectAll(\".ltv-map-chart-selection-border\").remove();\n\n      mapChart.svg\n        .selectAll(\".ltv-map-chart-selection-border\")\n        .append(\"path\")\n        .attr(\"class\", \"ltv-map-chart-selection-border\")\n        .data(mapChart.selectionBorderGeoJSON.features)\n        .enter()\n        .append(\"path\")\n        .attr(\"d\", mapChart.path)\n        .attr(\"class\", \"ltv-map-chart-selection-border\")\n        .raise();\n    };\n\n    this.raise = function() {\n      mapChart.svg.selectAll(\".ltv-map-chart-selection-border\").raise();\n    };\n  }\n}\n","import { Chart } from \"../chart/chart\";\nimport { removeFeatures } from \"../geojson/remove.features\";\nimport { MapTooltipRenderer } from \"./map.tooltip.renderer\";\nimport { MapLegendRenderer } from \"./map.legend.renderer\";\nimport { MapLabelRenderer } from \"./map.label.renderer\";\nimport { MapDatasetRenderer } from \"./map.dataset.renderer\";\nimport { MapGeoJSONRenderer } from \"./map.geojson.renderer\";\nimport { MapExteriorBorderRenderer } from \"./map.exterior.border.renderer\";\nimport { createGeoJSON } from \"../geojson/create.geojson\";\nimport { MapChartConfig } from \"./map.chart.config\";\nimport { MapBackgroundRenderer } from \"./map.background.renderer\";\nimport { GeoJson } from \"../geojson/geojson\";\nimport { MapSelectionRenderer } from \"./map.selection.renderer\";\nimport { lotivis_log } from \"../shared/debug\";\n\n/**\n * A component which renders a GeoJSON with d3.\n * @class MapChart\n * @extends Chart\n */\nexport class MapChart extends Chart {\n  /**\n   * Creates a new instance of MapChart.\n   * @param parent The parental component.\n   * @param config The configuration of the map.chart chart.\n   */\n  constructor(parent, config) {\n    super(parent, config);\n    // empty. constructor defined for documentation.\n  }\n\n  /**\n   * Initialize with default values.\n   */\n  initialize() {\n    let theConfig = this.config;\n    let margin;\n    margin = Object.assign({}, MapChartConfig.margin);\n    margin = Object.assign(margin, theConfig.margin || {});\n\n    let config = Object.assign({}, MapChartConfig);\n    this.config = Object.assign(config, this.config);\n    this.config.margin = margin;\n\n    this.projection = d3.geoMercator();\n    this.path = d3.geoPath().projection(this.projection);\n\n    this.initializeRenderers();\n  }\n\n  initializeRenderers() {\n    this.backgroundRenderer = new MapBackgroundRenderer(this);\n    this.geoJSONRenderer = new MapGeoJSONRenderer(this);\n    this.datasetRenderer = new MapDatasetRenderer(this);\n    this.exteriorBorderRenderer = new MapExteriorBorderRenderer(this);\n    this.labelRenderer = new MapLabelRenderer(this);\n    this.legendRenderer = new MapLegendRenderer(this);\n    this.selectionRenderer = new MapSelectionRenderer(this);\n    this.tooltipRenderer = new MapTooltipRenderer(this);\n  }\n\n  remove() {\n    if (!this.svg) return;\n    this.svg.remove();\n  }\n\n  precalculate() {\n    this.renderSVG();\n    if (!this.datasetController) return;\n    this.dataview = this.datasetController.getLocationDataview();\n    if (this.geoJSON) return;\n    let geoJSON = createGeoJSON(this.datasetController.datasets);\n    this.setGeoJSON(geoJSON);\n  }\n\n  draw() {\n    lotivis_log(\"[lotivis] \", this.constructor.name, \"draw\");\n    if (!this.geoJSON) {\n      return lotivis_log(\"[lotivis]  No GeoJSON to render.\");\n    }\n    this.backgroundRenderer.render();\n    this.exteriorBorderRenderer.render();\n    this.geoJSONRenderer.render();\n    this.legendRenderer.render();\n    this.datasetRenderer.render();\n    this.labelRenderer.render();\n    this.tooltipRenderer.raise();\n    this.selectionRenderer.render();\n  }\n\n  /**\n   *\n   */\n  renderSVG() {\n    this.svg = this.element\n      .append(\"svg\")\n      .classed(\"ltv-chart-svg ltv-map-chart-svg\", true)\n      .attr(\"id\", this.svgSelector)\n      .attr(\"viewBox\", `0 0 ${this.config.width} ${this.config.height}`);\n  }\n\n  /**\n   * Sets the size of the projection to fit the given geo json.\n   * @param geoJSON\n   */\n  zoomTo(geoJSON) {\n    this.projection.fitSize([this.config.width, this.config.height], geoJSON);\n  }\n\n  /**\n   * Tells this map.chart chart that the given feature was selected with the mouse.\n   * @param event The mouse event.\n   * @param feature The feature.\n   */\n  onSelectFeature(event, feature) {}\n\n  /**\n   * Sets the presented geo json.\n   * @param newGeoJSON\n   */\n  setGeoJSON(newGeoJSON) {\n    if (typeof newGeoJSON === \"object\" && newGeoJSON.prototype === \"GeoJSON\") {\n      this.geoJSON = newGeoJSON;\n    } else {\n      this.geoJSON = new GeoJson(newGeoJSON);\n    }\n    this.presentedGeoJSON = this.geoJSON;\n    this.geoJSONDidChange();\n  }\n\n  /**\n   * Tells the receiving map.chart chart that its `geoJSON` property did change.\n   */\n  geoJSONDidChange() {\n    if (!this.geoJSON) return;\n    // precalculate the center of each feature\n    this.geoJSON.features.forEach(\n      feature => (feature.center = d3.geoCentroid(feature))\n    );\n\n    if (this.config.excludedFeatureCodes) {\n      this.presentedGeoJSON = removeFeatures(\n        this.geoJSON,\n        this.config.excludedFeatureCodes\n      );\n    }\n\n    // precalculate lotivis feature ids\n\n    let feature;\n    for (let i = 0; i < this.presentedGeoJSON.features.length; i++) {\n      feature = this.presentedGeoJSON.features[i];\n      this.presentedGeoJSON.features[\n        i\n      ].lotivisId = this.config.featureIDAccessor(feature);\n    }\n\n    this.zoomTo(this.geoJSON);\n    this.draw();\n\n    // this.backgroundRenderer.render();\n    // this.exteriorBorderRenderer.render();\n    // this.geoJSONRenderer.render();\n  }\n}\n","import {Checkbox} from \"../shared.components/checkbox\";\nimport {UrlParameters} from \"../shared/url.parameters\";\nimport {SettingsPopup} from \"../shared.components/settings.popup\";\n\n/**\n * A popup presenting a settings panel for a map.chart chart.\n *\n * @class MapChartSettingsPopup\n * @extends SettingsPopup\n */\nexport class MapChartSettingsPopup extends SettingsPopup {\n\n  /**\n   * Injects the elements of the settings panel.\n   * @override\n   */\n  inject() {\n    super.inject();\n    let container = this.row.append('div').classed('col-12', true);\n    this.showLabelsCheckbox = new Checkbox(container);\n    this.showLabelsCheckbox.setText('Labels');\n    this.showLabelsCheckbox.onClick = function (checked) {\n      this.mapChart.config.showLabels = checked;\n      this.mapChart.update();\n      UrlParameters.getInstance().setWithoutDeleting('map-chart-show-labels', checked);\n    }.bind(this);\n  }\n\n  /**\n   * Tells the popup that it is about to be presented.\n   * @override\n   */\n  willShow() {\n    this.showLabelsCheckbox.setChecked(this.mapChart.config.showLabels);\n    if (!this.mapChart.datasetController) {\n      this.showLabelsCheckbox.disable();\n    }\n  }\n}\n","import { MapChart } from \"../map.chart/map.chart\";\nimport { MapChartSettingsPopup } from \"./map.chart.settings.popup\";\nimport { ChartCard } from \"../shared.components/chart.card\";\nimport { downloadImage } from \"../shared/download\";\nimport { createDownloadFilename } from \"../shared/filename\";\n\n/**\n * A lotivis card containing a location chart.\n * @class MapChartCard\n * @extends ChartCard\n */\nexport class MapChartCard extends ChartCard {\n  /**\n   * Creates a new instance of MapChartCard.\n   * @param {Component|String} parent The parental component.\n   * @param config The config of the map.chart chart.\n   */\n  constructor(parent, config) {\n    super(parent || \"map-chart-card\", config);\n  }\n\n  /**\n   * Creates and injects the map.chart chart.\n   */\n  injectChart() {\n    this.chartID = this.selector + \"-chart\";\n    this.body.attr(\"id\", this.chartID);\n    this.chart = new MapChart(this.chartID, this.config);\n  }\n\n  /**\n   * Creates and downloads a screenshot from the chart.\n   * @override\n   */\n  screenshotButtonAction() {\n    let filename = \"Unknown\";\n    if (this.chart && this.chart.datasetController) {\n      filename = this.chart.datasetController.getFilename();\n    }\n    let downloadFilename = createDownloadFilename(filename, `map-chart`);\n    downloadImage(this.chart.svgSelector, downloadFilename);\n  }\n\n  /**\n   * Triggered when the more button is pushed.\n   */\n  presentSettingsPopupAction() {\n    let bodyElement = d3.select(\"body\");\n    let button = document.getElementById(this.moreButton.selector);\n    let settingsPopup = new MapChartSettingsPopup(bodyElement);\n    settingsPopup.mapChart = this.chart;\n    settingsPopup.showUnder(button, \"right\");\n  }\n}\n","import {DatasetsController} from \"./datasets.controller\";\n\nDatasetsController.prototype.getCached = function (type) {\n  return this.cache.getDataView(\n    type,\n    this.filters.locations,\n    this.filters.dates,\n    this.filters.labels\n  );\n};\n\nDatasetsController.prototype.setCached = function (dataview, type) {\n  return this.cache.setDataView(\n    dataview,\n    type,\n    this.filters.locations,\n    this.filters.dates,\n    this.filters.labels\n  );\n};\n","import {DatasetsController} from \"../datasets.controller/datasets.controller\";\nimport {copy} from \"../shared/copy\";\nimport {\n  extractDatesFromDatasets,\n  extractEarliestDateWithValue,\n  extractLabelsFromDatasets,\n  extractLatestDateWithValue\n} from \"../data.juggle/data.extract\";\nimport {combineByDate} from \"../data.juggle/data.combine\";\nimport {sumOfValues} from \"../data.juggle/data.sum\";\nimport {flatDataset} from \"../data.juggle/data.flat\";\nimport \"../datasets.controller/datasets.controller.cache\";\n\n/**\n *\n * @param dataset\n * @param dateAccess\n * @returns {{}}\n */\nfunction createPlotDataset(dataset, dateAccess) {\n\n  let newDataset = {};\n  let data = copy(dataset.data);\n  let firstDate = extractEarliestDateWithValue(data, dateAccess) || 0;\n  let lastDate = extractLatestDateWithValue(data, dateAccess) || 0;\n  let flatData = flatDataset(dataset);\n\n  newDataset.dataset = dataset.label;\n  newDataset.label = dataset.label;\n  newDataset.stack = dataset.stack;\n  newDataset.firstDate = firstDate;\n  newDataset.lastDate = lastDate;\n  newDataset.sum = sumOfValues(flatData);\n  // newDataset.min = d3.min();\n\n  // dataView.max = d3.max(flatData, function (stack) {\n  //   return d3.max(stack, function (series) {\n  //     return d3.max(series.map(item => item['1']));\n  //   });\n  // });\n\n  newDataset.data = combineByDate(data)\n    .sort((left, right) => left.dateNumeric - right.dateNumeric)\n    .filter(item => (item.value || 0) > 0);\n\n  return newDataset;\n}\n\n/**\n * Returns a new generated date.chart.plot.chart samples view for the current enabled samples of dataset of this controller.\n */\nDatasetsController.prototype.getPlotDataview = function () {\n\n  let cachedDataView = this.getCached('date.chart.plot.chart');\n  if (cachedDataView) {\n    return cachedDataView;\n  }\n\n  let dateAccess = this.dateAccess;\n  let enabledDatasets = this.filteredDatasets();\n  let dataview = {datasets: []};\n\n  dataview.dates = extractDatesFromDatasets(enabledDatasets).sort();\n  dataview.labels = extractLabelsFromDatasets(enabledDatasets);\n\n  dataview.firstDate = dataview.dates.first();\n  dataview.lastDate = dataview.dates.last();\n\n  enabledDatasets.forEach(function (dataset) {\n    let newDataset = createPlotDataset(dataset, dateAccess);\n    let firstIndex = dataview.dates.indexOf(newDataset.firstDate);\n    let lastIndex = dataview.dates.indexOf(newDataset.lastDate);\n    newDataset.duration = lastIndex - firstIndex;\n    dataview.datasets.push(newDataset);\n  });\n\n  dataview.labelsCount = dataview.datasets.length;\n  dataview.max = d3.max(dataview.datasets, function (dataset) {\n    return d3.max(dataset.data, function (item) {\n      return item.value;\n    });\n  });\n\n  this.setCached(dataview, 'plot');\n\n  return dataview;\n};\n","import { LotivisConfig } from \"../shared/config\";\n\n/**\n * Enumeration of available style types of a plot chart.\n */\nexport const PlotChartType = {\n  gradient: \"gradient\",\n  fraction: \"fraction\"\n};\n\n/**\n * Enumeration of sorts available in the date.chart.plot.chart chart.\n */\nexport const PlotChartSort = {\n  none: \"none\",\n  alphabetically: \"alphabetically\",\n  duration: \"duration\",\n  intensity: \"intensity\",\n  firstDate: \"firstDate\"\n};\n\n/**\n *\n * @type {{margin: {top: number, left: number, bottom: number, right: number}, highColor: string, showTooltip: boolean, lowColor: string, sort: string, type: string, showLabels: boolean, numberFormat: Intl.NumberFormat, width: number, lineHeight: number, drawGrid: boolean, radius: number, height: number}}\n */\nexport const defaultPlotChartConfig = {\n  width: 1000,\n  height: 600,\n  margin: {\n    top: LotivisConfig.defaultMargin,\n    right: LotivisConfig.defaultMargin,\n    bottom: LotivisConfig.defaultMargin,\n    left: LotivisConfig.defaultMargin\n  },\n  lineHeight: 28,\n  radius: 23,\n  showLabels: true,\n  drawGrid: true,\n  showTooltip: true,\n  sendsNotifications: true,\n  lowColor: \"rgb(184, 233, 148)\",\n  highColor: \"rgb(0, 122, 255)\",\n  sort: PlotChartSort.none,\n  type: PlotChartType.gradient,\n  numberFormat: Intl.NumberFormat(\"de-DE\", {\n    maximumFractionDigits: 3\n  })\n};\n","/**\n * Draws the axis on the timm plot chart.\n * @class PlotAxisRenderer\n */\nexport class PlotAxisRenderer {\n  /**\n   * Creates a new instance of PlotAxisRenderer.\n   * @constructor\n   * @param plotChart The parental date.chart.plot.chart chart.\n   */\n  constructor(plotChart) {\n    /**\n     * Appends axis on the top, left and bottom of the date.chart.plot.chart chart.\n     */\n    this.renderAxis = function() {\n      let margin = plotChart.config.margin;\n\n      // top\n      plotChart.svg\n        .append(\"g\")\n        .call(d3.axisTop(plotChart.xChart))\n        .attr(\"transform\", () => `translate(0,${margin.top})`);\n\n      // left\n      plotChart.svg\n        .append(\"g\")\n        .call(d3.axisLeft(plotChart.yChart))\n        .attr(\"transform\", () => `translate(${margin.left},0)`);\n\n      // bottom\n      plotChart.svg\n        .append(\"g\")\n        .call(d3.axisBottom(plotChart.xChart))\n        .attr(\n          \"transform\",\n          () => `translate(0,${plotChart.height - margin.bottom})`\n        );\n    };\n  }\n}\n","import { LotivisConfig } from \"../shared/config\";\n\n/**\n * Appends and updates the tooltip of a date.chart.plot.chart chart.\n * @class PlotTooltipRenderer\n * @see PlotChart\n */\nexport class PlotTooltipRenderer {\n  /**\n   * Creates a new instance of PlotTooltipRenderer.\n   *\n   * @constructor\n   * @param plotChart\n   */\n  constructor(plotChart) {\n    const tooltip = plotChart.element\n      .append(\"div\")\n      .attr(\"class\", \"ltv-tooltip\")\n      .attr(\"rx\", 5) // corner radius\n      .attr(\"ry\", 5)\n      .style(\"opacity\", 0);\n\n    /**\n     * Returns the HTML content for the given dataset.\n     * @param dataset The dataset to represent in HTML.\n     */\n    function getHTMLContentForDataset(dataset) {\n      let components = [];\n\n      let sum = dataset.data\n        .map(item => item.value)\n        .reduce((acc, next) => +acc + +next, 0);\n      let formatted = plotChart.config.numberFormat.format(sum);\n\n      components.push(\"Label: \" + dataset.label);\n      components.push(\"\");\n      components.push(\"Start: \" + dataset.firstDate);\n      components.push(\"End: \" + dataset.lastDate);\n      components.push(\"\");\n      components.push(\"Items: \" + formatted);\n      components.push(\"\");\n\n      let filtered = dataset.data.filter(item => item.value !== 0);\n      for (let index = 0; index < filtered.length; index++) {\n        let entry = filtered[index];\n        let formatted = plotChart.config.numberFormat.format(entry.value);\n        components.push(`${entry.date}: ${formatted}`);\n      }\n\n      return components.join(\"<br/>\");\n    }\n\n    /**\n     * Returns the pixel position for to tooltip to display it aligned to the left of a bar.\n     * @param dataset The dataset to display the tooltip for.\n     * @param factor The factor of the view box of the SVG.\n     * @param offset The offset of the chart.\n     * @returns {*} The left pixel position for the tooltip.\n     */\n    function getTooltipLeftForDataset(dataset, factor, offset) {\n      let left = plotChart.xChart(dataset.firstDate);\n      left *= factor;\n      left += offset[0];\n      return left;\n    }\n\n    /**\n     * Presents the tooltip for the given dataset.\n     *\n     * @param event The mouse event.\n     * @param dataset The dataset.\n     */\n    this.showTooltip = function(event, dataset) {\n      if (!plotChart.config.showTooltip) return;\n      tooltip.html(getHTMLContentForDataset(dataset));\n\n      // position tooltip\n      let tooltipHeight = Number(tooltip.style(\"height\").replace(\"px\", \"\"));\n      let factor =\n        plotChart.getElementEffectiveSize()[0] / plotChart.config.width;\n      let offset = plotChart.getElementPosition();\n\n      let top = plotChart.yChart(dataset.label) * factor;\n      top += offset[1];\n\n      if (\n        plotChart.yChart(dataset.label) - plotChart.config.margin.top <=\n        plotChart.graphHeight / 2\n      ) {\n        top +=\n          plotChart.config.lineHeight * factor + LotivisConfig.tooltipOffset;\n      } else {\n        top -= tooltipHeight + 20; // subtract padding\n        top -= LotivisConfig.tooltipOffset;\n      }\n\n      let left = getTooltipLeftForDataset(dataset, factor, offset);\n\n      tooltip\n        .style(\"left\", left + \"px\")\n        .style(\"top\", top + \"px\")\n        .style(\"opacity\", 1);\n    };\n\n    /**\n     * Hides the tooltip by setting its opacity to 0.\n     */\n    this.hideTooltip = function() {\n      let controller = plotChart.datasetController;\n      let filters = controller.datasetFilters;\n\n      if (filters && filters.length !== 0) {\n        controller.resetFilters();\n      }\n\n      if (+tooltip.style(\"opacity\") === 0) return;\n      tooltip.style(\"opacity\", 0);\n    };\n  }\n}\n","import { hashCode } from \"../shared/hash\";\n\n/**\n *\n * @class PlotLabelRenderer\n */\nexport class PlotLabelRenderer {\n  /**\n   * Creates a new instance of PlotLabelRenderer.\n   *\n   * @constructor\n   * @param plotChart The parental date.chart.plot.chart chart.\n   */\n  constructor(plotChart) {\n    /**\n     * Draws the labels on the bars on the date.chart.plot.chart chart.\n     */\n    this.renderLabels = function() {\n      if (!plotChart.config.showLabels) return;\n\n      let xBandwidth = plotChart.yChart.bandwidth();\n      let xChart = plotChart.xChart;\n\n      plotChart.labels = plotChart.barsData\n        .append(\"g\")\n        .attr(\"transform\", `translate(0,${xBandwidth / 2 + 4})`)\n        .append(\"text\")\n        .attr(\"class\", \"ltv-plot-label\")\n        .attr(\"id\", d => \"rect-\" + hashCode(d.label))\n        .attr(\"x\", d => xChart(d.firstDate) + xBandwidth / 2)\n        .attr(\"y\", d => plotChart.yChart(d.label))\n        .attr(\n          \"width\",\n          d => xChart(d.lastDate) - xChart(d.firstDate) + xBandwidth\n        )\n        .text(function(dataset) {\n          if (dataset.sum === 0) return;\n          let formatted = plotChart.config.numberFormat.format(dataset.sum);\n          return `${dataset.duration + 1} years, ${formatted} items`;\n        });\n    };\n  }\n}\n","/**\n * Draws a grid on the date.chart.plot.chart chart.\n *\n * @class PlotGridRenderer\n */\nexport class PlotGridRenderer {\n  /**\n   * Creates a new instance of TimePlotGridRenderer.\n   *\n   * @constructor\n   * @param plotChart The parental date.chart.plot.chart chart.\n   */\n  constructor(plotChart) {\n    /**\n     * Adds a grid to the chart.\n     */\n    this.render = function() {\n      if (!plotChart.config.drawGrid) return;\n\n      plotChart.svg\n        .append(\"g\")\n        .attr(\"class\", \"ltv-plot-grid ltv-plot-grid-x\")\n        .attr(\n          \"transform\",\n          \"translate(0,\" +\n            (plotChart.preferredHeight - plotChart.config.margin.bottom) +\n            \")\"\n        )\n        .call(plotChart.xAxisGrid);\n\n      plotChart.svg\n        .append(\"g\")\n        .attr(\"class\", \"ltv-plot-grid ltv-plot-grid-y\")\n        .attr(\"transform\", `translate(${plotChart.config.margin.left},0)`)\n        .call(plotChart.yAxisGrid);\n    };\n  }\n}\n","/**\n * Draws the background of a time plot chart.\n */\nexport class PlotBackgroundRenderer {\n  /**\n   *\n   * @param plotChart\n   */\n  constructor(plotChart) {\n    this.render = function() {\n      plotChart.svg\n        .append(\"rect\")\n        .attr(\"width\", plotChart.width || plotChart.config.width)\n        .attr(\"height\", plotChart.height)\n        .attr(\"class\", `ltv-plot-chart-background`)\n        .on(\"click\", (event, some) => {\n          plotChart.datasetController.resetLabelFilters();\n        });\n    };\n  }\n}\n","import { createIDFromDataset } from \"../shared/selector\";\n\n/**\n * Draws the background / selection bars of a time plot chart.\n *\n * @class PlotChartHoverBarsRenderer\n */\nexport class PlotChartHoverBarsRenderer {\n  /**\n   * Creates a new instance of PlotAxisRenderer.\n   * @constructor\n   * @param plotChart The parental date.chart.plot.chart chart.\n   */\n  constructor(plotChart) {\n    function createID(dataset) {\n      return `ltv-plot-chart-hover-bar-id-${createIDFromDataset(dataset)}`;\n    }\n\n    function hideAll() {\n      plotChart.svg.selectAll(\".ltv-plot-chart-hover-bar\").attr(\"opacity\", 0);\n    }\n\n    /**\n     * To be called when the mouse enters a bar on the date.chart.plot.chart chart.\n     * @param event The mouse event.\n     * @param dataset The represented dataset.\n     */\n    function mouseEnter(event, dataset) {\n      hideAll();\n\n      let id = createID(dataset);\n      plotChart.svg.select(`#${id}`).attr(\"opacity\", 0.3);\n\n      plotChart.tooltipRenderer.showTooltip.bind(plotChart)(event, dataset);\n      // plotChart.onSelectDataset(event, dataset);\n    }\n\n    /**\n     * To be called when the mouse leaves a bar on the date.chart.plot.chart chart.\n     * @param event The mouse event.\n     * @param dataset The represented dataset.\n     */\n    function mouseOut(event, dataset) {\n      hideAll();\n      plotChart.tooltipRenderer.hideTooltip.bind(plotChart)(event, dataset);\n\n      if (event.buttons === 1) {\n        mouseClick(event, dataset);\n      }\n    }\n\n    function mouseClick(event, dataset) {\n      if (plotChart.config.sendsNotifications) {\n        plotChart.makeUpdateInsensible();\n        plotChart.datasetController.toggleDataset(dataset.label);\n        plotChart.makeUpdateSensible();\n      }\n      plotChart.selectionRenderer.update();\n    }\n\n    /**\n     * Draws the bars.\n     */\n    this.render = function() {\n      let datasets = plotChart.dataView.datasets;\n      let graphWidth = plotChart.graphWidth;\n\n      plotChart.backgrounBarsData = plotChart.svg\n        .append(\"g\")\n        .selectAll(\"g\")\n        .data(datasets)\n        .enter();\n\n      plotChart.backgrounBars = plotChart.backgrounBarsData\n        .append(\"rect\")\n        .attr(\"id\", d => createID(d))\n        .attr(\"class\", \"ltv-plot-chart-hover-bar\")\n        .attr(`opacity`, 0)\n        .attr(\"x\", plotChart.config.margin.left)\n        .attr(\"y\", d => plotChart.yChart(d.label))\n        .attr(\"height\", plotChart.yChart.bandwidth())\n        .attr(\"width\", graphWidth)\n        .on(\"mouseenter\", mouseEnter)\n        .on(\"mouseout\", mouseOut)\n        .on(\"click\", mouseClick);\n    };\n  }\n}\n","import { createIDFromDataset } from \"../shared/selector\";\nimport { flatDatasets } from \"../data.juggle/data.flat\";\nimport { combineByDate } from \"../data.juggle/data.combine\";\nimport { Color } from \"../shared/color\";\n\n/**\n * Draws the bar on the time plot chart.\n * @class PlotBarsFractionsRenderer\n */\nexport class PlotBarsFractionsRenderer {\n  /**\n   * Creates a new instance of PlotAxisRenderer.\n   * @constructor\n   * @param plotChart The parental date.chart.plot.chart chart.\n   */\n  constructor(plotChart) {\n    // constant for the radius of the drawn bars.\n    const radius = 6;\n\n    /**\n     * To be called when the mouse enters a bar on the date.chart.plot.chart chart.\n     * @param event The mouse event.\n     * @param dataset The represented dataset.\n     */\n    function mouseEnter(event, dataset) {\n      // plotChart.tooltipRenderer.showTooltip.bind(plotChart)(event, dataset);\n      // plotChart.onSelectDataset(event, dataset);\n    }\n\n    /**\n     * To be called when the mouse leaves a bar on the date.chart.plot.chart chart.\n     * @param event The mouse event.\n     * @param dataset The represented dataset.\n     */\n    function mouseOut(event, dataset) {\n      // plotChart.tooltipRenderer.hideTooltip.bind(plotChart)(event, dataset);\n    }\n\n    /**\n     * Draws the bars.\n     */\n    this.renderBars = function() {\n      let datasets = plotChart.dataView.datasets;\n      let max = plotChart.dataView.max;\n      let flatData = flatDatasets(datasets);\n      flatData = combineByDate(flatData);\n\n      plotChart.barsData = plotChart.svg\n        .append(\"g\")\n        .selectAll(\"g\")\n        .data(flatData)\n        .enter();\n\n      let colors = Color.mapColors(max);\n\n      plotChart.bars = plotChart.barsData\n        .append(\"rect\")\n        .attr(\"id\", d => `ltv-plot-bar-${createIDFromDataset(d)}`)\n        .attr(\"class\", \"ltv-plot-bar\")\n        .attr(`fill`, d => colors(d.value))\n        .attr(\"rx\", radius)\n        .attr(\"ry\", radius)\n        .attr(\"x\", d => plotChart.xChart(d.date))\n        .attr(\"y\", d => plotChart.yChartPadding(d.label))\n        .attr(\"height\", plotChart.yChartPadding.bandwidth())\n        .attr(\"id\", d => \"rect-\" + createIDFromDataset(d))\n        .on(\"mouseenter\", mouseEnter)\n        .on(\"mouseout\", mouseOut)\n        .attr(\"width\", plotChart.xChart.bandwidth());\n    };\n  }\n}\n","import { Color } from \"../shared/color\";\nimport { createIDFromDataset } from \"../shared/selector\";\n\n/**\n * Calculates and creates the gradients for the bars of a date.chart.plot.chart chart.\n *\n * @class PlotBarsGradientCreator\n */\nexport class PlotBarsGradientCreator {\n  /**\n   * Creates a new instance of PlotBarsGradientCreator.\n   *\n   * @constructor\n   * @param plotChart The parental date.chart.plot.chart chart.\n   */\n  constructor(plotChart) {\n    this.plotChart = plotChart;\n    this.colorGenerator = Color.plotColor(1);\n  }\n\n  /**\n   * Creates the gradient for the bar representing the given dataset.\n   * @param dataset The dataset to represent.\n   */\n  createGradient(dataset) {\n    let max = this.plotChart.dataView.max;\n    let gradient = this.plotChart.definitions\n      .append(\"linearGradient\")\n      .attr(\"id\", \"ltv-plot-gradient-\" + createIDFromDataset(dataset))\n      .attr(\"x1\", \"0%\")\n      .attr(\"x2\", \"100%\")\n      .attr(\"y1\", \"0%\")\n      .attr(\"y2\", \"0%\");\n\n    let data = dataset.data;\n    let count = data.length;\n    let latestDate = dataset.lastDate;\n    let duration = dataset.duration;\n\n    if (!data || data.length === 0) return;\n\n    if (duration === 0) {\n      let item = data[0];\n      let value = item.value;\n      let opacity = value / max;\n\n      gradient\n        .append(\"stop\")\n        .attr(\"offset\", `100%`)\n        .attr(\"stop-color\", this.colorGenerator(opacity));\n    } else {\n      for (let index = 0; index < count; index++) {\n        let item = data[index];\n        let date = item.date;\n        let opacity = item.value / max;\n\n        let dateDifference = latestDate - date;\n        let value = dateDifference / duration;\n        let datePercentage = (1 - value) * 100;\n\n        gradient\n          .append(\"stop\")\n          .attr(\"offset\", `${datePercentage}%`)\n          .attr(\"stop-color\", this.colorGenerator(opacity));\n      }\n    }\n  }\n}\n","import { PlotBarsGradientCreator } from \"./plot.bars.gradient.creator\";\nimport { createIDFromDataset } from \"../shared/selector\";\n\n/**\n * Draws the bar on the date.chart.plot.chart chart.\n * @class PlotBarsGradientRenderer\n */\nexport class PlotBarsGradientRenderer {\n  /**\n   * Creates a new instance of PlotAxisRenderer.\n   * @constructor\n   * @param plotChart The parental date.chart.plot.chart chart.\n   */\n  constructor(plotChart) {\n    // constant for the radius of the drawn bars.\n    const radius = 6;\n\n    this.gradientCreator = new PlotBarsGradientCreator(plotChart);\n    plotChart.definitions = plotChart.svg.append(\"defs\");\n\n    /**\n     * Draws the bars.\n     */\n    this.renderBars = function() {\n      let datasets = plotChart.dataView.datasets;\n      plotChart.definitions = plotChart.svg.append(\"defs\");\n\n      for (let index = 0; index < datasets.length; index++) {\n        this.gradientCreator.createGradient(datasets[index]);\n      }\n\n      plotChart.barsData = plotChart.svg\n        .append(\"g\")\n        .selectAll(\"g\")\n        .data(datasets)\n        .enter();\n\n      plotChart.bars = plotChart.barsData\n        .append(\"rect\")\n        .attr(\"fill\", d => `url(#ltv-plot-gradient-${createIDFromDataset(d)})`)\n        .attr(\"class\", \"ltv-plot-bar\")\n        .attr(\"rx\", radius)\n        .attr(\"ry\", radius)\n        .attr(\"x\", d =>\n          plotChart.xChart(d.duration < 0 ? d.lastDate : d.firstDate || 0)\n        )\n        .attr(\"y\", d => plotChart.yChartPadding(d.label))\n        .attr(\"height\", plotChart.yChartPadding.bandwidth())\n        .attr(\"id\", d => \"ltv-plot-rect-\" + createIDFromDataset(d))\n        .attr(\n          \"width\",\n          function(data) {\n            if (!data.firstDate || !data.lastDate) return 0;\n            return (\n              plotChart.xChart(data.lastDate) -\n              plotChart.xChart(data.firstDate) +\n              plotChart.xChart.bandwidth()\n            );\n          }.bind(this)\n        );\n    };\n  }\n}\n","import { hashCode } from \"../shared/hash\";\n\n/**\n *\n * @class PlotLabelsFractionsRenderer\n */\nexport class PlotLabelsFractionsRenderer {\n  /**\n   * Creates a new instance of PlotLabelRenderer.\n   *\n   * @constructor\n   * @param plotChart The parental date.chart.plot.chart chart.\n   */\n  constructor(plotChart) {\n    /**\n     * Draws the labels on the bars on the date.chart.plot.chart chart.\n     */\n    this.renderLabels = function() {\n      if (!plotChart.config.showLabels) return;\n\n      let xBandwidth = plotChart.yChart.bandwidth();\n\n      plotChart.labels = plotChart.barsData\n        .append(\"g\")\n        .attr(\"transform\", `translate(0,${xBandwidth / 2 + 4})`)\n        .append(\"text\")\n        .attr(\"class\", \"ltv-plot-label\")\n        .attr(\"id\", d => \"rect-\" + hashCode(d.label))\n        .attr(\"x\", d => plotChart.xChart(d.date) + 4)\n        .attr(\"y\", d => plotChart.yChart(d.label))\n        .text(function(dataset) {\n          if (dataset.sum === 0) return;\n          let formatted = plotChart.config.numberFormat.format(dataset.value);\n          return `${formatted}`;\n        });\n    };\n  }\n}\n","import { createIDFromDataset } from \"../shared/selector\";\n\n/**\n * Draws the selection rectangles of a plot chart.\n *\n * @class PlotChartSelectionRenderer\n */\nexport class PlotChartSelectionRenderer {\n  /**\n   * Creates a new instance of PlotChartSelectionRenderer.\n   *\n   * @constructor\n   * @param plotChart The parental plot chart.\n   */\n  constructor(plotChart) {\n    function createID(dataset) {\n      return `ltv-plot-chart-selection-rect-id-${createIDFromDataset(dataset)}`;\n    }\n\n    function hideAll() {\n      plotChart.svg\n        .selectAll(`.ltv-plot-chart-selection-rect`)\n        .attr(\"opacity\", 0);\n    }\n\n    /**\n     * Draws the bars.\n     */\n    this.render = function() {\n      let datasets = plotChart.dataView.datasets;\n      let graphWidth = plotChart.graphWidth;\n\n      plotChart.selectionBarsData = plotChart.svg\n        .append(\"g\")\n        .selectAll(\"g\")\n        .data(datasets)\n        .enter();\n\n      plotChart.selectionBars = plotChart.selectionBarsData\n        .append(\"rect\")\n        .attr(\"id\", d => createID(d))\n        .attr(\"class\", \"ltv-plot-chart-selection-rect\")\n        .attr(`opacity`, 0)\n        .attr(\"x\", plotChart.config.margin.left)\n        .attr(\"y\", d => plotChart.yChart(d.label))\n        .attr(\"height\", plotChart.yChart.bandwidth())\n        .attr(\"width\", graphWidth);\n    };\n\n    this.update = function() {\n      let selectedLabels = getSelectedLabels();\n      plotChart.svg\n        .selectAll(`.ltv-plot-chart-selection-rect`)\n        .attr(`opacity`, dataset =>\n          selectedLabels.includes(dataset.label) ? 0.3 : 0\n        );\n      console.log(\"selectedLabels\", selectedLabels);\n    };\n\n    function getSelectedLabels() {\n      console.log(\n        \"plotChart.datasetController.filters\",\n        plotChart.datasetController.filters\n      );\n      return plotChart.datasetController.filters.labels || [];\n    }\n  }\n}\n","import { Chart } from \"../chart/chart\";\nimport \"../dataview/dataview.plot\";\nimport {\n  defaultPlotChartConfig,\n  PlotChartSort,\n  PlotChartType\n} from \"./plot.chart.config\";\nimport { PlotAxisRenderer } from \"./plot.axis.renderer\";\nimport { PlotTooltipRenderer } from \"./plot.tooltip.renderer\";\nimport { PlotLabelRenderer } from \"./plot.label.renderer\";\nimport { PlotGridRenderer } from \"./plot.grid.renderer\";\nimport { PlotBackgroundRenderer } from \"./plot.background.renderer\";\nimport { PlotChartHoverBarsRenderer } from \"./plot.chart.hover.bars.renderer\";\nimport { PlotBarsFractionsRenderer } from \"./plot.bars.fractions.renderer\";\nimport { PlotBarsGradientRenderer } from \"./plot.bars.gradient.renderer\";\nimport { PlotLabelsFractionsRenderer } from \"./plot.labels.fractions.renderer\";\nimport { PlotChartSelectionRenderer } from \"./plot.chart.selection.renderer\";\n\n/**\n * A lotivis date.chart.plot.chart chart.\n *\n * @class PlotChart\n * @extends Chart\n */\nexport class PlotChart extends Chart {\n  /**\n   * Initializes this diachronic chart by setting the default values.\n   */\n  initialize() {\n    let theConfig = this.config;\n    let margin;\n    margin = Object.assign({}, defaultPlotChartConfig.margin);\n    margin = Object.assign(margin, this.config.margin);\n\n    let config = Object.assign({}, defaultPlotChartConfig);\n    this.config = Object.assign(config, this.config);\n    this.config.margin = margin;\n\n    this.createSVG();\n    this.backgroundRenderer = new PlotBackgroundRenderer(this);\n    this.axisRenderer = new PlotAxisRenderer(this);\n    this.gridRenderer = new PlotGridRenderer(this);\n    this.selectionRenderer = new PlotChartSelectionRenderer(this);\n    this.hoverBarsRenderer = new PlotChartHoverBarsRenderer(this);\n\n    this.barsFractionsRenderer = new PlotBarsFractionsRenderer(this);\n    this.barsRenderer = new PlotBarsGradientRenderer(this);\n\n    this.labelsRenderer = new PlotLabelRenderer(this);\n    this.labelsFractionRenderer = new PlotLabelsFractionsRenderer(this);\n\n    this.tooltipRenderer = new PlotTooltipRenderer(this);\n  }\n\n  /**\n   * Appends the svg element to the parental element.\n   */\n  createSVG() {\n    this.svg = this.element\n      .append(\"svg\")\n      .attr(\"id\", this.svgSelector)\n      .attr(\"class\", \"ltv-chart-svg ltv-plot-chart-svg\")\n      .attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n      .attr(\"viewBox\", `0 0 ${this.config.width} ${this.config.height}`);\n  }\n\n  /**\n   * Removes any (old) components from the svg.\n   */\n  remove() {\n    this.svg.selectAll(\"*\").remove();\n  }\n\n  /**\n   *\n   */\n  precalculate() {\n    if (this.datasetController) {\n      this.dataView = this.datasetController.getPlotDataview();\n    } else {\n      this.dataView = { datasets: [], barsCount: 0 };\n    }\n\n    this.sortDatasets();\n\n    let margin = this.config.margin;\n    let barsCount = this.dataView.labelsCount || 0;\n\n    this.graphWidth = this.config.width - margin.left - margin.right;\n    this.graphHeight = barsCount * this.config.lineHeight;\n    this.height = this.graphHeight + margin.top + margin.bottom;\n    this.preferredHeight = this.height;\n\n    this.svg.attr(\n      \"viewBox\",\n      `0 0 ${this.config.width} ${this.preferredHeight}`\n    );\n\n    this.createScales();\n  }\n\n  /**\n   * Creates and renders the chart.\n   */\n  draw() {\n    this.backgroundRenderer.render();\n    this.gridRenderer.render();\n    this.axisRenderer.renderAxis();\n    this.selectionRenderer.render();\n    this.hoverBarsRenderer.render();\n    if (this.config.type === PlotChartType.gradient) {\n      this.barsRenderer.renderBars();\n      this.labelsRenderer.renderLabels();\n    } else {\n      this.barsFractionsRenderer.renderBars();\n      this.labelsFractionRenderer.renderLabels();\n    }\n  }\n\n  /**\n   * Updates the date.chart.plot.chart chart.\n   */\n  update(controller, reason) {\n    if (!this.updateSensible) return;\n    if (reason === \"dates-filter\") return;\n    this.remove();\n    this.precalculate();\n    this.draw();\n  }\n\n  /**\n   * Creates scales which are used to calculate the x and y positions of bars or circles.\n   */\n  createScales() {\n    this.xChart = d3\n      .scaleBand()\n      .domain(this.dataView.dates || [])\n      .rangeRound([\n        this.config.margin.left,\n        this.config.width - this.config.margin.right\n      ])\n      .paddingInner(0.1);\n\n    this.yChartPadding = d3\n      .scaleBand()\n      .domain(this.dataView.labels || [])\n      .rangeRound([\n        this.height - this.config.margin.bottom,\n        this.config.margin.top\n      ])\n      .paddingInner(0.1);\n\n    this.yChart = d3\n      .scaleBand()\n      .domain(this.dataView.labels || [])\n      .rangeRound([\n        this.height - this.config.margin.bottom,\n        this.config.margin.top\n      ]);\n\n    this.xAxisGrid = d3\n      .axisBottom(this.xChart)\n      .tickSize(-this.graphHeight)\n      .tickFormat(\"\");\n\n    this.yAxisGrid = d3\n      .axisLeft(this.yChart)\n      .tickSize(-this.graphWidth)\n      .tickFormat(\"\");\n  }\n\n  /**\n   *\n   * @param event\n   * @param dataset\n   */\n  onSelectDataset(event, dataset) {\n    if (!dataset || !dataset.label) return;\n    let label = dataset.label;\n    if (this.datasetController.listeners.length === 1) return;\n    this.updateSensible = false;\n    this.datasetController.setDatasetsFilter([label]);\n    this.updateSensible = true;\n  }\n\n  sortDatasets() {\n    let datasets = this.dataView.datasets;\n    let sortedDatasets = [];\n    switch (this.config.sort) {\n      case PlotChartSort.alphabetically:\n        sortedDatasets = datasets.sort((set1, set2) => set1.label > set2.label);\n        break;\n      case PlotChartSort.duration:\n        sortedDatasets = datasets.sort(\n          (set1, set2) => set1.duration < set2.duration\n        );\n        break;\n      case PlotChartSort.intensity:\n        sortedDatasets = datasets.sort((set1, set2) => set1.sum < set2.sum);\n        break;\n      case PlotChartSort.firstDate:\n        sortedDatasets = datasets.sort(\n          (set1, set2) => set1.firstDate > set2.firstDate\n        );\n        break;\n      default:\n        sortedDatasets = datasets;\n        break;\n    }\n\n    this.dataView.labels = sortedDatasets\n      .map(dataset => String(dataset.label))\n      .reverse();\n    this.dataView.datasetsSorted = this.dataView.labels;\n  }\n}\n","import {Checkbox} from \"../shared.components/checkbox\";\nimport {UrlParameters} from \"../shared/url.parameters\";\nimport {Dropdown} from \"../shared.components/dropdown\";\nimport {Option} from \"../shared.components/option\";\nimport {SettingsPopup} from \"../shared.components/settings.popup\";\nimport {PlotChartSort, PlotChartType} from \"../plot.chart/plot.chart.config\";\n\n/**\n *\n * @class PlotChartCardSettingsPopup\n * @extends SettingsPopup\n */\nexport class PlotChartCardSettingsPopup extends SettingsPopup {\n\n  /**\n   * Appends the headline and the content row of the popup.\n   */\n  inject() {\n    super.inject();\n\n    let container = this.row.append('div');\n\n    let showLabelsCheckboxContainer = container.append('div').classed('lotivis-settings-card-row', true);\n    this.showLabelsCheckbox = new Checkbox(showLabelsCheckboxContainer);\n    this.showLabelsCheckbox.setText('Labels');\n    this.showLabelsCheckbox.onClick = function (checked) {\n      this.chart.config.showLabels = checked;\n      this.chart.update();\n      UrlParameters.getInstance().set(UrlParameters.chartShowLabels, checked);\n    }.bind(this);\n\n    let typeDropdownContainer = container.append('div').classed('lotivis-settings-card-row', true);\n    this.typeDropdown = new Dropdown(typeDropdownContainer);\n    this.typeDropdown.setLabelText('Type');\n    this.typeDropdown.setOptions([\n      new Option(PlotChartType.gradient),\n      new Option(PlotChartType.fraction)\n    ]);\n    this.typeDropdown.setOnChange(function (value) {\n      this.chart.config.type = value;\n      this.chart.update();\n    }.bind(this));\n\n    let dropdownContainer = container.append('div').classed('lotivis-settings-card-row', true);\n    this.sortDropdown = new Dropdown(dropdownContainer);\n    this.sortDropdown.setLabelText('Sort');\n    this.sortDropdown.setOptions([\n      new Option(PlotChartSort.alphabetically),\n      new Option(PlotChartSort.duration),\n      new Option(PlotChartSort.intensity),\n      new Option(PlotChartSort.firstDate)\n    ]);\n    this.sortDropdown.setOnChange(function (value) {\n      this.chart.config.sort = value;\n      this.chart.update();\n    }.bind(this));\n  }\n\n  /**\n   * Tells this popup that it is about to be displayed.\n   */\n  willShow() {\n    this.showLabelsCheckbox.setChecked(this.chart.config.showLabels);\n    this.typeDropdown.setSelectedOption(this.chart.config.type);\n    this.sortDropdown.setSelectedOption(this.chart.config.sort);\n  }\n}\n","import { Card } from \"../shared.components/card\";\nimport { UrlParameters } from \"../shared/url.parameters\";\nimport { ChartCard } from \"../shared.components/chart.card\";\nimport { PlotChart } from \"../plot.chart/plot.chart\";\nimport { PlotChartCardSettingsPopup } from \"./plot.chart.card.settings.popup\";\nimport { downloadImage } from \"../shared/download\";\nimport { createDownloadFilename } from \"../shared/filename\";\n\n/**\n * A card containing a date.chart.plot.chart chart.\n * @class PlotChartCard\n * @extends Card\n */\nexport class PlotChartCard extends ChartCard {\n  /**\n   * Creates a new instance of PlotChartCard.\n   * @param selector The selector\n   * @param config\n   */\n  constructor(selector, config) {\n    let theSelector = selector || \"plot-chart-card\";\n    super(theSelector, config);\n    this.applyURLParameters();\n    // this.setTitle('Plot');\n  }\n\n  /**\n   * Injects the time plot chart in the body of the card.\n   */\n  injectChart() {\n    this.chartID = this.selector + \"-chart\";\n    this.body.attr(\"id\", this.chartID);\n    this.chart = new PlotChart(this.chartID, this.config);\n  }\n\n  /**\n   * Applies possible url parameters.\n   */\n  applyURLParameters() {\n    let instance = UrlParameters.getInstance();\n    this.chart.type = instance.getString(UrlParameters.chartType, \"bar\");\n    this.chart.isShowLabels = instance.getBoolean(\n      UrlParameters.chartShowLabels,\n      false\n    );\n    this.chart.isCombineStacks = instance.getBoolean(\n      UrlParameters.chartCombineStacks,\n      false\n    );\n  }\n\n  /**\n   * Presents the settings popup.\n   */\n  presentSettingsPopupAction() {\n    let bodyElement = d3.select(\"body\");\n    let button = document.getElementById(this.moreButton.selector);\n    let settingsPopup = new PlotChartCardSettingsPopup(bodyElement);\n    settingsPopup.chart = this.chart;\n    settingsPopup.showUnder(button, \"right\");\n  }\n\n  /**\n   * Creates and downloads a screenshot from the chart.\n   * @override\n   */\n  screenshotButtonAction() {\n    let filename = this.chart.datasetController.getFilename();\n    let downloadFilename = createDownloadFilename(filename, `plot-chart`);\n    downloadImage(this.chart.svgSelector, downloadFilename);\n  }\n}\n","import {DatasetsController} from \"./datasets.controller\";\nimport {lotivis_log} from \"../shared/debug\";\n\n/**\n * Appends the given listener to the collection of listeners.\n *\n * @param listener The listener to addDataset.\n */\nDatasetsController.prototype.addListener = function (listener) {\n  if (!this.listeners) this.listeners = [];\n  if (!listener.update) return lotivis_log('Listener unqualified.');\n  if (this.listeners.includes(listener)) return lotivis_log(`[lotivis]  Attempt to add listener twice (${listener}).`);\n  this.listeners.push(listener);\n  listener.update(this, 'registration');\n};\n\n/**\n * Removes the given listener from the collection of listeners.\n *\n * @param listener The listener to removeDataset.\n */\nDatasetsController.prototype.removeListener = function (listener) {\n  if (!this.listeners) return lotivis_log('No listeners property.');\n  let index = this.listeners.indexOf(listener);\n  if (index === -1) return lotivis_log(`Listener not registered: ${listener}`);\n  this.listeners = this.listeners.splice(index, 1);\n};\n\n/**\n * Notifies all listeners.\n * @param reason The reason to send to the listener.  Default is 'none'.\n */\nDatasetsController.prototype.notifyListeners = function (reason = 'none') {\n  if (!this.listeners) return;\n  for (let index = 0; index < this.listeners.length; index++) {\n    let listener = this.listeners[index];\n    if (!listener.update) {\n      lotivis_log('Listener unqualified.');\n      continue;\n    }\n    lotivis_log(`listener: ${listener}`);\n    console.timeStamp('will update ' + listener);\n    listener.update(this, reason);\n    console.timeStamp('did update ' + listener);\n  }\n};\n\n/**\n * Sets this controller to all of the given listeners via the `setDatasetsController` function.\n * @param listeners A collection of listeners.\n */\nDatasetsController.prototype.register = function (listeners) {\n  if (!Array.isArray(listeners)) return;\n  for (let index = 0; index < listeners.length; index++) {\n    let listener = listeners[index];\n    if (!listener.setDatasetsController) continue;\n    listener.setDatasetsController(this);\n  }\n};\n","import {DatasetsController} from \"./datasets.controller\";\nimport {objectsEqual} from \"../shared/equal\";\nimport {lotivis_log} from \"../shared/debug\";\nimport {copy} from \"../shared/copy\";\n\n/**\n * Resets all filters.  Notifies listeners.\n */\nDatasetsController.prototype.resetFilters = function (notifyListeners = true) {\n  this.filters.locations = [];\n  this.filters.dates = [];\n  this.filters.labels = [];\n  this.calculateSnapshot();\n  if (!notifyListeners) return;\n  this.notifyListeners('reset-filters');\n};\n\n/**\n * Resets locations filters.  Notifies listeners.\n */\nDatasetsController.prototype.resetLocationFilters = function (notifyListeners = true) {\n  this.filters.locations = [];\n  this.calculateSnapshot();\n  if (!notifyListeners) return;\n  this.notifyListeners('reset-location-filters');\n};\n\n/**\n * Resets date filters.  Notifies listeners.\n */\nDatasetsController.prototype.resetDateFilters = function (notifyListeners = true) {\n  this.filters.dates = [];\n  this.calculateSnapshot();\n  if (!notifyListeners) return;\n  this.notifyListeners('reset-dates-filters');\n};\n\n/**\n * Resets label filters.  Notifies listeners.\n */\nDatasetsController.prototype.resetLabelFilters = function (notifyListeners = true) {\n  this.filters.labels = [];\n  this.calculateSnapshot();\n  if (!notifyListeners) return;\n  this.notifyListeners('reset-label-filters');\n};\n\n/**\n * Sets the locations filter.  Notifies listeners.\n *\n * @param locations The locations to filter.\n */\nDatasetsController.prototype.setLocationsFilter = function (locations) {\n  let stringVersions = locations.map(location => String(location)).filter(item => item.length > 0);\n  if (objectsEqual(this.filters.locations, stringVersions)) {\n    return lotivis_log(`[lotivis]  Location filters not changed.`);\n  }\n  this.filters.locations = stringVersions;\n  this.calculateSnapshot();\n  this.notifyListeners('filter-locations');\n};\n\nDatasetsController.prototype.toggleLocation = function (location) {\n  const index = this.filters.locations.indexOf(location);\n  if (index !== -1) {\n    this.filters.locations.splice(index, 1);\n  } else {\n    this.filters.locations.push(location);\n  }\n  this.calculateSnapshot();\n  this.notifyListeners('filter-locations');\n};\n\n/**\n * Sets the dates filter.  Notifies listeners.\n * @param dates The dates to filter.\n */\nDatasetsController.prototype.setDatesFilter = function (dates) {\n  let stringVersions = dates.map(date => String(date)).filter(item => item.length > 0);\n  if (objectsEqual(this.filters.dates, stringVersions)) return lotivis_log(`[lotivis]  Date filters not changed.`);\n  this.filters.dates = stringVersions;\n  this.calculateSnapshot();\n  this.notifyListeners('filter-dates');\n  lotivis_log('filter-dates:', this.filters.dates);\n};\n\nDatasetsController.prototype.toggleDate = function (date) {\n  const stringVersion = String(date);\n  const index = this.filters.dates.indexOf(stringVersion);\n  if (index !== -1) {\n    this.filters.dates.splice(index, 1);\n  } else {\n    this.filters.dates.push(stringVersion);\n  }\n  this.calculateSnapshot();\n  this.notifyListeners('filter-dates');\n};\n\n/**\n * Sets the datasets filter.  Notifies listeners.\n *\n * @param datasets The datasets to filter.\n */\nDatasetsController.prototype.setDatasetsFilter = function (datasets) {\n  let stringVersions = datasets.map(dataset => String(dataset)).filter(item => item.length > 0);\n  if (objectsEqual(this.filters.labels, stringVersions)) return lotivis_log(`[lotivis]  Dataset filters not changed.`);\n  this.filters.labels = stringVersions;\n  this.calculateSnapshot();\n  this.notifyListeners('filter-labels');\n  lotivis_log('filter-labels:', this.filters.labels);\n};\n\n/**\n * Toggles the enabled of the dataset with the given label.\n *\n * @param label The label of the dataset.\n * @param notifyListeners A boolean value indicating whether to notify the listeners.  Default is `true`.\n */\nDatasetsController.prototype.toggleDataset = function (label, notifyListeners = true) {\n\n  let index = this.filters.labels.indexOf(label);\n  if (index !== -1) {\n    this.filters.labels.splice(index, 1);\n  } else {\n    this.filters.labels.push(String(label));\n  }\n\n  if (!notifyListeners) return;\n  this.calculateSnapshot();\n  this.notifyListeners('dataset-toggle');\n};\n\n/**\n * Returns a newly generated collection containing all enabled datasets.\n *\n * @returns {*} The collection of enabled datasets.\n */\nDatasetsController.prototype.filteredDatasets = function () {\n  let filtered = copy(this.datasets);\n\n  if (this.filters.labels && this.filters.labels.length > 0) {\n    let datasetFilters = this.filters.labels;\n    filtered = filtered.filter(function (dataset) {\n      return datasetFilters.includes(String(dataset.label));\n    });\n  }\n\n  if (this.filters.locations && this.filters.locations.length > 0) {\n    let locationFilters = this.filters.locations;\n    filtered = filtered.map(function (dataset) {\n      dataset.data = dataset.data\n        .filter(data => locationFilters.includes(String(data.location))) || [];\n      return dataset;\n    });\n  }\n\n  if (this.filters.dates && this.filters.dates.length > 0) {\n    let dateFilters = this.filters.dates;\n    filtered = filtered.map(function (dataset) {\n      dataset.data = dataset.data\n        .filter(data => dateFilters.includes(String(data.date))) || [];\n      return dataset;\n    });\n  }\n\n  return filtered.filter(dataset => dataset.data.length > 0);\n};\n","import {Color} from \"../shared/color\";\n\n/**\n *\n * @class DatasetsColorsController\n */\nexport class DatasetsColorsController {\n\n  /**\n   * Creates a new instance of DatasetsColorsController.\n   * @param workingDatasets\n   * @param stacks\n   */\n  constructor(workingDatasets, stacks) {\n\n    let datasets = workingDatasets;\n    let labelToColor = {};\n    let stackToColors = {};\n\n    for (let sIndex = 0; sIndex < stacks.length; sIndex++) {\n      let stack = stacks[sIndex];\n\n      // filter datasets for stack\n      let filtered = datasets.filter(function (dataset) {\n        return dataset.label === stack || dataset.stack === stack;\n      });\n\n      let colors = Color.colorsForStack(sIndex, filtered.length);\n      stackToColors[stack] = colors;\n      for (let dIndex = 0; dIndex < filtered.length; dIndex++) {\n        labelToColor[filtered[dIndex].label] = colors[dIndex];\n      }\n    }\n\n    this.colorForDataset = function (label) {\n      return labelToColor[label] || Color.defaultTint;\n    };\n\n    this.colorForStack = function (stack) {\n      return stackToColors[stack][0] || Color.defaultTint;\n    };\n\n    this.colorsForStack = function (stack) {\n      return stackToColors[stack] || [];\n    };\n  }\n}\n","import {DatasetsController} from \"./datasets.controller\";\nimport {flatDatasets} from \"../data.juggle/data.flat\";\nimport {\n  extractDatesFromDatasets,\n  extractDatesFromFlatData,\n  extractLabelsFromDatasets, extractLocationsFromDatasets,\n  extractLocationsFromFlatData,\n  extractStacksFromDatasets\n} from \"../data.juggle/data.extract\";\nimport {copy} from \"../shared/copy\";\nimport {DatasetsColorsController} from \"./datasets.controller.colors\";\nimport {lotivis_log} from \"../shared/debug\";\n\n/**\n */\nDatasetsController.prototype.calculateSnapshot = function () {\n  lotivis_log(`[lotivis]  calculateSnapshot`);\n  this.snapshot = {};\n  this.snapshot.datasets = this.filteredDatasets();\n  this.snapshot.flatData = flatDatasets(this.snapshot.datasets);\n  this.snapshot.labels = extractLabelsFromDatasets(this.snapshot.datasets);\n  this.snapshot.stacks = extractStacksFromDatasets(this.snapshot.datasets);\n  this.snapshot.dates = extractDatesFromFlatData(this.snapshot.datasets)\n    .sort((left, right) => this.dateAccess(left) - this.dateAccess(right));\n  this.snapshot.locations = extractLocationsFromFlatData(this.snapshot.datasets);\n};\n\n/**\n * Calculates the additional data.\n */\nDatasetsController.prototype.calculateAdditionalData = function () {\n  let dateAccess = this.dateAccess;\n\n  this.datasets = copy(this.datasets)\n    .sort((left, right) => left.label > right.label);\n\n  this.datasets.forEach((dataset) => {\n    dataset.data.forEach((item) => {\n      item.dateNumeric = dateAccess(item.date);\n    });\n    dataset.data = dataset.data\n      .sort((left, right) => left.dateNumeric - right.dateNumeric);\n  });\n\n  this.flatData = flatDatasets(this.datasets);\n  this.labels = extractLabelsFromDatasets(this.datasets);\n  this.stacks = extractStacksFromDatasets(this.datasets);\n  this.dates = extractDatesFromDatasets(this.datasets)\n    .sort((left, right) => dateAccess(left) - dateAccess(right));\n\n  this.locations = extractLocationsFromDatasets(this.datasets);\n  this.datasetsColorsController = new DatasetsColorsController(this.datasets, this.stacks);\n};\n\n/**\n * Tells this datasets controller that its datasets did change.\n */\nDatasetsController.prototype.datasetsDidChange = function () {\n  if (!this.datasets || !Array.isArray(this.datasets)) {\n    lotivis_log('[lotivis]  No datasets.');\n    return;\n  }\n\n  this.calculateAdditionalData();\n  this.calculateSnapshot();\n  this.notifyListeners('datasets-update');\n};\n","import {DatasetsController} from \"./datasets.controller\";\nimport {copy} from \"../shared/copy\";\nimport {validateDatasets} from \"../data.juggle/data.validate\";\nimport \"./datasets.controller.snapshot\";\n\n/*\nCRUD:\n- create\n- read\n- update\n- delete\n */\n\n/**\n * Sets the given dataset.\n * @param dataset The new dataset.\n */\nDatasetsController.prototype.setDataset = function (dataset) {\n  this.cache.invalidate();\n  this.setDatasets([dataset]);\n};\n\n/**\n * Updates the datasets of this controller.\n * @param datasets The new datasets.\n */\nDatasetsController.prototype.setDatasets = function (datasets) {\n  this.cache.invalidate();\n  this.originalDatasets = datasets;\n  this.datasets = copy(datasets);\n  validateDatasets(datasets);\n  this.datasetsDidChange();\n};\n\n/**\n * Appends the given dataset to this controller.\n * @param dataset The dataset to append.\n */\nDatasetsController.prototype.addDataset = function (dataset) {\n  this.cache.invalidate();\n  this.addDatasets([dataset]);\n};\n\n/**\n * Appends the given datasets to this controller.\n * @param datasets The collection of datasets to add.\n */\nDatasetsController.prototype.addDatasets = function (datasets) {\n  if (!this.datasets || !Array.isArray(this.datasets)) return;\n  if (!datasets || !Array.isArray(datasets)) return;\n  if (this.datasets.find(dataset => dataset.label === datasets.label)) {\n    throw new Error(`DatasetsController already contains a dataset with the same label (${datasets.label}).`);\n  }\n  this.cache.invalidate();\n  datasets.forEach(dataset => this.datasets.push(dataset));\n  this.datasetsDidChange();\n  this.notifyListeners('datasets-update');\n};\n\n/**\n * Removes the dataset with the given label from this controller.  Will do nothing if no dataset\n * with the given label exists.\n *\n * @param label The label of the dataset to remove.\n */\nDatasetsController.prototype.removeDataset = function (label) {\n  this.cache.invalidate();\n  this.removeDatasets([label]);\n};\n\n/**\n * Removes the given datasets from this controller.  Datasets this controller already containing will be ignored.\n * @param labels The collection of labels to remove.\n */\nDatasetsController.prototype.removeDatasets = function (labels) {\n  if (!this.datasets || !Array.isArray(this.datasets)) return;\n  if (!labels || !Array.isArray(labels)) return;\n  this.cache.invalidate();\n  labels.forEach(function (label) {\n    let candidate = this.datasets.find(dataset => dataset.label === label);\n    if (!candidate) return;\n    let index = this.datasets.indexOf(candidate);\n    if (index < 0) return;\n    this.datasets = this.datasets.splice(index, 1);\n  }.bind(this));\n  this.datasetsDidChange();\n};\n","import {extractStacksFromDatasets} from \"./data.extract\";\n\n/**\n *\n * @param datasets\n * @param dateToItemsRelation\n * @returns {*[]}\n */\nexport function createStackModel(controller, datasets, dateToItemsRelation) {\n  let listOfStacks = extractStacksFromDatasets(datasets);\n\n  return listOfStacks.map(function (stackName) {\n\n    let stackCandidates = datasets.filter(function (dataset) {\n      return dataset.stack === stackName\n        || dataset.label === stackName;\n    });\n\n    let candidatesNames = stackCandidates.map(stackCandidate => stackCandidate.label);\n    let candidatesColors = stackCandidates.map(stackCandidate => controller.getColorForDataset(stackCandidate.label));\n\n    let stack = d3\n      .stack()\n      .keys(candidatesNames)\n      (dateToItemsRelation);\n\n    stack.label = stackName;\n    stack.stack = stackName;\n    stack.colors = candidatesColors;\n\n    return stack;\n  });\n}\n","/**\n * Returns the first item of the array.\n * @returns {*} The first item.\n */\nArray.prototype.first = function () {\n  return this[0];\n};\n\n/**\n * Returns the last item of the array.\n * @returns {*} The last item.\n */\nArray.prototype.last = function () {\n  return this[this.length - 1];\n};\n","import {combineByDate} from \"./data.combine\";\nimport '../shared/extension.array';\nimport {sumOfValues} from \"./data.sum\";\nimport {copy} from \"../shared/copy\";\n\n/**\n * Combines each `ratio` entries to one.\n * @param datasets The datasets collection.\n * @param ratio The ratio.\n */\nexport function combineDatasetsByRatio(datasets, ratio) {\n  let copied = copy(datasets);\n  for (let index = 0; index < copied.length; index++) {\n    let dataset = copied[index];\n    let data = dataset.data;\n    dataset.data = combineDataByGroupsize(data, ratio);\n    copied[index] = dataset;\n  }\n  return copied;\n}\n\n/**\n *\n * @param data\n * @param ratio\n */\nexport function combineDataByGroupsize(data, ratio) {\n  if (!data || data.length <= ratio) return data;\n  if (ratio <= 1) return data;\n\n  let combined = combineByDate(copy(data));\n  let newData = [];\n\n  while (combined.length > 0) {\n    let dateGroup = combined.splice(0, ratio);\n    let firstItem = dateGroup.first() || {};\n    let lastItem = dateGroup.last() || {};\n    let item = {};\n    item.dataset = firstItem.dataset;\n    item.label = firstItem.label;\n    item.stack = firstItem.stack;\n    item.date = firstItem.date;\n    item.date = firstItem.date;\n    item.from = firstItem.date;\n    item.till = lastItem.date;\n    item.value = sumOfValues(dateGroup);\n    newData.push(item);\n  }\n\n  return newData;\n}\n","import {DatasetsController} from \"../datasets.controller/datasets.controller\";\nimport {dateToItemsRelation} from \"../data.juggle/data.relations\";\nimport {createStackModel} from \"../data.juggle/data.stacks\";\nimport {copy} from \"../shared/copy\";\nimport {combineDatasetsByRatio} from \"../data.juggle/data.combine.ratio\";\nimport {extractDatesFromDatasets} from \"../data.juggle/data.extract\";\nimport \"../datasets.controller/datasets.controller.cache\";\nimport {lotivis_log} from \"../shared/debug\";\n\n/**\n * Returns a new generated DateDataview for the current enabled samples of dataset of this controller.\n */\nDatasetsController.prototype.getDateDataview = function (groupSize) {\n\n  let cachedDataView = this.getCached('date');\n  if (cachedDataView) {\n    return cachedDataView;\n  }\n\n  let dateAccess = this.dateAccess;\n  let datasets = copy(this.datasets);\n  let enabledDatasets = copy(this.filteredDatasets() || datasets);\n  let dataView = {};\n  let saveGroupSize = groupSize || 1;\n\n  dataView.groupSize = saveGroupSize;\n  if (saveGroupSize <= 1) {\n    dataView.datasets = datasets;\n    dataView.enabledDatasets = enabledDatasets;\n  } else {\n    datasets = combineDatasetsByRatio(datasets, saveGroupSize);\n    enabledDatasets = combineDatasetsByRatio(enabledDatasets, saveGroupSize);\n    dataView.datasets = datasets;\n  }\n\n  dataView.dateToItemsRelation = dateToItemsRelation(datasets, dateAccess);\n  dataView.dateToItemsRelationPresented = dateToItemsRelation(enabledDatasets, dateAccess);\n  dataView.datasetStacks = createStackModel(this, datasets, dataView.dateToItemsRelation);\n  dataView.datasetStacksPresented = createStackModel(this, enabledDatasets, dataView.dateToItemsRelationPresented);\n\n  dataView.max = d3.max(dataView.datasetStacksPresented, function (stack) {\n    return d3.max(stack, function (series) {\n      return d3.max(series.map(item => item['1']));\n    });\n  });\n\n  dataView.dates = extractDatesFromDatasets(enabledDatasets);\n  dataView.enabledStacks = this.snapshot.stacks;\n\n  this.setCached(dataView, 'date');\n\n  return dataView;\n};\n","import {DatasetsController} from \"../datasets.controller/datasets.controller\";\nimport {dateToItemsRelation} from \"../data.juggle/data.relations\";\nimport {createStackModel} from \"../data.juggle/data.stacks\";\nimport {copy} from \"../shared/copy\";\nimport {combineDatasetsByRatio} from \"../data.juggle/data.combine.ratio\";\nimport {extractDatesFromDatasets} from \"../data.juggle/data.extract\";\nimport {combine} from \"../data.juggle/data.combine\";\nimport {flatDatasets} from \"../data.juggle/data.flat\";\nimport {createDatasets} from \"../data.juggle/data.create.datasets\";\nimport \"../datasets.controller/datasets.controller.cache\";\n\n/**\n * Returns a new generated DateDataview for the current enabled samples of dataset of this controller.\n */\nDatasetsController.prototype.getDateDataviewCombinedStacks = function (groupSize) {\n  let dateAccess = this.dateAccess;\n  let datasets = copy(this.datasets);\n  let enabledDatasets = copy(this.filteredDatasets() || datasets);\n\n  let dataView = {};\n  let saveGroupSize = groupSize || 1;\n\n  datasets.forEach(function (dataset) {\n    dataset.label = dataset.stack || dataset.label;\n  });\n\n  enabledDatasets.forEach(function (dataset) {\n    dataset.label = dataset.stack || dataset.label;\n  });\n\n  datasets = createDatasets(combine(flatDatasets(datasets)));\n  enabledDatasets = createDatasets(combine(flatDatasets(enabledDatasets)));\n\n  dataView.groupSize = saveGroupSize;\n  if (saveGroupSize <= 1) {\n    dataView.datasets = datasets;\n    dataView.enabledDatasets = enabledDatasets;\n  } else {\n    datasets = combineDatasetsByRatio(datasets, saveGroupSize);\n    enabledDatasets = combineDatasetsByRatio(enabledDatasets, saveGroupSize);\n    dataView.datasets = datasets;\n  }\n\n  dataView.dateToItemsRelation = dateToItemsRelation(datasets, dateAccess);\n  dataView.dateToItemsRelationPresented = dateToItemsRelation(enabledDatasets, dateAccess);\n  dataView.datasetStacks = createStackModel(this, datasets, dataView.dateToItemsRelation);\n  dataView.datasetStacksPresented = createStackModel(this, enabledDatasets, dataView.dateToItemsRelationPresented);\n\n  dataView.max = d3.max(dataView.datasetStacksPresented, function (stack) {\n    return d3.max(stack, function (series) {\n      return d3.max(series.map(item => item['1']));\n    });\n  });\n\n  dataView.dates = extractDatesFromDatasets(enabledDatasets);\n  dataView.enabledStacks = this.snapshot.stacks;\n\n  return dataView;\n};\n","import {DatasetsController} from \"../datasets.controller/datasets.controller\";\nimport {combineByLocation, combineByStacks} from \"../data.juggle/data.combine\";\nimport \"../datasets.controller/datasets.controller.cache\";\n\n/**\n * Returns a new generated location data view for the current selected datasets.controller of datasets of this controller.\n *\n * A location dataview has the following form:\n * ```\n * {\n *   stacks: [String],\n *   items: [\n *     {\n *       dataset: String,\n *       stack: String,\n *       location: Any,\n *       value: Number\n *     }\n *   ]\n * }\n * ```\n */\nDatasetsController.prototype.getLocationDataview = function () {\n\n  let cachedDataView = this.getCached('location');\n  if (cachedDataView) { return cachedDataView; }\n\n  let dataView = {};\n\n  let flatData = this.snapshot.flatData;\n  let combinedByStack = combineByStacks(flatData);\n  let combinedByLocation = combineByLocation(combinedByStack);\n\n  dataView.stacks = this.stacks;\n  dataView.combinedData = combinedByLocation;\n\n  dataView.combinedData.forEach(item => {\n    item.stack = item.stack || item.label || item.dataset;\n  });\n\n  this.setCached(dataView, 'location');\n\n  return dataView;\n};\n","import { Color } from \"./js/shared/color\";\nimport { Button } from \"./js/shared.components/button\";\nimport { Component } from \"./js/shared.components/component\";\nimport { Toast } from \"./js/shared.components/toast\";\nimport { Option } from \"./js/shared.components/option\";\nimport \"./js/chart/chart.datasets\";\nimport { Card } from \"./js/shared.components/card\";\nimport { Checkbox } from \"./js/shared.components/checkbox\";\n\nimport { Dropdown } from \"./js/shared.components/dropdown\";\nimport { Popup } from \"./js/shared.components/popup\";\n\nimport { UpdatableDataviewCard } from \"./js/dataview.card/updatable.dataview.card\";\nimport { EditableDataviewCard } from \"./js/dataview.card/editable.dataview.card\";\nimport { DatasetsJSONCard } from \"./js/dataview.card/data.json.card\";\nimport { DatasetCSVCard } from \"./js/dataview.card/data.csv.card\";\nimport { DatasetCSVDateCard } from \"./js/dataview.card/data.csv.date.card\";\nimport { DatasetsControllerCard } from \"./js/dataview.card/datasets.controller.card\";\nimport {\n  DataViewCard,\n  DataViewDateChartCard,\n  DataViewDatePlotChartCard,\n  DataViewFlatCard,\n  DataViewMapChartCard\n} from \"./js/dataview.card/dataview.card\";\n\nimport { DateChart } from \"./js/date.chart/date.chart\";\nimport { DateChartCard } from \"./js/date.chart.card/date.chart.card\";\nimport { MapChart } from \"./js/map.chart/map.chart\";\nimport { MapChartCard } from \"./js/map.chart.card/map.chart.card\";\nimport { PlotChart } from \"./js/plot.chart/plot.chart\";\nimport { PlotChartCard } from \"./js/plot.chart.card/plot.chart.card\";\n\nimport { DatasetsController } from \"./js/datasets.controller/datasets.controller\";\nimport \"./js/datasets.controller/datasets.controller.listeners\";\nimport \"./js/datasets.controller/datasets.controller.filter\";\nimport \"./js/datasets.controller/datasets.controller.data\";\n\nimport { parseCSV } from \"./js/data.parse/parse.csv\";\nimport { parseCSVDate } from \"./js/data.parse/parse.csv.date\";\n\nimport \"./js/dataview/dataview.date\";\nimport \"./js/dataview/dataview.date.combined.stacks\";\nimport \"./js/dataview/dataview.plot\";\nimport \"./js/dataview/dataview.location\";\n\nimport { LotivisConfig } from \"./js/shared/config\";\nimport { debug } from \"./js/shared/debug\";\n\nimport {\n  FormattedDateAccess,\n  DateGermanAssessor,\n  DefaultDateAccess,\n  DateWeekAssessor\n} from \"./js/data.date.assessor/date.assessor\";\nimport { UrlParameters } from \"./js/shared/url.parameters\";\nimport { createID } from \"./js/shared/selector\";\n\nexports.createID = createID;\n\n// colors\nexports.Color = Color;\n\n// shared.components\nexports.Button = Button;\nexports.Card = Card;\nexports.Checkbox = Checkbox;\nexports.Component = Component;\nexports.Dropdown = Dropdown;\nexports.Popup = Popup;\nexports.Option = Option;\nexports.Toast = Toast;\n\n// datasets / csv cards\nexports.DatasetsJSONCard = DatasetsJSONCard;\nexports.DatasetCSVCard = DatasetCSVCard;\nexports.DatasetCSVDateCard = DatasetCSVDateCard;\nexports.DataViewCard = DataViewCard;\nexports.DataViewDateChartCard = DataViewDateChartCard;\nexports.DataViewDatePlotChartCard = DataViewDatePlotChartCard;\nexports.DataViewMapChartCard = DataViewMapChartCard;\nexports.DataViewMapCard = DataViewMapChartCard;\nexports.DataviewFlatCard = DataViewFlatCard;\nexports.DatasetsControllerCard = DatasetsControllerCard;\nexports.DatasetsControllerSnapshotCard = DatasetsControllerCard;\nexports.UpdatableDataviewCard = UpdatableDataviewCard;\nexports.EditableDataviewCard = EditableDataviewCard;\n\n// date.chart\nexports.DateChart = DateChart;\nexports.DateChartCard = DateChartCard;\n\n// map.chart\nexports.MapChart = MapChart;\nexports.MapChartCard = MapChartCard;\n\n// date.chart.plot.chart\nexports.PlotChart = PlotChart;\nexports.PlotChartCard = PlotChartCard;\n\n// datasets\nexports.DatasetController = DatasetsController;\n\n// parse\nexports.parseCSV = parseCSV;\nexports.parseCSVDate = parseCSVDate;\n\n// constants\nexports.config = LotivisConfig;\nexports.debug = debug;\n\n// date.chart assessors\nexports.DefaultDateAccess = DefaultDateAccess;\nexports.FormattedDateAccess = FormattedDateAccess;\nexports.GermanDateAccess = DateGermanAssessor;\nexports.DateWeekAssessor = DateWeekAssessor;\n\n// url parameters\nexports.URLParameters = UrlParameters;\nexports.version = \"1.0.94\";\nexports.versionShort = \"1\";\n\nexport default exports;\n\nconsole.log(`[lotivis]  lotivis module loaded.`);\n"],"names":["Color","constructor","r","g","b","initialize","Error","Math","round","rgbString","toString","colorAdding","mapColors","till","d3","scaleLinear","domain","range","plotColor","colorsForStack","stackNumber","amount","colorCouple","stackColors","length","colorGenerator","colors","i","color","push","defaultTint","organgeLow","organgeHigh","redLow","redHigh","blueLow","blueHigh","lightBlueLow","lightBlueHight","greenLow","greenHight","hashCode","aString","hash","chr","charCodeAt","createID","uniquePrevious","toSaveID","theID","split","join","createIDFromDataset","dataset","label","camel2title","camelCase","replace","match","toUpperCase","LotivisError","message","name","LotivisElementNotFoundError","selector","DataValidateError","MissingPropertyError","data","JSON","stringify","InvalidFormatError","GeoJSONValidateError","LotivisUnimplementedMethodError","functionName","exports","Component","parent","Object","getPrototypeOf","String","prototype","initializeFromSelector","initializeFromConfig","initializeFromParent","element","undefined","select","empty","config","toLowerCase","trim","show","style","hide","isVisible","getElementEffectiveSize","width","height","Number","getElementPosition","document","getElementById","rect","getBoundingClientRect","xPosition","x","window","scrollX","yPosition","y","scrollY","components","getClassname","Button","append","attr","on","event","onClick","bind","setText","text","Toast","row","leftComponnt","rightComponent","hideButton","setStatusMessage","newStatusMessage","saveString","Option","title","id","LotivisConfig","defaultMargin","tooltipOffset","barRadius","debugLog","debug","downloadFilePrefix","filenameSeparator","unknown","alreadyLogged","lotivis_log_once","includes","console","warn","lotivis_log","enabled","printConfig","log","Chart","svgSelector","updateSensible","datasets","setDatasets","update","datasetsController","reason","snapshot","remove","precalculate","draw","makeUpdateInsensible","makeUpdateSensible","copy","object","parse","isValue","value","Boolean","toValue","combine","flattenList","combined","copiedList","index","listItem","entry","find","entryItem","stack","location","date","locationTotal","dateTotal","locationName","combineByStacks","combineByDate","flatData","combineByLocation","sumOfDataset","sumOfValues","filter","item","sumOfLabel","sumOfStack","map","reduce","acc","next","DefaultDateAccess","FormattedDateAccess","dateString","Date","isNaN","DateGermanAssessor","saveDateString","day","month","year","DateWeekAssessor","weekday","lowercase","DataViewCache","content","createName","type","locationFilters","dateFilters","datasetFilters","getDataView","setDataView","dataView","invalidate","DatasetsController","Array","isArray","dateAccess","filters","cache","locations","dates","labels","getFlatDataCombinedStacks","getFlatDataCombinedDates","getFlatDataCombinedLocations","getSumOfLabel","getSumOfDataset","getSumOfStack","getMax","max","getColorForDataset","datasetsColorsController","colorForDataset","getColorForStack","colorForStack","getColorsForStack","getFilename","splice","setDatasetsController","newController","datasetController","removeListener","addListener","newDatasets","getDatasets","Card","injectCard","injectHeader","injectBody","classed","header","headerLeftComponent","headerCenterComponent","headerRightComponent","titleLabel","body","setTitle","newTitle","showFooter","footer","hideFooter","Checkbox","renderInput","renderLabel","thisReference","target","checkbox","checked","setChecked","enable","disable","Dropdown","inputElements","selectId","renderSelect","addOption","optionId","optionName","setOptions","options","removeAllInputs","translatedTitle","inputElement","selectAll","onChange","argument","setLabelText","setOnChange","callback","setSelectedOption","optionID","create","selectedOption","div","dropdown","Popup","injectUnderground","injectContainer","inject","injectCloseButton","addCloseActionListeners","modalBackgroundId","modalBackground","elementId","card","closeButton","validIDs","popup","dismiss","willShow","didShow","getUnderground","display","willDismiss","willRemoveDOMElement","showUnder","sourceElement","position","preferredSize","origin","calculateBottomCenter","left","top","showBigModal","margin","respectWindowScroll","TextareaCard","render","textarea","lines","textareaID","onKeyup","downloadButton","getTextareaContent","download","setTextareaContent","newContent","updatesHeight","numberOfRows","enableTextarea","forEach","disableTextarea","UpdatableDataviewCard","newDatasetController","datasetsToText","cachedDatasets","controller","validateDatasets","validateDataset","validateDataItem","equals","value1","value2","objectsEqual","object1","object2","string1","string2","EditableDataviewCard","toast","updateDatasetsOfController","notifyController","parsedDatasets","textToDatasets","error","appendExtensionIfNeeded","filename","extension","startsWith","endsWith","createDownloadFilename","separator","arguments","getSVGString","svgNode","setAttribute","cssStyleText","getCSSStyles","appendCSS","serializer","XMLSerializer","svgString","serializeToString","parentElement","selectorTextArr","c","classList","contains","nodes","getElementsByTagName","classes","extractedCSSText","styleSheets","s","cssRules","e","selectorText","cssText","str","arr","indexOf","styleElement","createElement","innerHTML","refNode","hasChildNodes","children","insertBefore","svgString2Image","imageSource","btoa","unescape","encodeURIComponent","canvas","context","getContext","image","Image","onload","clearRect","drawImage","toDataURL","src","getOriginalSizeOfSVG","svgElement","viewBoxBaseValue","viewBox","baseVal","downloadBlob","blob","navigator","msSaveOrOpenBlob","msSaveBlob","anchor","href","URL","createObjectURL","appendChild","click","removeChild","downloadJSON","jsonString","Blob","saveFilename","downloadCSV","downloadImage","node","size","dataURL","fetch","then","res","dataBlob","DatasetsJSONCard","downloadFilename","csvStringToArray","strData","objPattern","RegExp","arrMatches","arrData","exec","trimByChar","string","character","first","findIndex","char","last","reverse","substring","createDatasets","datasetsByLabel","itemIndex","getOwnPropertyNames","parseCSV","arrays","headlines","shift","lineIndex","lineArray","csv","flatDatasets","datasetsCopy","datasetIndex","flatDataChunk","flatDataset","concat","newItem","dateNumeric","surroundWithQuotationMarks","renderCSV","csvContent","DatasetCSVCard","parseCSVDate","datasetLabels","minLineLength","columnIndex","extractLabelsFromDatasets","toSet","extractStacksFromDatasets","extractDatesFromDatasets","extractDatesFromFlatData","extractLocationsFromDatasets","extractLocationsFromFlatData","array","from","Set","extractEarliestDate","sort","right","extractEarliestDateWithValue","filterWithValue","extractLatestDate","pop","extractLatestDateWithValue","dateToItemsRelation","listOfDates","listOfLabels","datasetDate","total","renderCSVDate","dateRelation","labelIndex","dateRow","csvRow","DatasetCSVDateCard","DataViewCard","getDataview","DataViewDateChartCard","getTitle","getDateDataview","DataViewDatePlotChartCard","getPlotDataview","DataViewMapChartCard","getLocationDataview","DataViewFlatCard","DatasetsControllerCard","stacks","selection","originalDatasets","DateChartAxisRenderer","dateChart","svg","call","axisLeft","yChart","axisBottom","xChartScale","bottom","TimeChartLabelRenderer","renderBarLabels","xChartRef","yChartRef","xStackRef","xStack","numberFormat","labelColor","numberOfSeries","seriesIndex","bandwidth","enter","format","TimeChartLegendRenderer","combineStacks","renderCombinedStacksLegend","renderDefaultLegend","datasetNames","circleRadius","labelMargin","xLegend","scaleBand","rangeRound","legends","graph","graphHeight","formatted","toggleDataset","isEnabled","stackNames","TimeChartBarsRenderer","renderBars","isCombineStacks","stackData","d","TimeChartHoverBarsRenderer","hideAll","onMouseEnter","tooltipRenderer","showTooltip","onMouserOut","hideTooltip","buttons","onMouseClick","even","sendsNotifications","toggleDate","selectionRenderer","renderGhostBars","dateLabels","dataview","TimeChartTooltipRenderer","tooltip","getTooltipSize","tooltipWidth","tooltipHeight","getTop","factor","offset","tooltipSize","getXLeft","xChartScalePadding","getXRight","getHTMLForDate","sum","dataHTML","divHTML","valueFormatted","sumFormatted","html","TimeChartGridRenderer","createAxis","xAxisGrid","tickSize","tickFormat","yAxisGrid","graphWidth","ticks","renderGrid","opacity","TimeChartSelectionRenderer","getSelectedDates","selectedDates","DATE_CHART_CONFIG","showLabels","Intl","NumberFormat","maximumFractionDigits","DateChart","initializeDefaultValues","initializeRenderers","assign","axisRenderer","gridRenderer","labelRenderer","legendRenderer","barsRenderer","ghostBarsRenderer","groupSize","getDateDataviewCombinedStacks","createScales","paddingInner","enabledStacks","padding","nice","renderSVG","datasetStacks","datasetStacksPresented","background","some","resetDateFilters","UrlParameters","getInstance","instance","getURL","getBoolean","parameter","defaultValue","searchParams","get","getString","set","newValue","url","delete","history","replaceState","updateCurrentPageFooter","setWithoutDeleting","clear","newPath","protocol","host","newURL","language","page","query","searchViewMode","chartType","chartShowLabels","chartCombineStacks","contentType","valueType","searchSensitivity","startYear","endYear","showTestData","SettingsPopup","container","screenshotButton","screenshotButtonAction","chart","DateChartCardSettingsPopup","injectShowLabelsCheckbox","injectCombineStacksCheckbox","showLabelsCheckbox","combineStacksCheckbox","ChartCard","injectButtons","injectRadioGroup","injectChart","cardSelector","moreButton","presentSettingsPopupAction","setDataset","updateRadioGroup","names","firstDataset","onSelectedDatasetChanged","datasetLabel","DateChartCard","theSelector","chartID","applyURLParameters","parameters","button","settingsPopup","removeFeatures","geoJSON","removeCandidates","newGeoJSON","code","candidate","features","feature","properties","candidateIndex","styleForCSSClass","className","querySelector","getComputedStyle","formatNumber","number","MapTooltipRenderer","mapChart","featureMapID","lotivisId","htmlTitle","featuresSlice","slice","ids","featureNameAccessor","moreCount","htmlValues","combinedByLabel","positionTooltip","projection","featureBounds","geoBounds","featureLowerLeft","featureUpperRight","featureBoundsWidth","effectiveSize","positionOffset","getTooltipLeft","getTooltipLocationAbove","getTooltipLocationUnder","mouseEnter","selectedFeatures","selectionBorderGeoJSON","mouseOut","mapID","stroke","departmentsData","raise","MapLegendRenderer","legend","appendLegend","removeDatasetLegend","combinedData","stackName","dataForStack","steps","generator","MapLabelRenderer","removeLabels","featureID","featureIDAccessor","center","MapDatasetRenderer","styleArea","resetAreas","datasetEntry","locationID","MapGeoJSONRenderer","datasetRenderer","mouseClick","toggleLocation","presentedGeoJSON","areas","path","joinFeatures","topology","topojson","objects","extractObjects","geometry","merge","nom","topologyKey","hasOwnProperty","MapExteriorBorderRenderer","borders","createGeoJSON","rowsCount","ceil","latSpan","lngSpan","loop1","rowIndex","lat","lng","coordinates","MapChartConfig","isShowLabels","excludedFeatureCodes","drawRectangleAroundSelection","MapBackgroundRenderer","resetLocationFilters","Geometry","source","Feature","GeoJson","featureSource","getCenter","allCoordinates","extractAllCoordinates","latitudeSum","longitudeSum","extractGeometryCollection","geometryCollection","geometries","coordinatesCollection","coordinate","polygonCoordinates","featureCoordinates","MapSelectionRenderer","self","getSelectedFeatures","allFeatures","filteredLocations","MapChart","theConfig","geoMercator","geoPath","backgroundRenderer","geoJSONRenderer","exteriorBorderRenderer","setGeoJSON","zoomTo","fitSize","onSelectFeature","geoJSONDidChange","geoCentroid","MapChartSettingsPopup","MapChartCard","bodyElement","getCached","setCached","createPlotDataset","newDataset","firstDate","lastDate","cachedDataView","enabledDatasets","filteredDatasets","firstIndex","lastIndex","duration","labelsCount","PlotChartType","gradient","fraction","PlotChartSort","none","alphabetically","intensity","defaultPlotChartConfig","lineHeight","radius","drawGrid","lowColor","highColor","PlotAxisRenderer","plotChart","renderAxis","axisTop","xChart","PlotTooltipRenderer","getHTMLContentForDataset","filtered","getTooltipLeftForDataset","resetFilters","PlotLabelRenderer","renderLabels","xBandwidth","barsData","PlotGridRenderer","preferredHeight","PlotBackgroundRenderer","resetLabelFilters","PlotChartHoverBarsRenderer","backgrounBarsData","backgrounBars","PlotBarsFractionsRenderer","bars","yChartPadding","PlotBarsGradientCreator","createGradient","definitions","count","latestDate","dateDifference","datePercentage","PlotBarsGradientRenderer","gradientCreator","PlotLabelsFractionsRenderer","PlotChartSelectionRenderer","selectionBarsData","selectionBars","selectedLabels","getSelectedLabels","PlotChart","createSVG","hoverBarsRenderer","barsFractionsRenderer","labelsRenderer","labelsFractionRenderer","barsCount","sortDatasets","onSelectDataset","listeners","setDatasetsFilter","sortedDatasets","set1","set2","datasetsSorted","PlotChartCardSettingsPopup","showLabelsCheckboxContainer","typeDropdownContainer","typeDropdown","dropdownContainer","sortDropdown","PlotChartCard","listener","notifyListeners","timeStamp","register","calculateSnapshot","setLocationsFilter","stringVersions","setDatesFilter","stringVersion","DatasetsColorsController","workingDatasets","labelToColor","stackToColors","sIndex","dIndex","calculateAdditionalData","datasetsDidChange","addDataset","addDatasets","removeDataset","removeDatasets","createStackModel","listOfStacks","stackCandidates","candidatesNames","stackCandidate","candidatesColors","keys","combineDatasetsByRatio","ratio","copied","combineDataByGroupsize","newData","dateGroup","firstItem","lastItem","saveGroupSize","dateToItemsRelationPresented","series","combinedByStack","combinedByLocation","DataViewMapCard","DataviewFlatCard","DatasetsControllerSnapshotCard","DatasetController","GermanDateAccess","URLParameters","version","versionShort"],"mappings":"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"}