{"version":3,"file":"lotivis.min.js","sources":["../../../src/js/shared/uuid.js","../../../src/js/components/component.js","../../../src/js/components/button.js","../../../src/js/shared/url-parameters.js","../../../src/js/language/language_de_DE.js","../../../src/js/language/language_en_EN.js","../../../src/js/language/language_fr_FR.js","../../../src/js/language/language.js","../../../src/js/components/radio-group.js","../../../src/js/components/card.js","../../../src/js/components/popup.js","../../../src/js/components/modal-popup.js","../../../src/js/pages/page.js","../../../src/js/components/option.js","../../../src/js/components/checkbox.js","../../../src/js/pages/search-page-settings-popup.js","../../../src/js/shared/colors.js","../../../src/js/shared/test-data.js","../../../src/js/time-chart/diachronic-chart.js","../../../src/js/time-chart/diachronic-chart-settings-popup.js","../../../src/js/shared/screenshot.js","../../../src/js/time-chart/diachronic-chart-card.js","../../../src/js/shared/recent-searches.js","../../../src/js/components/search-field.js","../../../src/js/components/dropdown.js","../../../src/js/components/loading-view.js","../../../src/js/pages/innovation-list-popup.js","../../../src/js/pages/search-card.js","../../../src/js/geojson/geojson.js","../../../src/js/shared/auxiliary.js","../../../src/js/location-chart/map-chart.js","../../../src/js/components/slider.js","../../../src/js/location-chart/map-chart-settings-popup.js","../../../src/js/location-chart/map-chart-card.js","../../../src/js/pages/track-popup.js","../../../src/js/pages/word-about-card.js","../../../src/js/data-model/dataset-collection.js","../../../src/js/pages/search-page.js","../../../src/js/pages/corpus-data-page.js","../../../src/js/pages/main-page.js","../../../src/js/pages/diachronic-about-page.js","../../../src/js/pages/artists-data-page.js","../../../src/js/pages/location-data-page.js","../../../src/js/data-source/data-delegate.js","../../../src/js/data-source/default-data-delegate.js","../../../src/js/application.js"],"sourcesContent":["export function createUUID() {\n    let index = 0;\n    let usedIDs;\n    usedIDs = [];\n    function generate() {\n        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n            let r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);\n            return v.toString(16);\n        });\n    }\n    let uuid = generate();\n    while (usedIDs.indexOf(uuid) >= 0) {\n        uuid = generate();\n    }\n    return \"id-\" + uuid;\n}\n","import {createUUID} from \"../shared/uuid\";\n\n/**\n *\n * @class Component\n */\nexport class Component {\n\n    /**\n     *\n     * @param parent\n     */\n    constructor(parent) {\n        if (!parent) {\n            throw 'No parent specified.';\n        }\n        this.selector = createUUID();\n        this.parent = parent;\n    }\n\n    show() {\n        if (!this.element) return;\n        this.element.style('display', 'inline-block');\n    }\n\n    hide() {\n        if (!this.element) return;\n        this.element.style('display', 'none');\n    }\n\n    get isVisible() {\n        if (!this.element) return false;\n        return this.element.style('display') !== 'none';\n    }\n}\n","import {Component} from \"./component\";\n\n/**\n * @class Button\n * @extends Component\n */\nexport class Button extends Component {\n\n  /**\n   * Creates an instance of Button.\n   *\n   * @constructor\n   * @param {Component} parent The parental component.\n   */\n  constructor(parent) {\n    super(parent);\n\n    let thisRef = this;\n    this.element = parent\n      .append('button')\n      // .classed('button', true)\n      .attr('id', this.selector)\n      .on('click', function (event) {\n        if (!thisRef.onClick) return;\n        thisRef.onClick(event);\n      });\n  }\n\n  setText(text) {\n    this.element.text(text);\n  }\n\n  setFontAwesomeImage(imageName) {\n    this.element.html('<i class=\"fas fa-' + imageName + '\"></i>');\n  }\n\n  onClick(event) {\n    // empty\n  }\n}\n","import {Application} from \"../application\";\n\nexport class URLParameters {\n    static getInstance() {\n        if (!URLParameters.instance) {\n            URLParameters.instance = new URLParameters();\n        }\n        return URLParameters.instance;\n    }\n\n    getURL() {\n        return new URL(window.location.href);\n    }\n\n    getBoolean(parameter, defaultValue = false) {\n        let value = this.getURL().searchParams.get(parameter);\n        return value ? value === 'true' : defaultValue;\n    }\n\n    getString(parameter, defaultValue = '') {\n        return this.getURL().searchParams.get(parameter) || defaultValue;\n    }\n\n    set(parameter, newValue) {\n        const url = this.getURL();\n\n        if (newValue === false) {\n            url.searchParams.delete(parameter);\n        } else {\n            url.searchParams.set(parameter, newValue);\n        }\n\n        window.history.replaceState(null, null, url);\n        this.updateCurrentPageFooter();\n    }\n\n    setWithoutDeleting(parameter, newValue) {\n        const url = this.getURL();\n        url.searchParams.set(parameter, newValue);\n        window.history.replaceState(null, null, url);\n        this.updateCurrentPageFooter();\n    }\n\n    clear() {\n        const url = this.getURL();\n        const newPath = url.protocol + url.host;\n        const newURL = new URL(newPath);\n        window.history.replaceState(null, null, newURL);\n        this.updateCurrentPageFooter();\n    }\n\n    updateCurrentPageFooter() {\n        Application.default.currentPage.updateFooter();\n    }\n}\n\nURLParameters.language = 'language';\nURLParameters.page = 'page';\nURLParameters.query = 'query';\nURLParameters.searchViewMode = 'search-view-mode';\nURLParameters.chartType = 'chart-type';\nURLParameters.chartShowLabels = 'chart-show-labels';\nURLParameters.chartCombineStacks = 'chart-combine-stacks';\nURLParameters.contentType = 'content-type';\nURLParameters.valueType = 'value-type';\nURLParameters.searchSensitivity = 'search-sensitivity';\nURLParameters.startYear = 'start-year';\nURLParameters.endYear = 'end-year';\n\nURLParameters.showTestData = 'show-test-data';\n","\nexport const Strings = {\n    greeting: 'Hallo Welt',\n\n    // title\n    'French Rap Corpus Visualization': 'Französiche Rap Corpus Visualisierung',\n    'Version': 'Version',\n    'Server': 'Server',\n\n    'Search': 'Suchen',\n    'Diachronic Data': 'Diachronische Daten',\n    'Diatopic Data': 'Diatopische Daten',\n    'Corpus Data': 'Korpus Daten',\n    'Artists Data': 'KünstlerInnen Daten',\n    'About the Project': 'Über das Projekt',\n\n    'Click on URL to copy it to clipboard': 'Klicken Sie auf die URL, um sie in die Zwischenablage zu kopieren',\n\n    // diachronic about\n    'Tracks': 'Lieder',\n    'Words': 'Wörter',\n    'Words (Relative)': 'Wörter (Relativ)',\n    'Types': 'Typen',\n    'Types (Relative)': 'Typen (Relativ)',\n\n    // common\n    'true': 'Ja',\n    'false': 'Nein',\n    'Back': 'Zurück',\n    'Loading...': 'Laden...',\n    'Settings': 'Einstellungen',\n    'Chart': 'Diagramm',\n    'Close': 'Schließen',\n\n    // search page\n    'Half': 'Halb',\n    'Full': 'Voll',\n    'from': 'von', // from year\n    'till': 'bis', // till year\n    'Relative': 'Relativ',\n    'Absolute': 'Absolut',\n    'Innovation List': 'Innovations-Liste',\n    'View Mode': 'Ansicht',\n    'Map': 'Karte',\n\n    // page footer\n    'Impress': 'Impressum',\n    'Privacy Policy': 'Datenschutzerklärung',\n    'Corpus loaded status': 'Korpus geladen',\n    'Language': 'Sprache',\n};\n","export const Strings = {\n    greeting: 'Hello World',\n\n    // title\n    'French Rap Corpus Visualization': 'French Rap Corpus Visualization',\n    'Version': 'Version',\n    'Server': 'Server',\n\n    'Search': 'Search',\n    'Diachronic About': 'Diachronic About',\n    'Corpus Metadata': 'Corpus Metadata',\n    'Artists Metadata': 'Artists Metadata',\n    'About': 'About',\n\n    'Click on URL to copy it to clipboard': 'Click on URL to copy it to clipboard',\n\n    // common\n    'true': 'Yes',\n    'false': 'No',\n    'Back': 'Back',\n    'Loading...': 'Loading...',\n\n    // page footer\n    'Impress': 'Impress',\n    'Privacy Policy': 'Privacy Policy',\n    'Corpus loaded status': 'Corpus loaded status',\n    'Language': 'Language',\n};\n","\n// Translation provided by Jan-Nicklas Wilsker. Thank you!\n\nexport const Strings = {\n    greeting: 'Bonjour le monde',\n\n    // title\n    'French Rap Corpus Visualization': 'Visualisation du corpus rap français ',\n    'Version': 'Version',\n    'Server': 'Serveur',\n\n    'Search': 'Chercher',\n    'Diachronic About': 'Diachronic About',\n    'Corpus Metadata': 'Métadonnées du corpus ',\n    'Artists Metadata': 'Métadonnées des artistes',\n    'About the Project': 'À propos du projet',\n\n    'Click on URL to copy it to clipboard': 'Cliquez sur l\\'URL pour la copier dans le presse-papiers',\n\n    // common\n    'true': 'Oui',\n    'false': 'Non',\n    'Back': 'Arrière',\n    'Loading...': 'Chargement...',\n    'Close': 'Conclure',\n\n    // page footer\n    'Impress': 'Impressionner',\n    'Privacy Policy': 'Politique de confidentialité',\n    'Corpus loaded status': 'Corpus chargé',\n    'Language': 'Langue',\n};\n","import {Strings as Strings_de_DE} from \"./language_de_DE\";\nimport {Strings as Strings_en_EN} from \"./language_en_EN\";\nimport {Strings as Strings_fr_FR} from \"./language_fr_FR\";\n\n/**\n * @enum\n * Enumeration of languages of the application.\n */\nexport const Language = {\n    /** Case for the english language. */\n    English: 'en_EN',\n    /** Case for the german language. */\n    German: 'de_DE',\n    /** Case for the french language. */\n    French: 'fr_FR'\n};\n\n// set default language\nLanguage.language = Language.English;\nLanguage.strings = Strings_en_EN;\n\n/**\n * Sets the language of the application to the given one.\n * @param language The language to set.\n */\nLanguage.setLanguage = function (language) {\n    switch (language) {\n        case Language.English:\n            Language.strings = Strings_en_EN;\n            break;\n        case Language.German:\n            Language.strings = Strings_de_DE;\n            break;\n        case Language.French:\n            Language.strings = Strings_fr_FR;\n            break;\n        default:\n            break;\n    }\n    Language.language = language;\n};\n\n/**\n * Returns the translated version of the given string.\n * @param string The string to be translated.\n */\nLanguage.translate = function (string) {\n    if (Language.language === Language.English) {\n        return Language.strings[string] || string;\n    } else {\n        return Language.strings[string] || ('='.repeat(string.length));\n    }\n};\n","import {Component} from \"./component\";\n\n/**\n *\n * @class RadioGroup\n * @extends Component\n */\nexport class RadioGroup extends Component {\n\n    /**\n     *\n     * @param parent The parental component.\n     */\n    constructor(parent) {\n        super(parent);\n\n        this.inputElements = [];\n        this.element = parent.append('form');\n        this.element.classed('radio-group', true);\n    }\n\n    /**\n     *\n     * @param optionId\n     * @param optionName\n     * @returns {*}\n     */\n    addOption(optionId, optionName) {\n        let inputElement = this.element\n            .append('input')\n            .attr('type', 'radio')\n            .attr('name', this.selector)\n            .attr('value', optionId)\n            .attr('id', optionId);\n\n        this.element\n            .append('label')\n            .attr('for', optionId)\n            .text(optionName || optionId);\n\n        let thisReference = this;\n        inputElement.on(\"click\", function (event) {\n            thisReference.onClick(event);\n        });\n\n        return inputElement;\n    }\n\n    /**\n     *\n     * @param options\n     * @returns {RadioGroup}\n     */\n    setOptions(options) {\n        this.removeOptions();\n        this.inputElements = [];\n        for (let i = 0; i < options.length; i++) {\n            let id = options[i][0] || options[i].id;\n            let name = options[i][1] || options[i].translatedTitle;\n            let inputElement = this.addOption(id, name);\n            if (i === 0) {\n                inputElement.attr('checked', 'true');\n            }\n            this.inputElements.push(inputElement);\n        }\n        return this;\n    }\n\n    /**\n     *\n     * @param selectedOption\n     * @returns {RadioGroup}\n     */\n    setSelectedOption(selectedOption) {\n        for (let i = 0; i < this.inputElements.length; i++) {\n            let inputElement = this.inputElements[i];\n            let value = inputElement.attr('value');\n            if (value === selectedOption) {\n                inputElement.attr('checked', 'true');\n            }\n        }\n        return this;\n    }\n\n    /**\n     *\n     * @returns {RadioGroup}\n     */\n    removeOptions() {\n        this.element.selectAll('input').remove();\n        this.element.selectAll('label').remove();\n        this.inputElements = [];\n        return this;\n    }\n\n    /**\n     *\n     * @param event\n     */\n    onClick(event) {\n        let element = event.target;\n        if (!element) return;\n\n        let value = element.value;\n        if (!this.onChange) return;\n\n        this.onChange(value);\n\n        return this;\n    }\n\n    // onChange(newFunction) {\n    //     this.onChange = newFunction;\n    //     return this;\n    // }\n    onChange(value) {\n    }\n}","import {Component} from \"./component\";\n\nexport class Card extends Component {\n    constructor(parent) {\n        super(parent);\n        this.element = this.parent\n            .append('div')\n            .classed('card', true);\n        this.createHeader();\n        this.createBody();\n        this.createFooter();\n    }\n\n    createHeader() {\n        this.header = this.element\n            .append('div')\n            .classed('card-header', true);\n        this.headerRow = this.header\n            .append('div')\n            .classed('row', true);\n        this.headerLeftComponent = this.headerRow\n            .append('div')\n            // .classed('col-lg-2', true)\n            .classed('col-3', true);\n        this.headerCenterComponent = this.headerRow\n            .append('div')\n            // .classed('col-lg-2', true)\n            .classed('col-6', true);\n        this.headerRightComponent = this.headerRow\n            .append('div')\n            // .classed('col-lg-10', true)\n            .classed('col-3 button-group', true)\n            .classed('text-end', true);\n        this.titleLabel = this.headerLeftComponent\n            .append('span')\n            .text(this.name);\n    }\n\n    createBody() {\n        this.body = this.element\n            .append('div')\n            .classed('card-body', true);\n        this.content = this.body\n            .append('div')\n            .attr('id', 'content');\n    }\n\n    createFooter() {\n        this.footer = this.element\n            .append('div')\n            .classed('card-footer', true);\n        this.footerRow = this.footer\n            .append('div')\n            .classed('row', true);\n        this.footerLeftComponent = this.footerRow\n            .append('div')\n            .classed('col-6', true);\n        this.footerRightComponent = this.footerRow\n            .append('div')\n            .classed('col-6', true)\n            .classed('text-end', true);\n        this.footer.style('display', 'none');\n    }\n}\n","import {Component} from './component';\nimport {createUUID} from '../shared/uuid';\nimport {Card} from './card';\nimport {Button} from './button';\nimport {Language} from '../language/language';\n\n/**\n *\n *\n * @class Popup\n * @extends Component\n */\nexport class Popup extends Component {\n\n    /**\n     * Creates a new instance of Popup.\n     *\n     * @param parent The parental component.\n     */\n    constructor(parent) {\n        super(parent);\n        this.renderUnderground(parent);\n        this.renderContainer();\n        this.renderCard();\n        this.render();\n        this.renderCloseButton();\n        this.addCloseActionListeners();\n    }\n\n    // MARK: - Render\n\n    /**\n     * Appends components to this popup.\n     *\n     * Should be overridden by subclasses.\n     */\n    render() {\n        // empty\n    }\n\n    /**\n     * Appends the 'dim' background to the given parent.\n     *\n     * @param parent The parental element.\n     */\n    renderUnderground(parent) {\n        this.modalBackgroundId = createUUID();\n        this.modalBackground = parent\n            .append('div')\n            .classed('popup-underground fade-in', true)\n            .attr('id', this.modalBackgroundId);\n    }\n\n    /**\n     *\n     */\n    renderContainer() {\n        this.elementId = createUUID();\n        this.element = this.modalBackground\n            .append('div')\n            .classed('popup', true)\n            .attr('id', this.elementId);\n    }\n\n    /**\n     *\n     */\n    renderCard() {\n        this.card = new Card(this.element);\n        this.card.element.classed('popup arrow arrow-right', true);\n    }\n\n    /**\n     * Appends a close button to the right header component.\n     */\n    renderCloseButton() {\n        this.closeButton = new Button(this.card.headerRightComponent);\n        this.closeButton.element.classed('button-small', true);\n        this.closeButton.setText(Language.translate('Close'));\n    }\n\n    /**\n     * Appends an on click listener to the button.\n     */\n    addCloseActionListeners() {\n        let validIDs = [\n            this.closeButton.selector,\n            this.modalBackgroundId\n        ];\n        let popup = this;\n        this.modalBackground.on('click', function (event) {\n            if (!event || !event.target) return;\n            if (!validIDs.includes(event.target.id)) return;\n            popup.dismiss();\n        });\n    }\n\n    // MARK: - Life Cycle\n\n    /**\n     * Tells the receiving popup that it is about to be presented.\n     *\n     * Subclasses may override.\n     */\n    willShow() {\n        // empty\n    }\n\n    /**\n     * Tells the receiving popup that it is now presented.\n     *\n     * Subclasses may override.\n     */\n    didShow() {\n        // empty\n    }\n\n    /**\n     * Presents the popup.\n     */\n    show() {\n        if (this.willShow) this.willShow();\n        this.getUnderground().style.display = 'block';\n        if (this.didShow) this.didShow();\n    }\n\n    /**\n     * Tells the receiving popup that it is about to be dismissed.\n     *\n     * Subclasses may override.\n     */\n    willDismiss() {\n        // empty\n    }\n\n    /**\n     * Tells the receiving popup that the DOM element will be removed.\n     *\n     * Subclasses may override.\n     */\n    willRemoveDOMElement() {\n        // empty\n    }\n\n    /**\n     * Dismisses the popup.\n     */\n    dismiss() {\n        if (this.willDismiss) this.willDismiss();\n        this.getUnderground().style.display = 'none';\n        if (this.willRemoveDOMElement) this.willRemoveDOMElement();\n        this.getUnderground().remove();\n    }\n\n    getUnderground() {\n        return document.getElementById(this.modalBackgroundId);\n    }\n\n    showUnder(sourceElement, position = 'center') {\n        if (!sourceElement) return;\n\n        let preferredSize = this.preferredSize();\n        let origin = this.calculateBottomCenter(sourceElement);\n\n        if (position === 'left') {\n            origin.x -= origin.width / 2;\n        } else if (position === 'right') {\n            origin.x -= preferredSize.width - origin.width / 2;\n        } else { // assume center\n            origin.x -= (preferredSize.width / 2);\n        }\n\n        let id = this.elementId;\n        let popup = document.getElementById(id);\n\n        popup.style.position = 'absolute';\n        popup.style.width = preferredSize.width + 'px';\n        // popup.style.height = preferredSize.height + 'px';\n        popup.style.left = origin.x + 'px';\n        popup.style.top = origin.y + 'px';\n\n        this.show();\n    }\n\n    showBigModal() {\n        let id = this.elementId;\n        let popup = document.getElementById(id);\n        let preferredSize = this.preferredSize();\n\n        popup.style.position = 'relative';\n        popup.style.margin = '50px auto';\n        popup.style.width = preferredSize.width + 'px';\n\n        this.show();\n    }\n\n    /**\n     * Returns the preferred size of the popup.  Subclasses may override in order to\n     * change the size of the popup.\n     *\n     * @returns {{width: number, height: number}}\n     */\n    preferredSize() {\n        return {\n            width: 300,\n            height: 300\n        };\n    }\n\n    /**\n     * Returns the bottom middle point of the passed element.\n     *\n     * @param element\n     * @param respectWindowScroll\n     * @returns {{x: number, width: number, y: number, height: number}}\n     */\n    calculateBottomCenter(element, respectWindowScroll = false) {\n        let rect = element.getBoundingClientRect();\n        let x = rect.x + (rect.width / 2);\n        let y = rect.y + rect.height;\n\n        if (respectWindowScroll) {\n            x += window.scrollX;\n            y += window.scrollY;\n        }\n\n        return {\n            x: x,\n            y: y,\n            width: rect.width,\n            height: rect.height\n        };\n    }\n}\n","import {Popup} from \"./popup\";\nimport {Language} from \"../language/language\";\n\n/**\n *\n * @class ModalPopup\n * @extends Popup\n */\nexport class ModalPopup extends Popup {\n\n    /**\n     *\n     * @param parent\n     */\n    constructor(parent) {\n        super(parent);\n        this.modalBackground\n            .classed('popup-underground', false)\n            .classed('modal-underground', true);\n    }\n\n    /**\n     *\n     */\n    render() {\n        super.render();\n        this.renderRow();\n    }\n\n    /**\n     *\n     */\n    renderRow() {\n        this.row = this.card.body\n            .append('div')\n            .classed('row', true);\n        this.content = this.row\n            .append('div')\n            .classed('col-12 info-box-margin', true);\n    }\n\n    /**\n     *\n     */\n    loadContent(url) {\n        if (!url) return;\n        console.log('url: ' + url);\n        let content = this.content;\n        d3.text(url)\n            .then(function (text) {\n                console.log(text);\n                content.html(text);\n            })\n            .catch(function (error) {\n                console.log(error);\n                content.html(Language.translate(''));\n            });\n    }\n\n    /**\n     *\n     * @returns {{width: number, height: number}}\n     */\n    preferredSize() {\n        return {\n            width: 800,\n            height: 600\n        };\n    }\n}\n","import {Button} from '../components/button';\nimport {URLParameters} from \"../shared/url-parameters\";\nimport {Language} from \"../language/language\";\nimport {RadioGroup} from \"../components/radio-group\";\nimport {Application} from \"../application\";\nimport {ModalPopup} from \"../components/modal-popup\";\n\nexport class Page {\n\n    constructor(application, title = 'Unknown') {\n        if (!application) {\n            throw 'No application given.';\n        }\n        this.title = title || 'Unknown';\n        this.application = application;\n        this.element = application.element;\n        this.renderHeader();\n        this.renderBody();\n        this.renderFooter();\n        application.makeContainerNormal();\n        document.title = 'FRC-Visualization - ' + this.title;\n    }\n\n\n    // MARK: - Add Components\n\n    buildSubpage() {\n        this.titleLabel = this.centerHeaderContainer.append('h1')\n            .text(this.title);\n    }\n\n    addRow(toParent = this.element) {\n        return this.addContainer(toParent, 'row');\n    }\n\n    addContainer(toParent = this.element, classes = '') {\n        let parent = toParent || this.element;\n        return parent\n            .append('div')\n            .classed(classes, true);\n    }\n\n\n    setTitle(newTitle) {\n        this.title = newTitle;\n        this.titleLabel.text(newTitle);\n    }\n\n    addSpace(toParent = this.element, width) {\n        toParent\n            .append('label')\n            .style('width', width + 'px');\n        return this;\n    }\n\n    // MARK: - Header\n\n    renderHeader() {\n        this.headerRow = this.addRow(this.element)\n            .classed('row margin-bottom', true);\n        this.leftHeaderContainer = this.headerRow\n            .append('div')\n            .classed('col-3', true);\n        this.centerHeaderContainer = this.headerRow\n            .append('div')\n            .classed('col-6 text-center', true);\n        this.rightHeaderContainer = this.headerRow\n            .append('div')\n            .classed('col-3 text-end button-group', true);\n        this.backButton = this.addBackButton(this.leftHeaderContainer);\n    }\n\n    // MARK: - Body\n\n    renderBody() {\n        this.row = this.addRow(this.element);\n    }\n\n    // MARK: - Footer\n\n    renderFooterRow() {\n        this.footerRow = this.addRow(this.element)\n            .classed('footer', true);\n    }\n\n    renderFooterLinks() {\n        this.footerLinksContainer = this.footerRow\n            .append('div')\n            .classed('col-12 text-center', true);\n\n        this.footerLinksContainer\n            .append('a')\n            .text(Language.translate('Impress'))\n            .on('click', function () {\n                let language = Language.language;\n                let url = `/html/impress-${language}.html`;\n                this.presentModalPopup(url);\n            }.bind(this));\n\n        this.footerLinksContainer\n            .append('a')\n            .text(Language.translate('Privacy Policy'))\n            .on('click', function () {\n                let language = Language.language;\n                let url = `/html/privacy-policy-${language}.html`;\n                this.presentModalPopup(url);\n            }.bind(this));\n\n        this.footerLinksContainer\n            .append('a')\n            .text(Language.translate('About the Project'))\n            .on('click', function () {\n                let language = Language.language;\n                let url = `/html/about-project-${language}.html`;\n                this.presentModalPopup(url);\n            }.bind(this));\n    }\n\n    presentModalPopup(contentURL) {\n        let parent = window.frcvApp.element;\n        let impressPopup = new ModalPopup(parent);\n        impressPopup.loadContent(contentURL);\n        impressPopup.showBigModal();\n    }\n\n    renderFooterURL() {\n\n        this.footerURLContainer = this.footerRow\n            .append('div')\n            .classed('col-12 text-center', true);\n\n        this.footerURLContainer.append('br');\n\n        this.footerTooltipContainer = this.footerURLContainer\n            .append('div')\n            .classed('tooltip', true);\n\n        this.footerURLLabel = this.footerTooltipContainer\n            .append('a')\n            .append('samp')\n            .on('click', this.copyLocationToClipboard);\n\n        let text = Language.translate('Click on URL to copy it to clipboard');\n        this.footerURLLabelTooltip = this.footerTooltipContainer\n            .append('span')\n            .classed('tooltiptext', true)\n            .text(text);\n    }\n\n    copyLocationToClipboard() {\n        let urlPath = window.location.href;\n        navigator.clipboard.writeText(urlPath).then(function () {\n            console.log('Async: Copying to clipboard was successful!');\n        }, function (err) {\n            console.error('Async: Could not copy text: ', err);\n        });\n    }\n\n    renderFooterCorpusInfo() {\n        this.footerCorpusInfoContainer = this.footerRow\n            .append('div')\n            .classed('col-12 text-center', true);\n\n        this.footerDebugLabel = this.footerCorpusInfoContainer\n            .append('samp');\n\n        this.updateFooterDebugInfo();\n    }\n\n    renderFooterLanguageInfo() {\n        this.footerLanguageInfoContainer = this.footerRow\n            .append('div')\n            .classed('col-12 text-center', true);\n\n        this.footerLanguageLabel = this.footerLanguageInfoContainer\n            .append('samp');\n\n        this.footerLanguageRadioGroup = new RadioGroup(\n            this.footerLanguageInfoContainer\n        );\n\n        this.footerLanguageRadioGroup.setOptions([\n            [Language.English, 'English'],\n            [Language.German, 'German'],\n            [Language.French, 'French'],\n        ]);\n\n        this.footerLanguageRadioGroup.onChange = function (value) {\n            Language.setLanguage(value);\n            URLParameters.getInstance().set(URLParameters.language, value);\n            Application.default.reloadPage();\n        };\n\n        this.footerLanguageRadioGroup.setSelectedOption(\n            Language.language\n        );\n\n        // this.updateFooterLanguageInfo();\n    }\n\n    renderFooter() {\n        this.renderFooterRow();\n        this.renderFooterLinks();\n        this.renderFooterURL();\n        this.renderFooterCorpusInfo();\n        this.renderFooterLanguageInfo();\n    }\n\n    // MARK: Update Footer\n\n    updateFooter() {\n        this.updateFooterURL();\n        this.updateFooterDebugInfo();\n        // this.updateFooterLanguageInfo();\n    }\n\n    updateFooterURL() {\n        let url = URLParameters.getInstance().getURL();\n        this.footerURLLabel.text(url);\n    }\n\n    updateFooterDebugInfo() {\n        let label = Language.translate('Corpus loaded status');\n        let isCorpusLoaded = this.application.isCorpusLoaded();\n        let valueTranslated = Language.translate('' + isCorpusLoaded);\n        this.footerDebugLabel.text(`${label}: ${valueTranslated}`);\n    }\n\n    // updateFooterLanguageInfo() {\n    //     let label = Language.translate('Language');\n    //     let translatedGreeting = Language.language;\n    //     let text = `${label}: ${translatedGreeting}`;\n    //     this.footerLanguageLabel.text(text);\n    // }\n\n\n    // MARK: - Loading View\n\n    addLoadingView(toParent = this.element) {\n        toParent.loadingView = toParent\n            .append('div')\n            .classed('loading-container', true);\n\n        toParent.loadingView\n            .append('div')\n            .classed('loading-card', true)\n            .text(Language.translate('Loading...'));\n\n        return toParent.loadingView;\n    }\n\n    showLoadingView() {\n        this.loadingView = this.addLoadingView(this.element);\n    }\n\n    hideLoadingView() {\n        if (!this.loadingView) return;\n        this.loadingView.remove();\n    }\n\n    // MARK: - Back Button\n\n    addBackButton(toParent = this.element) {\n        let button = new Button(toParent);\n        button.element.classed('back-button', true);\n        button.setText(Language.translate('Back'));\n        let applicationReference = this.application;\n        button.onClick = function () {\n            applicationReference.showPage('main', true);\n        };\n        return button;\n    }\n\n    showBackButton() {\n        this.backButton.element.style('visibility', 'visible');\n    }\n\n    hideBackButton() {\n        this.backButton.element.style('visibility', 'hidden');\n    }\n\n    // MARK: - Load Corpus\n\n    loadCorpusIfNeeded() {\n        this.willLoadCorpus();\n        if (this.application.isCorpusLoaded()) {\n            this.didLoadCorpus();\n        } else {\n            let ref = this;\n            this.application.loadCorpus(function () {\n                ref.didLoadCorpus();\n            });\n        }\n    }\n\n    willLoadCorpus() {\n\n    }\n\n    didLoadCorpus() {\n        this.updateFooterURL();\n        this.updateFooterDebugInfo();\n    }\n}\n","import {Language} from \"../language/language\";\n\nexport class Option {\n\n    constructor(id, title) {\n        this.id = id;\n        this.title = title || id;\n    }\n\n    get translatedTitle() {\n        return Language.translate(this.title);\n    }\n}\n","import {Component} from \"./component\";\n\nexport class Checkbox extends Component {\n    constructor(parent) {\n        super(parent);\n        this.renderInput();\n        this.renderLabel();\n    }\n\n    // MARK: - Life Cycle\n    renderInput() {\n        let thisReference = this;\n        this.element = this.parent\n            .classed('radio-group', true)\n            .append('input')\n            .attr('type', 'checkbox')\n            .attr('id', this.selector)\n            .on('click', function (event) {\n                if (!event.target) {\n                    return;\n                }\n                let checkbox = event.target;\n                if (thisReference.onClick) {\n                    thisReference.onClick(checkbox.checked);\n                }\n            });\n    }\n\n    renderLabel() {\n        this.label = this.parent\n            .append('label')\n            .attr('for', this.selector)\n            .text('Unknown');\n    }\n\n    // MARK: - Functions\n    setText(text) {\n        this.label.text(text);\n        return this;\n    }\n\n    setChecked(checked) {\n        this.element.attr('checked', checked === true ? checked : null);\n        return this;\n    }\n\n    onClick(checked) {\n        // empty\n        console.log('onClick: ' + checked);\n    }\n\n    enable() {\n        this.element.attr('disabled', null);\n        this.label.style('color', 'black');\n    }\n\n    disable() {\n        this.element.attr('disabled', true);\n        this.label.style('color', 'gray');\n    }\n}\n","import {Popup} from '../components/popup';\nimport {RadioGroup} from \"../components/radio-group\";\nimport {Option} from \"../components/option\";\nimport {SearchPage} from \"./search-page\";\nimport {URLParameters} from \"../shared/url-parameters\";\nimport {Language} from \"../language/language\";\nimport {Checkbox} from \"../components/checkbox\";\n\n/**\n *\n * @class SearchPageSettingsPopup\n * @extends Popup\n */\nexport class SearchPageSettingsPopup extends Popup {\n\n    preferredSize() {\n        return {width: 320, height: 300};\n    }\n\n    /**\n     * Override `Popup` component.\n     */\n    render() {\n        // this.card.header.style('display', 'none');\n        this.renderViewRadioGroup();\n        this.renderShowChartCheckbox();\n        this.renderShowMapCheckbox();\n        this.renderShowWordAboutCheckbox();\n    }\n\n    /**\n     *\n     */\n    renderCard() {\n        super.renderCard();\n        this.row = this.card.body\n            .append('div')\n            .classed('row margin-top', true);\n    }\n\n    /**\n     *\n     */\n    renderViewRadioGroup() {\n        // this.card.body.append('p');\n\n        this.viewRadioGroupLabel = this.row\n            .append('div')\n            .classed('col-4 text-end', true)\n            .text(Language.translate('View Mode') + ':');\n\n        this.viewRadioGroupContainer = this.row\n            .append('div')\n            .classed('col-8', true);\n\n        this.viewRadioGroup = new RadioGroup(this.viewRadioGroupContainer);\n        this.viewRadioGroup.setOptions([\n            new Option('half', 'Half'),\n            new Option('full', 'Full')\n        ]);\n\n        this.viewRadioGroup.onChange = function (value) {\n            if (!this.searchPage) return;\n            this.searchPage.setViewMode(value, true);\n            URLParameters.getInstance().set(URLParameters.searchViewMode, value);\n        }.bind(this);\n    }\n\n    /**\n     *\n     */\n    renderShowChartCheckbox() {\n        this.showChartCheckboxLabel = this.row.append('div').classed('col-4 text-end', true);\n        this.showChartCheckboxContainer = this.row.append('div').classed('col-8', true);\n        this.showChartCheckbox = new Checkbox(this.showChartCheckboxContainer);\n        this.showChartCheckbox.setText(Language.translate('Show Chart'));\n        this.showChartCheckbox.onClick = function (value) {\n            value ? this.searchPage.showChart() : this.searchPage.hideChart();\n            URLParameters.getInstance().setWithoutDeleting('show-chart', value);\n        }.bind(this);\n    }\n\n    /**\n     *\n     */\n    renderShowMapCheckbox() {\n        this.showMapCheckboxLabel = this.row.append('div').classed('col-4 text-end', true);\n        this.showMapCheckboxContainer = this.row.append('div').classed('col-8', true);\n        this.showMapCheckbox = new Checkbox(this.showMapCheckboxContainer);\n        this.showMapCheckbox.setText(Language.translate('Show Map'));\n        this.showMapCheckbox.onClick = function (value) {\n            value ? this.searchPage.showMap() : this.searchPage.hideMap();\n            URLParameters.getInstance().setWithoutDeleting('show-map', value);\n        }.bind(this);\n    }\n\n    /**\n     *\n     */\n    renderShowWordAboutCheckbox() {\n        this.showWordAboutCheckboxLabel = this.row.append('div').classed('col-4 text-end', true);\n        this.showWordAboutCheckboxContainer = this.row.append('div').classed('col-8', true);\n        this.showWordAboutCheckbox = new Checkbox(this.showWordAboutCheckboxContainer);\n        this.showWordAboutCheckbox.setText(Language.translate('Show Word About'));\n        this.showWordAboutCheckbox.onClick = function (value) {\n            value ? this.searchPage.showWordAbout() : this.searchPage.hideWordAbout();\n            URLParameters.getInstance().setWithoutDeleting('show-word-about', value);\n        }.bind(this);\n    }\n\n    /**\n     *\n     */\n    willShow() {\n        super.willShow();\n        this.card.headerRow.append('h3').text(Language.translate('Settings'));\n        this.loadValues();\n    }\n\n    loadValues() {\n        let searchPage = this.searchPage;\n        this.viewRadioGroup.setSelectedOption(searchPage.viewMode);\n        this.showChartCheckbox.setChecked(searchPage.diachronicChartCard.isVisible);\n        this.showMapCheckbox.setChecked(searchPage.mapChartCard.isVisible);\n        this.showWordAboutCheckbox.setChecked(searchPage.wordAboutCard.isVisible);\n    }\n}\n\n/**\n * Enumeration of available view modes.\n * @enum\n */\nSearchPageSettingsPopup.ViewMode = {\n    Half: 'Half',\n    Full: 'Full'\n};\n","export function randomColor() {\n    return \"rgb(\" +\n        (Math.random() * 255) + \", \" +\n        (Math.random() * 255) + \",\" +\n        (Math.random() * 255) + \")\";\n}\n\nexport class Color {\n    constructor(r, g, b) {\n        this.r = Math.round(r);\n        this.g = Math.round(g);\n        this.b = Math.round(b);\n    }\n\n    rgbString() {\n        return `rgb(${this.r},${this.g},${this.b})`;\n    }\n\n    colorAdding(r, g, b) {\n        return new Color(this.r + r, this.g + g, this.b + b);\n    }\n}\n\nColor.organgeLow = new Color(250, 211, 144);\nColor.organgeHigh = new Color(229, 142, 38);\nColor.redLow = new Color(248, 194, 145);\nColor.redHigh = new Color(183, 21, 64);\nColor.blueLow = new Color(106, 137, 204);\nColor.blueHigh = new Color(12, 36, 97);\nColor.lightBlueLow = new Color(130, 204, 221);\nColor.lightBlueHight = new Color(10, 61, 98);\nColor.greenLow = new Color(184, 233, 148);\nColor.greenHight = new Color(7, 153, 146);\n\nColor.stackColors = [\n    [Color.blueHigh, Color.blueLow],\n    [Color.redHigh, Color.redLow],\n    [Color.greenHight, Color.greenLow],\n    [Color.organgeHigh, Color.organgeLow],\n    [Color.lightBlueHight, Color.lightBlueLow],\n];\n// Returns a collection of colors with the given amount.\n//\nexport function colorsForStack(stack, amount) {\n\n    if (!Number.isInteger(stack)) {\n        return [Color.stackColors[0]];\n    }\n\n    let usedAmount = Math.max(amount, 5);\n    let stackColors = Color.stackColors[stack % Color.stackColors.length];\n    let highColor = stackColors[0];\n    let lowColor = stackColors[1];\n    let redDiff = lowColor.r - highColor.r;\n    let greenDiff = lowColor.g - highColor.g;\n    let blueDiff = lowColor.b - highColor.b;\n    let redStep = redDiff / usedAmount;\n    let greenStep = greenDiff / usedAmount;\n    let blueStep = blueDiff / usedAmount;\n    let colors = [];\n\n    for (let i = 0; i < amount; i++) {\n        let newColor = highColor.colorAdding(redStep * i, greenStep * i, blueStep * i);\n        colors.push(newColor);\n    }\n\n    return colors;\n}","export class TestData {\n}\n\nTestData.datasets = [\n    {\n        label: 'Merde',\n        stack: 'Merde',\n        data: [\n            {label: 2012, year: 2012, yearTotal: 100, value: 12},\n            {label: 2013, year: 2013, yearTotal: 120, value: 24},\n            {label: 2014, year: 2014, yearTotal: 140, value: 12},\n        ]\n    },\n    {\n        label: 'Gucci',\n        stack: 'Gucci,Lacoste',\n        data: [\n            {label: 2012, year: 2012, yearTotal: 100, value: 5},\n            {label: 2013, year: 2013, yearTotal: 120, value: 10},\n            {label: 2014, year: 2014, yearTotal: 140, value: 15},\n        ]\n    },\n    {\n        label: 'Lacoste',\n        stack: 'Gucci,Lacoste',\n        data: [\n            {label: 2012, year: 2012, yearTotal: 100, value: 8},\n            {label: 2013, year: 2013, yearTotal: 120, value: 8},\n            {label: 2014, year: 2014, yearTotal: 140, value: 5},\n        ]\n    },\n    {\n        label: 'Nike',\n        stack: 'Nike,Puma',\n        data: [\n            {label: 2012, year: 2012, yearTotal: 100, value: 2},\n            {label: 2013, year: 2013, yearTotal: 120, value: 4},\n            {label: 2014, year: 2014, yearTotal: 140, value: 20},\n        ]\n    },\n    {\n        label: 'Puma',\n        stack: 'Nike,Puma',\n        data: [\n            {label: 2012, year: 2012, yearTotal: 100, value: 15},\n            {label: 2013, year: 2013, yearTotal: 120, value: 30},\n            {label: 2014, year: 2014, yearTotal: 140, value: 10},\n        ]\n    }\n];\n","import {Component} from \"../components/component\";\nimport {Color, colorsForStack} from \"../shared/colors\";\nimport {URLParameters} from \"../shared/url-parameters\";\nimport {TestData} from \"../shared/test-data\";\n\n/**\n *\n * @class Diachronic Chart Component\n * @extends Component\n */\nexport class DiachronicChart extends Component {\n\n  /**\n   * Creates an instance of DiachronicChart.\n   *\n   * @constructor\n   * @param {Component} parent The parental component.\n   */\n  constructor(parent) {\n    super(parent);\n    if (!parent) {\n      throw 'No parent specified.';\n    }\n    if (Object.getPrototypeOf(parent) === String.prototype) {\n      this.selector = parent;\n      this.element = d3.select('#' + parent);\n    } else {\n      this.element = parent;\n    }\n    this.initialize();\n    this.update();\n  }\n\n  /**\n   * Initializes this diachronic chart by setting the default values.\n   */\n  initialize() {\n    this.width = 1000;\n    this.height = 600;\n    this.defaultMargin = 60;\n    this.margin = {\n      top: this.defaultMargin,\n      right: this.defaultMargin,\n      bottom: this.defaultMargin,\n      left: this.defaultMargin\n    };\n\n    this.datasets = [];\n    this.presentedDatasetGroups = [];\n    this.presentedStacks = [];\n\n    this.labelColor = new Color(155, 155, 155).rgbString();\n    this.type = DiachronicChart.ChartType.Bar;\n    this.valueType = 'relative';\n\n    this.isShowLabels = false;\n    this.isCombineStacks = false;\n\n    this.numberFormat = new Intl.NumberFormat('de-DE', {\n      maximumFractionDigits: 3\n    });\n\n    if (URLParameters.getInstance().getBoolean(URLParameters.showTestData)) {\n      this.datasets = TestData.datasets;\n    }\n  }\n\n  /**\n   *\n   * @param datasets\n   */\n  set datasets(datasets) {\n    this._datasets = datasets;\n    this._datasets.forEach(dataset => dataset.isEnabled = true);\n  }\n\n\n  // MARK: - Life Cycle\n\n  /**\n   * Updates the receiver by calling the draw chart chain: `beforeDrawChart()`,\n   * `drawChart()` and `afterDrawChart()`.\n   */\n  update() {\n    this.beforeDrawChart();\n    this.drawChart();\n    this.afterDrawChart();\n  }\n\n  /**\n   * Does some (pre)calculations for drawing the chart.\n   */\n  beforeDrawChart() {\n    this.configureChart();\n    this.calculatePresentedDatasets();\n    this.calculateListOfDatasetNames();\n    this.calculateListOfYears();\n    this.calculateListOfStacks();\n    this.calculateFlattenData();\n    this.calculateDatasetsPerYear();\n    this.calculateColors();\n    this.calculateDatasetStacks();\n  }\n\n  /**\n   * Creates and renders the chart.\n   */\n  drawChart() {\n    this.createSVG();\n\n    // if (this.datasetStacks.length === 0) return;\n\n    this.createGraph();\n    this.createScales();\n    this.createAxis();\n\n    this.renderAxis();\n    this.renderGrid();\n    this.renderStacks();\n\n    this.renderLegend();\n  }\n\n  // MARK: - Calculate Data\n\n  /**\n   *\n   */\n  configureChart() {\n    this.renderMethod = this.type === 'Bar' ? this.renderBars : this.renderLine;\n    let margin = this.margin;\n    this.graphWidth = this.width - margin.left - margin.right;\n    this.graphHeight = this.height - margin.top - margin.bottom;\n  }\n\n  /**\n   *\n   */\n  calculatePresentedDatasets() {\n    this.presentedDatasets = this._datasets.filter(dataset => dataset.isEnabled);\n  }\n\n  /**\n   *\n   */\n  calculateDatasetStacks() {\n    let datasetRef = this.presentedDatasets;\n    let datasetsPerYearRef = this.presentedDatasetsPerYear;\n\n    this.datasetStacks = this.listOfStacks.map(function (stackName, index) {\n\n      let stackCandidates = datasetRef.filter(dataset => dataset.stack === stackName);\n      let candidatesNames = stackCandidates.map(stackCandidate => stackCandidate.label);\n      let candidatesColors = stackCandidates.map(stackCandidate => stackCandidate.color);\n\n      let stack = d3.stack()\n        .keys(candidatesNames)\n        (datasetsPerYearRef);\n\n      stack.label = stackName;\n      stack.stack = stackName;\n      stack.colors = candidatesColors;\n\n      return stack;\n    });\n\n\n    this.allDatasetStacks = this.listOfAllStacks.map(function (stackName) {\n\n      let stackCandidates = this._datasets.filter(dataset => dataset.stack === stackName);\n      let candidatesNames = stackCandidates.map(stackCandidate => stackCandidate.label);\n      let candidatesColors = stackCandidates.map(stackCandidate => stackCandidate.color);\n\n      let stack = d3.stack()\n        .keys(candidatesNames)\n        (this.datasetsPerYear);\n\n      stack.label = stackName;\n      stack.stack = stackName;\n      stack.colors = candidatesColors;\n\n      return stack;\n    }.bind(this));\n  }\n\n  /**\n   *\n   */\n  calculateListOfStacks() {\n    let temporaryMap = d3.map(this.presentedDatasets, dataset => dataset.stack || dataset.label);\n    this.listOfStacks = Array.from(new Set(temporaryMap));\n\n    let temporaryMap2 = d3.map(this._datasets, dataset => dataset.stack || dataset.label);\n    this.listOfAllStacks = Array.from(new Set(temporaryMap2));\n  }\n\n  /**\n   *\n   */\n  calculateListOfYears() {\n    if (this.presentedDatasets.length > 0) {\n      this.listOfYears = this.presentedDatasets[0].data.map(item => item.year);\n    } else {\n      this.listOfYears = [];\n    }\n  }\n\n  /**\n   *\n   */\n  calculateListOfDatasetNames() {\n    this.listOfDatasetNames = this.presentedDatasets.map(dataset => dataset.label);\n  }\n\n  /**\n   *\n   */\n  calculateDatasetsPerYear() {\n    let flattenData = this.flattenData;\n    this.datasetsPerYear = this.listOfYears.map(function (year) {\n      let yearSet = {year: year};\n      flattenData\n        .filter(item => item.year === year)\n        .forEach(function (entry) {\n          yearSet[entry.label] = entry.value;\n          yearSet.total = entry.yearTotal;\n        });\n      return yearSet;\n    });\n\n    this.presentedDatasetsPerYear = this.listOfYears.map(function (year) {\n      let yearSet = {year: year};\n      flattenData\n        .filter(item => item.year === year)\n        .filter(item => item.isEnabled === true)\n        .forEach(function (entry) {\n          yearSet[entry.label] = entry.value;\n          yearSet.total = entry.yearTotal;\n        });\n      return yearSet;\n    });\n  }\n\n  /**\n   *\n   */\n  calculateFlattenData() {\n    this.flattenData = this._datasets.map(function (dataset) {\n      dataset.data.forEach(function (item) {\n        item.label = dataset.label;\n        item.stack = dataset.stack;\n        item.key = dataset.stack;\n        item.isEnabled = dataset.isEnabled;\n      });\n      return dataset.data;\n    }).flat(1);\n  }\n\n  /**\n   *\n   */\n  calculateColors() {\n    for (let index = 0; index < this.listOfAllStacks.length; index++) {\n      let stackName = this.listOfAllStacks[index];\n      let datasets = this._datasets.filter(dataset => dataset.stack === stackName);\n      let numberOfDatasets = datasets.length;\n      let colors = colorsForStack(index, numberOfDatasets);\n\n      for (let index = 0; index < colors.length; index++) {\n        datasets[index].color = colors[index];\n      }\n    }\n  }\n\n  /**\n   * Does some calculations after drawing the chart.\n   */\n  afterDrawChart() {\n\n  }\n\n  // MARK: - SVG\n\n  /**\n   * Removes all `svg`s from the parental element.\n   */\n  removeSVG() {\n    this.element\n      .selectAll('svg')\n      .remove();\n  }\n\n  /**\n   *\n   */\n  createSVG() {\n    this.removeSVG();\n    this.svg = this.element\n      .append('svg')\n      // .attr('width', this.width)\n      // .attr('height', this.height)\n      .attr('preserveAspectRatio', 'xMidYMid meet')\n      .attr(\"viewBox\", `0 0 ${this.width} ${this.height}`)\n      .attr('id', DiachronicChart.svgID);\n\n    let image = new Image;\n\n    // let aspect = this.width / this.height;\n    // d3.select(window)\n    //     .on(\"resize\", function () {\n    //         var targetWidth = this.element.node().getBoundingClientRect().width;\n    //         console.log('targetWidth: ' + targetWidth);\n    //         this.width = targetWidth;\n    //         this.height = targetWidth / aspect;\n    //         this.svg.attr(\"width\", targetWidth);\n    //         this.svg.attr(\"height\", targetWidth / aspect);\n    //         this.update();\n    //     }.bind(this));\n  }\n\n  /**\n   *\n   */\n  createGraph() {\n    this.graph = this.svg\n      .append('g')\n      .attr('width', this.graphWidth)\n      .attr('height', this.graphHeight)\n      .attr('transform', `translate(${this.margin.left}, ${this.margin.top})`);\n  }\n\n  /**\n   *\n   */\n  createScales() {\n\n    // console.log('this.listOfYears: ' + this.listOfYears);\n    // console.log('this.listOfDatasetNames: ' + this.listOfDatasetNames);\n    // console.log('this.listOfStacks: ' + this.listOfStacks);\n\n    let max = d3.max(this.allDatasetStacks, function (stack) {\n      return d3.max(stack, function (serie) {\n        let values = serie.map(item => item['1']);\n        return d3.max(values);\n      });\n    });\n    this.max = max;\n    console.log('this.max: ' + this.max);\n\n    this.xChart = d3.scaleBand()\n      .domain(this.listOfYears)\n      .rangeRound([this.margin.left, this.width - this.margin.right])\n      .paddingInner(0.1);\n\n    this.xDataset = d3.scaleBand()\n      .domain(this.listOfDatasetNames)\n      .rangeRound([0, this.xChart.bandwidth()])\n      .padding(0.05);\n\n    this.xStack = d3.scaleBand()\n      .domain(this.listOfStacks)\n      .rangeRound([0, this.xChart.bandwidth()])\n      .padding(0.05);\n\n    this.yChart = d3.scaleLinear()\n      .domain([0, max]).nice()\n      .rangeRound([this.height - this.margin.bottom, this.margin.top]);\n  }\n\n  /**\n   *\n   */\n  createAxis() {\n    this.xAxisGrid = d3\n      .axisBottom(this.xChart)\n      .tickSize(-this.graphHeight)\n      .tickFormat('');\n\n    this.yAxisGrid = d3\n      .axisLeft(this.yChart)\n      .tickSize(-this.graphWidth)\n      .tickFormat('')\n      .ticks(20);\n  }\n\n\n  // MARK: - Render\n\n  /**\n   *\n   */\n  renderAxis() {\n    this.svg\n      .append(\"g\")\n      .call(d3.axisBottom(this.xChart))\n      .attr(\"transform\", dataset => `translate(0,${this.height - this.margin.bottom})`);\n    this.svg\n      .append(\"g\")\n      .call(d3.axisLeft(this.yChart))\n      .attr(\"transform\", dataset => `translate(${this.margin.left},0)`);\n  }\n\n\n  // MARK: - Grid\n\n  /**\n   *\n   */\n  renderGrid() {\n    this.svg\n      .append('g')\n      .attr('class', 'x axis-grid')\n      .attr('transform', 'translate(0,' + (this.height - this.margin.bottom) + ')')\n      .attr('stroke', 'lightgray')\n      .attr('stroke-width', '0.5')\n      .attr(\"opacity\", 0.3)\n      .call(this.xAxisGrid);\n    this.svg\n      .append('g')\n      .attr('class', 'y axis-grid')\n      .attr('transform', `translate(${this.margin.left},0)`)\n      .attr('stroke', 'lightgray')\n      .attr('stroke-width', '0.5')\n      .attr(\"opacity\", 0.3)\n      .call(this.yAxisGrid);\n  }\n\n  /**\n   *\n   */\n  renderStacks() {\n    for (let index = 0; index < this.datasetStacks.length; index++) {\n      this.renderBars(this.datasetStacks[index], index);\n    }\n\n    if (this.isShowLabels === false) return;\n    for (let index = 0; index < this.datasetStacks.length; index++) {\n      this.renderBarLabels(this.datasetStacks[index], index);\n    }\n  }\n\n\n  // MARK: - Bars\n\n  /**\n   *\n   * @param stack\n   * @param index\n   */\n  renderBars(stack, index) {\n    let xChartRef = this.xChart;\n    let yChartRef = this.yChart;\n    let xStackRef = this.xStack;\n    this.svg.append(\"g\")\n      .selectAll(\"g\")\n      .data(stack)\n      .enter()\n      .append(\"g\")\n      .attr(\"fill\", function (dataset, index) {\n        if (this.isCombineStacks) {\n          return stack.colors[0].rgbString();\n        } else {\n          return stack.colors[index].rgbString();\n        }\n      }.bind(this))\n      .selectAll(\"rect\")\n      .data(function (data) {\n        return data;\n      })\n      .enter()\n      .append(\"rect\")\n      .attr(\"rx\", function () {\n        return this.isCombineStacks ? 0 : 4;\n      }.bind(this))\n      .attr(\"x\", function (d) {\n        return xChartRef(d.data.year) + xStackRef(stack.label);\n      })\n      .attr(\"y\", function (d) {\n        return yChartRef(d[1]);\n      })\n      .attr(\"height\", function (d) {\n        return yChartRef(d[0]) - yChartRef(d[1]);\n      })\n      .attr(\"width\", xStackRef.bandwidth());\n  }\n\n  /**\n   *\n   * @param stack\n   * @param index\n   */\n  renderBarLabels(stack, index) {\n    let xChartRef = this.xChart;\n    let yChartRef = this.yChart;\n    let xStackRef = this.xStack;\n    let numberFormat = this.numberFormat;\n    let labelColor = this.labelColor;\n    let numberOfSeries = stack.length;\n    let serieIndex = 0;\n\n    this.svg.append(\"g\")\n      .selectAll('g')\n      .data(stack)\n      .enter()\n      .append('g')\n      .attr('fill', labelColor)\n      .selectAll('.text')\n      .data(function (dataset) {\n        return dataset;\n      })\n      .enter()\n      .append('text')\n      .attr(\"transform\", function (item) {\n        let x = xChartRef(item.data.year) + xStackRef(stack.label) + (xStackRef.bandwidth() / 2);\n        let y = yChartRef(item[1]) - 5;\n        return `translate(${x},${y})rotate(-60)`;\n      })\n      .attr(\"font-size\", 13)\n      .text(function (item, index) {\n        if (index === 0) serieIndex += 1;\n        if (serieIndex !== numberOfSeries) return;\n        let value = item[1];\n        return value === 0 ? '' : numberFormat.format(value);\n      });\n  }\n\n  // MARK: - Line\n\n  /**\n   *\n   * @returns {*}\n   */\n  createLine() {\n    if (this.datasetGroups.length === 0) {\n      return debug('no datasets given to render lines.');\n    }\n    for (let i = 0; i < this.presentedDatasetGroups.length; i++) {\n      let dataset = this.presentedDatasetGroups[i];\n      let color = colorsForStack(i, 1)[0];\n      dataset.color = color;\n      this.renderLine(dataset);\n    }\n  }\n\n  /**\n   *\n   * @param dataset\n   * @param index\n   */\n  renderLine(dataset, index) {\n    this.graph\n      .append(\"path\")\n      .datum(dataset.data)\n      .attr(\"fill\", \"none\")\n      .attr(\"stroke\", dataset.color.rgbString())\n      .attr(\"stroke-width\", 3.5)\n      .attr(\"d\", d3.line()\n        .x((item) => this.x0(item.year))\n        .y((item) => this.y0(item.value))\n        .curve(d3.curveMonotoneX));\n\n    let dots = this.graph\n      .selectAll(\".dot\")\n      .data(dataset.data.filter((item) => item.value > 0))\n      .enter()\n      .append(\"circle\")\n      .attr(\"r\", 6)\n      .attr(\"cx\", (item) => this.x0(item.year))\n      .attr(\"cy\", (item) => this.y0(item.value))\n      .attr(\"fill\", dataset.color.rgbString());\n\n    let tooltip = this.element\n      .append(\"div\")\n      .attr(\"class\", \"toolTip\")\n      .style('z-index', '9999');\n\n    dots\n      .on(\"mousemove\", function (event, item) {\n        let text = \"<b>\" + item.searchText + \"</b>\"\n          + \" in \"\n          + \"<b>\" + item.year + \"</b>\"\n          + \"<br>Abs.: <b>\" + item.value + \"</b>\"\n          + \"<br>Rel.: <b>\" + item.relativeValue + \"</b>\"\n          + \"<br>Total Year: <b>\" + item.yearTotal + \"</b>\";\n        tooltip\n          .style(\"left\", event.pageX - 20 + \"px\")\n          .style(\"top\", event.pageY - 160 + \"px\")\n          .style(\"padding\", \"10px\")\n          .style(\"background\", \"none repeat scroll 0 0 #ffffff\")\n          .style(\"position\", \"absolute\")\n          .style(\"border\", \"1px solid \" + dataset.color.rgbString())\n          .style(\"display\", \"inline-block\")\n          .html(text);\n      })\n      .on(\"mouseout\", function (d) {\n        tooltip.style(\"display\", \"none\");\n      });\n\n    if (this.isShowLabels === true) {\n      this.renderLineLabels(dataset);\n    }\n  }\n\n  /**\n   *\n   * @param dataset\n   */\n  renderLineLabels(dataset) {\n    this.graph\n      .selectAll(\".text\")\n      .data(dataset.data.filter((item) => item.value > 0))\n      .enter()\n      .append('text')\n      .attr(\"x\", (item) => this.x0(item.year))\n      .attr(\"y\", (item) => this.y0(item.value))\n      .attr('dy', '-10')\n      .attr('text-anchor', 'middle')\n      .attr(\"font-size\", 15)\n      .attr('fill', 'gray')\n      .text((item) => this.numberFormat.format(item.value || 0));\n  }\n\n  // MARK: - Render Legend\n\n  /**\n   *\n   */\n  renderLegend() {\n    if (this.isCombineStacks) {\n      this.renderCombinedStacksLegend();\n    } else {\n      this.renderNormalLegend();\n    }\n  }\n\n  renderNormalLegend() {\n\n    let datasets = this._datasets;\n    let datasetNames = datasets.map(dataset => dataset.label);\n    let circleRadius = 6;\n    let labelMargin = 50;\n\n    let xLegend = d3.scaleBand()\n      .domain(datasetNames)\n      .rangeRound([this.margin.left, this.width - this.margin.right]);\n\n    let legends = this.graph\n      .selectAll('.legend')\n      .data(datasets)\n      .enter();\n\n    let legendsTexts = legends\n      .append('text')\n      .attr(\"font-size\", 13)\n      .attr(\"x\", function (item) {\n        return xLegend(item.label) - 30;\n      })\n      .attr(\"y\", function (item) {\n        return this.graphHeight + labelMargin;\n      }.bind(this))\n      .style('cursor', 'pointer')\n      .style(\"fill\", function (item, index) {\n        return item.color.rgbString();\n      }.bind(this))\n      .text(function (item) {\n        return `${item.label} (${this.getSumForWord(item.label)})`;\n      }.bind(this));\n\n    let legendsCircles = legends\n      .append(\"circle\")\n      .attr(\"r\", circleRadius)\n      .attr(\"cx\", function (item) {\n        return xLegend(item.label) - (circleRadius * 2) - 30;\n      }.bind(this))\n      .attr(\"cy\", function (item) {\n        return this.graphHeight + labelMargin - circleRadius + 2;\n      }.bind(this))\n      .style('cursor', 'pointer')\n      .style(\"stroke\", function (item) {\n        return item.color.rgbString();\n      }.bind(this))\n      .style(\"fill\", function (item) {\n        return item.isEnabled ? item.color.rgbString() : 'white';\n      }.bind(this))\n      .style(\"stroke-width\", 2);\n\n    legendsTexts.on('click', function (event) {\n      if (!event || !event.target) return;\n      if (!event.target.innerHTML) return;\n      let label = event.target.innerHTML.split(' ')[0];\n      this.toggleDataset(label);\n    }.bind(this));\n  }\n\n  renderCombinedStacksLegend() {\n    let stackNames = this.listOfAllStacks;\n    console.log('stackNames: ' + stackNames);\n\n    let circleRadius = 6;\n    let labelMargin = 50;\n\n    let xLegend = d3.scaleBand()\n      .domain(stackNames)\n      .rangeRound([this.margin.left, this.width - this.margin.right]);\n\n    let legends = this.graph\n      .selectAll('.legend')\n      .data(stackNames)\n      .enter();\n\n    let legendsTexts = legends\n      .append('text')\n      .attr(\"font-size\", 13)\n      .attr(\"x\", function (item) {\n        return xLegend(item) - 30;\n      })\n      .attr(\"y\", function (item) {\n        return this.graphHeight + labelMargin;\n      }.bind(this))\n      .style('cursor', 'pointer')\n      .style(\"fill\", function (item, index) {\n        return colorsForStack(index, 1)[0].rgbString();\n      }.bind(this))\n      .text(function (item) {\n        return `${item} (${this.getSumForStack(item)})`;\n      }.bind(this));\n\n    let legendsCircles = legends\n      .append(\"circle\")\n      .attr(\"r\", circleRadius)\n      .attr(\"cx\", function (item) {\n        return xLegend(item) - (circleRadius * 2) - 30;\n      }.bind(this))\n      .attr(\"cy\", function (item) {\n        return this.graphHeight + labelMargin - circleRadius + 2;\n      }.bind(this))\n      .style('cursor', 'pointer')\n      .style(\"stroke\", function (item, index) {\n        return colorsForStack(index, 1)[0].rgbString();\n      }.bind(this))\n      .style(\"fill\", function (item, index) {\n        let color = colorsForStack(index, 1)[0];\n        return item.isEnabled ? color.rgbString() : 'white';\n      }.bind(this))\n      .style(\"stroke-width\", 2);\n\n  }\n\n  /**\n   *\n   * @param label\n   */\n  toggleDataset(label) {\n    let dataset = this._datasets.find(dataset => dataset.label === label);\n    dataset.isEnabled = !dataset.isEnabled;\n    this.update();\n  }\n\n  getSumForWord(word) {\n    let values = this.flattenData\n      .filter(item => item.label === word)\n      .map(item => item.value);\n    return this.numberFormat.format(d3.sum(values));\n  }\n\n  getSumForStack(stackName) {\n    let values = this.flattenData\n      .filter(item => item.stack === stackName)\n      .map(item => item.value);\n    return d3.sum(values);\n  }\n}\n\n// MARK: - Statics\n\nDiachronicChart.svgID = 'chart-svg';\n\n/**\n * @enum\n * Enumeration of available chart types.\n */\nDiachronicChart.ChartType = {\n  /** Case for bar chart type. */\n  Bar: 'Bar',\n  /** Case for line chart type. */\n  Line: 'Line'\n};\n\n","import {Popup} from \"../components/popup\";\nimport {Checkbox} from \"../components/checkbox\";\nimport {RadioGroup} from \"../components/radio-group\";\nimport {URLParameters} from \"../shared/url-parameters\";\nimport {Application} from \"../application\";\nimport {Language} from \"../language/language\";\nimport {Option} from \"../components/option\";\n\n/**\n *\n * @class DiachronicChartSettingsPopup\n * @extends Popup\n */\nexport class DiachronicChartSettingsPopup extends Popup {\n\n  render() {\n    this.card\n      .headerRow\n      .append('h3')\n      .text(Language.translate('Settings'));\n    // this.card\n    //     .header\n    //     .style('display', 'none');\n\n    this.row = this.card.body\n      .append('div')\n      .classed('row', true);\n\n    this.renderShowLabelsCheckbox();\n    this.renderCombineStacksCheckbox();\n    this.renderRadios();\n  }\n\n  renderShowLabelsCheckbox() {\n    let container = this.row.append('div').classed('col-12 margin-top', true);\n    this.showLabelsCheckbox = new Checkbox(container);\n    this.showLabelsCheckbox.setText(Language.translate('Labels'));\n    this.showLabelsCheckbox.onClick = function (checked) {\n      this.diachronicChart.isShowLabels = checked;\n      this.diachronicChart.update();\n      URLParameters.getInstance().set(URLParameters.chartShowLabels, checked);\n    }.bind(this);\n  }\n\n  renderCombineStacksCheckbox() {\n    let container = this.row.append('div').classed('col-12', true);\n    this.combineStacksCheckbox = new Checkbox(container);\n    this.combineStacksCheckbox.setText(Language.translate('Combine Stacks'));\n    this.combineStacksCheckbox.onClick = function (checked) {\n      this.diachronicChart.isCombineStacks = checked;\n      this.diachronicChart.update();\n      URLParameters.getInstance().set(URLParameters.chartCombineStacks, checked);\n    }.bind(this);\n  }\n\n  renderRadios() {\n    let container = this.row.append('div').classed('col-12', true);\n    this.typeRadioGroup = new RadioGroup(container);\n    this.typeRadioGroup.setOptions([\n      new Option('bar', 'Bar'),\n      new Option('line', 'Line')\n    ]);\n\n    this.typeRadioGroup.onChange = function (value) {\n      this.diachronicChart.type = value;\n      this.diachronicChart.update();\n      URLParameters.getInstance().set(URLParameters.chartType, value);\n    }.bind(this);\n  }\n\n  preferredSize() {\n    return {\n      width: 240,\n      height: 600\n    };\n  }\n\n  willShow() {\n    this.loadValues();\n  }\n\n  loadValues() {\n    this.showLabelsCheckbox.setChecked(this.diachronicChart.isShowLabels);\n    console.log('this.diachronicChart.showLabels: ' + this.diachronicChart.isShowLabels);\n    this.combineStacksCheckbox.setChecked(this.diachronicChart.isCombineStacks);\n    console.log('this.diachronicChart.combineGroups: ' + this.diachronicChart.isCombineStacks);\n    this.typeRadioGroup.setSelectedOption(this.diachronicChart.type);\n  }\n}\n","export function screenshotElement(selector, name) {\n    console.log('selector: ' + selector);\n    let element = document.querySelector(selector);\n    console.log('element: ' + element);\n    html2canvas(element).then(canvas => {\n        const link = document.createElement(\"a\");\n        link.setAttribute('download', name || \"name\");\n        link.href = canvas.toDataURL(\"image/jpg\");\n        document.body.appendChild(link);\n        link.click();\n        link.remove();\n    });\n}","import {Card} from \"../components/card\";\nimport {Button} from \"../components/button\";\nimport {DiachronicChart} from \"./diachronic-chart\";\nimport {createUUID} from \"../shared/uuid\";\nimport {DiachronicChartSettingsPopup} from \"./diachronic-chart-settings-popup\";\nimport {URLParameters} from \"../shared/url-parameters\";\nimport {screenshotElement} from \"../shared/screenshot\";\n\n/**\n *\n *\n * @class DiachronicChartCard\n * @extends Card\n */\nexport class DiachronicChartCard extends Card {\n\n  /**\n   *\n   * @param selector\n   * @param name\n   */\n  constructor(selector, name) {\n    super(selector);\n    if (!selector) {\n      throw 'No selector specified.';\n    }\n    this.selector = selector;\n    this.name = selector;\n    this.renderChart();\n    this.renderScreenshotButton();\n    this.renderMoreActionsButton();\n    this.applyURLParameters();\n  }\n\n  /**\n   *\n   */\n  renderChart() {\n    this.chart = new DiachronicChart(this.body);\n    this.chart.margin.left = 150;\n    this.chart.margin.right = 150;\n  }\n\n  /**\n   *\n   */\n  renderScreenshotButton() {\n    this.chartID = createUUID();\n    this.body.attr('id', this.chartID);\n\n    this.screenshotButton = new Button(this.headerRightComponent);\n    this.screenshotButton.setText('Screenshot');\n    this.screenshotButton.element.classed('simple-button', true);\n    this.screenshotButton.element.html('<i class=\"fas fa-camera\"></i>');\n\n    this.screenshotButton.onClick = function (event) {\n      let name = 'my_image.jpg';\n      let chartID = this.chartID;\n      screenshotElement(\"#\" + chartID, name);\n    }.bind(this);\n  }\n\n  /**\n   *\n   */\n  renderMoreActionsButton() {\n    this.moreActionButton = new Button(this.headerRightComponent);\n    this.moreActionButton.setText('More');\n    this.moreActionButton.element.classed('simple-button', true);\n    this.moreActionButton.element.html('<i class=\"fas fa-ellipsis-h\"></i>');\n    this.moreActionButton.onClick = function (event) {\n      if (!event || !event.target) return;\n      this.presentSettingsPopup();\n    }.bind(this);\n  }\n\n  /**\n   *\n   */\n  applyURLParameters() {\n    this.chart.type = URLParameters.getInstance()\n      .getString(URLParameters.chartType, 'bar');\n    this.chart.isShowLabels = URLParameters.getInstance()\n      .getBoolean(URLParameters.chartShowLabels, false);\n    this.chart.isCombineStacks = URLParameters.getInstance()\n      .getBoolean(URLParameters.chartCombineStacks, false);\n  }\n\n\n  // MARK: - Settings Popup\n\n  /**\n   *\n   */\n  presentSettingsPopup() {\n    let application = window.frcvApp;\n    let button = document.getElementById(this.moreActionButton.selector);\n    let settingsPopup = new DiachronicChartSettingsPopup(application.element);\n    settingsPopup.diachronicChart = this.chart;\n    settingsPopup.showUnder(button, 'right');\n  }\n}\n","const RecentSearchesLocalStorageKey = 'de.beuth.frc-visualization.RecentSearchesLocalStorageKey';\nconst MaxItemsCount = 100;\nconst UseLocalStorage = true;\n\nexport class RecentSearches {\n    constructor() {\n        this.loadFromLocalStorage();\n    }\n\n    static getInstance() {\n        if (!RecentSearches.instance) {\n            RecentSearches.instance = new RecentSearches();\n        }\n        return RecentSearches.instance;\n    }\n\n    // Mark: - Append / Insert\n    append(searchText) {\n        this.removeIfExisting(searchText);\n        this.insert(searchText);\n        this.storeToLocalStorage();\n    }\n\n    insert(value) {\n        this.values.splice(0, 0, value);\n        this.removeDispensableValues();\n    }\n\n    // MARK: - Remove\n    removeIfExisting(value) {\n        let index = this.values.indexOf(value);\n        if (index < 0) return;\n        this.values.splice(index, 1);\n    }\n\n    removeDispensableValues() {\n        if (this.values.length < MaxItemsCount) return;\n        let tooMuch = this.values.length - MaxItemsCount;\n        console.log(\"tooMuch: \" + tooMuch);\n        this.values.splice(MaxItemsCount, tooMuch);\n    }\n\n    // MARK: - Local Storage\n    loadFromLocalStorage() {\n        let wordlist = localStorage.getItem(RecentSearchesLocalStorageKey);\n        if (wordlist) {\n            this.values = wordlist.split('\\n');\n        } else {\n            this.values = [];\n        }\n    }\n\n    storeToLocalStorage() {\n        localStorage.setItem(RecentSearchesLocalStorageKey, this.values.join('\\n'));\n    }\n}\n\n// const RecentSearches = (function () {\n//     let instance: {\n//         values: string[];\n//     };\n//\n//     function createInstance() {\n//         let recentSearches = {\n//             values: [],\n//             append: undefined\n//         };\n//\n//         recentSearches.values = [];\n//\n//\n//\n//         recentSearches.append = function\n//\n//         recentSearches.insert = function\n//\n//\n//\n//         recentSearches.removeIfExisting = function\n//\n//         recentSearches.\n//\n//\n//\n//         recentSearches.\n//\n//         recentSearches.\n//\n//         if (UseLocalStorage) {\n//             recentSearches.\n//         }\n//\n//         return recentSearches;\n//     }\n//\n//     return {\n//         getInstance: function () {\n//             if (!instance) {\n//                 instance = createInstance();\n//             }\n//             return instance;\n//         }\n//     };\n// })();","import {Component} from \"./component\";\nimport {createUUID} from \"../shared/uuid\";\nimport {RecentSearches} from \"../shared/recent-searches\";\n\nexport class SearchField extends Component {\n\n    constructor(parent) {\n        super(parent);\n        if (!parent) {\n            throw 'No parent specified.';\n        }\n        this.parent = parent;\n        this.datalistId = createUUID();\n        this.element = parent\n            .append('input')\n            .classed('form-control form-control-sm', true)\n            .attr('type', 'text')\n            .attr('placeholder', 'Search Word')\n            .attr('id', this.selector)\n            .attr('list', this.datalistId);\n\n        this.datalist = parent\n            .append('datalist')\n            .attr('id', this.datalistId);\n\n        this.element.on('keyup', function (event) {\n            if (event.key !== 'Enter') return;\n            this.onEnter();\n        }.bind(this));\n\n        this.element.on('change', function (event) {\n            this.onEnter();\n        }.bind(this));\n\n        this.updateRecentSearches();\n    }\n\n    onEnter() {\n        // empty\n    }\n\n    startSearch(searchText) {\n        // empty\n    }\n\n    getText() {\n        let element = document.getElementById(this.selector);\n        return element.value;\n    }\n\n    setText(newValue) {\n        let element = document.getElementById(this.selector);\n        element.value = newValue;\n    }\n\n    updateRecentSearches() {\n        this.datalist\n            .selectAll('option')\n            .remove();\n        let recentSearches = RecentSearches.getInstance().values || [];\n        this.datalist\n            .selectAll('option')\n            .data(recentSearches)\n            .enter()\n            .append(\"option\")\n            .attr('value', (item) => item);\n    }\n}\n","import {Component} from \"./component\";\nimport {createUUID} from \"../shared/uuid\";\n\n/**\n *\n * @class Dropdown\n * @extends Component\n */\nexport class Dropdown extends Component {\n\n    constructor(parent) {\n        super(parent);\n        this.inputElements = [];\n        this.selector = createUUID();\n        this.element = parent\n            .append('div')\n            .classed('dropdown-container', true);\n        this.selectId = createUUID();\n        this.renderLabel();\n        this.renderSelect();\n    }\n\n    renderLabel() {\n        this.label = this.element\n            .append('label')\n            .attr('for', this.selectId);\n    }\n\n    renderSelect() {\n        let thisReference = this;\n        this.select = this.element\n            .append('select')\n            .classed('form-control form-control-sm', true)\n            .attr('id', this.selectId)\n            .on('change', function (event) {\n                thisReference.onClick(event);\n            });\n    }\n\n    addOption(optionId, optionName) {\n        return this.select\n            .append('option')\n            .attr('id', optionId)\n            .attr('value', optionId)\n            .text(optionName);\n    }\n\n    setOptions(options) {\n        this.removeAllInputs();\n        for (let i = 0; i < options.length; i++) {\n            let id = options[i][0] || options[i].id;\n            let name = options[i][1] || options[i].translatedTitle;\n            let inputElement = this.addOption(id, name);\n            this.inputElements.push(inputElement);\n        }\n        return this;\n    }\n\n    removeAllInputs() {\n        this.element.selectAll('input').remove();\n        return this;\n    }\n\n    onClick(event) {\n        let element = event.target;\n        if (!element) {\n            return;\n        }\n        let value = element.value;\n        if (!this.onChange) {\n            return;\n        }\n        this.onChange(value);\n        return this;\n    }\n\n    onChange(argument) {\n        console.log('argument: ' + argument);\n        if (typeof argument !== 'string') {\n            this.onChange = argument;\n        } else {\n\n        }\n        return this;\n    }\n\n    // MARK: - Chaining Setter\n\n    setLabelText(text) {\n        this.label.text(text);\n        return this;\n    }\n\n    setOnChange(callback) {\n        this.onChange = callback;\n        return this;\n    }\n\n    setSelectedOption(optionID) {\n        if (this.inputElements.find(function (item) {\n            return item.attr('value') === optionID;\n        }) !== undefined) {\n            this.value = optionID;\n        }\n        return this;\n    }\n\n    set value(optionID) {\n        document.getElementById(this.selectId).value = optionID;\n    }\n\n    get value() {\n        return document.getElementById(this.selectId).value;\n    }\n}\n","import {Component} from \"./component\";\nimport {Language} from \"../language/language\";\n\n/**\n *\n * @class LoadingView\n * @extends Component\n */\nexport class LoadingView extends Component {\n\n    /**\n     * Creates a new instance of LoadingView.\n     *\n     * @param parent The parental component.\n     */\n    constructor(parent) {\n        super(parent);\n        this.render();\n    }\n\n    /**\n     * Renders this component.\n     */\n    render() {\n        this.container = this.parent\n            .append('div')\n            .classed('loading-container', true);\n\n        this.card = this.container\n            .append('div')\n            .classed('loading-card', true)\n            .text(Language.translate('Loading...'));\n    }\n\n    /**\n     * Presents this component.\n     */\n    show() {\n        this.container.style('display', 'block');\n    }\n\n    /**\n     * Hides this component.\n     */\n    hide() {\n        this.container.style('display', 'none');\n    }\n\n    /**\n     * Removes this component.\n     */\n    remove() {\n        this.container.remove();\n    }\n}\n","import {Popup} from \"../components/popup\";\nimport {LoadingView} from \"../components/loading-view\";\nimport {Language} from \"../language/language\";\n\n/**\n *\n * @class InnovationListPopup\n * @extends Popup\n */\nexport class InnovationListPopup extends Popup {\n\n    constructor(parent) {\n        super(parent);\n    }\n\n    render() {\n        super.render();\n        this.row = this.card.body\n            .append('div')\n            .classed('row word-list', true);\n        this.card.headerRow\n            .append('h3')\n            .text(Language.translate('Innovation List'));\n    }\n\n    // MARK: - Override Popup\n\n    willShow() {\n        super.willShow();\n        this.loadingView = new LoadingView(this.row);\n\n        d3.text('/assets/InnovationList.txt')\n            .then(function (data) {\n                this.data = data.split('\\n');\n                this.loadingView.remove();\n                this.dataDidLoad();\n            }.bind(this))\n            .catch(function () {\n                this.data = [];\n                this.dataDidLoad();\n            }.bind(this));\n    }\n\n    preferredSize() {\n        return {\n            width: 400,\n            height: 0,\n        };\n    }\n\n    dataDidLoad() {\n        let reducedData = this.data.map(function (item) {\n            let components = item.split(';');\n            return {\n                title: components[0],\n                variations: components.join(',')\n            };\n        });\n\n        let thisReference = this;\n        this.row\n            .selectAll('div')\n            .append('div')\n            .data(reducedData)\n            .enter()\n            .append('div')\n            .append('a')\n            .append('span')\n            .classed('representation', true)\n            .text(item => item.title)\n            .append('span')\n            .classed('variations', true)\n            .text(item => '(' + item.variations + ')')\n            .on('click', function (item, some) {\n                thisReference.searchCard.searchField.setText('' + some.variations);\n                thisReference.searchCard.startSearching();\n                thisReference.dismiss();\n            });\n    }\n}\n","import {Card} from \"../components/card\";\nimport {SearchField} from \"../components/search-field\";\nimport {Dropdown} from \"../components/dropdown\";\nimport {RadioGroup} from \"../components/radio-group\";\nimport {Button} from \"../components/button\";\nimport {Language} from \"../language/language\";\nimport {URLParameters} from \"../shared/url-parameters\";\nimport {Option} from \"../components/option\";\nimport {InnovationListPopup} from \"./innovation-list-popup\";\nimport {Application} from \"../application\";\n\n/**\n *\n * @class SearchCard\n * @extends Card\n */\nexport class SearchCard extends Card {\n\n    /**\n     *\n     * @param parent\n     */\n    constructor(parent) {\n        super(parent);\n\n        this.header.style('display', 'none');\n        // this.footer.style('display', 'none');\n        this.row = this.body\n            .append('div')\n            .classed('row margin-top', true);\n\n        this.renderSearchField();\n        this.renderCaseSensitiveDropdown();\n        this.renderRangeDropdown();\n        this.renderRelativeAbsolute();\n        this.renderFooterRow();\n        this.renderPresentInnovationListPopupButton();\n        this.renderSearchButton();\n    }\n\n    /**\n     *\n     */\n    renderSearchField() {\n        this.searchFieldContainer = this.row\n            .append('div')\n            .classed('col-4', true);\n        this.searchField = new SearchField(this.searchFieldContainer);\n        this.searchField.onEnter = function () {\n            this.startSearching();\n        }.bind(this);\n    }\n\n    /**\n     *\n     */\n    renderCaseSensitiveDropdown() {\n        this.caseSensetiveGroupContainer = this.row\n            .append('div')\n            .classed('col-2', true);\n        this.sensitivityDropdown = new Dropdown(this.caseSensetiveGroupContainer)\n            .setOptions([\n                new Option('case-sensitive', 'Case Sensitive'),\n                new Option('case-insensitive', 'Case Insensitive'),\n                // new Option('regex', 'Reg. Expression')\n            ]);\n        this.sensitivityDropdown.label.text('Sensitivity');\n        this.sensitivityDropdown.onChange = function (value) {\n            URLParameters.getInstance().set(URLParameters.searchSensitivity, value);\n            this.startSearching();\n        }.bind(this);\n    }\n\n    /**\n     *\n     */\n    renderRangeDropdown() {\n        let startYear = 1995;\n        let endYear = 2020;\n        let defaultStartYear = 2000;\n        let options = [];\n        for (let year = startYear; year <= endYear; year++) {\n            options.push([year, year]);\n        }\n\n        this.yearStartContainer = this.row.append('div').classed('col-2', true);\n        this.yearStartDropdown = new Dropdown(this.yearStartContainer)\n            .setLabelText(Language.translate('from'))\n            .setOptions(options)\n            .setSelectedOption(defaultStartYear)\n            .setOnChange(function (startYear) {\n                URLParameters.getInstance().set(URLParameters.startYear, startYear);\n                this.startSearching();\n            }.bind(this));\n\n        this.yearEndContainer = this.row.append('div').classed('col-2', true);\n        this.yearEndDropdown = new Dropdown(this.yearEndContainer)\n            .setLabelText(Language.translate('till'))\n            .setOptions(options)\n            .setSelectedOption(endYear)\n            .setOnChange(function (endYear) {\n                URLParameters.getInstance().set(URLParameters.endYear, endYear);\n                this.startSearching();\n            }.bind(this));\n    }\n\n    /**\n     *\n     */\n    renderRelativeAbsolute() {\n        let container2 = this.row\n            .append('div')\n            .classed('col-2', true);\n        this.valueRadioGroup = new RadioGroup(container2);\n        this.valueRadioGroup.setOptions([\n            new Option('relative', 'Relative'),\n            new Option('absolute', 'Absolute')\n        ]);\n        this.valueRadioGroup.onChange = function (value) {\n            this.diachronicChart.valueType = value;\n            this.diachronicChart.update();\n            this.valueType = value;\n            URLParameters.getInstance().set(URLParameters.valueType, value);\n            this.startSearching();\n        }.bind(this);\n    }\n\n    /**\n     *\n     */\n    renderFooterRow() {\n        this.footer = this.row\n            .append('div')\n            .classed('col-12 button-group margin-top text-end', true);\n    }\n\n    /**\n     *\n     */\n    renderPresentInnovationListPopupButton() {\n        this.presentInnovationListPopupButton = new Button(this.footer);\n        this.presentInnovationListPopupButton.element.classed('button-down', true);\n        this.presentInnovationListPopupButton.setText(Language.translate('Innovation List'));\n        this.presentInnovationListPopupButton.onClick = function (event) {\n            if (!event || !event.target) return;\n            let application = Application.default;\n            let popup = new InnovationListPopup(application.element);\n            popup.searchCard = this;\n            popup.showUnder(event.target, 'center');\n        }.bind(this);\n    }\n\n    /**\n     *\n     */\n    renderSearchButton() {\n        this.searchButton = new Button(this.footer);\n        this.searchButton.element.classed('button round-button', true);\n        this.searchButton.setText(Language.translate('Search'));\n        this.searchButton.onClick = function () {\n            this.startSearching();\n        }.bind(this);\n    }\n\n    /**\n     *\n     * @returns {string}\n     */\n    getSearchText() {\n        return this.searchField.getText();\n    }\n\n    /**\n     *\n     */\n    startSearching() {\n        // empty\n    }\n\n    /**\n     *\n     */\n    createFooter() {\n        // do not call super\n    }\n\n    // MARK: - Getter\n\n    get searchText() {\n        return this.searchField.getText();\n    }\n\n    get sensitivity() {\n        return this.sensitivityDropdown.value;\n    }\n\n    get firstYear() {\n        return this.yearStartDropdown.value;\n    }\n\n    get lastYear() {\n        return this.yearEndDropdown.value;\n    }\n}\n","/**\n *\n */\nexport class GeoJson {\n\n    constructor(source) {\n        this.type = source.type;\n        this.features = [];\n\n\n        for (let index = 0; index < source.features.length; index++) {\n            let featureSource = source.features[index];\n            let feature = new Feature(featureSource);\n            this.features.push(feature);\n        }\n    }\n\n    getCenter() {\n        let allCoordinates = this.extractAllCoordinates();\n        console.log('allCoordinates.length: ' + allCoordinates.length);\n        let latitudeSum = 0;\n        let longitudeSum = 0;\n\n        allCoordinates.forEach(function (coordinates) {\n            latitudeSum += coordinates[1];\n            longitudeSum += coordinates[0];\n        });\n\n        return [\n            latitudeSum / allCoordinates.length,\n            longitudeSum / allCoordinates.length\n        ];\n    }\n\n    extractGeometryCollection() {\n        let geometryCollection = [];\n        if (this.type === 'Feature') {\n            geometryCollection.push(this.geometry);\n        } else if (this.type === 'FeatureCollection') {\n            this.features.forEach(feature => geometryCollection.push(feature.geometry));\n        } else if (this.type === 'GeometryCollection') {\n            this.geometries.forEach(geometry => geometryCollection.push(geometry));\n        } else {\n            throw new Error('The geoJSON is not valid.');\n        }\n        return geometryCollection;\n    }\n\n    extractAllCoordinates() {\n        let geometryCollection = this.extractGeometryCollection();\n        let coordinatesCollection = [];\n\n        geometryCollection.forEach(item => {\n\n            let coordinates = item.coordinates;\n            let type = item.type;\n\n            if (type === 'Point') {\n                console.log(\"Point: \" + coordinates.length);\n                coordinatesCollection.push(coordinates);\n            } else if (type === 'MultiPoint') {\n                console.log(\"MultiPoint: \" + coordinates.length);\n                coordinates.forEach(coordinate => coordinatesCollection.push(coordinate));\n            } else if (type === 'LineString') {\n                console.log(\"LineString: \" + coordinates.length);\n                coordinates.forEach(coordinate => coordinatesCollection.push(coordinate));\n            } else if (type === 'Polygon') {\n                coordinates.forEach(function (polygonCoordinates) {\n                    polygonCoordinates.forEach(function (coordinate) {\n                        coordinatesCollection.push(coordinate);\n                    });\n                });\n            } else if (type === 'MultiLineString') {\n                coordinates.forEach(function (featureCoordinates) {\n                    featureCoordinates.forEach(function (polygonCoordinates) {\n                        polygonCoordinates.forEach(function (coordinate) {\n                            coordinatesCollection.push(coordinate);\n                        });\n                    });\n                });\n            } else if (type === 'MultiPolygon') {\n                coordinates.forEach(function (featureCoordinates) {\n                    featureCoordinates.forEach(function (polygonCoordinates) {\n                        polygonCoordinates.forEach(function (coordinate) {\n                            coordinatesCollection.push(coordinate);\n                        });\n                    });\n                });\n            } else {\n                throw new Error('The geoJSON is not valid.');\n            }\n        });\n\n        return coordinatesCollection;\n    }\n}\n\nexport class Feature {\n\n    constructor(source) {\n        this.type = source.type;\n        this.properties = source.properties;\n        this.geometry = new Geometry(source.geometry);\n    }\n}\n\nexport class Geometry {\n\n    constructor(source) {\n        this.type = source.type;\n        this.coordinates = source.coordinates;\n    }\n}\n","/**\n *\n * @param arrayOfArrays\n * @returns {[]}\n */\nexport function flatArrayOfArrays(arrayOfArrays) {\n    let flattenList = [];\n    for (let index = 0; index < arrayOfArrays.length; index++) {\n        let currentArray = arrayOfArrays[index];\n        for (let index = 0; index < currentArray.length; index++) {\n            let currentItem = currentArray[index];\n            flattenList.push(currentItem);\n        }\n    }\n    return flattenList;\n}\n\n/**\n *\n * @param datasets\n * @returns {[]}\n */\nexport function flattenDatasets(datasets) {\n    let flattenList = [];\n    for (let index = 0; index < datasets.length; index++) {\n        let dataset = datasets[index];\n        let dataCollection = dataset.data;\n        dataCollection.forEach(item => {\n            item.dataset = dataset.dlabel;\n            item.stack = dataset.stack;\n            flattenList.push(item);\n        });\n    }\n    return flattenList;\n}\n\nexport function combine(flattenList) {\n    let combined = [];\n    for (let index = 0; index < flattenList.length; index++) {\n        let listItem = flattenList[index];\n        let entry = combined.find(function (entryItem) {\n            return entryItem.stack === listItem.stack\n                && entryItem.dlabel === listItem.dlabel;\n        });\n        if (entry) {\n            entry.value += listItem.value;\n        } else {\n            combined.push({\n                dlabel: listItem.dlabel,\n                stack: listItem.stack,\n                value: listItem.value\n            });\n        }\n    }\n    return combined;\n}\n\nexport function combineDataByLabel(flattenList) {\n    let combined = [];\n    for (let index = 0; index < flattenList.length; index++) {\n        let listItem = flattenList[index];\n        let entry = combined.find(function (entryItem) {\n            return entryItem.dlabel === listItem.dlabel;\n        });\n        if (entry) {\n            entry.value += listItem.value;\n        } else {\n            combined.push({\n                dlabel: listItem.dlabel,\n                stack: listItem.stack,\n                value: listItem.value\n            });\n        }\n    }\n    return combined;\n}\n","import {Component} from '../components/component';\nimport {GeoJson} from '../geojson/geojson';\nimport {colorsForStack} from '../shared/colors';\nimport {combine, combineDataByLabel, flatArrayOfArrays, flattenDatasets} from '../shared/auxiliary';\n\n/**\n * A component which renders a geo json with d3.\n *\n * @class MapChart\n * @extends Component\n */\nexport class MapChart extends Component {\n\n  /**\n   * Creates a new instance of MapChart.\n   *\n   * @param parent The parental component.\n   */\n  constructor(parent) {\n    super(parent);\n    this.element = parent\n      .append('div')\n      .attr('id', this.selector);\n\n    this.initialize();\n    this.initializeProjection();\n    this.initializePath();\n\n    this.renderSVG();\n    this.renderMapBackground();\n    this.renderTooltipContainer();\n    this.renderLegend();\n  }\n\n  // MARK: - Initialize\n\n  /**\n   * Initialize with default values.\n   */\n  initialize() {\n    this.width = 1000;\n    this.height = 1000;\n\n    this.tintColor = 'blue';\n    this.backgroundColor = 'gray';\n    this.backgroundOpacity = 0.2;\n\n    this.isDrawsBackground = true;\n    this.isZoomable = true;\n    this.isShowLabels = true;\n\n    this.datasets = [];\n    this.geoJSON = null;\n    this.departmentsData = [];\n    this.excludedFeatureCodes = [\n      '2A', '2B'\n    ];\n  }\n\n  /**\n   * Initializes a mercator projection.\n   */\n  initializeProjection() {\n    this.projection = d3.geoMercator(); //.geoAlbers().rotate(30);\n  }\n\n  /**\n   * Initializes a geo path.\n   */\n  initializePath() {\n    this.path = d3.geoPath().projection(this.projection);\n  }\n\n\n  // MARK: - Render\n\n  /**\n   *\n   */\n  renderSVG() {\n    this.svg = d3\n      .select(`#${this.selector}`)\n      .append('svg')\n      .attr('id', 'map')\n      .classed('map', true)\n      .attr('viewBox', `0 0 ${this.width} ${this.height}`);\n\n    // .call(d3.zoom().on('zoom', function (event) {\n    //     if (!this.isZoomable) return;\n    //     this.svg.selectAll('path').attr('transform', event.transform);\n    //     this.svg.selectAll('text').attr('transform', event.transform);\n    // }.bind(this)));\n  }\n\n  /**\n   * Appends a rectangle to the svg which can be used as background.\n   */\n  renderMapBackground() {\n    this.background = this.svg\n      .append('rect')\n      .attr('width', this.width)\n      .attr('height', this.height)\n      .attr('fill', this.backgroundColor)\n      .attr('fill-opacity', function () {\n        return this.isDrawsBackground ? this.backgroundOpacity : 0;\n      }.bind(this));\n  }\n\n  /**\n   * Appends a division to the svg.\n   */\n  renderTooltipContainer() {\n    let color = this.tintColor;\n    this.tooltip = this.element\n      .append('div')\n      .attr('class', 'map-tooltip')\n      .attr('rx', 5) // corner radius\n      .attr('ry', 5)\n      .style('position', 'absolute')\n      .style('color', 'black')\n      .style('border', function () {\n        return `solid 1px ${color}`;\n      })\n      .style('opacity', 0);\n\n    this.bounds = this.svg\n      .append('rect')\n      .attr('class', 'bounds')\n      .style('position', 'absolute')\n      .style('pointer-events', 'none')\n      .style('fill-opacity', 0)\n      .style('stroke', 'red')\n      .style('stroke-width', '0.7px')\n      .style('stroke-dasharray', '1,1');\n  }\n\n  renderLegend() {\n    this.legend = this.svg\n      .append('svg')\n      .attr('class', 'legend')\n      .attr('fill', 'red')\n      .attr('width', this.width)\n      .attr('height', 200)\n      .attr('x', 0)\n      .attr('y', 0);\n  }\n\n\n  // MARK: - Render\n\n  /**\n   * Renders the `geoJSON` property.\n   */\n  renderGeoJson() {\n    let geoJSON = this.geoJSON;\n    let projection = this.projection;\n\n    // precalculate the center of each feature\n    geoJSON.features.forEach(function (feature) {\n      feature.center = d3.geoCentroid(feature);\n      let code = feature.properties.code;\n      if (!this.departmentsData || !this.departmentsData.length) return;\n      feature.departmentsData = this.departmentsData.find(dataset => +dataset.departmentNumber === +code);\n    }.bind(this));\n\n    let max = d3.max(this.departmentsData, data => data.value);\n    let tooltip = this.tooltip;\n    let boundsRectangle = this.bounds;\n    let tooltipWidth = String(this.tooltip.style('width') || 210).replace('px', '');\n    let tintColor = this.tintColor;\n    let thisReference = this;\n\n    this.svg\n      .selectAll('path')\n      .data(geoJSON.features)\n      .enter()\n      .append('path')\n      .attr('d', this.path)\n      .attr('id', feature => feature.properties.code)\n      .attr('fill', 'white')\n      .attr('fill-opacity', 0.5)\n      .attr('stroke', 'black')\n      .attr('stroke-width', '0.7')\n      .attr('stroke-dasharray', function (feature) {\n        return feature.departmentsData ? '0' : '1,4';\n      }.bind(this))\n      .attr('cursor', 'pointer')\n      .on('click', function (event, feature) {\n        // this.zoomTo(feature);\n      }.bind(this))\n      .on('mouseenter', function (event, feature) {\n        d3.select(this)\n          .attr('stroke', () => tintColor)\n          .attr('stroke-width', '2')\n          .attr('stroke-dasharray', '0');\n\n\n        // set tooltip content\n        let properties = feature.properties;\n        if (!properties) return;\n\n        let code = properties.code;\n        let propertiesSelection = Object.keys(properties);\n        let components = propertiesSelection.map(function (propertyName) {\n          return `${propertyName.capitalize()}: ${properties[propertyName]}`;\n        });\n\n        let flatData = flattenDatasets(thisReference.datasets);\n        let data = flatData.filter(item => +item.dlabel === +code);\n\n        if (data) {\n          for (let index = 0; index < data.length; index++) {\n            let item = data[index];\n            components.push(item.datasetName + ': ' + item.value);\n          }\n        }\n\n        tooltip.html(components.join('<br>'));\n\n\n        // position tooltip\n        let tooltipWidth = Number(tooltip.style('width').replace('px', '') || 200);\n        let tooltipHeight = Number(tooltip.style('height').replace('px', ''));\n        tooltipWidth += 20;\n        tooltipHeight += 20;\n\n        let featureBounds = d3.geoBounds(feature);\n        let featureLowerLeft = projection(featureBounds[0]);\n        let featureUpperRight = projection(featureBounds[1]);\n        let featureBoundsWidth = featureUpperRight[0] - featureLowerLeft[0];\n        let featureBoundsHeight = featureLowerLeft[1] - featureUpperRight[1];\n\n        // svg is presented in dynamic sized view box so we need to get the actual size\n        // of the element in order to calculate a scale for the position of the tooltip.\n        let effectiveSize = thisReference.getElementEffectiveSize();\n        let widthFactor = effectiveSize[0] / thisReference.width;\n        let heightFactor = effectiveSize[1] / thisReference.height;\n\n        // calculate offset\n        let positionOffset = thisReference.getElementPosition();\n\n        // calculate scaled position\n        let top = 0;\n\n        if ((featureLowerLeft[1] * heightFactor) > (effectiveSize[1] / 2)) {\n          top = featureUpperRight[1];\n          top *= widthFactor;\n          top -= tooltipHeight;\n          top -= 5;\n        } else {\n          top = featureLowerLeft[1];\n          top *= widthFactor; // Use width factor instead of heightFactor for propert using. Can't figure out why width factor works better.\n          top += 5;\n        }\n\n        top += positionOffset[1];\n\n        // calculate tooltip center\n        let centerBottom = featureLowerLeft[0];\n        centerBottom += (featureBoundsWidth / 2);\n        centerBottom *= widthFactor;\n        centerBottom -= (Number(tooltipWidth) / 2);\n        centerBottom += positionOffset[0];\n\n        tooltip.style('opacity', 1)\n          .style('left', centerBottom + 'px')\n          .style('top', top + 'px');\n\n        boundsRectangle\n          .style('opacity', 1)\n          .style('width', featureBoundsWidth + 'px')\n          .style('height', featureBoundsHeight + 'px')\n          .style('x', featureLowerLeft[0])\n          .style('y', featureUpperRight[1]);\n\n      })\n      .on('mouseout', function (event, feature) {\n        d3.select(this)\n          .attr('stroke', 'black')\n          .attr('stroke-width', '0.7')\n          .attr('stroke-dasharray', function (feature) {\n            return feature.departmentsData ? '0' : '1,4';\n          });\n        tooltip.style('opacity', 0);\n        boundsRectangle.style('opacity', 0);\n      });\n  }\n\n  /**\n   *\n   */\n  renderDatasets() {\n    if (!this.geoJSON) return;\n    if (!this.datasets) return;\n\n    let stackNames = this.getStackNames();\n    let flatData = flattenDatasets(this.datasets);\n    let combinedData = combineDataByLabel(flatData);\n    let color = colorsForStack(0, 1)[0];\n\n    // reset colors\n    this.svg\n      .selectAll('path')\n      .attr('fill', 'white')\n      .attr('fill-opacity', '.5');\n\n    for (let index = 0; index < stackNames.length; index++) {\n      let stackName = stackNames[index];\n      let dataForStack = combinedData.filter(data => data.stack === stackName);\n      let max = d3.max(dataForStack, item => item.value);\n      let color = colorsForStack(index, 1)[0];\n\n      for (let index = 0; index < dataForStack.length; index++) {\n        let datasetEntry = dataForStack[index];\n        let id = +datasetEntry.dlabel;\n        this.svg\n          .selectAll('path')\n          .filter(item => +item.properties.code === id)\n          .attr('fill', color.rgbString())\n          .attr('fill-opacity', datasetEntry.value / max);\n      }\n    }\n  }\n\n  renderDatasetLabels() {\n    if (!this.geoJSON) return;\n    if (!this.datasets) return;\n\n    let geoJSON = this.geoJSON;\n    let datasetsFlatten = flattenDatasets(this.datasets);\n    let combinedData = combineDataByLabel(datasetsFlatten);\n\n    this.svg.selectAll('.map-label').remove();\n    this.svg\n      .selectAll('text')\n      .data(geoJSON.features)\n      .enter()\n      .append('text')\n      .attr('class', 'map-label')\n      .attr('text-anchor', 'middle')\n      .attr('fill', this.tintColor)\n      .attr('font-size', 12)\n      .attr('opacity', function () {\n        return this.isShowLabels ? 1 : 0;\n      }.bind(this))\n      .text(function (feature) {\n        let code = +feature.properties.code;\n        let dataset = combinedData.find(dataset => +dataset.dlabel === code);\n        return dataset ? dataset.value : '';\n      })\n      .attr('x', function (feature) {\n        return this.projection(feature.center)[0];\n      }.bind(this))\n      .attr('y', function (feature) {\n        return this.projection(feature.center)[1];\n      }.bind(this));\n  }\n\n  /**\n   *\n   */\n  renderDatasetsLegend() {\n    if (!this.datasets) return;\n\n    let stackNames = this.getStackNames();\n    let flatData = flattenDatasets(this.datasets);\n    let combinedData = combine(flatData);\n\n    this.legend.raise();\n    this.legend.selectAll('rect').remove();\n    this.legend.selectAll('text').remove();\n\n    for (let index = 0; index < stackNames.length; index++) {\n\n      let stackName = stackNames[index];\n      let dataForStack = combinedData.filter(data => data.stack === stackName);\n      let max = d3.max(dataForStack, item => item.value);\n      let offset = index * 80;\n      let color = colorsForStack(index, 1)[0];\n\n      let steps = 4;\n      let data = [0, 1, 2, 3, 4];\n\n      this.legend\n        .append('text')\n        .attr('x', offset + 20)\n        .attr('y', '14')\n        .style('fill', color.rgbString())\n        .text(stackName);\n\n      this.legend\n        .append(\"g\")\n        .selectAll(\"rect\")\n        .data(data)\n        .enter()\n        .append(\"rect\")\n        .style('fill', color.rgbString())\n        .attr('x', '20')\n        .attr('y', '20')\n        .attr('width', 18)\n        .attr('height', 18)\n        .attr('transform', function (d, i) {\n          return 'translate(' + offset + ',' + (i * 20) + ')';\n        })\n        .style('stroke', 'black')\n        .style('stroke-width', 1)\n        .style('fill-opacity', (d, i) => i / steps);\n\n      this.legend\n        .append(\"g\")\n        .selectAll(\"text\")\n        .data(data)\n        .enter()\n        .append(\"text\")\n        .style('fill', color.rgbString())\n        .attr('x', '40')\n        .attr('y', '35')\n        .attr('width', 18)\n        .attr('height', 18)\n        .attr('transform', function (d, i) {\n          return 'translate(' + offset + ',' + (i * 20) + ')';\n        })\n        .style('stroke', 'black')\n        .style('stroke-width', 1)\n        .style('fill-opacity', (d, i) => i / steps)\n        .text(function (d, i) {\n          return ((i / steps) * max);\n        });\n    }\n  }\n\n  /**\n   * Sets the size of the projection to fit the given geo json.\n   *\n   * @param geoJSON\n   */\n  zoomTo(geoJSON) {\n    this.projection.fitSize([this.width, this.height], geoJSON);\n  }\n\n  /**\n   * Returns an array of strings containing the names of stacks in the datasets.\n   *\n   * @returns {string[]}\n   */\n  getStackNames() {\n    if (!this.datasets) return [];\n    let stackNames = this.datasets.map(dataset => String(dataset.stack));\n    return Array.from(new Set(stackNames));\n  }\n\n  /**\n   * Tells the receiving map chart to update its view.\n   */\n  update() {\n    this.geoJSONDidChange();\n    this.datasetsDidChange();\n  }\n\n\n  // MARK: - Load JSON\n\n  /**\n   *\n   */\n  loadGeoJSON(geoJSONURL) {\n    d3.json(geoJSONURL)\n      .then(function (rawJSON) {\n        this.setGeoJSON(new GeoJson(rawJSON));\n      }.bind(this))\n      .catch(function (error) {\n        console.log(error);\n      }.bind(this));\n  }\n\n  /**\n   *\n   * @param newGeoJSON\n   */\n  setGeoJSON(newGeoJSON) {\n    this.geoJSON = newGeoJSON;\n    this.geoJSONDidChange();\n    this.tooltip.raise();\n  }\n\n  /**\n   *\n   * @param newDatasets\n   */\n  setDatasets(newDatasets) {\n    this.datasets = newDatasets;\n    this.datasetsDidChange();\n    this.tooltip.raise();\n    this.bounds.raise();\n  }\n\n  /**\n   * Tells the receiving map chart that its `geoJSON` property did change.\n   */\n  geoJSONDidChange() {\n    if (!this.geoJSON) return;\n    this.removeExcludedFeatures();\n    this.zoomTo(this.geoJSON);\n    this.renderGeoJson();\n    this.renderDatasets();\n  }\n\n  /**\n   * Tells the receiving map chartt that its `datasets` property did change.\n   */\n  datasetsDidChange() {\n    if (!this.datasets) return;\n    this.renderDatasets();\n    this.renderDatasetLabels();\n    this.renderDatasetsLegend();\n  }\n\n\n  // MARK: - Auxiliary\n\n  getElementEffectiveSize() {\n    let width = this.element.style('width').replace('px', '');\n    let height = this.element.style('height').replace('px', '');\n    return [Number(width), Number(height)];\n  }\n\n  getElementPosition() {\n    let element = document.getElementById(this.selector);\n    let rect = element.getBoundingClientRect();\n    let xPosition = rect.x + window.scrollX;\n    let yPosition = rect.y + window.scrollY;\n    return [xPosition, yPosition];\n  }\n\n  removeExcludedFeatures() {\n    if (!this.geoJSON) return;\n    let excludedFeatureCodes = this.excludedFeatureCodes;\n    for (let index = 0; index < excludedFeatureCodes.length; index++) {\n      let code = excludedFeatureCodes[index];\n      let candidate = this.geoJSON.features.find(feature => feature.properties.code === code);\n      if (!candidate) return;\n      let candidateIndex = this.geoJSON.features.indexOf(candidate);\n      if (candidateIndex < 0) return;\n      this.geoJSON.features.splice(candidateIndex, 1);\n    }\n  }\n}\n\n","import {Component} from \"./component\";\n\n/**\n *\n * @class Slider\n * @extends Component\n */\nexport class Slider extends Component {\n\n  constructor(parent) {\n    super(parent);\n    this.element = this.parent\n      .append('div')\n      .attr('id', this.selector)\n      .classed('range-container', true);\n    this.renderMinLabel();\n    this.render();\n    this.renderMaxLabel();\n    this.renderValueLabel();\n  }\n\n  renderMinLabel() {\n    this.minLabel = this.element\n      .append('label')\n      .attr('id', this.selector + '-min-label');\n  }\n\n  render() {\n    this.range = this.element\n      .append('input')\n      .attr('type', 'range')\n      .attr('name', 'mySlider')\n      .attr('min', '0')\n      .attr('max', '100')\n      .on('input', function (event) {\n        if (!event.target || event.target.value) return;\n        this.valueLabel.text(event.target.value);\n      }.bind(this));\n  }\n\n  renderMaxLabel() {\n    this.maxLabel = this.element\n      .append('label')\n      .attr('id', this.selector + '-max-label');\n  }\n\n  renderValueLabel() {\n    this.valueLabel = this.element\n      .append('label')\n      .classed('range-value-label', true);\n  }\n\n  get value() {\n    return d3.select(this.range).attr('value');\n  }\n\n  set value(newValue) {\n    this.range.attr('value', newValue);\n    this.valueLabel.text(newValue);\n  }\n\n  set minimum(newMin) {\n    this.range.attr('min', newMin);\n    this.minLabel.text(newMin);\n  }\n\n  set maximum(newMax) {\n    this.range.attr('max', newMax);\n    this.maxLabel.text(newMax);\n  }\n}\n","import {Popup} from \"../components/popup\";\nimport {Language} from \"../language/language\";\nimport {Checkbox} from \"../components/checkbox\";\nimport {URLParameters} from \"../shared/url-parameters\";\nimport {RadioGroup} from \"../components/radio-group\";\nimport {Option} from \"../components/option\";\n\n/**\n *\n * @class MapChartSettingsPopup\n * @extends Popup\n */\nexport class MapChartSettingsPopup extends Popup {\n\n  /**\n   *\n   */\n  render() {\n    this.card\n      .headerRow\n      .append('h3')\n      .text(Language.translate('Settings'));\n\n    this.row = this.card.body\n      .append('div')\n      .classed('row', true);\n\n    this.renderShowLabelsCheckbox();\n  }\n\n  /**\n   *\n   */\n  renderShowLabelsCheckbox() {\n    let container = this.row.append('div').classed('col-12 margin-top', true);\n    this.showLabelsCheckbox = new Checkbox(container);\n    this.showLabelsCheckbox.setText(Language.translate('Labels'));\n    this.showLabelsCheckbox.onClick = function (checked) {\n      this.mapChart.isShowLabels = checked;\n      this.mapChart.update();\n      URLParameters.getInstance().setWithoutDeleting('map-show-labels', checked);\n    }.bind(this);\n  }\n\n  /**\n   *\n   * @returns {{width: number, height: number}}\n   */\n  preferredSize() {\n    return {\n      width: 240,\n      height: 600\n    };\n  }\n\n  /**\n   *\n   */\n  willShow() {\n    super.willShow();\n    this.loadValues();\n  }\n\n  /**\n   *\n   */\n  loadValues() {\n    this.showLabelsCheckbox.setChecked(this.mapChart.isShowLabels);\n    console.log('this.mapChart.showLabels: ' + this.mapChart.isShowLabels);\n  }\n}\n","import {Card} from \"../components/card\";\nimport {Button} from \"../components/button\";\nimport {MapChart} from \"./map-chart\";\nimport {Language} from \"../language/language\";\nimport {Checkbox} from \"../components/checkbox\";\nimport {URLParameters} from \"../shared/url-parameters\";\nimport {Slider} from \"../components/slider\";\nimport {screenshotElement} from \"../shared/screenshot\";\nimport {DiachronicChartSettingsPopup} from \"../time-chart/diachronic-chart-settings-popup\";\nimport {MapChartSettingsPopup} from \"./map-chart-settings-popup\";\n\n/**\n *\n * @class MapChartCard\n * @extends Card\n */\nexport class MapChartCard extends Card {\n\n  /**\n   * Creates a new instance of MapChartCard.\n   *\n   * @param parent The parental component.\n   */\n  constructor(parent) {\n    super(parent);\n    // this.renderSlider();\n    this.renderMenuItems();\n    this.renderMapChart();\n  }\n\n  /**\n   *\n   */\n  renderSlider() {\n    this.slider = new Slider(this.headerCenterComponent);\n    this.slider.minimum = 1995;\n    this.slider.maximum = 2020;\n    this.slider.value = 2000;\n  }\n\n  /**\n   *\n   */\n  renderMenuItems() {\n\n    // this.showLabelsCheckbox = new Checkbox(this.headerRightComponent)\n    //     .setText(Language.translate('Labels'))\n    //     .setChecked(true);\n    //\n    // this.showLabelsCheckbox.onClick = function (checked) {\n    //     this.mapChart.isShowLabels = checked;\n    //     this.mapChart.update();\n    //     URLParameters.getInstance().setWithoutDeleting('map-show-labels', checked);\n    // }.bind(this);\n    //\n    // this.zoomEnabledCheckbox = new Checkbox(this.headerRightComponent)\n    //     .setText(Language.translate('Zoom'))\n    //     .setChecked(true);\n    //\n    // this.zoomEnabledCheckbox.onClick = function (checked) {\n    //     this.mapChart.isZoomable = checked;\n    //     this.mapChart.update();\n    //     URLParameters.getInstance().setWithoutDeleting('map-zoomable', checked);\n    // }.bind(this);\n\n    this.centerButton = new Button(this.headerRightComponent);\n    this.centerButton.setText(Language.translate('Center'));\n    this.centerButton.hide();\n    this.centerButton.onClick = function (event) {\n      console.log(event);\n    }.bind(this);\n\n    this.screenshotButton = new Button(this.headerRightComponent);\n    this.screenshotButton.setText('Screenshot');\n    this.screenshotButton.element.classed('simple-button', true);\n    this.screenshotButton.setFontAwesomeImage('camera');\n    this.screenshotButton.onClick = this.screenshotButtonAction.bind(this);\n\n    this.moreButton = new Button(this.headerRightComponent);\n    this.moreButton.setText('More');\n    this.moreButton.element.classed('simple-button', true);\n    this.moreButton.setFontAwesomeImage('ellipsis-h');\n    this.moreButton.onClick = this.presentSettingsPopupAction.bind(this);\n\n  }\n\n  /**\n   *\n   */\n  renderMapChart() {\n    this.mapChart = new MapChart(this.body);\n    this.mapChart.loadGeoJSON('/assets/geojson/Departements-Simple.geojson');\n  }\n\n\n  // MARK: - Actions\n\n  /**\n   * Triggered when the screenshot button is pushed.\n   */\n  screenshotButtonAction() {\n    let name = 'my_image.jpg';\n    let chartID = this.mapChart.selector;\n    screenshotElement(\"#\" + chartID, name);\n  }\n\n  /**\n   * Triggered when the more button is pushed.\n   */\n  presentSettingsPopupAction() {\n    let application = window.frcvApp;\n    let button = document.getElementById(this.moreButton.selector);\n    let settingsPopup = new MapChartSettingsPopup(application.element);\n    settingsPopup.mapChart = this.mapChart;\n    settingsPopup.showUnder(button, 'right');\n  }\n}\n","import {Popup} from \"../components/popup\";\nimport {Language} from \"../language/language\";\nimport {Checkbox} from \"../components/checkbox\";\nimport {URLParameters} from \"../shared/url-parameters\";\n\n/**\n *\n * @class TrackPopup\n * @extends Popup\n */\nexport class TrackPopup extends Popup {\n\n    /**\n     *\n     */\n    render() {\n        super.render();\n        this.renderHeadline();\n        this.renderRow();\n\n        this.renderTrackContentContainer();\n    }\n\n    renderHeadline() {\n        this.card\n            .headerRow\n            .append('h3')\n            .text(Language.translate('Track'));\n    }\n\n    renderRow() {\n        this.row = this.card.body\n            .append('div')\n            .classed('row', true);\n    }\n\n    renderTrackContentContainer() {\n        this.lyricsContainer = this.row\n            .append('div')\n            .classed('col-12', true)\n            .append('p');\n    }\n\n    update() {\n        if (!this.track) return;\n        let input = this.searchWord;\n        // let content = this.track.components.map(function (word) {\n        //     if (word.toLowerCase() === input.toLowerCase()) {\n        //         return `<b class=\"important\">${word}</b>`\n        //     } else {\n        //         return word\n        //     }\n        // }).join(' ');\n        let content = String(this.track.content);\n        let lines = content.split('\\n');\n        let html = '';\n        for (let i = 0; i < lines.length; i++) {\n            let line = lines[i];\n            let words = line.split(' ');\n            for (let j = 0; j < words.length; j++) {\n                let word = words[j];\n                if (word.toLowerCase() === input.toLowerCase()) {\n                    html += `<b class=\"important\">${word}</b>`;\n                } else if (word.toLowerCase() === `${input},`.toLowerCase()) {\n                    html += `<b class=\"important\">${word}</b>`;\n                } else {\n                    html += word;\n                }\n                html += ' ';\n            }\n            html += '<br>';\n        }\n\n        this.lyricsContainer.html(html);\n    }\n\n    /**\n     *\n     * @returns {{width: number, height: number}}\n     */\n    preferredSize() {\n        return {\n            width: 800,\n            height: 600\n        };\n    }\n}\n","import {Card} from \"../components/card\";\nimport {TrackPopup} from \"./track-popup\";\n\n/**\n *\n * @class WordAboutCard\n * @extends Card\n */\nexport class WordAboutCard extends Card {\n\n    /**\n     * Creates a new instance of WordAboutCard.\n     *\n     * @param parent The parental component.\n     */\n    constructor(parent) {\n        super(parent);\n    }\n\n    update() {\n        this.body.html('');\n        if (!this.datasets) return;\n\n        this.divs = this.body\n            .selectAll('div')\n            .data(this.datasets)\n            .enter()\n            .append('div')\n            .html(function (dataset, index) {\n                let components = [];\n                if (index !== 0) { components.push(`<br>`); }\n                components.push(`<b class=\"larger\">`);\n                components.push(`${dataset.label}`);\n                components.push(` (${dataset.data.length} Tracks)`);\n                components.push(`</b>`);\n                return components.join('');\n            })\n            .selectAll(\"div\")\n            .data(function (dataset) {\n                dataset.data.forEach(item => item.dataset = dataset.label);\n                return dataset.data\n                    .sort(function (item1, item2) {\n                    return d3.descending(item1.releaseYear, item2.releaseYear);\n                });\n            })\n            .enter()\n            .append(\"div\")\n            .style('cursor', 'pointer')\n            .html(function (item) {\n                let components = [];\n                components.push(`<span class=\"primary\">${item.title}</span>`);\n                components.push(`<span class=\"secondary\">(by ${item.artist}, ${item.releaseYear})</span>`);\n                return `<li>${components.join(' ')}</li>`;\n            })\n            .on('click', function (event, item) {\n                let parent = window.frcvApp.element;\n                let popup = new TrackPopup(parent);\n\n                console.log(item);\n                popup.searchWord = item.dataset;\n                popup.track = item;\n                popup.update();\n                popup.showBigModal();\n            });\n    }\n}\n","\n/**\n *\n * @class DatasetCollection\n */\nexport class DatasetCollection extends Array {\n\n}\n","import {Page} from './page';\nimport {Button} from \"../components/button\";\nimport {SearchPageSettingsPopup} from \"./search-page-settings-popup\";\nimport {DiachronicChartCard} from \"../time-chart/diachronic-chart-card\";\nimport {SearchCard} from \"./search-card\";\nimport {RecentSearches} from \"../shared/recent-searches\";\nimport {URLParameters} from \"../shared/url-parameters\";\nimport {Language} from \"../language/language\";\nimport {randomColor} from \"../shared/colors\";\nimport {MapChartCard} from \"../location-chart/map-chart-card\";\nimport {WordAboutCard} from \"./word-about-card\";\nimport {DatasetCollection} from \"../data-model/dataset-collection\";\n\n/**\n *\n * @class SearchPage\n * @extends Page\n */\nexport class SearchPage extends Page {\n\n    /**\n     *\n     * @param application\n     */\n    constructor(application) {\n        super(application, Language.translate('Search'));\n        application.makeContainerFull();\n\n        this.renderSettingsButton();\n\n        this.renderSearchInputCard();\n        this.renderDiachronicChart();\n        this.renderMapChart();\n        this.renderWordAboutCard();\n\n        this.loadCorpusIfNeeded();\n        this.applyURLParameters();\n    }\n\n\n    // MARK: - Render\n\n    renderSettingsButton() {\n        this.settingsButton = new Button(this.rightHeaderContainer);\n        this.settingsButton.setText(Language.translate('Settings'));\n        this.settingsButton.element.classed('simple-button button-down', true);\n        let thisReference = this;\n        this.settingsButton.onClick = function (event) {\n            if (!event || !event.target) return;\n            let settingsPopup = new SearchPageSettingsPopup(thisReference.application.element);\n            settingsPopup.searchPage = thisReference;\n            settingsPopup.showUnder(event.target, 'right');\n        };\n    }\n\n    renderSearchInputCard() {\n        this.searchCardContainer = this.addContainer(this.row, 'col-12');\n        this.searchCard = new SearchCard(this.searchCardContainer);\n\n        let thisReference = this;\n        this.searchCard.startSearching = function () {\n            thisReference.startSearching();\n        };\n    }\n\n    renderDiachronicChart() {\n        this.diachronicChartCardContainer = this.addContainer(this.row, 'col-12 col-lg-6');\n        this.diachronicChartCard = new DiachronicChartCard(this.diachronicChartCardContainer, null);\n        this.diachronicChartCard.titleLabel.text(Language.translate('Chart'));\n        this.diachronicChart = this.diachronicChartCard.chart;\n        this.searchCard.diachronicChart = this.diachronicChart;\n        this.diachronicChart.margin = {top: 40, left: 40, bottom: 80, right: 40};\n        this.diachronicChartCard.footer.style('display', 'none');\n    }\n\n    renderMapChart() {\n        this.mapCardContainer = this.addContainer(this.row, 'col-12 col-lg-6');\n        this.mapChartCard = new MapChartCard(this.mapCardContainer);\n        this.mapChartCard.titleLabel.text(Language.translate('Map'));\n    }\n\n    renderWordAboutCard() {\n        this.wordAboutCardContainer = this.addContainer(this.row, 'col-12 col-lg-6');\n        this.wordAboutCard = new WordAboutCard(this.diachronicChartCardContainer);\n        this.wordAboutCard.titleLabel.text(Language.translate('Word About'));\n    }\n\n\n    // MARK: - Override Page\n\n    willLoadCorpus() {\n        super.willLoadCorpus();\n        this.loadingView = this.addLoadingView(this.row);\n        this.diachronicChartCardContainer.style('display', 'none');\n        this.mapCardContainer.style('display', 'none');\n    }\n\n    didLoadCorpus() {\n        super.didLoadCorpus();\n        this.loadingView.remove();\n        this.diachronicChartCardContainer.style('display', 'block');\n        this.mapCardContainer.style('display', 'block');\n        // this.mapChartCard.mapChart.setCorpus(this.application.corpus);\n\n\n        if (this.searchCard.getSearchText()) {\n            this.startSearching();\n        }\n    }\n\n\n    // MARK: - View Mode\n\n    useFullWidthMode() {\n        this.diachronicChartCardContainer\n            .classed('col-lg-12', true)\n            .classed('col-lg-6', false);\n        this.mapCardContainer\n            .classed('col-lg-12', true)\n            .classed('col-lg-6', false);\n        this.wordAboutCardContainer\n            .classed('col-lg-12', true)\n            .classed('col-lg-6', false);\n    }\n\n    useHalfWidthMode() {\n        this.diachronicChartCardContainer\n            .classed('col-lg-12', false)\n            .classed('col-lg-6', true);\n        this.mapCardContainer\n            .classed('col-lg-12', false)\n            .classed('col-lg-6', true);\n        this.wordAboutCardContainer\n            .classed('col-lg-12', false)\n            .classed('col-lg-6', true);\n    }\n\n    setViewMode(viewMode, save = false) {\n        this.viewMode = viewMode;\n        switch (viewMode) {\n            case 'full':\n                this.useFullWidthMode();\n                break;\n            case 'half':\n                this.useHalfWidthMode();\n                break;\n            default:\n                break;\n        }\n        if (save) {\n            localStorage.setItem(SearchPage.viewModeKey, viewMode);\n        }\n    }\n\n    applyURLParameters() {\n        let parameters = URLParameters.getInstance();\n        let searchText = parameters.getString(URLParameters.query);\n        let searchSensitivity = parameters.getString(URLParameters.searchSensitivity, 'case-insensitive');\n        let startYear = parameters.getString(URLParameters.startYear, '2000');\n        let endYear = parameters.getString(URLParameters.endYear, '2020');\n        let valueType = parameters.getString(URLParameters.valueType, 'relative');\n\n        this.searchCard.searchField.setText(searchText);\n        this.searchCard.sensitivityDropdown.setSelectedOption(searchSensitivity);\n        this.searchCard.yearStartDropdown.value = startYear;\n        this.searchCard.yearEndDropdown.value = endYear;\n        this.searchCard.valueType = valueType;\n        this.searchCard.valueRadioGroup.setSelectedOption(valueType);\n\n        let viewModeURL = URLParameters.getInstance().getString(URLParameters.searchViewMode);\n        let viewModeLocalStorage = localStorage.getItem(SearchPage.viewModeKey);\n\n        if (viewModeURL) {\n            this.setViewMode(viewModeURL);\n        } else if (viewModeLocalStorage) {\n            this.setViewMode(viewModeLocalStorage);\n        } else {\n            this.setViewMode('half');\n        }\n\n        let showChart = parameters.getBoolean('show-chart', true);\n        showChart ? this.showChart() : this.hideChart();\n        let showMap = parameters.getBoolean('show-map', true);\n        showMap ? this.showMap() : this.hideMap();\n    }\n\n    showChart() {\n        this.diachronicChartCard.element.style('display', 'block');\n    }\n\n    hideChart() {\n        this.diachronicChartCard.element.style('display', 'none');\n    }\n\n    showMap() {\n        this.mapChartCard.element.style('display', 'block');\n    }\n\n    hideMap() {\n        this.mapChartCard.element.style('display', 'none');\n    }\n\n    showWordAbout() {\n        this.wordAboutCard.element.style('display', 'block');\n    }\n\n    hideWordAbout() {\n        this.wordAboutCard.element.style('display', 'none');\n    }\n\n\n    // MARK: - Search\n\n    startSearching() {\n        if (!this.application.isCorpusLoaded()) return;\n\n        let searchText = this.searchCard.getSearchText();\n        let searchField = this.searchCard.searchField;\n\n        if (searchText === undefined) {\n            return console.log('search text undefined');\n        } else if (searchText.trim().length === 0) {\n            return console.log('search text too short');\n        }\n\n        RecentSearches.getInstance().append(searchText);\n        searchField.updateRecentSearches();\n\n        this.searchFor(searchText);\n    }\n\n    searchFor(searchQuery) {\n\n        // clean search query\n        let groups = searchQuery.split(';').map(value => value.trim());\n        groups = groups.map(group => group.split(',').map(word => word.trim()).join(','));\n        groups = groups.map(group => group.trim());\n        let searchTextFormatted = groups.join(';');\n\n        let localDatasets = [];\n        let mapDatasets = [];\n        let trackDatasets = new DatasetCollection();\n\n        for (let i = 0; i < groups.length; i++) {\n            let group = groups[i];\n            let words = group.split(',').map(value => value.trim());\n            let stack = words.join(\", \");\n\n            for (let j = 0; j < words.length; j++) {\n\n                let searchWord = words[j];\n                let datasetObject = this.datasetFor(searchWord);\n                let data = datasetObject.chartData;\n                let mapData = datasetObject.mapData;\n                let tracks = datasetObject.tracks;\n\n                let newDataset = {\n                    label: searchWord,\n                    stack: stack,\n                    data: data\n                };\n\n                if (this.searchCard.valueType === 'relative') {\n                    data.forEach(item => item.value = (item.value / item.yearTotal));\n                }\n\n                let mapDataset = {\n                    label: searchWord,\n                    stack: stack,\n                    data: mapData\n                };\n\n                localDatasets.push(newDataset);\n\n                mapDatasets.push(mapDataset);\n\n                trackDatasets.push({\n                    label: searchWord,\n                    stack: stack,\n                    data: tracks\n                });\n            }\n        }\n\n        this.diachronicChart.datasets = localDatasets;\n        this.diachronicChart.update();\n\n        this.mapChartCard.mapChart.datasets = mapDatasets;\n        this.mapChartCard.mapChart.update();\n\n        this.wordAboutCard.datasets = trackDatasets;\n        this.wordAboutCard.update();\n\n        URLParameters.getInstance().set(URLParameters.query, searchTextFormatted);\n    }\n\n    datasetFor(searchText) {\n        let sensitivity = this.searchCard.sensitivity;\n        let firstYear = this.searchCard.firstYear;\n        let lastYear = this.searchCard.lastYear;\n\n        let corpus = this.application.corpus;\n        let tracks = corpus.tracksForWord(searchText, sensitivity);\n\n        tracks = tracks.filter(function (track) {\n            return track.releaseYear >= firstYear\n                && track.releaseYear <= lastYear;\n        });\n\n        let mapData = corpus.getMapDataForTracks(tracks);\n        mapData.forEach((item) => item.datasetName = searchText);\n\n\n        // mapData.forEach((item) => item.stack = searchText);\n        // mapData.searchText = searchText;\n\n        let chartData = corpus.getChartDataForTracks(\n            tracks,\n            firstYear,\n            lastYear,\n            sensitivity\n        );\n\n        return {\n            mapData: mapData,\n            chartData: chartData,\n            searchText: searchText,\n            tracks: tracks\n        };\n    }\n\n    applyMapData(mapData) {\n        let color = randomColor();\n        for (let i = 0; i < mapData.length; i++) {\n            const entry = mapData[i];\n            const departementNumber = entry.departementNumber;\n            const numberOfLyrics = entry.value;\n            if (numberOfLyrics === 0) {\n                continue;\n            }\n            const departement = this.application.getDepartementForNumber(departementNumber);\n            this.mapChart.drawDepartement(departement, color, \"\" + numberOfLyrics);\n        }\n    }\n}\n\nSearchPage.viewModeKey = 'de.beuth.frc-visualization.SearchPageViewMode';\n","import {Page} from './page';\nimport {Language} from \"../language/language\";\n\n/**\n *\n */\nexport class CorpusDataPage extends Page {\n    constructor(application) {\n        super(application, Language.translate('Corpus Metadata'));\n        // this.buildSubpage();\n        this.createLeftPanel();\n        this.createCard();\n        this.loadCorpusIfNeeded();\n    }\n\n    willLoadCorpus() {\n        super.willLoadCorpus();\n        this.loadingView = this.addLoadingView(this.cardBody);\n    }\n\n    didLoadCorpus() {\n        super.didLoadCorpus();\n        this.loadingView.remove();\n        this.update();\n    }\n\n    createLeftPanel() {\n        this.leftPanel = this.addContainer(this.row, 'col-lg-3');\n        this.titleLabel = this.leftPanel\n            .append('h1')\n            .text(this.title);\n    }\n\n    createCard() {\n        this.wrapper = this.addContainer(this.row, 'col-lg-6 col-12');\n        this.card = this.addContainer(this.wrapper, 'card card-corpus-metadata');\n        this.cardBody = this.addContainer(this.card, 'card-body');\n        this.cardBodyRow = this.addRow(this.cardBody);\n    }\n\n    update() {\n        this.clearContent();\n        let corpus = this.application.corpus;\n        this.currentGroup = this.createGroup();\n        this.createLine('# Artists', corpus.artists.length);\n        this.createLine('# Female Artists', corpus.femaleArtists().length);\n        this.createLine('# Male Artists', corpus.maleArtists().length);\n        this.createLine('# Group Artists', corpus.groupArtists().length);\n        this.currentGroup = this.createGroup();\n        this.createLine('# Albums', corpus.allAlbums().length);\n        this.currentGroup = this.createGroup();\n        this.createLine('# Tracks w/o Album', corpus.allTracksWithoutAlbum().length);\n        this.createLine('# Tracks', corpus.allTracks().length);\n        this.currentGroup = this.createGroup();\n        this.createLine('# Words', corpus.allWords().length);\n    }\n\n    createGroup() {\n        return this.addContainer(this.cardBodyRow, 'group');\n    }\n\n    createLine(title, value) {\n        let row = this.currentGroup\n            .append('div')\n            .classed('row text-vertical-center', true);\n        row.append('div')\n            .classed('col-6 text-end label', true)\n            .text(appendColon(title));\n        row.append('div')\n            .classed('col-6', true)\n            .append('samp')\n            .text(value);\n    }\n\n    clearContent() {\n        this.cardBody.selectAll('div').remove();\n        this.cardBodyRow = this.addRow(this.cardBody);\n    }\n}\n\nfunction appendColon(text) {\n    return text.endsWith(':') ? text : text + ':';\n}\n","import {Page} from './page';\nimport {Language} from \"../language/language\";\n\n/**\n * The main page of the application.\n *\n * @class MainPage\n * @extends Page\n */\nexport class MainPage extends Page {\n\n    /**\n     * Creates a new instance.\n     *\n     * @param application\n     */\n    constructor(application) {\n        super(application, 'Main');\n        if (!application) {\n            throw 'No application given.';\n        }\n        this.application = application;\n        this.element = application.element;\n        this.renderLeftTitleComponent();\n        this.renderCard();\n        this.renderMenuItems();\n        this.hideBackButton();\n        this.fetchServerInfo();\n\n        this.updateFooterURL();\n        this.updateFooterDebugInfo();\n    }\n\n    /**\n     *\n     */\n    renderLeftTitleComponent() {\n\n        this.titleContainer = this.row\n            .append('div')\n            .classed('col-lg-3', true);\n\n        let title = this.application.delegate.name;\n        this.titleLabel = this.titleContainer\n            .append('h1')\n            .text(title);\n\n        this.titleInfoBox = this.titleContainer\n            .append('div')\n            .classed('info-box', true);\n\n        // this.versionLabel = this.titleInfoBox\n        //     // .append('p')\n        //     // .classed('margin-bottom margin-top', true)\n        //     .append('samp')\n        //     .text(Language.translate('Version') + ': ')\n        //     .append('samp')\n        //     .attr('id', 'version-label')\n        //     .text('-');\n        //\n        // this.environmentLabel = this.titleInfoBox\n        //     // .append('p')\n        //     // .classed('margin-bottom margin-top', true)\n        //     .append('samp')\n        //     .text(Language.translate('Server') + ': ')\n        //     .append('samp')\n        //     .attr('id', 'environment-label')\n        //     .text('-');\n\n    }\n\n    renderCard() {\n        this.menuCard = this.row\n            .append('div')\n            .classed('col-6', true)\n            .append('div')\n            .classed('card card-inset menu', true);\n    }\n\n    renderMenuItems() {\n        let application = this.application;\n        let pages = [\n            ['search', Language.translate('Search')],\n            ['diachronic-data', Language.translate('Diachronic Data')],\n            ['diatopic-data', Language.translate('Diatopic Data')],\n            ['corpus-data', Language.translate('Corpus Data')],\n            ['artists-data', Language.translate('Artists Data')]\n        ];\n\n        for (let i = 0; i < pages.length; i++) {\n            let pageItem = pages[i];\n            let pageId = pageItem[0];\n            let pageTitle = pageItem[1];\n            this.addMenuButton(pageTitle, function () {\n                application.showPage(pageId, true);\n            });\n        }\n    }\n\n    addMenuButton(name, functionToCall) {\n        let link = this.menuCard\n            .append('a')\n            .text(name)\n            .on('click', function () {\n                if (!functionToCall)\n                    return;\n                functionToCall();\n            });\n        this.menuCard.append('br');\n        return link;\n    }\n\n    fetchServerInfo() {\n        let thisReference = this;\n        fetch(\"info\")\n            .then(response => response.json())\n            .then(function (json) {\n                thisReference.versionLabel\n                    .text(json.application_version);\n                thisReference.environmentLabel\n                    .text(json.environment);\n            });\n    }\n}\n","import {Page} from './page';\nimport {DiachronicChartCard} from \"../time-chart/diachronic-chart-card\";\nimport {RadioGroup} from \"../components/radio-group\";\nimport {Language} from \"../language/language\";\nimport {URLParameters} from \"../shared/url-parameters\";\n\n/**\n * An application page which presents information about the diachronic data of the corpus.\n *\n * @class DiachronicAboutPage\n * @extends Page\n */\nexport class DiachronicAboutPage extends Page {\n\n    /**\n     * Creates a new instance.\n     *\n     * @param application The main application.\n     */\n    constructor(application) {\n        super(application, Language.translate('Diachronic About'));\n        this.contentType = 'tracks';\n        this.buildSubpage();\n        this.renderDiachronicChart();\n        this.renderContentRadioGroup();\n        this.applyURLParameters();\n        this.loadCorpusIfNeeded();\n    }\n\n    /**\n     * Appends a chart wrapper and a chart cart containing the chart to the main row.\n     */\n    renderDiachronicChart() {\n        this.chartWrapper = this\n            .addContainer(this.row, 'col-12')\n            .append('div');\n\n        this.chartCard = new DiachronicChartCard(this.chartWrapper, 'Chart');\n        this.chart = this.chartCard.chart;\n        this.chartCard.chart.margin = {\n            top: 60, left: 50, bottom: 70, right: 50\n        };\n    }\n\n    /**\n     * Appends a radio group to specify the presentet content type.\n     */\n    renderContentRadioGroup() {\n        this.radioGroup = new RadioGroup(this.chartCard.headerCenterComponent);\n        this.radioGroup.setOptions([\n            ['tracks', Language.translate('Tracks')],\n            ['words', Language.translate('Words')],\n            ['words-relative', Language.translate('Words (Relative)')],\n            ['types', Language.translate('Types')],\n            ['types-relative', Language.translate('Types (Relative)')],\n        ]);\n\n        this.radioGroup.onChange = function (value) {\n            this.contentType = value;\n            this.update();\n        }.bind(this);\n    }\n\n    // MARK: - Override Page\n\n    willLoadCorpus() {\n        super.willLoadCorpus();\n        this.showLoadingView();\n    }\n\n    didLoadCorpus() {\n        super.didLoadCorpus();\n        this.hideLoadingView();\n        this.update();\n    }\n\n    applyURLParameters() {\n        this.contentType = URLParameters.getInstance().getString(\n            URLParameters.contentType, 'tracks');\n        this.radioGroup.setSelectedOption(this.contentType);\n    }\n\n    // MARK: - Funtions\n\n    update() {\n        let corpus = this.application.corpus;\n        if (!corpus) return;\n        this.setCorpus(corpus);\n    }\n\n    contentTypeDidChange() {\n\n    }\n\n    setCorpus(corpus) {\n        let yearCollection;\n        switch (this.contentType) {\n            case 'tracks':\n                yearCollection = corpus.getLyricsPerYear();\n                break;\n            case 'words':\n                yearCollection = corpus.getWordsPerYear();\n                break;\n            case 'words-relative':\n                yearCollection = corpus.getWordsPerYearRelative();\n                break;\n            case 'types':\n                yearCollection = corpus.getTypesPerYear();\n                break;\n            case 'types-relative':\n                yearCollection = corpus.getTypesPerYearRelative();\n                break;\n            case 'non-standard':\n                yearCollection = corpus.getTotalNonStandardPerYearCount();\n                break;\n            default:\n                yearCollection = [];\n                break;\n        }\n\n        URLParameters.getInstance().set(URLParameters.contentType, this.contentType);\n\n        let title = this.contentType.capitalize();\n        let dataset = {\n            label: title,\n            stack: title,\n            data: []\n        };\n\n        let firstYear = d3.min(Object.keys(yearCollection));\n        let lastYear = d3.max(Object.keys(yearCollection));\n\n        for (let year = firstYear; year <= lastYear; year++) {\n            dataset.data.push({\n                year: year,\n                value: yearCollection[year] || 0,\n                yearTotal: yearCollection[year] || 0\n            });\n        }\n\n        this.chart.datasets = [dataset];\n        this.chart.update();\n    }\n}\n\n// MARK: - Extension of String\n\nString.prototype.capitalize = function () {\n    return this.charAt(0).toUpperCase() + this.slice(1);\n};\n","import {Page} from './page';\nimport {RadioGroup} from \"../components/radio-group\";\nimport {Card} from \"../components/card\";\nimport {colorsForStack} from \"../shared/colors\";\n\n/**\n *\n * @class ArtistsDataPage\n * @extends Page\n */\nexport class ArtistsDataPage extends Page {\n\n    /**\n     *\n     * @param application\n     */\n    constructor(application) {\n        super(application, 'Artists Metadata');\n\n\n        this.buildSubpage();\n        this.createCard();\n        this.createContentTypeRadioGroup();\n        this.valueGettingFunction = this.numberOfTypes;\n\n        this.initialize();\n        this.renderSVG();\n        this.renderTooltip();\n\n        this.loadCorpusIfNeeded();\n    }\n\n    initialize() {\n        this.width = 1000;\n        this.margin = {top: 20, right: 70, bottom: 50, left: 180};\n        this.graphWidth = this.width - this.margin.left - this.margin.right;\n        this.lineHeight = 18;\n    }\n\n    renderSVG() {\n        this.chartView = this.card.content;\n        this.svg = this.chartView\n            .append(\"svg\");\n        this.graph = this.svg\n            .append(\"g\")\n            .attr(\"transform\", \"translate(\" + this.margin.left + \",\" + this.margin.top + \")\");\n    }\n\n    renderTooltip() {\n        this.tooltip = this.card.content\n            .append(\"div\")\n            .attr(\"class\", \"tooltip map-tooltip\")\n            .style(\"position\", \"absolute\")\n            .style(\"border\", \"1px solid #69b3a2\")\n            .style(\"display\", \"none\");\n    }\n\n    buildVisual(data) {\n        const margin = this.margin;\n        const max = d3.max(data, (item) => item.value);\n        const colorString = colorsForStack(0, 1)[0].rgbString();\n\n        this.graphHeight = (this.lineHeight * data.length);\n        this.height = this.graphHeight + (margin.top + margin.bottom);\n\n        this.graph.selectAll('g').remove();\n        this.graph.selectAll('text').remove();\n        this.graph.selectAll('rect').remove();\n\n        this.svg.attr('viewBox', `0 0 ${this.width} ${this.height}`);\n\n        const x = d3.scaleLinear()\n            .domain([0, max])\n            .range([0, this.graphWidth]);\n\n        const y = d3.scaleBand()\n            .range([0, this.graphHeight])\n            .domain(data.map((item) => `${item.name} (${item.geniusId})`))\n            .padding(.1);\n\n        this.graph\n            .append(\"g\")\n            .attr(\"transform\", \"translate(0,\" + this.graphHeight + \")\")\n            .call(d3.axisBottom(x))\n            .selectAll(\"text\")\n            .attr(\"transform\", \"translate(-10,0)rotate(-45)\")\n            .style(\"text-anchor\", \"end\");\n\n        this.graph\n            .append(\"g\")\n            .call(d3.axisLeft(y));\n\n        const barGroup = this.graph\n            .selectAll(\"chart-rect\")\n            .data(data)\n            .enter()\n            .append(\"rect\")\n            .classed(\"chart-rect\", true);\n\n        barGroup\n            .attr(\"x\", x(0))\n            .attr(\"y\", (item) => y(`${item.name} (${item.geniusId})`))\n            .attr(\"width\", (item) => x(item.value))\n            .attr(\"height\", y.bandwidth())\n            .attr(\"fill\", colorString)\n            .attr(\"rx\", \"4\")\n            .attr(\"ry\", this.lineHeight / 2);\n\n        barGroup\n            .on(\"mousemove\", function (event, item) {\n\n                this.tooltip\n                    .style(\"display\", \"inline-block\")\n                    .html('Value: ' + (item.value) + \"<br>Artist: \" + item.name);\n\n                let tooltipWidth = this.tooltip.style('width').replace('px', '');\n\n                let element = document.getElementById('content');\n                let offset = element.getBoundingClientRect();\n\n                let width = this.chartView.style('width').replace('px', '');\n                let ratio = width / 1000;\n                console.log('ratio: ' + ratio);\n\n                let xPos = x(item.value) / 2;\n                xPos += offset.x;\n                xPos *= ratio;\n                xPos += margin.left;\n                xPos += window.scrollX;\n                xPos -= tooltipWidth / 2;\n\n                let yPos = y(`${item.name} (${item.geniusId})`);\n                yPos += margin.top;\n                yPos *= ratio;\n                yPos += offset.y;\n                yPos += this.lineHeight;\n                yPos += window.scrollY;\n\n                this.tooltip\n                    .style(\"left\", xPos + \"px\")\n                    .style(\"top\", yPos + \"px\")\n                    .style(\"position\", \"absolute\")\n                    .style(\"border\", \"1px solid #69b3a2\")\n                    .style(\"display\", \"inline-block\")\n                    .html('Value: ' + (item.value) + \"<br>Artist: \" + item.name);\n            }.bind(this))\n            .on(\"mouseout\", function (d) {\n                this.tooltip.style(\"display\", \"none\");\n            }.bind(this));\n\n        this.graph\n            .selectAll(\".text\")\n            .data(data)\n            .enter()\n            .append('text')\n            .text((item) => item.value)\n            .attr(\"x\", (item) => x(item.value))\n            .attr(\"y\", (item) => y(`${item.name} (${item.geniusId})`))\n            .attr('dy', this.lineHeight - 6)\n            .attr('dx', '6')\n            .attr(\"width\", (item) => x(item.value))\n            .attr(\"height\", y.bandwidth())\n            .attr(\"font-size\", 13)\n            .attr('fill', 'gray');\n\n    }\n\n    /**\n     *\n     */\n    willLoadCorpus() {\n        super.willLoadCorpus();\n        this.loadingView = this.addLoadingView(this.card.body);\n    }\n\n    /**\n     *\n     */\n    didLoadCorpus() {\n        super.didLoadCorpus();\n        this.update();\n        this.loadingView.remove();\n    }\n\n    /**\n     *\n     */\n    createCard() {\n        this.cardContainer = this.addContainer(this.row, 'col-12');\n        this.card = new Card(this.cardContainer);\n    }\n\n    /**\n     *\n     */\n    createContentTypeRadioGroup() {\n\n        this.card.headerCenterComponent\n            .classed('text-center', true)\n            .append('div')\n            .attr('id', 'radio-group-2');\n\n        this.radioGroup = new RadioGroup(this.card.headerCenterComponent);\n        this.radioGroup.setOptions([\n            ['types', 'Types'],\n            ['words', 'Words'],\n            ['tracks', 'Tracks'],\n            ['albums', 'Albums']\n        ]);\n\n        this.radioGroup.onChange = function (value) {\n            this.chartTypeAction(value);\n        }.bind(this);\n    }\n\n    chartTypeAction(value) {\n        console.log(\"value: \" + value);\n        switch (value) {\n            case 'types':\n                this.valueGettingFunction = this.numberOfTypes;\n                break;\n            case 'words':\n                this.valueGettingFunction = this.numberOfWords;\n                break;\n            case 'tracks':\n                this.valueGettingFunction = this.numberOfTracks;\n                break;\n            case 'albums':\n                this.valueGettingFunction = this.numberOfAlbums;\n                break;\n            default:\n                console.log(\"unknown chart type: \" + value);\n                break;\n        }\n        this.update();\n    }\n\n    numberOfTypes(artist) {\n        return (new Set(artist.allWords())).size;\n    }\n\n    numberOfWords(artist) {\n        return artist.allWords().length;\n    }\n\n    numberOfTracks(artist) {\n        return artist.allTracks().length;\n    }\n\n    numberOfAlbums(artist) {\n        return artist.albums.length;\n    }\n\n    update() {\n        let corpus = this.application.corpus;\n        if (!corpus) return;\n\n        const root2 = d3.hierarchy(corpus.artists);\n        const artists = corpus.artists\n            .filter((artists) => artists.allTracks().length > 0)\n            .reverse();\n\n        let data = [];\n        for (let i = 0; i < artists.length; i++) {\n            let artist = artists[i];\n            let artistName = artist.name;\n            let value = this.valueGettingFunction(artist);\n            data.push({\n                name: artistName,\n                geniusId: artist.geniusId,\n                departement: artist.departement,\n                departementNo: artist.departementNo,\n                value: Number(value)\n            });\n        }\n\n        data = d3.sort(data, function (a, b) {\n            return b.value - a.value;\n        });\n\n        const countAll = data.length;\n        data = data.filter((item) => item.value > 0);\n\n        const countFiltered = data.length;\n        console.log(\"countAll: \" + countAll);\n        console.log(\"countFiltered: \" + countFiltered);\n        this.buildVisual(data);\n\n    }\n\n    buildHistogram(data) {\n        // const max = d3.max(data, (item: any) => item.value);\n        // const height = 500;\n        // const width = 1000;\n        // const margin = {top: 50, right: 50, bottom: 50, left: 50};\n        //\n        // const histogramView = d3.select(\".histogram\");\n        // histogramView.selectAll('svg').remove();\n        //\n        // const svg = histogramView\n        //     .append(\"svg\")\n        //     .attr(\"width\", width)\n        //     .attr(\"height\", height + margin.top + margin.bottom)\n        //     .append(\"g\")\n        //     .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n        //\n        // const x = d3.scaleLinear()\n        //     .domain([0, max])\n        //     .range([0, width]);\n        //\n        // svg.append(\"g\")\n        //     .attr(\"transform\", \"translate(0,\" + height + \")\")\n        //     .call(d3.axisBottom(x));\n        //\n        // const histogram = d3.histogram()\n        //     .value((item: any) => item.value)\n        //     .domain(this.x.domain())\n        //     .thresholds(x.ticks(50));\n        //\n        // const bins = histogram(data);\n        //\n        // const y = d3.scaleLinear()\n        //     .range([height, 0]);\n        //\n        // y.domain([0, d3.max(bins, function (d) {\n        //     // @ts-ignore\n        //     return d.length;\n        // })]);   // d3.hist has to be called before the Y axis obviously\n        //\n        // svg.append(\"g\")\n        //     .call(d3.axisLeft(y));\n        //\n        // svg.selectAll(\"myRect\")\n        //     .data(bins)\n        //     .enter()\n        //     .append(\"rect\")\n        //     .attr(\"x\", 1)\n        //     .attr(\"transform\", function (d: any) {\n        //         return \"translate(\" + x(d.x0) + \",\" + y(d.length) + \")\";\n        //     })\n        //     .attr(\"width\", (d: any) => Math.max(0, x(d.x1) - x(d.x0) - 1))\n        //     .attr(\"height\", function (d: any) {\n        //         return height - y(d.length);\n        //     })\n        //     .style(\"fill\", \"#69b3a2\");\n    }\n}\n","import {Page} from \"./page\";\nimport {Language} from \"../language/language\";\nimport {MapChartCard} from \"../location-chart/map-chart-card\";\nimport {URLParameters} from \"../shared/url-parameters\";\n\n/**\n *\n * @class LocationDataPage\n * @extends Page\n */\nexport class LocationDataPage extends Page {\n\n  constructor(application) {\n    let title = Language.translate('Location Data');\n    super(application, title);\n\n    this.buildSubpage();\n    this.applyURLParameters();\n    this.loadGeoJSONFromDelegate();\n  }\n\n  renderBody() {\n    super.renderBody();\n    this.mapChartContainer = this.row.append('div').classed('col-12', true);\n    this.mapChartCard = new MapChartCard(this.mapChartContainer);\n    this.mapChartCard.titleLabel.text(Language.translate('Map'));\n    this.mapChartCard.mapChart.isDrawsBackground = false;\n    this.mapChartCard.mapChart.isShowLabels = true;\n    this.mapChartCard.mapChart.isZoomable = false;\n  }\n\n  didLoadCorpus() {\n    super.didLoadCorpus();\n\n    let mapChart = this.mapChartCard.mapChart;\n    let corpus = this.application.corpus;\n    let departmentData = corpus.getDepartementsData();\n    let data = [];\n\n    departmentData.forEach(function (departmentData) {\n      data.push({\n        departmentName: departmentData.departmentName,\n        dlabel: departmentData.departmentNumber,\n        value: departmentData.value,\n      });\n    });\n\n    let dataset = {\n      dlabel: 'Total Lyrics',\n      stack: 'Total Lyrics',\n      data: data\n    };\n\n    mapChart.setDatasets([dataset]);\n  }\n\n  applyURLParameters() {\n    let parameters = URLParameters.getInstance();\n    let showLabels = parameters.getBoolean('map-show-labels', true);\n    this.mapChartCard.mapChart.isShowLabels = showLabels;\n    this.mapChartCard.mapChart.update();\n  }\n\n  loadGeoJSONFromDelegate() {\n    let url = this.application.delegate.geoJSON;\n    this.mapChartCard.mapChart.loadGeoJSON(url);\n  }\n}\n","\nexport class DataDelegate {\n\n  constructor() {\n  }\n}\n\n","import {DataDelegate} from \"./data-delegate\";\n\n/**\n * @class DefaultDataDelegate\n * @extends DataDelegate\n */\nexport class DefaultDataDelegate extends DataDelegate {\n\n  constructor() {\n    super();\n    this.name = 'Lotivis';\n  }\n}\n","import {SearchPage} from './pages/search-page';\nimport {CorpusDataPage} from './pages/corpus-data-page';\nimport {MainPage} from \"./pages/main-page\";\nimport {DiachronicAboutPage} from \"./pages/diachronic-about-page\";\nimport {ArtistsDataPage} from \"./pages/artists-data-page\";\nimport {URLParameters} from \"./shared/url-parameters\";\nimport {Language} from \"./language/language\";\nimport {LocationDataPage} from \"./pages/location-data-page\";\nimport {DataDelegate} from \"./data-source/data-delegate\";\nimport {DefaultDataDelegate} from \"./data-source/default-data-delegate\";\n\n/**\n *\n * @class Application\n */\nexport class Application {\n\n  /**\n   * Creates a new instance in the container with the given id.\n   *\n   * @param selector The id of the `div` element.\n   * @param delegate A data delegate which provides data for the app.\n   */\n    constructor(selector, delegate) {\n        if (!selector) throw 'No selector specified.';\n        if (!delegate) delegate = new DefaultDataDelegate();\n\n        this.selector = selector;\n        this.delegate = delegate;\n\n        this.willInitialize();\n        this.initialize();\n        this.didInitialize();\n\n        Application.default = this;\n    }\n\n\n    // MARK: - Life Cycle\n\n    willInitialize() {\n        // console.clear();\n    }\n\n    initialize() {\n        this.element = d3\n            .select(`#${this.selector}`)\n            .classed('container', true);\n        window.frcvApp = this;\n        window.frcvConfig = {};\n\n        let parameters = URLParameters.getInstance();\n        let language = parameters.getString(URLParameters.language, Language.English);\n        Language.setLanguage(language);\n    }\n\n    didInitialize() {\n        this.loadPage();\n    }\n\n    // MARK: - Load Page\n\n    clearContainer() {\n        document.getElementById(this.selector).innerHTML = '';\n    }\n\n    loadPage() {\n        let page = URLParameters.getInstance().getString(URLParameters.page, 'main');\n        this.showPage(page, false);\n    }\n\n    showPage(selector, updateHistory = false) {\n        this.clearContainer();\n        if (updateHistory) {\n            URLParameters.getInstance().clear();\n            URLParameters.getInstance().set(URLParameters.page, selector);\n            URLParameters.getInstance().set(URLParameters.language, Language.language);\n        }\n\n        this.currentPageSelector = selector;\n\n        switch (selector) {\n            case 'search':\n                this.currentPage = new SearchPage(this);\n                break;\n            case 'about':\n                this.currentPage = new AboutPage(this);\n                break;\n            case 'corpus-data':\n                this.currentPage = new CorpusDataPage(this);\n                break;\n            case 'artists-data':\n                this.currentPage = new ArtistsDataPage(this);\n                break;\n            case 'diachronic-data':\n                this.currentPage = new DiachronicAboutPage(this);\n                break;\n            case 'diatopic-data':\n                this.currentPage = new LocationDataPage(this);\n                break;\n            default:\n                this.currentPage = new MainPage(this);\n                this.currentPageSelector = 'main';\n                break;\n        }\n    }\n\n    reloadPage() {\n        this.showPage(this.currentPageSelector);\n    }\n\n    makeFluit() {\n        this.element.classed('container-fluit', true);\n        this.element.classed('container', false);\n    }\n\n    makeUnfluit() {\n        this.element.classed('container-fluit', false);\n        this.element.classed('container', true);\n    }\n\n    // Corpus\n\n    isCorpusLoaded() {\n        return this.corpus !== undefined;\n    }\n\n    loadCorpus(completion) {\n        let thisReference = this;\n        this.isLoading = true;\n        let url = \"../../corpus/original\";\n        d3.json(url)\n            .then(function (json) {\n                // thisReference.corpus = new Corpus(json);\n                // thisReference.isLoading = false;\n                // thisReference.fetchDepartements(completion);\n            });\n    }\n\n    fetchDepartements(completion) {\n        let thisReference = this;\n        this.isFetchingDepartements = true;\n        fetch(\"../../departements\")\n            .then(response => response.json())\n            .then(function (json) {\n                thisReference.departements = json;\n                thisReference.corpus.departements = json;\n                thisReference.isFetchingDepartements = false;\n                if (completion) {\n                    completion();\n                }\n            });\n    }\n\n    getDepartementForNumber(departementNumber) {\n        for (let i = 0; i < this.departements.length; i++) {\n            const departement = this.departements[i];\n            if (departementNumber === departement.deptCode) {\n                return departement;\n            }\n        }\n\n        return null;\n    }\n\n    makeContainerNormal() {\n        this.element.classed('container-full', false);\n        this.element.classed('container', true);\n    }\n\n    makeContainerFull() {\n        this.element.classed('container', false);\n        this.element.classed('container-full', true);\n    }\n}\n\nclass MenuItem {\n\n}\n\nApplication.Pages = {\n\n};\n\nexports.DataDelegate = DataDelegate;\n"],"names":["createUUID","usedIDs","generate","replace","c","r","Math","random","toString","uuid","indexOf","Component","[object Object]","parent","this","selector","element","style","isVisible","Button","super","thisRef","append","attr","on","event","onClick","text","imageName","html","URLParameters","instance","URL","window","location","href","parameter","defaultValue","value","getURL","searchParams","get","newValue","url","delete","set","history","replaceState","updateCurrentPageFooter","newPath","protocol","host","newURL","Application","default","currentPage","updateFooter","language","page","query","searchViewMode","chartType","chartShowLabels","chartCombineStacks","contentType","valueType","searchSensitivity","startYear","endYear","showTestData","Strings","greeting","French Rap Corpus Visualization","Version","Server","Search","Diachronic Data","Diatopic Data","Corpus Data","Artists Data","About the Project","Click on URL to copy it to clipboard","Tracks","Words","Words (Relative)","Types","Types (Relative)","true","false","Back","Loading...","Settings","Chart","Close","Half","Full","from","till","Relative","Absolute","Innovation List","View Mode","Map","Impress","Privacy Policy","Corpus loaded status","Language","Diachronic About","Corpus Metadata","Artists Metadata","About","English","German","French","strings","Strings_en_EN","setLanguage","Strings_de_DE","Strings_fr_FR","translate","string","repeat","length","RadioGroup","inputElements","classed","optionId","optionName","inputElement","thisReference","options","removeOptions","i","id","name","translatedTitle","addOption","push","selectedOption","selectAll","remove","target","onChange","Card","createHeader","createBody","createFooter","header","headerRow","headerLeftComponent","headerCenterComponent","headerRightComponent","titleLabel","body","content","footer","footerRow","footerLeftComponent","footerRightComponent","Popup","renderUnderground","renderContainer","renderCard","render","renderCloseButton","addCloseActionListeners","modalBackgroundId","modalBackground","elementId","card","closeButton","setText","validIDs","popup","includes","dismiss","willShow","getUnderground","display","didShow","willDismiss","willRemoveDOMElement","document","getElementById","sourceElement","position","preferredSize","origin","calculateBottomCenter","x","width","left","top","y","show","margin","height","respectWindowScroll","rect","getBoundingClientRect","scrollX","scrollY","ModalPopup","renderRow","row","console","log","d3","then","catch","error","Page","application","title","renderHeader","renderBody","renderFooter","makeContainerNormal","centerHeaderContainer","toParent","addContainer","classes","newTitle","addRow","leftHeaderContainer","rightHeaderContainer","backButton","addBackButton","footerLinksContainer","presentModalPopup","bind","contentURL","frcvApp","impressPopup","loadContent","showBigModal","footerURLContainer","footerTooltipContainer","footerURLLabel","copyLocationToClipboard","footerURLLabelTooltip","urlPath","navigator","clipboard","writeText","err","footerCorpusInfoContainer","footerDebugLabel","updateFooterDebugInfo","footerLanguageInfoContainer","footerLanguageLabel","footerLanguageRadioGroup","setOptions","getInstance","reloadPage","setSelectedOption","renderFooterRow","renderFooterLinks","renderFooterURL","renderFooterCorpusInfo","renderFooterLanguageInfo","updateFooterURL","label","isCorpusLoaded","valueTranslated","loadingView","addLoadingView","button","applicationReference","showPage","willLoadCorpus","didLoadCorpus","ref","loadCorpus","Option","Checkbox","renderInput","renderLabel","checkbox","checked","SearchPageSettingsPopup","renderViewRadioGroup","renderShowChartCheckbox","renderShowMapCheckbox","renderShowWordAboutCheckbox","viewRadioGroupLabel","viewRadioGroupContainer","viewRadioGroup","searchPage","setViewMode","showChartCheckboxLabel","showChartCheckboxContainer","showChartCheckbox","showChart","hideChart","setWithoutDeleting","showMapCheckboxLabel","showMapCheckboxContainer","showMapCheckbox","showMap","hideMap","showWordAboutCheckboxLabel","showWordAboutCheckboxContainer","showWordAboutCheckbox","showWordAbout","hideWordAbout","loadValues","viewMode","setChecked","diachronicChartCard","mapChartCard","wordAboutCard","ViewMode","Color","g","b","round","colorsForStack","stack","amount","Number","isInteger","stackColors","usedAmount","max","highColor","lowColor","redStep","greenStep","blueStep","colors","newColor","colorAdding","organgeLow","organgeHigh","redLow","redHigh","blueLow","blueHigh","lightBlueLow","lightBlueHight","greenLow","greenHight","TestData","datasets","data","year","yearTotal","DiachronicChart","Object","getPrototypeOf","String","prototype","select","initialize","update","defaultMargin","right","bottom","presentedDatasetGroups","presentedStacks","labelColor","rgbString","type","ChartType","Bar","isShowLabels","isCombineStacks","numberFormat","Intl","NumberFormat","maximumFractionDigits","getBoolean","_datasets","forEach","dataset","isEnabled","beforeDrawChart","drawChart","afterDrawChart","configureChart","calculatePresentedDatasets","calculateListOfDatasetNames","calculateListOfYears","calculateListOfStacks","calculateFlattenData","calculateDatasetsPerYear","calculateColors","calculateDatasetStacks","createSVG","createGraph","createScales","createAxis","renderAxis","renderGrid","renderStacks","renderLegend","renderMethod","renderBars","renderLine","graphWidth","graphHeight","presentedDatasets","filter","datasetRef","datasetsPerYearRef","presentedDatasetsPerYear","datasetStacks","listOfStacks","map","stackName","index","stackCandidates","candidatesNames","stackCandidate","candidatesColors","color","keys","allDatasetStacks","listOfAllStacks","datasetsPerYear","temporaryMap","Array","Set","temporaryMap2","listOfYears","item","listOfDatasetNames","flattenData","yearSet","entry","total","key","flat","removeSVG","svg","svgID","Image","graph","serie","values","xChart","scaleBand","domain","rangeRound","paddingInner","xDataset","bandwidth","padding","xStack","yChart","scaleLinear","nice","xAxisGrid","axisBottom","tickSize","tickFormat","yAxisGrid","axisLeft","ticks","call","renderBarLabels","xChartRef","yChartRef","xStackRef","enter","d","numberOfSeries","serieIndex","format","datasetGroups","debug","datum","line","x0","y0","curve","curveMonotoneX","dots","tooltip","searchText","relativeValue","pageX","pageY","renderLineLabels","renderCombinedStacksLegend","renderNormalLegend","datasetNames","xLegend","legends","legendsTexts","getSumForWord","innerHTML","split","toggleDataset","stackNames","getSumForStack","find","word","sum","Line","DiachronicChartSettingsPopup","renderShowLabelsCheckbox","renderCombineStacksCheckbox","renderRadios","container","showLabelsCheckbox","diachronicChart","combineStacksCheckbox","typeRadioGroup","screenshotElement","querySelector","html2canvas","canvas","link","createElement","setAttribute","toDataURL","appendChild","click","DiachronicChartCard","renderChart","renderScreenshotButton","renderMoreActionsButton","applyURLParameters","chart","chartID","screenshotButton","moreActionButton","presentSettingsPopup","getString","settingsPopup","showUnder","RecentSearchesLocalStorageKey","RecentSearches","loadFromLocalStorage","removeIfExisting","insert","storeToLocalStorage","splice","removeDispensableValues","tooMuch","wordlist","localStorage","getItem","setItem","join","SearchField","datalistId","datalist","onEnter","updateRecentSearches","recentSearches","Dropdown","selectId","renderSelect","removeAllInputs","argument","callback","optionID","undefined","LoadingView","InnovationListPopup","dataDidLoad","reducedData","components","variations","some","searchCard","searchField","startSearching","SearchCard","renderSearchField","renderCaseSensitiveDropdown","renderRangeDropdown","renderRelativeAbsolute","renderPresentInnovationListPopupButton","renderSearchButton","searchFieldContainer","caseSensetiveGroupContainer","sensitivityDropdown","yearStartContainer","yearStartDropdown","setLabelText","setOnChange","yearEndContainer","yearEndDropdown","container2","valueRadioGroup","presentInnovationListPopupButton","searchButton","getText","sensitivity","firstYear","lastYear","GeoJson","source","features","featureSource","feature","Feature","allCoordinates","extractAllCoordinates","latitudeSum","longitudeSum","coordinates","geometryCollection","geometry","Error","geometries","extractGeometryCollection","coordinatesCollection","coordinate","polygonCoordinates","featureCoordinates","properties","Geometry","flattenDatasets","flattenList","dlabel","combineDataByLabel","combined","listItem","entryItem","MapChart","initializeProjection","initializePath","renderSVG","renderMapBackground","renderTooltipContainer","tintColor","backgroundColor","backgroundOpacity","isDrawsBackground","isZoomable","geoJSON","departmentsData","excludedFeatureCodes","projection","geoMercator","path","geoPath","background","bounds","legend","center","geoCentroid","code","departmentNumber","boundsRectangle","propertyName","capitalize","datasetName","tooltipWidth","tooltipHeight","featureBounds","geoBounds","featureLowerLeft","featureUpperRight","featureBoundsWidth","featureBoundsHeight","effectiveSize","getElementEffectiveSize","widthFactor","heightFactor","positionOffset","getElementPosition","centerBottom","getStackNames","combinedData","dataForStack","datasetEntry","combine","raise","offset","steps","fitSize","geoJSONDidChange","datasetsDidChange","geoJSONURL","json","rawJSON","setGeoJSON","newGeoJSON","newDatasets","removeExcludedFeatures","zoomTo","renderGeoJson","renderDatasets","renderDatasetLabels","renderDatasetsLegend","candidate","candidateIndex","Slider","renderMinLabel","renderMaxLabel","renderValueLabel","minLabel","range","valueLabel","maxLabel","minimum","newMin","maximum","newMax","MapChartSettingsPopup","mapChart","MapChartCard","renderMenuItems","renderMapChart","slider","centerButton","hide","setFontAwesomeImage","screenshotButtonAction","moreButton","presentSettingsPopupAction","loadGeoJSON","TrackPopup","renderHeadline","renderTrackContentContainer","lyricsContainer","track","input","searchWord","lines","words","j","toLowerCase","WordAboutCard","divs","sort","item1","item2","descending","releaseYear","artist","DatasetCollection","SearchPage","makeContainerFull","renderSettingsButton","renderSearchInputCard","renderDiachronicChart","renderWordAboutCard","loadCorpusIfNeeded","settingsButton","searchCardContainer","diachronicChartCardContainer","mapCardContainer","wordAboutCardContainer","getSearchText","save","useFullWidthMode","useHalfWidthMode","viewModeKey","parameters","viewModeURL","viewModeLocalStorage","trim","searchFor","searchQuery","groups","group","searchTextFormatted","localDatasets","mapDatasets","trackDatasets","datasetObject","datasetFor","chartData","mapData","tracks","newDataset","mapDataset","corpus","tracksForWord","getMapDataForTracks","getChartDataForTracks","departementNumber","numberOfLyrics","departement","getDepartementForNumber","drawDepartement","CorpusDataPage","createLeftPanel","createCard","cardBody","leftPanel","wrapper","cardBodyRow","clearContent","currentGroup","createGroup","createLine","artists","femaleArtists","maleArtists","groupArtists","allAlbums","allTracksWithoutAlbum","allTracks","allWords","endsWith","MainPage","renderLeftTitleComponent","hideBackButton","fetchServerInfo","titleContainer","delegate","titleInfoBox","menuCard","pages","pageItem","pageId","pageTitle","addMenuButton","functionToCall","fetch","response","versionLabel","application_version","environmentLabel","environment","DiachronicAboutPage","buildSubpage","renderContentRadioGroup","chartWrapper","chartCard","radioGroup","showLoadingView","hideLoadingView","setCorpus","yearCollection","getLyricsPerYear","getWordsPerYear","getWordsPerYearRelative","getTypesPerYear","getTypesPerYearRelative","getTotalNonStandardPerYearCount","min","charAt","toUpperCase","slice","ArtistsDataPage","createContentTypeRadioGroup","valueGettingFunction","numberOfTypes","renderTooltip","lineHeight","chartView","colorString","geniusId","barGroup","ratio","xPos","yPos","cardContainer","chartTypeAction","numberOfWords","numberOfTracks","numberOfAlbums","size","albums","hierarchy","reverse","artistName","departementNo","a","countAll","countFiltered","buildVisual","LocationDataPage","loadGeoJSONFromDelegate","mapChartContainer","departmentData","getDepartementsData","departmentName","setDatasets","showLabels","DataDelegate","DefaultDataDelegate","willInitialize","didInitialize","frcvConfig","loadPage","updateHistory","clearContainer","clear","currentPageSelector","AboutPage","completion","isLoading","isFetchingDepartements","departements","deptCode","Pages","exports"],"mappings":"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"}